{
  ObjectMapper mapper=new ObjectMapper();
  if (value.startsWith("Struct")) {
    DocStructExample struct=new DocStructExample(DocPartName.unknown(),value);
    packer.packStructHeader(struct.size(),(byte)struct.signature());
    for (    String s : struct) {
      pack(s,packer,writer);
    }
  }
 else   if (value.equals("FAILURE { \"code\": \"Neo.ClientError.Statement.InvalidSyntax\",                  \"message\": \"Invalid input 'T': expected" + " <init> (line 1, column 1 (offset: 0))                          \"This will cause a syntax error\"                          " + " ^\"}")) {
    writer.handleFailureMessage(Status.Statement.InvalidSyntax,"Invalid input 'T': expected <init> (line 1, column 1 (offset: 0))\n" + "\"This will cause a syntax error\"\n" + " ^");
  }
 else {
    try {
      Object scalar=mapper.readValue(value,Object.class);
      packer.pack(scalar);
    }
 catch (    JsonParseException e) {
      String[] parts=value.split(" ",2);
      List<Object> args=new ArrayList<>();
      String type=parts[0];
      if (parts.length == 2) {
        JsonParser parser=mapper.getJsonFactory().createJsonParser(new ByteArrayInputStream(parts[1].getBytes(StandardCharsets.UTF_8)));
        try {
          while (!parser.isClosed()) {
            Object e1=mapper.readValue(parser,Object.class);
            args.add(e1);
          }
        }
 catch (        EOFException ignore) {
        }
catch (        JsonParseException je) {
          throw new RuntimeException("Unable to parse documented protocol exchange in '" + value + "': "+ je.getMessage(),je);
        }
      }
switch (type) {
case "DISCARD_ALL":
        writer.handleDiscardAllMessage();
      break;
case "PULL_ALL":
    writer.handlePullAllMessage();
  break;
case "IGNORED":
writer.handleIgnoredMessage();
break;
case "RUN":
writer.handleRunMessage((String)args.get(0),(Map<String,Object>)args.get(1));
break;
case "RECORD":
writer.handleRecordMessage(new ImmutableRecord(Iterables.toArray(Object.class,(List<Object>)args.get(0))));
break;
case "SUCCESS":
writer.handleSuccessMessage((Map<String,Object>)args.get(0));
break;
case "FAILURE":
Map<String,Object> meta=(Map<String,Object>)args.get(0);
writer.handleFailureMessage(Neo4jError.codeFromString((String)meta.get("code")),(String)meta.get("message"));
break;
case "INIT":
writer.handleInitMessage((String)args.get(0),(Map<String,Object>)args.get(1));
break;
case "RESET":
writer.handleResetMessage();
break;
default :
throw new RuntimeException("Unknown value: " + type);
}
}
}
}
