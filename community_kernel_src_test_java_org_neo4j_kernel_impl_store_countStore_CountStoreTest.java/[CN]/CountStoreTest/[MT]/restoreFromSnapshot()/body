{
  CountStore countStore=new CountStore();
  Map<CountsKey,long[]> update=new HashMap<>();
  NodeKey keyA=CountsKeyFactory.nodeKey(1);
  NodeKey keyB=CountsKeyFactory.nodeKey(2);
  NodeKey keyC=CountsKeyFactory.nodeKey(3);
  update.put(keyA,new long[]{1});
  countStore.updateAll(1,update);
  update.clear();
  update.put(keyB,new long[]{1});
  countStore.updateAll(2,update);
  update.clear();
  update.put(keyC,new long[]{1});
  countStore.updateAll(3,update);
  Snapshot snapshot=countStore.snapshot(3);
  long beforeTxId=snapshot.getTxId();
  Assert.assertEquals(3,beforeTxId);
  countStore=new CountStore(snapshot);
  Snapshot secondSnapshot=countStore.snapshot(3);
  Assert.assertEquals(3,secondSnapshot.getTxId());
  update.put(keyC,new long[]{1});
  countStore.updateAll(4,update);
  Snapshot thirdSnapshot=countStore.snapshot(4);
  Assert.assertEquals(4,thirdSnapshot.getTxId());
}
