{
  return new GraphDatabaseBuilder.DatabaseCreator(){
    @Override @SuppressWarnings("deprecation") public GraphDatabaseService newDatabase(    Map<String,String> config){
      return new ImpermanentGraphDatabase(storeDir,config,state.databaseDependencies()){
        @Override protected FileSystemAbstraction createFileSystemAbstraction(){
          FileSystemAbstraction fs=state.getFileSystem();
          if (fs != null) {
            return fs;
          }
 else {
            return super.createFileSystemAbstraction();
          }
        }
        @Override protected LogService createLogService(){
          final LogProvider internalLogProvider=state.getInternalLogProvider();
          if (internalLogProvider == null) {
            return super.createLogService();
          }
          final LogProvider userLogProvider=state.databaseDependencies().userLogProvider();
          return new AbstractLogService(){
            @Override public LogProvider getUserLogProvider(){
              return userLogProvider;
            }
            @Override public LogProvider getInternalLogProvider(){
              return internalLogProvider;
            }
          }
;
        }
      }
;
    }
  }
;
}
