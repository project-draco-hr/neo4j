{
  return new GraphDatabaseBuilder.DatabaseCreator(){
    @Override @SuppressWarnings("deprecation") public GraphDatabaseService newDatabase(    Map<String,String> config){
      config.put(GraphDatabaseSettings.store_dir.name(),storeDir);
      return new CommunityFacadeFactory(){
        @Override protected PlatformModule createPlatform(        Map<String,String> params,        Dependencies dependencies,        GraphDatabaseFacade graphDatabaseFacade){
          return new ImpermanentGraphDatabase.ImpermanentPlatformModule(params,dependencies,graphDatabaseFacade){
            @Override protected FileSystemAbstraction createFileSystemAbstraction(){
              FileSystemAbstraction fs=state.getFileSystem();
              if (fs != null) {
                return fs;
              }
 else {
                return super.createFileSystemAbstraction();
              }
            }
            @Override protected LogService createLogService(            LogProvider logProvider){
              final LogProvider internalLogProvider=state.getInternalLogProvider();
              if (internalLogProvider == null) {
                return super.createLogService(logProvider);
              }
              final LogProvider userLogProvider=state.databaseDependencies().userLogProvider();
              return new AbstractLogService(){
                @Override public LogProvider getUserLogProvider(){
                  return userLogProvider;
                }
                @Override public LogProvider getInternalLogProvider(){
                  return internalLogProvider;
                }
              }
;
            }
          }
;
        }
      }
.newFacade(config,GraphDatabaseDependencies.newDependencies(state.databaseDependencies()));
    }
  }
;
}
