{
  return new TestGraphDatabaseBuilder(new GraphDatabaseBuilder.DatabaseCreator(){
    @Override public GraphDatabaseService newDatabase(    Map<String,String> config){
      return new ImpermanentGraphDatabase(storeDir,config,indexProviders,kernelExtensions,cacheProviders,txInterceptorProviders){
        @Override protected FileSystemAbstraction createFileSystemAbstraction(){
          if (TestGraphDatabaseFactory.this.fileSystem != null)           return TestGraphDatabaseFactory.this.fileSystem;
 else           return super.createFileSystemAbstraction();
        }
        @Override protected Logging createLogging(){
          if (TestGraphDatabaseFactory.this.systemOutLogging)           return new SingleLoggingService(StringLogger.SYSTEM);
 else           return super.createLogging();
        }
      }
;
    }
  }
);
}
