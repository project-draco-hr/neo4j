{
  ArrayList<CacheProvider> cacheList=new ArrayList<>();
  TestGraphDatabaseFactory gdbf=new TestGraphDatabaseFactory();
  CacheProvider cacheProvider=new SoftCacheProvider();
  CapturingCacheProvider capturingProvider=new CapturingCacheProvider(cacheProvider);
  cacheList.add(capturingProvider);
  gdbf.setCacheProviders(cacheList);
  GraphDatabaseAPI db=(GraphDatabaseAPI)gdbf.newImpermanentDatabase();
  try {
    assertTrue(capturingProvider.nodeCacheCalled);
    assertTrue(capturingProvider.relCacheCalled);
  }
  finally {
    db.shutdown();
  }
}
