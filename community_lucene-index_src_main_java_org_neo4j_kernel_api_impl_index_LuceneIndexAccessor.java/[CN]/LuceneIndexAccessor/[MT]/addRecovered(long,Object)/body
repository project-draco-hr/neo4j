{
  IndexSearcher searcher=searcherManager.acquire();
  try {
    TopDocs hits=searcher.search(new TermQuery(documentStructure.newQueryForChangeOrRemove(nodeId)),1);
    if (hits.totalHits > 0) {
      Fieldable encodedValue=documentStructure.encodeAsFieldable(value);
      writer.updateDocument(documentStructure.newQueryForChangeOrRemove(nodeId),documentStructure.newDocumentRepresentingProperty(nodeId,encodedValue));
    }
 else {
      add(nodeId,value);
    }
  }
  finally {
    searcherManager.release(searcher);
  }
}
