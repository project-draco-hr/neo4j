{
  if (readOnly) {
    throw new UnsupportedOperationException("Index drop is unsupported in read only mode.");
  }
  taskCoordinator.cancel();
  closeIndexResources();
  try {
    taskCoordinator.awaitCompletion();
  }
 catch (  InterruptedException e) {
    throw new IOException("Interrupted while waiting for concurrent tasks to complete.",e);
  }
  deleteDirectoryContents(dir);
}
