{
  this.documentStructure=documentStructure;
  this.readOnly=readOnly;
  this.indexFolder=indexFolder;
  this.bufferSizeLimit=bufferSizeLimit;
  this.dir=dirFactory.open(indexFolder);
  if (readOnly) {
    try {
      this.writer=null;
      searcherManager=new LuceneReferenceManager.Wrap<>(new SearcherManager(dir,new SearcherFactory()));
    }
 catch (    IndexNotFoundException e) {
      throw new IllegalStateException("Index creation is not supported in read only mode.",e);
    }
  }
 else {
    this.writer=indexWriterFactory.create(dir);
    this.searcherManager=new LuceneReferenceManager.Wrap<>(writer.createSearcherManager());
  }
}
