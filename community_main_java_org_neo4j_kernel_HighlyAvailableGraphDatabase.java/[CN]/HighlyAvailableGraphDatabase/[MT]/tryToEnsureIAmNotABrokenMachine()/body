{
  try {
    if (broker.thisIsMaster()) {
      return;
    }
    XaDataSource nioneoDataSource=this.localGraph.getConfig().getTxModule().getXaDataSourceManager().getXaDataSource(Config.DEFAULT_DATA_SOURCE_NAME);
    long lastCommittedTx=nioneoDataSource.getLastCommittedTxId();
    int masterForMyLastCommittedTx=nioneoDataSource.getMasterForCommittedTx(lastCommittedTx);
    Master master=broker.getMaster();
    int masterForMastersLastCommittedTx=master.getMasterIdForCommittedTx(lastCommittedTx);
    if (masterForMastersLastCommittedTx == masterForMyLastCommittedTx) {
      broker.setLastCommittedTxId(lastCommittedTx);
      return;
    }
 else {
      msgLog.logMessage("Broken store, my last committed tx,machineId[" + lastCommittedTx + ","+ masterForMyLastCommittedTx+ "] but master says machine id for that txId is "+ masterForMastersLastCommittedTx);
      throw new RuntimeException("I am broken");
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
