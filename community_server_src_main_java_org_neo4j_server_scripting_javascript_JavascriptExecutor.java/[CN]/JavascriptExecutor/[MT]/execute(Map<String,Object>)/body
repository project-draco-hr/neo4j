{
  Context cx=Context.enter();
  try {
    Scriptable scope=cx.newObject(prototype);
    scope.setPrototype(prototype);
    if (variables != null) {
      for (      String k : variables.keySet()) {
        scope.put(k,scope,variables.get(k));
      }
    }
    Object out=compiledScript.exec(cx,scope);
    if (out instanceof NativeJavaObject) {
      return ((NativeJavaObject)out).unwrap();
    }
 else     if (out instanceof Undefined) {
      return null;
    }
 else {
      return out;
    }
  }
 catch (  RhinoException e) {
    throw new EvaluationException("Failed to execute script, see nested exception.",e);
  }
 finally {
    Context.exit();
  }
}
