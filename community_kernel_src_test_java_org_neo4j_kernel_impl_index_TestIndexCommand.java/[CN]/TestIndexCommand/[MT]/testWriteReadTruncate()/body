{
  List<XaCommand> commands=createSomeCommands();
  Pair<File,List<Long>> writtenCommands=writeCommandsToFile(commands);
  List<XaCommand> readCommands=readCommandsFromFile(writtenCommands.first());
  Iterator<XaCommand> commandIterator=commands.iterator();
  for (  XaCommand readCommand : readCommands) {
    assertEquals(commandIterator.next(),readCommand);
  }
  for (int i=0; i < commands.size(); i++) {
    long startPosition=writtenCommands.other().get(i);
    long nextStartPosition=i + 1 < commands.size() ? writtenCommands.other().get(i + 1) : writtenCommands.first().length();
    for (long p=startPosition; p < nextStartPosition; p++) {
      File copy=copyAndTruncateFile(writtenCommands.first(),p);
      List<XaCommand> readTruncatedCommands=readCommandsFromFile(copy);
      assertEquals(i,readTruncatedCommands.size());
      FileUtils.deleteFile(copy);
    }
  }
  writtenCommands.first().delete();
}
