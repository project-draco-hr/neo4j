{
  FileInputStream in=null;
  ReadableByteChannel reader=null;
  List<Command> commands;
  try {
    commands=new ArrayList<Command>();
    while (true) {
      Command command=readCommand(channel);
      if (command == null) {
        break;
      }
      commands.add(command);
    }
  }
  finally {
    if (in != null)     in.close();
    if (reader != null)     reader.close();
  }
  return commands;
}
