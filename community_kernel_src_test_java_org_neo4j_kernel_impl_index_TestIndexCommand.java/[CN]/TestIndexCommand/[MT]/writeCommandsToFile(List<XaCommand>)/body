{
  File file=createTempFile("index","command");
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"rw");
  List<Long> startPositions;
  try {
    StoreFileChannel fileChannel=new StoreFileChannel(randomAccessFile.getChannel());
    LogBuffer writeBuffer=new DirectMappedLogBuffer(fileChannel,new Monitors().newMonitor(ByteCounterMonitor.class));
    startPositions=new ArrayList<>();
    for (    XaCommand command : commands) {
      startPositions.add(writeBuffer.getFileChannelPosition());
      writer.write(command,writeBuffer);
    }
    writeBuffer.force();
    fileChannel.close();
  }
  finally {
    randomAccessFile.close();
  }
  return Pair.of(file,startPositions);
}
