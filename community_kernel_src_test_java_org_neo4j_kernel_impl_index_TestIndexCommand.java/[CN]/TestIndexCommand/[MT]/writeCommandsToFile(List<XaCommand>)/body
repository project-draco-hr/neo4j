{
  File file=createTempFile("index","command");
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"rw");
  List<Long> startPositions;
  try {
    FileChannel fileChannel=randomAccessFile.getChannel();
    LogBuffer writeBuffer=new DirectMappedLogBuffer(fileChannel,new Monitors().newMonitor(ByteCounterMonitor.class));
    startPositions=new ArrayList<Long>();
    for (    XaCommand command : commands) {
      startPositions.add(writeBuffer.getFileChannelPosition());
      command.writeToFile(writeBuffer);
    }
    writeBuffer.force();
    fileChannel.close();
  }
  finally {
    randomAccessFile.close();
  }
  return Pair.of(file,startPositions);
}
