{
  File file=createTempFile("index","command");
  FileChannel fileChannel=new RandomAccessFile(file,"rw").getChannel();
  LogBuffer writeBuffer=new DirectMappedLogBuffer(fileChannel,new Monitors().newMonitor(LogBufferMonitor.class));
  List<Long> startPositions=new ArrayList<Long>();
  for (  XaCommand command : commands) {
    startPositions.add(writeBuffer.getFileChannelPosition());
    command.writeToFile(writeBuffer);
  }
  writeBuffer.force();
  fileChannel.close();
  return Pair.of(file,startPositions);
}
