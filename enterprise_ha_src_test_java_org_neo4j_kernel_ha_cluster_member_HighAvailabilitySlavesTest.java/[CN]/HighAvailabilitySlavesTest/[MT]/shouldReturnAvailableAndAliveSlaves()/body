{
  Cluster cluster=mock(Cluster.class);
  ClusterMembers clusterMembers=mock(ClusterMembers.class);
  when(clusterMembers.getMembers()).thenReturn(Iterables.<ClusterMember,ClusterMember>iterable(new ClusterMember(instanceId1).availableAs(HighAvailabilityModeSwitcher.SLAVE,haUri1)));
  SlaveFactory slaveFactory=mock(SlaveFactory.class);
  when(slaveFactory.newSlave((ClusterMember)any())).thenReturn(mock(Slave.class));
  HighAvailabilitySlaves slaves=new HighAvailabilitySlaves(clusterMembers,cluster,slaveFactory);
  slaves.init();
  Iterable<Slave> memberSlaves=slaves.getSlaves();
  Assert.assertThat(count(memberSlaves),CoreMatchers.equalTo(1L));
}
