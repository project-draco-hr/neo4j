{
  URI clusterUri1=new URI("cluster://server1");
  URI haUri1=new URI("ha://server1?serverId=1");
  URI clusterUri2=new URI("cluster://server2");
  URI haUri2=new URI("ha://server2?serverId=2");
  MockedClusterMonitor clusterMonitor=new MockedClusterMonitor();
  MockedHighAvailability highAvailability=new MockedHighAvailability();
  SlaveFactory slaveFactory=mock(SlaveFactory.class);
  HighAvailabilitySlaves slaves=new HighAvailabilitySlaves(clusterMonitor,highAvailability,slaveFactory,new DevNullLoggingService());
  clusterMonitor.listeningAt(clusterUri1);
  highAvailability.masterIsElectedAndAvailable(clusterUri1,haUri1);
  highAvailability.slaveIsAvailable(clusterUri2,haUri2);
  verify(slaveFactory).newSlave(haUri2);
  assertEquals(1,asCollection(slaves.getSlaves()).size());
}
