{
  return new StreamingOutput(){
    public void write(    OutputStream output) throws IOException, WebApplicationException {
      RepresentationFormat outputStreamFormat=streamingFormat.writeTo(output);
      try {
        representation.serialize(outputStreamFormat,baseUri,extensions);
        if (!mustFail)         representationWrittenHandler.onRepresentationWritten();
      }
 catch (      Exception e) {
        if (e instanceof NodeNotFoundException || e instanceof RelationNotFoundException) {
          new WebApplicationException(notFound(e));
        }
        if (e instanceof BadInputException) {
          throw new WebApplicationException(badRequest(e));
        }
        throw new WebApplicationException(serverError(e));
      }
 finally {
        representationWrittenHandler.onRepresentationFinal();
      }
    }
  }
;
}
