{
  final InMemoryRaftLog log=new InMemoryRaftLog();
  RaftMembershipManager<RaftTestMember> membershipManager=new RaftMembershipManager<>(new DirectReplicator(),RaftTestMemberSetBuilder.INSTANCE,log,NullLogProvider.getInstance(),3,1000,new FakeClock(),1000,new InMemoryRaftMembershipState<>());
  log.registerListener(membershipManager);
  log.append(new RaftLogEntry(0,new RaftTestGroup(1,2,3,4)));
  log.commit(0);
  log.append(new RaftLogEntry(0,new RaftTestGroup(1,2,3,5)));
  log.append(new RaftLogEntry(0,new RaftTestGroup(1,2,3,6)));
  log.truncate(log.appendIndex());
  assertEquals(new RaftTestGroup(1,2,3,5).getMembers(),membershipManager.votingMembers());
  assertTrue(membershipManager.uncommittedMemberChangeInLog());
}
