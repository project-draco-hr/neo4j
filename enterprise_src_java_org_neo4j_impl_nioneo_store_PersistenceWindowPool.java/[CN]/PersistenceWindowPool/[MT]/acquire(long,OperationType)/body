{
  LockableWindow window=null;
synchronized (activeRowWindows) {
    if (brickMiss >= REFRESH_BRICK_COUNT) {
      brickMiss=0;
      refreshBricks();
    }
    if (brickSize > 0) {
      int brickIndex=(int)(position * blockSize / brickSize);
      if (brickIndex < brickArray.length) {
        window=brickArray[brickIndex].getWindow();
        brickArray[brickIndex].setHit();
      }
 else {
        expandBricks(brickIndex + 1);
        window=brickArray[brickIndex].getWindow();
      }
    }
    if (window == null) {
      miss++;
      brickMiss++;
      PersistenceRow dpw=activeRowWindows.get((int)position);
      if (dpw == null) {
        dpw=new PersistenceRow(position,blockSize,fileChannel);
        if (operationType == OperationType.READ) {
          dpw.readPosition();
        }
      }
      window=dpw;
      activeRowWindows.put((int)position,dpw);
    }
 else {
      hit++;
    }
    window.mark();
  }
  window.lock();
  window.setOperationType(operationType);
  return window;
}
