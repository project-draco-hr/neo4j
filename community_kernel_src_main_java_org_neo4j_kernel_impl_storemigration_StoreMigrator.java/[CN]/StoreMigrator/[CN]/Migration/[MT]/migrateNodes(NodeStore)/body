{
  Iterable<NodeRecord> records=legacyStore.getNodeStoreReader().readNodeStore();
  for (  NodeRecord nodeRecord : records) {
    reportProgress(nodeRecord.getId());
    nodeStore.setHighId(nodeRecord.getId() + 1);
    if (nodeRecord.inUse()) {
      nodeStore.updateRecord(nodeRecord);
    }
 else {
      nodeStore.freeId(nodeRecord.getId());
    }
  }
  legacyStore.getNodeStoreReader().close();
}
