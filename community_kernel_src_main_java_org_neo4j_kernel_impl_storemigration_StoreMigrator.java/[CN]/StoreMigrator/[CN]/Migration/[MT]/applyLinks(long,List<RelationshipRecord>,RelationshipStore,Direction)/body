{
  for (int i=0; i < records.size(); i++) {
    RelationshipRecord record=records.get(i);
    if (i > 0) {
      long previous=records.get(i - 1).getId();
      if (record.getFirstNode() == nodeId) {
        record.setFirstPrevRel(previous);
      }
      if (record.getSecondNode() == nodeId) {
        record.setSecondPrevRel(previous);
      }
    }
 else {
      setDegree(nodeId,record,records.size());
    }
    if (i < records.size() - 1) {
      long next=records.get(i + 1).getId();
      if (record.getFirstNode() == nodeId) {
        record.setFirstNextRel(next);
      }
      if (record.getSecondNode() == nodeId) {
        record.setSecondNextRel(next);
      }
    }
 else {
      if (record.getFirstNode() == nodeId) {
        record.setFirstNextRel(Record.NO_NEXT_RELATIONSHIP.intValue());
      }
      if (record.getSecondNode() == nodeId) {
        record.setSecondNextRel(Record.NO_NEXT_RELATIONSHIP.intValue());
      }
    }
    applyChangesToRecord(nodeId,record,relationshipStore);
    relationshipStore.forceUpdateRecord(record);
  }
}
