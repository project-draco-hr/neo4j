{
  LegacyStore legacyStore=new LegacyStore(fileSystem,new File(storeDir,NeoStore.DEFAULT_NAME));
  ExecutionMonitor executionMonitor=new CoarseBoundedProgressExecutionMonitor(legacyStore.getNodeStoreReader().getMaxId(),legacyStore.getRelStoreReader().getMaxId()){
    @Override protected void percent(    int percent){
      progressMonitor.percentComplete(percent);
    }
  }
;
  BatchImporter importer=new ParallellBatchImporter(migrationDir.getAbsolutePath(),fileSystem,new Configuration.OverrideFromConfig(config),Collections.<KernelExtensionFactory<?>>emptyList(),executionMonitor);
  progressMonitor.started();
  importer.doImport(legacyNodesAsInput(legacyStore),legacyRelationshipsAsInput(legacyStore),NodeIdMapping.actual);
  progressMonitor.finished();
  importer.shutdown();
  legacyStore.close();
}
