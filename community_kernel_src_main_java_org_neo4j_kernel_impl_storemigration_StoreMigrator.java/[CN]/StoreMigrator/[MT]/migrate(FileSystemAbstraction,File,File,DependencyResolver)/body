{
  versionToUpgradeFrom=upgradableDatabase.checkUpgradeable(storeDir);
  progressMonitor.started();
  if (versionToUpgradeFrom.equals(Legacy21Store.LEGACY_VERSION)) {
    migrateByCopyingFile(fileSystem,storeDir,migrationDir);
  }
 else {
    migrateWithBatchImporter(fileSystem,storeDir,migrationDir,dependencyResolver);
  }
  progressMonitor.finished();
}
