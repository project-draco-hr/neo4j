{
  final File storeFileBase=new File(migrationDir,NeoStore.DEFAULT_NAME + StoreFactory.COUNTS_STORE);
  final StoreFactory storeFactory=new StoreFactory(fileSystem,storeDir,pageCache,DEV_NULL,new Monitors(),StoreVersionMismatchHandler.ALLOW_OLD_VERSION);
  try (NodeStore nodeStore=storeFactory.newNodeStore();RelationshipStore relationshipStore=storeFactory.newRelationshipStore()){
    try (Lifespan life=new Lifespan()){
      CountsTracker tracker=life.add(new CountsTracker(logging.getMessagesLog(CountsTracker.class),fileSystem,pageCache,storeFileBase));
      try (CountsAccessor.Updater updater=tracker.updater()){
        CountsComputer.computeCounts(nodeStore,relationshipStore).accept(new CountsAccessor.Initializer(updater));
      }
       tracker.rotate(lastTxId);
    }
   }
 }
