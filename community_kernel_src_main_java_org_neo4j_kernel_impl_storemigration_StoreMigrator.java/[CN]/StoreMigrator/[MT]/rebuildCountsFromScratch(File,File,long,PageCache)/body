{
  final File storeFileBase=new File(migrationDir,NeoStore.DEFAULT_NAME + StoreFactory.COUNTS_STORE);
  final StoreFactory storeFactory=new StoreFactory(fileSystem,storeDir,pageCache,DEV_NULL,new Monitors(),StoreVersionMismatchHandler.ALLOW_OLD_VERSION);
  try (NodeStore nodeStore=storeFactory.newNodeStore();RelationshipStore relationshipStore=storeFactory.newRelationshipStore()){
    try (Lifespan life=new Lifespan()){
      CountsTracker tracker=life.add(new CountsTracker(logging.getMessagesLog(CountsTracker.class),fileSystem,pageCache,storeFileBase));
      CountsComputer.computeCounts(nodeStore,relationshipStore,tracker,(int)storeFactory.getHighId(StoreFile.LABEL_TOKEN_STORE,LabelTokenStore.RECORD_SIZE),(int)storeFactory.getHighId(StoreFile.RELATIONSHIP_TYPE_TOKEN_STORE,RelationshipTypeTokenStore.RECORD_SIZE));
      tracker.rotate(lastTxId);
    }
   }
 }
