{
  progressMonitor.percentComplete(0);
  final FileFilter allButMigrationDir=new FileFilter(){
    @Override public boolean accept(    File pathname){
      return !migrationDir.equals(pathname);
    }
  }
;
  for (  File file : storeDir.listFiles(allButMigrationDir)) {
    final File to=new File(migrationDir,file.getName());
    if (file.isDirectory()) {
      fileSystem.copyRecursively(file,to);
    }
 else {
      fileSystem.copyFile(file,to);
    }
  }
  progressMonitor.percentComplete(50);
  StoreFile.ensureStoreVersion(fileSystem,migrationDir,StoreFile.currentStoreFiles());
  progressMonitor.percentComplete(100);
}
