{
  progressMonitor.started();
  if (versionToUpgradeFrom(fileSystem,storeDir).equals(Legacy21Store.LEGACY_VERSION)) {
    ensureStoreVersions(storeDir);
    rebuildCountsFromScratch(storeDir,migrationDir);
  }
 else {
    migrateWithBatchImporter(storeDir,migrationDir);
    rebuildCountsFromScratch(migrationDir,migrationDir);
  }
  legacyLogs.migrateLogs(storeDir,migrationDir);
  progressMonitor.finished();
}
