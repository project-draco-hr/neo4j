{
  LoggerContext loggerContext=new LoggerContext();
  loggerContext.putProperty("host",serverId.toString());
  JoranConfigurator configurator=new JoranConfigurator();
  configurator.setContext(loggerContext);
  try {
    configurator.doConfigure(getClass().getResource("/test-logback.xml"));
  }
 catch (  JoranException e) {
    throw new IllegalStateException("Failed to configure logging",e);
  }
  Logging logging=new LogbackService(null,loggerContext);
  ProtocolServerFactory protocolServerFactory=new MultiPaxosServerFactory(new ClusterConfiguration("default"),logging);
  ServerIdElectionCredentialsProvider electionCredentialsProvider=new ServerIdElectionCredentialsProvider();
  electionCredentialsProvider.listeningAt(serverId);
  TestProtocolServer protocolServer=new TestProtocolServer(timeoutStrategy,protocolServerFactory,serverId,new InMemoryAcceptorInstanceStore(),electionCredentialsProvider);
  protocolServer.addStateTransitionListener(new StateTransitionLogger(logging));
  return protocolServer;
}
