{
  ProtocolServerFactory protocolServerFactory=new MultiPaxosServerFactory(new ClusterConfiguration("default",logProvider),logProvider,monitors.newMonitor(StateMachines.Monitor.class));
  ServerIdElectionCredentialsProvider electionCredentialsProvider=new ServerIdElectionCredentialsProvider();
  electionCredentialsProvider.listeningAt(serverUri);
  TestProtocolServer protocolServer=new TestProtocolServer(logProvider,timeoutStrategy,protocolServerFactory,serverUri,new InstanceId(serverId),new InMemoryAcceptorInstanceStore(),electionCredentialsProvider);
  protocolServer.addStateTransitionListener(new StateTransitionLogger(logProvider));
  return protocolServer;
}
