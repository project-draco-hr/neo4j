{
  acquireExclusiveLockInThisThread();
  CountDownLatch firstLockAcquired=new CountDownLatch(1);
  LockAcquisition acquisition=tryAcquireTwoLocksLockInAnotherThread(shared,firstLockAcquired);
  await(firstLockAcquired);
  assertThreadIsWaitingForLock(acquisition);
  assertLocksHeld(RESOURCE_ID,OTHER_RESOURCE_ID);
  acquisition.terminate();
  assertLockAcquisitionFailed(acquisition);
  assertLocksHeld(RESOURCE_ID);
  releaseAllLocksInThisThread();
  assertNoLocksHeld();
}
