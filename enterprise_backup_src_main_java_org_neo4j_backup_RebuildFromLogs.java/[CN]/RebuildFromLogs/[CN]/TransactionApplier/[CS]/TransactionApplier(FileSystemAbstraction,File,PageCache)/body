{
  this.fs=fs;
  this.graphdb=BackupService.startTemporaryDb(dbDirectory.getAbsolutePath(),pageCache,stringMap());
  DependencyResolver resolver=graphdb.getDependencyResolver();
  this.neoStore=resolver.resolveDependency(NeoStore.class);
  this.storeApplier=resolver.resolveDependency(TransactionRepresentationStoreApplier.class).withLegacyIndexTransactionOrdering(IdOrderingQueue.BYPASS);
  this.indexingService=resolver.resolveDependency(IndexingService.class);
  KernelHealth kernelHealth=resolver.resolveDependency(KernelHealth.class);
  this.indexUpdatesValidator=new OnlineIndexUpdatesValidator(neoStore,kernelHealth,new PropertyLoader(neoStore),indexingService,IndexUpdateMode.BATCHED);
}
