{
  final AtomicLong txId=new AtomicLong();
  try {
    FileChannel channel=new RandomAccessFile(new File(storeDir,logFileName),"r").getChannel();
    try {
      ByteBuffer buffer=ByteBuffer.allocateDirect(9 + Xid.MAXGTRIDSIZE + Xid.MAXBQUALSIZE * 10);
      txId.set(LogEntryReaderv1.readLogHeader(buffer,channel,true)[1]);
      XaCommandReader reader=new PhysicalLogNeoXaCommandReader(buffer);
      LogDeserializer deserializer=new LogDeserializer(new Monitors().newMonitor(ByteCounterMonitor.class),buffer,reader);
      Cursor<LogEntry,IOException> cursor=deserializer.cursor(channel);
      Consumer<LogEntry,IOException> consumer=new Consumer<LogEntry,IOException>(){
        @Override public boolean accept(        LogEntry entry) throws IOException {
          if (entry instanceof LogEntry.Commit) {
            txId.set(((LogEntry.Commit)entry).getTxId());
          }
          return true;
        }
      }
;
      while (cursor.next(consumer))       ;
    }
  finally {
      if (channel != null) {
        channel.close();
      }
    }
  }
 catch (  IOException e) {
    return -1;
  }
  return txId.get();
}
