{
  LogExtractor extractor=null;
  try {
    extractor=LogExtractor.from(FS,new XaCommandReaderFactory(){
      @Override public XaCommandReader newInstance(      ByteBuffer scratch){
        return new PhysicalLogNeoXaCommandReader(scratch);
      }
    }
,new XaCommandWriterFactory(){
      @Override public XaCommandWriter newInstance(){
        return new PhysicalLogNeoXaCommandWriter();
      }
    }
,sourceDir,new Monitors().newMonitor(ByteCounterMonitor.class));
    for (InMemoryLogBuffer buffer=new InMemoryLogBuffer(); ; buffer.reset()) {
      long txId=extractor.extractNext(buffer);
      if (txId == -1) {
        break;
      }
      applyTransaction(txId,buffer);
      progress.set(txId);
    }
  }
  finally {
    if (extractor != null) {
      extractor.close();
    }
    progress.done();
  }
  return this;
}
