{
  if (valid || transitions.isEmpty()) {
    if (!includeUnchanged && transition.getOldState().equals(transition.getNewState()))     return;
    if (transitions.isEmpty()) {
      valid=false;
      transitionHistory.add("UNEXPECTED:" + transition);
    }
 else {
      ExpectedTransition expected=transitions.pop();
      if (expected.matches(transition)) {
        transitionHistory.add(expected.toString());
      }
 else {
        transitionHistory.add("EXPECTED " + expected + ", GOT "+ transition);
        valid=false;
      }
    }
  }
}
