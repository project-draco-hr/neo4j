{
  Transaction transaction=mock(Transaction.class);
  GraphDatabaseService db=mock(GraphDatabaseService.class);
  when(db.beginTx()).thenReturn(transaction);
  ProgressListener progress=mock(ProgressListener.class);
  BatchTransaction tx=beginBatchTx(db).withIntermediarySize(10).withProgress(progress);
  tx.increment();
  tx.increment(9);
  verify(db,times(2)).beginTx();
  verify(transaction,times(1)).close();
  verify(progress,times(1)).add(1);
  verify(progress,times(1)).add(9);
}
