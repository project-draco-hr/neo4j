{
  params.put(GraphDatabaseSettings.store_dir.name(),dataDir.getPath());
  Config config=new Config(params,GraphDatabaseSettings.class);
  File baseLogPath=config.get(GraphDatabaseSettings.logical_log);
  XaLogicalLogFiles logFiles=new XaLogicalLogFiles(baseLogPath,fs);
  File log;
switch (logFiles.determineState()) {
case CLEAN:
    return false;
case NO_ACTIVE_FILE:
case DUAL_LOGS_LOG_1_ACTIVE:
case DUAL_LOGS_LOG_2_ACTIVE:
  return true;
case LEGACY_WITHOUT_LOG_ROTATION:
log=baseLogPath;
break;
case LOG_1_ACTIVE:
log=logFiles.getLog1FileName();
break;
case LOG_2_ACTIVE:
log=logFiles.getLog2FileName();
break;
default :
return true;
}
FileChannel logChannel=null;
try {
logChannel=fs.open(log,"r");
return new XaLogicalLogRecoveryCheck(logChannel).recoveryRequired();
}
  finally {
if (logChannel != null) {
logChannel.close();
}
}
}
