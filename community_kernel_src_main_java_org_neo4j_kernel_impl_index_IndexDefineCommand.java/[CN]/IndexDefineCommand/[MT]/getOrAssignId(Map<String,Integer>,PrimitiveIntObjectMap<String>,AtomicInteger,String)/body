{
  if (string == null) {
    return -1;
  }
  Integer id=stringToId.get(string);
  if (id != null) {
    return id;
  }
  int nextIdInt=nextId.incrementAndGet();
  if ((nextIdInt & ~0xFFFF) != 0) {
    throw new IllegalStateException(format("Modifying more than %d indexes in a single transaction is not supported",(int)(pow(2,16) - 1)));
  }
  id=nextIdInt;
  stringToId.put(string,id);
  idToString.put(id,string);
  return id;
}
