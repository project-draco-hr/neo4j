{
  if (string == null) {
    return -1;
  }
  Integer id=stringToId.get(string);
  if (id != null) {
    return id;
  }
  int nextIdInt=nextId.incrementAndGet();
  if (nextIdInt > HIGHEST_POSSIBLE_ID || stringToId.size() >= HIGHEST_POSSIBLE_ID) {
    throw new IllegalStateException(format("Modifying more than %d indexes or keys in a single transaction is not supported",HIGHEST_POSSIBLE_ID + 1));
  }
  id=nextIdInt;
  stringToId.put(string,id);
  idToString.put(id,string);
  return id;
}
