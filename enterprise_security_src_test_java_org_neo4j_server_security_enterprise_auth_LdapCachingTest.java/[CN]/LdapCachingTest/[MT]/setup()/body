{
  InternalFlatFileRealm internalFlatFileRealm=new InternalFlatFileRealm(new InMemoryUserRepository(),new InMemoryRoleRepository(),new BasicPasswordPolicy(),new RateLimitedAuthenticationStrategy(Clock.systemUTC(),3));
  testRealm=new TestRealm(getLdapConfig(),NullLogProvider.getInstance());
  List<Realm> realms=listOf(internalFlatFileRealm,testRealm);
  fakeClock=Clocks.fakeClock();
  authManager=new MultiRealmAuthManager(internalFlatFileRealm,realms,new AuthCache.Manager(fakeClock,100,10));
  authManager.init();
  authManager.start();
  authManager.getUserManager().newUser("mike","123",false);
  authManager.getUserManager().newUser("mats","456",false);
}
