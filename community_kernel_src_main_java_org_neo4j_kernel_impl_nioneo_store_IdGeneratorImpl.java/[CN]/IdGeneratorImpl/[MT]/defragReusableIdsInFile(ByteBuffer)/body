{
  if (readPosition > HEADER_SIZE) {
    long writePosition=HEADER_SIZE;
    long position=Math.min(readPosition,maxReadPosition);
    int bytesRead;
    do {
      writeBuffer.clear();
      fileChannel.position(position);
      bytesRead=fileChannel.read(writeBuffer);
      position+=bytesRead;
      writeBuffer.flip();
      fileChannel.position(writePosition);
      writePosition+=fileChannel.write(writeBuffer);
    }
 while (bytesRead > 0);
    fileChannel.truncate(writePosition);
  }
}
