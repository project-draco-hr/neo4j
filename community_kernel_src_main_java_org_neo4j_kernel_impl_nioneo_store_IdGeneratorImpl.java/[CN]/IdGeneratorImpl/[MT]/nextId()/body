{
  assertStillOpen();
  long nextDefragId=nextIdFromDefragList();
  if (nextDefragId != -1) {
    return nextDefragId;
  }
  long id=nextFreeId.get();
  if (id == INTEGER_MINUS_ONE) {
    id=nextFreeId.incrementAndGet();
  }
  assertIdWithinCapacity(id);
  nextFreeId.incrementAndGet();
  return id;
}
