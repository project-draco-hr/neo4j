{
  ThreadLink threadLink=new ThreadLink(Thread.currentThread());
  threadLink.next=threadLinkHead.getAndSet(threadLink);
  boolean attemptedForce=false;
  try (LogForceWaitEvent logForceWaitEvent=logForceEvents.beginLogForceWait()){
    do {
      if (forceLock.tryLock()) {
        attemptedForce=true;
        try {
          forceLog(logForceEvents);
        }
  finally {
          forceLock.unlock();
          ThreadLink nextWaiter=threadLinkHead.get();
          nextWaiter.unpark();
        }
      }
 else {
        waitForLogForce();
      }
    }
 while (!threadLink.done);
    if (!attemptedForce) {
      databaseHealth.assertHealthy(IOException.class);
    }
  }
 }
