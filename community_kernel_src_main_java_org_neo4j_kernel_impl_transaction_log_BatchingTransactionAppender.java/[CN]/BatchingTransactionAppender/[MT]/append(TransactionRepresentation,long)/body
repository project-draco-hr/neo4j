{
synchronized (logFile) {
    long transactionId=transactionIdStore.nextCommittingTransactionId();
    if (transactionId != expectedTransactionId) {
      throw new ThisShouldNotHappenError("Zhen Li and Mattias Persson","Received " + transaction + " with txId:"+ expectedTransactionId+ " to be applied, but appending it ended up generating an unexpected txId:"+ transactionId);
    }
    return appendToLog(transaction,transactionId);
  }
}
