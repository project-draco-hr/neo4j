{
synchronized (logFile) {
    long transactionId=transactionIdStore.nextCommittingTransactionId();
    if (transactionId != expectedTransactionId) {
      IllegalStateException illegalStateException=new IllegalStateException("Received " + transaction + " with txId:"+ expectedTransactionId+ " to be applied, but appending it ended up generating an unexpected txId:"+ transactionId);
      kernelHealth.panic(illegalStateException);
      throw illegalStateException;
    }
    return appendToLog(transaction,transactionId);
  }
}
