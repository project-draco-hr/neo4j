{
  if (!backupSlave) {
    throw new IllegalStateException("This is not a backup slave");
  }
  if (xidIdentMap.size() > 0) {
    throw new IllegalStateException("There are active transactions");
  }
  buffer.clear();
  buffer.limit(16);
  if (byteChannel.read(buffer) != 16) {
    throw new IOException("Unable to read log version");
  }
  buffer.flip();
  logVersion=buffer.getLong();
  long previousCommittedTx=buffer.getLong();
  if (logVersion != xaTf.getCurrentVersion()) {
    throw new IllegalStateException("Tried to apply version " + logVersion + " but expected version "+ xaTf.getCurrentVersion());
  }
  log.fine("Logical log version: " + logVersion + "(previous committed tx="+ previousCommittedTx+ ")");
  long logEntriesFound=0;
  LogApplier logApplier=new LogApplier(byteChannel);
  while (logApplier.readAndApplyEntry()) {
    logEntriesFound++;
  }
  byteChannel.close();
  xaTf.flushAll();
  xaTf.getAndSetNewVersion();
  xaRm.reset();
  log.info("Log[" + fileName + "] version "+ logVersion+ " applied successfully.");
}
