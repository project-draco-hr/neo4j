{
  when(runner.run(any(SessionState.class),anyString(),anyMap())).thenReturn(mock(RecordStream.class));
  machine.init("FunClient/1.2",Collections.<String,Object>emptyMap(),null,Session.Callback.NO_OP);
  machine.run("RETURN 1",Collections.EMPTY_MAP,null,Session.Callback.NO_OP);
  TestCallback callback=new TestCallback();
  machine.reset(null,callback);
  assertThat(machine.state(),equalTo(SessionStateMachine.State.IDLE));
  assertThat(callback.completedCount,equalTo(1));
}
