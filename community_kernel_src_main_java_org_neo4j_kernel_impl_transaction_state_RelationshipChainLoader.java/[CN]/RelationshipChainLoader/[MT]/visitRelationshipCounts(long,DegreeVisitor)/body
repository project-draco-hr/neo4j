{
  NodeRecord node=nodeStore.getRecord(nodeId);
  long nextRecord=node.getNextRel();
  if (Record.NO_NEXT_RELATIONSHIP.is(nextRecord)) {
    return;
  }
  if (!node.isDense()) {
    throw new UnsupportedOperationException("non-dense nodes should be handled by the cache layer");
  }
  while (!Record.NO_NEXT_RELATIONSHIP.is(nextRecord)) {
    RelationshipGroupRecord group=relationshipGroupStore.getRecord(nextRecord);
    nextRecord=group.getNext();
    int outgoing=getRelationshipCount(node,group.getFirstOut());
    int incoming=getRelationshipCount(node,group.getFirstIn());
    int loops=getRelationshipCount(node,group.getFirstLoop());
    visitor.visitDegree(group.getType(),outgoing + loops,incoming + loops);
  }
}
