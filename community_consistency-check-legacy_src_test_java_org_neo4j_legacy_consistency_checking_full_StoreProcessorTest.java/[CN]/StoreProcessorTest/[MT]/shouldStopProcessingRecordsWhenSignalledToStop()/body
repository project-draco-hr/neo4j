{
  final StoreProcessor processor=new StoreProcessor(CheckDecorator.NONE,mock(ConsistencyReport.Reporter.class));
  RecordStore<NodeRecord> recordStore=mock(RecordStore.class);
  when(recordStore.getHighId()).thenReturn(4L);
  when(recordStore.newRecord()).thenAnswer(new RecordStoreUtil.NewNodeRecordAnswer());
  when(recordStore.getRecord(eq(0L),any(NodeRecord.class),any(RecordLoad.class))).thenAnswer(new ReadNodeAnswer(false,0,0));
  when(recordStore.getRecord(eq(1L),any(NodeRecord.class),any(RecordLoad.class))).thenAnswer(new ReadNodeAnswer(false,0,0));
  when(recordStore.getRecord(eq(2L),any(NodeRecord.class),any(RecordLoad.class))).thenAnswer(new ReadNodeAnswer(false,0,0){
    @Override public NodeRecord answer(    InvocationOnMock invocation) throws Throwable {
      processor.stop();
      return super.answer(invocation);
    }
  }
);
  processor.applyFiltered(recordStore);
  verify(recordStore).getRecord(eq(0L),any(NodeRecord.class),any(RecordLoad.class));
  verify(recordStore).getRecord(eq(1L),any(NodeRecord.class),any(RecordLoad.class));
  verify(recordStore).getRecord(eq(2L),any(NodeRecord.class),any(RecordLoad.class));
  verify(recordStore,never()).getRecord(eq(3L),any(NodeRecord.class),any(RecordLoad.class));
}
