{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  final int numberOfEntriesBeforeRotation=100;
  DurableStateStorage<AtomicInteger> storage=lifeRule.add(new DurableStateStorage<>(fsa,testDir.directory(),"state",new AtomicIntegerMarshal(),numberOfEntriesBeforeRotation,NullLogProvider.getInstance()));
  for (int i=0; i < numberOfEntriesBeforeRotation * 2; i++) {
    storage.persistStoreData(new AtomicInteger(i));
  }
  storage.persistStoreData(new AtomicInteger(9999));
  assertEquals(4,fsa.getFileSize(stateFileA()));
  assertEquals(numberOfEntriesBeforeRotation * 4,fsa.getFileSize(stateFileB()));
}
