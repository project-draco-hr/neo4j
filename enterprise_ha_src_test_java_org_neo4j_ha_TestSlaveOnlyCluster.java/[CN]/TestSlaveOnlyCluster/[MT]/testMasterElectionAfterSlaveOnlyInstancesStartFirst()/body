{
  ClusterManager clusterManager=new ClusterManager(fromXml(getClass().getResource("/threeinstances.xml").toURI()),directory.cleanDirectory("slaveonly"),MapUtil.stringMap(),MapUtil.<Integer,Map<String,String>>genericMap(1,MapUtil.stringMap(HaSettings.slave_only.name(),"true"),2,MapUtil.stringMap(HaSettings.slave_only.name(),"true")));
  try {
    clusterManager.start();
    clusterManager.getDefaultCluster().await(ClusterManager.allSeesAllAsAvailable());
    HighlyAvailableGraphDatabase master=clusterManager.getDefaultCluster().getMaster();
    assertThat(clusterManager.getDefaultCluster().getServerId(master),CoreMatchers.equalTo(3));
  }
  finally {
    clusterManager.stop();
  }
}
