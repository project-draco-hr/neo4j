{
  ClusterManager clusterManager=new ClusterManager(fromXml(getClass().getResource("/threeinstances.xml").toURI()),TargetDirectory.forTest(getClass()).directory("testCluster",true),MapUtil.stringMap(),MapUtil.<Integer,Map<String,String>>genericMap(1,MapUtil.stringMap(HaSettings.slave_only.name(),"true"),2,MapUtil.stringMap(HaSettings.slave_only.name(),"true")));
  try {
    clusterManager.start();
    ClusterManager.ManagedCluster cluster=clusterManager.getDefaultCluster();
    cluster.await(masterAvailable(cluster.getMemberByServerId(1),cluster.getMemberByServerId(2)));
    HighlyAvailableGraphDatabase master=cluster.getMaster();
    assertThat(cluster.getServerId(master),CoreMatchers.equalTo(3));
  }
  finally {
    clusterManager.stop();
  }
}
