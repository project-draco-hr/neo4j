{
  ClusterManager clusterManager=new ClusterManager(fromXml(getClass().getResource("/threeinstances.xml").toURI()),directory.directory(),MapUtil.stringMap(),MapUtil.<Integer,Map<String,String>>genericMap(1,MapUtil.stringMap(HaSettings.slave_only.name(),"true"),2,MapUtil.stringMap(HaSettings.slave_only.name(),"true")));
  try {
    clusterManager.start();
    clusterManager.getDefaultCluster().await(ClusterManager.allSeesAllAsAvailable());
    HighlyAvailableGraphDatabase master=clusterManager.getDefaultCluster().getMaster();
    Assert.assertThat(clusterManager.getDefaultCluster().getServerId(master).toIntegerIndex(),CoreMatchers.equalTo(3));
  }
  finally {
    clusterManager.stop();
  }
}
