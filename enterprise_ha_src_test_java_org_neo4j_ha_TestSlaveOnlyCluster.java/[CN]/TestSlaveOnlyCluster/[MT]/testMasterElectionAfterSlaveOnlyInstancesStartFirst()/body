{
  ClusterManager clusterManager=new ClusterManager(fromXml(getClass().getResource("/threeinstances.xml").toURI()),directory.directory(),MapUtil.stringMap(),MapUtil.<Integer,Map<String,String>>genericMap(1,MapUtil.stringMap(HaSettings.slave_only.name(),"true"),2,MapUtil.stringMap(HaSettings.slave_only.name(),"true")));
  try {
    clusterManager.start();
    ClusterManager.ManagedCluster cluster=clusterManager.getDefaultCluster();
    cluster.await(masterAvailable(cluster.getMemberByServerId(new InstanceId(1)),cluster.getMemberByServerId(new InstanceId(2))));
    HighlyAvailableGraphDatabase master=cluster.getMaster();
    assertThat(cluster.getServerId(master).toIntegerIndex(),CoreMatchers.equalTo(3));
  }
  finally {
    clusterManager.stop();
  }
}
