{
  master.shutdown();
  Thread.sleep(1000);
  master=new HighlyAvailableGraphDatabase(dir.directory("master",true).getAbsolutePath(),stringMap(HaSettings.server_id.name(),"0",HaSettings.server.name(),"localhost:" + 6666,HaSettings.coordinators.name(),zoo.getConnectionString(),HaSettings.pull_interval.name(),0 + "ms"));
  while (!master.isMaster())   ;
  while (slaves[0].getBroker().getMaster().other().getMachineId() == -1)   ;
  assertEquals(0,slaves[0].getBroker().getMaster().other().getMachineId());
  while (slaves[1].getBroker().getMaster().other().getMachineId() == -1)   ;
  assertEquals(0,slaves[1].getBroker().getMaster().other().getMachineId());
  Transaction tx=slaves[0].beginTx();
  slaves[0].createNode();
  tx.success();
  tx.finish();
}
