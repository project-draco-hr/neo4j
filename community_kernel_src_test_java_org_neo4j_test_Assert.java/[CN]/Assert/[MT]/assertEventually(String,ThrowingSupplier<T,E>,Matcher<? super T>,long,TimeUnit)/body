{
  long waitUntil=System.currentTimeMillis() + timeUnit.toMillis(timeout);
  boolean matched;
  while (!(matched=matcher.matches(actual.get())) && System.currentTimeMillis() <= waitUntil) {
    try {
      Thread.sleep(250);
    }
 catch (    InterruptedException e) {
    }
  }
  if (!matched) {
    Description description=new StringDescription();
    description.appendText(reason).appendText("\nExpected: ").appendDescriptionOf(matcher).appendText("\n     but: ");
    matcher.describeMismatch(actual,description);
    throw new AssertionError("Timeout hit (" + timeout + " "+ timeUnit.toString().toLowerCase()+ ") while waiting for condition to match: "+ description.toString());
  }
}
