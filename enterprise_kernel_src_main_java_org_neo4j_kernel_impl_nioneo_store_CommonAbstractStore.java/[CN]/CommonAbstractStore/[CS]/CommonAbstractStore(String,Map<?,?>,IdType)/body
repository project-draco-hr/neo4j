{
  this.storageFileName=fileName;
  this.config=config;
  this.idType=idType;
  if (config != null) {
    String fileLock=(String)config.get("grab_file_lock");
    if (fileLock != null && fileLock.toLowerCase().equals("false")) {
      grabFileLock=false;
    }
  }
  this.idGeneratorFactory=(IdGeneratorFactory)config.get(IdGeneratorFactory.class);
  try {
    checkStorage();
    loadStorage();
    initStorage();
  }
 catch (  RuntimeException e) {
    closeFileChannelIfOpened();
    if (idGenerator != null) {
      idGenerator.close();
      idGenerator=null;
    }
    closeStorage();
    throw e;
  }
}
