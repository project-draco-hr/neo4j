{
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  ExecutionResultSerializer serializer=new ExecutionResultSerializer(output,null,StringLogger.DEV_NULL);
  Map<String,Object> data=map("column1","value1","column2","value2");
  Result executionResult=mock(Result.class);
  when(executionResult.columns()).thenReturn(new ArrayList<>(data.keySet()));
  when(executionResult.hasNext()).thenReturn(true,true,false);
  when(executionResult.next()).thenReturn(data).thenThrow(new RuntimeException("Stuff went wrong!"));
  try {
    serializer.statementResult(executionResult,false);
    fail("should have thrown exception");
  }
 catch (  RuntimeException e) {
    serializer.errors(asList(new Neo4jError(Status.Statement.ExecutionFailure,e)));
  }
  serializer.finish();
  String result=output.toString("UTF-8");
  assertEquals("{\"results\":[{\"columns\":[\"column1\",\"column2\"],\"data\":[{\"row\":[\"value1\",\"value2\"]}]}]," + "\"errors\":[{\"code\":\"Neo.DatabaseError.Statement.ExecutionFailure\",\"message\":\"Stuff went wrong!\",\"stackTrace\":***}]}",replaceStackTrace(result,"***"));
}
