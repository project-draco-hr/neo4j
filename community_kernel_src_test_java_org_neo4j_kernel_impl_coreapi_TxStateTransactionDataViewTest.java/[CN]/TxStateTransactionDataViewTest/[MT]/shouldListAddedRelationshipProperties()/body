{
  DefinedProperty prevProp=stringProperty(1,"prevValue");
  state.relationshipDoReplaceProperty(1L,prevProp,stringProperty(1,"newValue"));
  when(ops.propertyKeyGetName(1)).thenReturn("theKey");
  when(storeStatement.acquireSingleRelationshipCursor(1)).thenReturn(StubCursors.asRelationshipCursor(1,0,0,0,asPropertyCursor(prevProp)));
  Iterable<PropertyEntry<Relationship>> propertyEntries=snapshot().assignedRelationshipProperties();
  PropertyEntry<Relationship> entry=single(propertyEntries);
  assertThat(entry.key(),equalTo("theKey"));
  assertThat(entry.value(),equalTo((Object)"newValue"));
  assertThat(entry.previouslyCommitedValue(),equalTo((Object)"prevValue"));
  assertThat(entry.entity().getId(),equalTo(1L));
}
