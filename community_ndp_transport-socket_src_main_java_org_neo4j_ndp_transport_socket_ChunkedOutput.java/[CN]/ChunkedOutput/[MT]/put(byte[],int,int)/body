{
  int index=0;
  while (index < length) {
    int amountToWrite=Math.min(buffer == null ? maxChunkSize : buffer.writableBytes() - CHUNK_HEADER_SIZE,length - index);
    ensure(amountToWrite);
    buffer.writeBytes(data,offset + index,amountToWrite);
    index+=amountToWrite;
    if (buffer.writableBytes() == 0) {
      flush();
    }
  }
  return this;
}
