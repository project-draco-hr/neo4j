{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabase();
  KernelAPI kernel=db.getDependencyResolver().resolveDependency(KernelAPI.class);
  DoubleLatch latch=new DoubleLatch(10);
  List<Worker> workers=new ArrayList<>();
  for (int i=0; i < latch.getNumberOfContestants(); i++) {
    workers.add(new Worker(kernel,latch));
  }
  latch.awaitFinish();
  for (  Worker worker : workers) {
    if (worker.failure != null) {
      throw new RuntimeException("Worker failed",worker.failure);
    }
  }
  db.shutdown();
}
