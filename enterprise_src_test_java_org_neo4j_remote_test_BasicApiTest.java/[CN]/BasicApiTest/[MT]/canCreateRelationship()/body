{
  final Value<Node> startNode=new Value<Node>();
  final Value<Node> endNode=new Value<Node>();
  inTransaction(new Runnable(){
    public void run(){
      Node start=graphDb().createNode(), end=graphDb().createNode();
      startNode.set(start);
      endNode.set(end);
      Relationship rel=start.createRelationshipTo(end,withName("TEST"));
      assertNotNull(rel);
      verifyRelationship(rel,"TEST",start,end);
    }
  }
);
  inTransaction(new Runnable(){
    public void run(){
      Node start=startNode.get(), end=endNode.get();
      Iterator<Relationship> relationships=start.getRelationships().iterator();
      assertTrue(relationships.hasNext());
      Relationship rel=relationships.next();
      assertNotNull(rel);
      verifyRelationship(rel,"TEST",start,end);
      assertFalse(relationships.hasNext());
    }
  }
);
}
