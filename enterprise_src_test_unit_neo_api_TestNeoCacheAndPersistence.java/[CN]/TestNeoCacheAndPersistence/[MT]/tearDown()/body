{
  UserTransaction ut=TransactionFactory.getUserTransaction();
  try {
    if (ut.getStatus() == Status.STATUS_ACTIVE) {
      ut.commit();
    }
 else     if (ut.getStatus() == Status.STATUS_MARKED_ROLLBACK) {
      ut.rollback();
    }
 else     if (ut.getStatus() == Status.STATUS_NO_TRANSACTION) {
    }
 else {
      System.out.println("ARGH.");
      fail("Unkown transaction status[" + ut.getStatus() + "].");
    }
    ut.begin();
    Node node1=NodeManager.getManager().getNodeById(node1Id);
    Node node2=NodeManager.getManager().getNodeById(node2Id);
    node1.getSingleRelationship(MyRelTypes.TEST,Direction.BOTH).delete();
    node1.delete();
    node2.delete();
    ut.commit();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Failed to end transaciton and cleanup test population, " + e);
  }
}
