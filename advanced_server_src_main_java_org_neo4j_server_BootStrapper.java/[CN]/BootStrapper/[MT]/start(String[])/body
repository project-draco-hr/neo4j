{
  try {
    StartupHealthCheck startupHealthCheck=new StartupHealthCheck(new ConfigFileMustBePresentRule(),new Neo4jPropertiesMustExistRule());
    Jetty6WebServer webServer=new Jetty6WebServer();
    server=new NeoServerWithEmbeddedWebServer(new AddressResolver(),startupHealthCheck,getConfigFile(),webServer);
    server.start();
    log.info("Server started on [%s]",server.baseUri());
    Runtime.getRuntime().addShutdownHook(new Thread(){
      @Override public void run(){
        log.info("Neo4j Server shutdown initiated by kill signal");
        if (server != null) {
          server.stop();
        }
      }
    }
);
    return OK;
  }
 catch (  TransactionFailureException tfe) {
    tfe.printStackTrace();
    log.error(String.format("Failed to start Neo Server on port [%d], because ",server.getWebServerPort()) + tfe + ". Another process may be using database location "+ server.getDatabase().getLocation());
    return GRAPH_DATABASE_STARTUP_ERROR_CODE;
  }
catch (  Exception e) {
    e.printStackTrace();
    log.error("Failed to start Neo Server on port [%s]",server.getWebServerPort());
    return WEB_SERVER_STARTUP_ERROR_CODE;
  }
}
