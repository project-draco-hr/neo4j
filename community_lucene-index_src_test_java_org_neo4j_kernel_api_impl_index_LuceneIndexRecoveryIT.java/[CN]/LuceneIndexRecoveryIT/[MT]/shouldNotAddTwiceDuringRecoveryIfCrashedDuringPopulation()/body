{
  startDb(createForEverPopulatingLuceneIndexFactory());
  Label myLabel=label("MyLabel");
  createIndex(myLabel);
  long nodeId=createNode(myLabel,12);
  assertEquals(1,doIndexLookup(myLabel,12).size());
  killDb();
  startDb(createForEverPopulatingLuceneIndexFactory());
  Transaction transaction=db.beginTx();
  try {
    IndexDefinition indexDefinition=db.schema().getIndexes().iterator().next();
    db.schema().awaitIndexOnline(indexDefinition,2l,TimeUnit.SECONDS);
    assertEquals(12,db.getNodeById(nodeId).getProperty(NUM_BANANAS_KEY));
    assertEquals(1,doIndexLookup(myLabel,12).size());
  }
  finally {
    transaction.finish();
  }
}
