{
  try {
    File file=new File(basePath,path);
    RandomAccessFile randomAccessFile=null;
    try {
      file.getParentFile().mkdirs();
      randomAccessFile=new RandomAccessFile(file,"rw");
      if (hasData) {
        ByteBuffer intermediateBuffer=ByteBuffer.allocateDirect(1024);
        FileChannel channel=randomAccessFile.getChannel();
        while (data.read(intermediateBuffer) >= 0) {
          intermediateBuffer.flip();
          channel.write(intermediateBuffer);
          intermediateBuffer.clear();
        }
      }
      System.out.println("Copied " + file);
    }
  finally {
      if (randomAccessFile != null) {
        randomAccessFile.close();
      }
    }
  }
 catch (  Throwable t) {
    t.printStackTrace();
    throw new IOException(t);
  }
}
