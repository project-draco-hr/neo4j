{
  for (  NodeRecord nodeRecord : loop(legacyStore.getNodeStoreReader().iterator())) {
    reportProgress(nodeRecord.getId());
    nodeStore.setHighId(nodeRecord.getId() + 1);
    if (nodeRecord.inUse()) {
      nodeStore.updateRecord(nodeRecord);
    }
 else {
      nodeStore.freeId(nodeRecord.getId());
    }
  }
  legacyStore.getNodeStoreReader().close();
}
