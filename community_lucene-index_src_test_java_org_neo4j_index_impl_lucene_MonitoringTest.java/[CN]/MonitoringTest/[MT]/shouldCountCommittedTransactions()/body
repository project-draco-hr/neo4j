{
  GraphDatabaseService db=new TestGraphDatabaseFactory().newImpermanentDatabase();
  Monitors monitors=((GraphDatabaseAPI)db).getDependencyResolver().resolveDependency(Monitors.class);
  EideticTransactionMonitor monitor=new EideticTransactionMonitor();
  monitors.addMonitorListener(monitor,XaResourceManager.class.getName(),LuceneDataSource.DEFAULT_NAME);
  Transaction tx=db.beginTx();
  db.index().forNodes("foo").add(db.createNode(),"a string","a value");
  tx.success();
  tx.finish();
  assertEquals(2,monitor.getCommitCount());
  assertEquals(0,monitor.getInjectOnePhaseCommitCount());
  assertEquals(0,monitor.getInjectTwoPhaseCommitCount());
}
