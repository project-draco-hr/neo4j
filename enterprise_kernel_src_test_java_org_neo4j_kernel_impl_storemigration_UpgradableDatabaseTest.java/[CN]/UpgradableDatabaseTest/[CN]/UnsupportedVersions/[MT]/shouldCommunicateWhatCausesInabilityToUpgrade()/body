{
  final UpgradableDatabase upgradableDatabase=new UpgradableDatabase(fileSystem,new StoreVersionCheck(pageCacheRule.getPageCache(fileSystem)),new LegacyStoreVersionCheck(fileSystem),getRecordFormat());
  try {
    upgradableDatabase.checkUpgradeable(workingDirectory);
    fail("should not have been able to upgrade");
  }
 catch (  StoreUpgrader.UnexpectedUpgradingStoreVersionException e) {
    File expectedFile=new File(workingDirectory,neostoreFilename).getAbsoluteFile();
    assertEquals(String.format(MESSAGE,expectedFile,version),e.getMessage());
  }
catch (  StoreUpgrader.UnexpectedUpgradingStoreFormatException e) {
    assertNotSame(StandardFormatFamily.INSTANCE,RecordFormatSelector.selectForVersion(version).getFormatFamily());
    assertEquals(String.format(StoreUpgrader.UnexpectedUpgradingStoreFormatException.MESSAGE,GraphDatabaseSettings.record_format.name()),e.getMessage());
  }
}
