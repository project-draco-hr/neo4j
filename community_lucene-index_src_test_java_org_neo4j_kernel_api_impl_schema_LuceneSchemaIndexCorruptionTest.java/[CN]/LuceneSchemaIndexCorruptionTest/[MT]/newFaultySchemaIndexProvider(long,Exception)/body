{
  DirectoryFactory directoryFactory=mock(DirectoryFactory.class);
  File indexRootFolder=testDirectory.graphDbDir();
  FaultyIndexStorageFactory storageFactory=new FaultyIndexStorageFactory(faultyIndexId,error,directoryFactory,indexRootFolder);
  return new LuceneSchemaIndexProvider(fs.get(),directoryFactory,indexRootFolder,logProvider,Config.defaults(),OperationalMode.single){
    @Override protected IndexStorageFactory buildIndexStorageFactory(    FileSystemAbstraction fileSystem,    DirectoryFactory directoryFactory,    File schemaIndexStoreFolder){
      return storageFactory;
    }
  }
;
}
