{
  if (record.isTransferable() && !hasWindow(record.getId())) {
    if (transferRecord(record)) {
      if (!record.inUse() && !isInRecoveryMode()) {
        freeId(record.getId());
      }
      return;
    }
  }
  PersistenceWindow window=acquireWindow(record.getId(),OperationType.WRITE);
  try {
    updateRecord(record,window.getBuffer());
  }
  finally {
    releaseWindow(window);
  }
}
