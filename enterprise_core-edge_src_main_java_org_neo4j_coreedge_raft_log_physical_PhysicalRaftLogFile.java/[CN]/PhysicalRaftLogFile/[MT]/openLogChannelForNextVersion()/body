{
  long forVersion=logFiles.registerNextVersion(lastCommittedId.get());
  long lastTxId=lastCommittedId.get();
  writeLogHeader(headerBuffer,forVersion,lastTxId);
  logHeaderCache.putHeader(forVersion,lastTxId);
  File toOpen=logFiles.getLogFileForVersion(forVersion);
  StoreChannel storeChannel=fileSystem.open(toOpen,"rw");
  storeChannel.writeAll(headerBuffer);
  monitor.opened(toOpen,forVersion,lastTxId,true);
  return new PhysicalLogVersionedStoreChannel(storeChannel,forVersion,CURRENT_LOG_VERSION);
}
