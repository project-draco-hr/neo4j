{
  int eventIdentifier=txManager.getEventIdentifier();
  if (!txManager.getTransactionState().hasLocks()) {
    if (!switchBlock.await(config.getStateSwitchTimeout())) {
      throw new RuntimeException("Timed out waiting for database to switch state");
    }
    txHook.initializeTransaction(eventIdentifier);
  }
}
