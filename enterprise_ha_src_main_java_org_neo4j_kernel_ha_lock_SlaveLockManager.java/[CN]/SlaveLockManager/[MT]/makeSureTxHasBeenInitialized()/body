{
  int eventIdentifier=txManager.getEventIdentifier();
  if (!txManager.getTransactionState().hasLocks()) {
    if (!availabilityGuard.isAvailable(config.getAvailabilityTimeout())) {
      throw new RuntimeException("Timed out waiting for database to switch state");
    }
    txHook.initializeTransaction(eventIdentifier);
  }
}
