{
  cache=new GCResistantCache<Entity>(new AtomicReferenceArray<Entity>(10)){
    @Override protected int getPosition(    EntityWithSizeObject obj){
      return 1;
    }
  }
;
  final int size=10;
  SneakyEntity oldEntity=new SneakyEntity(0l,size){
    @Override void doThisBadStuffInSizeCall(){
      updateSize(size + 1);
      cache.updateSize(this,size + 1);
    }
  }
;
  cache.put(oldEntity);
  oldEntity.updateSize(size);
  Entity newEntity=new Entity(1l,11);
  cache.put(newEntity);
  assertEquals(11,cache.size());
}
