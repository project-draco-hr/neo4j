{
  acquireExclusiveLockInThisThread();
  TxTerminationImpl txTermination=new TxTerminationImpl();
  CountDownLatch firstLockFailed=new CountDownLatch(1);
  CountDownLatch startSecondLock=new CountDownLatch(1);
  Future<?> locking=acquireTwoLocksInAnotherThread(firstLockShared,secondLockShared,txTermination,firstLockFailed,startSecondLock);
  assertThreadIsWaitingForLock(locking);
  txTermination.markForTermination();
  await(firstLockFailed);
  txTermination.reset();
  releaseAllLocksInThisThread();
  startSecondLock.countDown();
  assertLockAcquisitionSucceeded(locking);
}
