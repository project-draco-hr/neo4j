{
  acquireExclusiveLockInThisThread();
  TxTerminationImpl txTermination=new TxTerminationImpl();
  CountDownLatch firstLockAcquired=new CountDownLatch(1);
  Future<?> acquisition=tryAcquireTwoLocksLockInAnotherThread(shared,txTermination,firstLockAcquired);
  await(firstLockAcquired);
  assertThreadIsWaitingForLock(acquisition);
  assertLocksHeld(RESOURCE_ID,OTHER_RESOURCE_ID);
  txTermination.markForTermination();
  assertLockAcquisitionFailed(acquisition);
  assertLocksHeld(RESOURCE_ID);
  releaseAllLocksInThisThread();
  assertNoLocksHeld();
}
