{
  Set<Integer> machineIds=new HashSet<Integer>();
  Map<Channel,SlaveContext> channels=getConnectedSlaveChannels();
synchronized (channels) {
    for (    SlaveContext context : channels.values()) {
      machineIds.add(context.machineId());
    }
  }
  Map<Integer,Collection<SlaveContext>> ongoingTransactions=((MasterImpl)getMaster()).getOngoingTransactions();
  for (  Integer machineId : machineIds) {
    if (!ongoingTransactions.containsKey(machineId)) {
      ongoingTransactions.put(machineId,Collections.<SlaveContext>emptyList());
    }
  }
  return new TreeMap<Integer,Collection<SlaveContext>>(ongoingTransactions);
}
