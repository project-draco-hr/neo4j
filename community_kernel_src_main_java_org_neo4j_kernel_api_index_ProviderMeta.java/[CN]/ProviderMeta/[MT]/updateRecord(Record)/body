{
  if (snapshotCount > 0) {
    snapshotRecords.put(record.getLongId(),record);
    return;
  }
  buffer.clear();
  buffer.put((byte)(record.inUse() ? 1 : 0));
  buffer.putLong(record.getValue());
  buffer.flip();
  try {
    channel.position(record.getLongId() * RECORD_SIZE);
    channel.write(buffer);
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Error writing channel",e);
  }
}
