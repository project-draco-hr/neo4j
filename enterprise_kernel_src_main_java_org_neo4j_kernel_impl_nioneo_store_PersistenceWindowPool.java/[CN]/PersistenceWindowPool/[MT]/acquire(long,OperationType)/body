{
  LockableWindow window=null;
  boolean readPos=false;
  if (brickMiss >= REFRESH_BRICK_COUNT) {
    refreshBricks();
  }
  if (brickSize > 0) {
    int brickIndex=(int)(position * blockSize / brickSize);
    if (brickIndex < brickArray.length) {
synchronized (this) {
        window=brickArray[brickIndex].getWindow();
        if (window != null) {
          window.mark();
        }
      }
      brickArray[brickIndex].setHit();
    }
 else {
      expandBricks(brickIndex + 1);
      window=brickArray[brickIndex].getWindow();
    }
  }
  if (window == null) {
synchronized (this) {
      miss++;
      brickMiss++;
      PersistenceRow dpw=activeRowWindows.get((int)position);
      if (dpw == null) {
        dpw=new PersistenceRow(position,blockSize,fileChannel);
      }
      if (operationType == OperationType.READ) {
        readPos=true;
      }
      window=dpw;
      activeRowWindows.put((int)position,dpw);
      window.mark();
    }
  }
 else {
    hit++;
  }
  window.lock();
  if (readPos) {
    ((PersistenceRow)window).readPosition();
  }
  window.setOperationType(operationType);
  return window;
}
