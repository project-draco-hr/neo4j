{
  assertAuthEnabled();
  Subject subject=buildSubject(null);
  UsernamePasswordToken token=new UsernamePasswordToken(username,password);
  AuthenticationResult result=AuthenticationResult.SUCCESS;
  if (!authStrategy.isAuthenticationPermitted(username)) {
    result=AuthenticationResult.TOO_MANY_ATTEMPTS;
  }
 else {
    try {
      subject.login(token);
      if (realm.findUser(username).passwordChangeRequired()) {
        result=AuthenticationResult.PASSWORD_CHANGE_REQUIRED;
      }
    }
 catch (    AuthenticationException e) {
      result=AuthenticationResult.FAILURE;
    }
    authStrategy.updateWithAuthenticationResult(result,username);
  }
  return new ShiroAuthSubject(this,subject,result);
}
