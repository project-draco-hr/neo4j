{
  assertAuthEnabled();
  Subject subject=buildSubject(null);
  UsernamePasswordToken token=new UsernamePasswordToken(username,password);
  AuthenticationResult result=AuthenticationResult.SUCCESS;
  if (!authStrategy.isAuthenticationPermitted(username)) {
    result=AuthenticationResult.TOO_MANY_ATTEMPTS;
  }
 else {
    try {
      subject.login(token);
    }
 catch (    ExpiredCredentialsException e) {
      result=AuthenticationResult.PASSWORD_CHANGE_REQUIRED;
      subject=buildSubject(username);
    }
catch (    AuthenticationException e) {
      result=AuthenticationResult.FAILURE;
    }
    authStrategy.updateWithAuthenticationResult(result,username);
  }
  User user=realm.findUser(username);
  if (user != null && user.isSuspended()) {
    result=AuthenticationResult.FAILURE;
  }
  return new ShiroAuthSubject(this,subject,result);
}
