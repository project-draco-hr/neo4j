{
  long highId=getNodeManager().getHighestPossibleIdInUse(Node.class);
  if (highId >= 0 && highId < 10000) {
    int count=0;
    for (    Node node : getEmbeddedGraphDb().getAllNodes()) {
      count++;
    }
    boolean found=false;
    Node newNode=getGraphDb().createNode();
    newTransaction();
    int oldCount=count;
    count=0;
    for (    Node node : getEmbeddedGraphDb().getAllNodes()) {
      count++;
      if (node.equals(newNode)) {
        found=true;
      }
    }
    assertTrue(found);
    assertEquals(count,oldCount + 1);
    Iterator<Node> allNodesIterator=getEmbeddedGraphDb().getAllNodes().iterator();
    assertNotNull(allNodesIterator.next());
    newNode.delete();
    newTransaction();
    found=false;
    count=0;
    for (    Node node : getEmbeddedGraphDb().getAllNodes()) {
      count++;
      if (node.equals(newNode)) {
        found=true;
      }
    }
    assertTrue(!found);
    assertEquals(count,oldCount);
  }
}
