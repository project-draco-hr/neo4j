{
  String indexName=defineCommand.getIndexName(command.getIndexNameId());
  Map<String,CommandVisitor> applierByIndex=applierByIndexMap(command);
  CommandVisitor applier=applierByIndex.get(indexName);
  if (applier == null) {
    IndexEntityType entityType=IndexEntityType.byId(command.getEntityType());
    Map<String,String> config=indexConfigStore.get(entityType.entityClass(),indexName);
    if (config == null) {
      return TransactionApplier.EMPTY;
    }
    String providerName=config.get(PROVIDER);
    applier=applierByProvider.get(providerName);
    if (applier == null) {
      applier=applierLookup.newApplier(providerName,mode.needsIdempotencyChecks());
      applier.visitIndexDefineCommand(defineCommand);
      applierByProvider.put(providerName,applier);
    }
    applierByIndex.put(indexName,applier);
  }
  return applier;
}
