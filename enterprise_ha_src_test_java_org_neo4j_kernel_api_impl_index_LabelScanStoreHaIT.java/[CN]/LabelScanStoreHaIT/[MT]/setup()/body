{
  KernelExtensionFactory<?> testExtension=new LuceneLabelScanStoreExtension(100,monitor);
  HighlyAvailableGraphDatabaseFactory factory=new TestHighlyAvailableGraphDatabaseFactory();
  factory.addKernelExtensions(Arrays.<KernelExtensionFactory<?>>asList(testExtension));
  ClusterManager clusterManager=new ClusterManager.Builder(testDirectory.directory("root")).withDbFactory(factory).withStoreDirInitializer(new ClusterManager.StoreDirInitializer(){
    @Override public void initializeStoreDir(    int serverId,    File storeDir) throws IOException {
      if (serverId == 1) {
        GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(storeDir.getAbsolutePath());
        try {
          createSomeLabeledNodes(db,new Label[]{Labels.First},new Label[]{Labels.First,Labels.Second},new Label[]{Labels.Second});
        }
  finally {
          db.shutdown();
        }
      }
    }
  }
).build();
  life.add(clusterManager);
  life.start();
  cluster=clusterManager.getDefaultCluster();
  cluster.await(allSeesAllAsAvailable());
  cluster.await(allAvailabilityGuardsReleased());
}
