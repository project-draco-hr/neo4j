{
  if (bufferPos >= buffer.length) {
    if (seekStartPos == 0) {
      throw new IllegalStateException("Tried to read in a value larger than buffer size " + buffer.length);
    }
    charBuffer.position(seekStartPos);
    charBuffer.compact();
    int remaining=charBuffer.remaining();
    int read=reader.read(buffer,charBuffer.position(),remaining);
    if (read < remaining) {
      buffer[charBuffer.position() + max(read,0)]=EOF_CHAR;
    }
    bufferPos=charBuffer.position();
    seekStartPos=0;
  }
}
