{
  if (eof) {
    return eof(mark);
  }
  seekStartPos=bufferPos;
  int ch;
  int endOffset=1;
  int skippedChars=0;
  int quoteDepth=0;
  boolean isQuoted=false;
  while (!eof) {
    ch=nextChar(skippedChars);
    if (quoteDepth == 0) {
      if (ch == quoteChar && seekStartPos == bufferPos - 1) {
        quoteDepth++;
        seekStartPos++;
        continue;
      }
 else       if (isNewLine(ch)) {
        if (bufferPos - 1 == lineStartPos) {
          seekStartPos++;
          lineStartPos++;
          continue;
        }
        break;
      }
 else       if (ch == untilChar) {
        mark.set(seekStartPos,bufferPos - endOffset - skippedChars,ch,isQuoted);
        return true;
      }
    }
 else {
      isQuoted=true;
      if (ch == quoteChar) {
        int nextCh=peekChar(skippedChars);
        if (nextCh == quoteChar) {
          repositionChar(bufferPos++,++skippedChars);
        }
 else {
          endOffset++;
          quoteDepth--;
        }
      }
 else       if (isNewLine(ch)) {
        if (ch == EOL_CHAR) {
          lineNumber++;
        }
        nextChar(skippedChars);
      }
 else       if (ch == BACK_SLASH) {
        int nextCh=peekChar(skippedChars);
        if (nextCh == quoteChar || nextCh == BACK_SLASH) {
          repositionChar(bufferPos++,++skippedChars);
        }
      }
    }
  }
  int valueLength=bufferPos - seekStartPos - 1;
  if (eof && valueLength == 0 && seekStartPos == lineStartPos) {
    return eof(mark);
  }
  lineNumber++;
  lineStartPos=bufferPos;
  mark.set(seekStartPos,bufferPos - endOffset - skippedChars,END_OF_LINE_CHARACTER,isQuoted);
  return true;
}
