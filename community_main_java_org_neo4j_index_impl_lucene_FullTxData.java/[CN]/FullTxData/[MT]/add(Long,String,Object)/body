{
  try {
    ensureLuceneDataInstantiated();
    Document document=LuceneDataSource.findDocument(index.type,searcher(),entityId);
    if (document != null) {
      index.type.addToDocument(document,key,value);
      writer.updateDocument(index.type.idTerm(entityId),document);
    }
 else {
      document=index.type.newDocument(entityId);
      index.type.addToDocument(document,key,value);
      writer.addDocument(document);
    }
    invalidateSearcher();
    return this;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
