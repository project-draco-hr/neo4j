{
  final long secondsForSessionToExpire=1;
  Map<String,String> stringConfig=new HashMap<String,String>();
  stringConfig.put(HaSettings.coordinators.name(),"localhost:4181");
  stringConfig.put(HaSettings.server_id.name(),"1");
  stringConfig.put(HaSettings.zk_session_timeout.name(),Long.toString(secondsForSessionToExpire));
  Config config=new Config(new ConfigurationDefaults(OnlineBackupSettings.class,GraphDatabaseSettings.class,HaSettings.class).apply(stringConfig));
  ZooClient client=new ZooClient("",StringLogger.SYSTEM,config,null,DummyClusterReceiver,new MasterClientResolver.F18(StringLogger.SYSTEM,Client.DEFAULT_READ_RESPONSE_TIMEOUT_SECONDS,Client.DEFAULT_READ_RESPONSE_TIMEOUT_SECONDS,Client.DEFAULT_MAX_NUMBER_OF_CONCURRENT_CHANNELS_PER_CLIENT));
  final Thread me=Thread.currentThread();
  final AtomicBoolean allOk=new AtomicBoolean(false);
  Thread wakeMeUp=new Thread(new Runnable(){
    @Override public void run(){
      try {
        Thread.sleep((secondsForSessionToExpire * 1000) * 2);
        if (!allOk.get()) {
          me.interrupt();
        }
      }
 catch (      Exception e) {
        if (!allOk.get()) {
          throw new RuntimeException(e);
        }
        Thread.interrupted();
      }
    }
  }
);
  wakeMeUp.setDaemon(true);
  wakeMeUp.start();
  try {
    client.waitForSyncConnected();
    fail("There is no zookeeper here, it should time out within a session timeout");
  }
 catch (  ZooKeeperTimedOutException success) {
    allOk.set(true);
  }
  wakeMeUp.interrupt();
  wakeMeUp.join();
  client.shutdown();
}
