{
  try {
    temporaryBuffer.clear();
    File file=new File(basePath,path);
    file.getParentFile().mkdirs();
    String filename=file.getName();
    final Optional<StoreType> storeType=isStoreType(filename);
    final Optional<PagedFile> existingMapping=pageCache.getExistingMapping(file);
    monitor.startReceivingStoreFile(file);
    try {
      if (existingMapping.isPresent()) {
        try (PagedFile pagedFile=existingMapping.get()){
          return writeDataThroughPageCache(pagedFile,data,temporaryBuffer,hasData);
        }
       }
      if (storeType.isPresent() && storeType.get().isRecordStore()) {
        int filePageSize=pageCache.pageSize() - pageCache.pageSize() % recordSize;
        try (PagedFile pagedFile=pageCache.map(file,filePageSize,CREATE,WRITE)){
          return writeDataThroughPageCache(pagedFile,data,temporaryBuffer,hasData);
        }
       }
 else {
        return writeDataThroughFileSystem(file,data,temporaryBuffer,hasData);
      }
    }
  finally {
      monitor.finishReceivingStoreFile(file);
    }
  }
 catch (  Throwable t) {
    throw new IOException(t);
  }
}
