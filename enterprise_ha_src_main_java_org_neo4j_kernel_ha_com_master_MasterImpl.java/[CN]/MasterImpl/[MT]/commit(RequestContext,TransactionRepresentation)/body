{
  assertCorrectEpoch(context);
  if (context.getEventIdentifier() == -1) {
    try (Locks.Client locks=spi.acquireClient()){
      return commit0(context,preparedTransaction,locks);
    }
   }
 else {
    try {
      Locks.Client locks=slaveLockSessions.acquire(context);
      try {
        return commit0(context,preparedTransaction,locks);
      }
  finally {
        slaveLockSessions.release(context);
      }
    }
 catch (    NoSuchEntryException|ConcurrentAccessException e) {
      throw new TransactionNotPresentOnMasterException(context);
    }
  }
}
