{
  try {
    Map<RequestContext,LockSession> safeSessions;
synchronized (slaveLockSessions) {
      safeSessions=new HashMap<>(slaveLockSessions);
    }
    for (    Map.Entry<RequestContext,LockSession> entry : safeSessions.entrySet()) {
      long time=entry.getValue().timeLastSuspended.get();
      if ((time != 0 && System.currentTimeMillis() - time >= unfinishedTransactionThresholdMillis) || entry.getValue().closeAsap()) {
        long displayableTime=(time == 0 ? 0 : (System.currentTimeMillis() - time));
        RequestContext context=entry.getKey();
        String oldTxDescription=format("old tx %s: %s at age %s ms",context,entry.getValue().client(),displayableTime);
        try {
          resume(context);
          endLockSession0(context);
          msgLog.info("Rolled back " + oldTxDescription);
        }
 catch (        LockSessionAlreadyActiveException e) {
        }
catch (        Throwable t) {
          msgLog.warn("Unable to roll back " + oldTxDescription,t);
        }
      }
    }
  }
 catch (  Throwable t) {
    msgLog.warn("Exception running " + getClass().getName() + ", although will continue...",t);
  }
}
