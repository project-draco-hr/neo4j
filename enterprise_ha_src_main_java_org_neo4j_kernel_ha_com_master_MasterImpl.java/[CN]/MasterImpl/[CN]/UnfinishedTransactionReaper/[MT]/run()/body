{
  try {
    Map<RequestContext,MasterTransaction> safeTransactions=null;
synchronized (transactions) {
      safeTransactions=new HashMap<RequestContext,MasterTransaction>(transactions);
    }
    for (    Map.Entry<RequestContext,MasterTransaction> entry : safeTransactions.entrySet()) {
      long time=entry.getValue().timeLastSuspended.get();
      if ((time != 0 && System.currentTimeMillis() - time >= unfinishedTransactionThresholdMillis) || entry.getValue().finishAsap()) {
        long displayableTime=(time == 0 ? 0 : (System.currentTimeMillis() - time));
        String oldTxDescription=format("old tx %s: %s at age %s ms",entry.getKey(),entry.getValue().transaction,displayableTime);
        try {
          resumeTransaction(entry.getKey());
          finishTransaction0(entry.getKey(),false);
          msgLog.info("Rolled back " + oldTxDescription);
        }
 catch (        TransactionAlreadyActiveException e) {
        }
catch (        Throwable t) {
          msgLog.warn("Unable to roll back " + oldTxDescription,t);
        }
      }
    }
  }
 catch (  Throwable t) {
    msgLog.warn("Exception running " + getClass().getName() + ", although will continue...",t);
  }
}
