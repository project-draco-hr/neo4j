{
  ClusterManager.ManagedCluster cluster=clusterRule.config(HaSettings.read_timeout,"4000s").startCluster();
  HighlyAvailableGraphDatabase slave=cluster.getAnySlave();
  HighlyAvailableGraphDatabase master=cluster.getMaster();
  ThreadToStatementContextBridge txBridge=slave.getDependencyResolver().resolveDependency(ThreadToStatementContextBridge.class);
  createUser(master,"Bob");
  slave.beginTx();
  slave.createNode(label("User")).setProperty("name","Bob");
  TopLevelTransaction slaveTx=txBridge.getTopLevelTransactionBoundToThisThread(true);
  txBridge.unbindTransactionFromCurrentThread();
  try (Transaction tx=master.beginTx()){
    master.schema().constraintFor(label("User")).assertPropertyIsUnique("name").create();
    tx.success();
  }
   txBridge.bindTransactionToCurrentThread(slaveTx);
  try {
    slaveTx.success();
    slaveTx.close();
    fail("Expected this commit to fail :(");
  }
 catch (  TransactionFailureException e) {
    assertThat(e.getCause().getCause(),instanceOf(org.neo4j.kernel.api.exceptions.TransactionFailureException.class));
  }
  assertOneBob(master);
  cluster.sync();
  assertOneBob(slave);
  createUser(slave,"Steven");
  createUser(master,"Caroline");
}
