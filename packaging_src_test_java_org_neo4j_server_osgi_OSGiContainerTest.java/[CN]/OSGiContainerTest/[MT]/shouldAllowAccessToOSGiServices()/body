{
  OSGiContainer container=new OSGiContainer();
  String expectedBundleSymbolicName="OSGiAwareBundle";
  InputStream bundleStream=newBundle().add(LifecycleActivator.class).add(ExampleServiceImpl.class).set(Constants.BUNDLE_SYMBOLICNAME,expectedBundleSymbolicName).set(Constants.EXPORT_PACKAGE,"org.neo4j.server.osgi.bundles.service").set(Constants.IMPORT_PACKAGE,"org.neo4j.server.osgi.bundles.service, org.neo4j.server.osgi.services, org.osgi.framework").build(withBnd());
  File awareJar=new File(container.getBundleDirectory(),"aware.jar");
  OutputStream jarOutputStream=new FileOutputStream(awareJar);
  StreamUtils.copyStream(bundleStream,jarOutputStream,true);
  container.start();
  Bundle awareBundle=container.getBundles()[1];
  ExampleServiceImpl service=(ExampleServiceImpl)awareBundle.getBundleContext().getService(awareBundle.getRegisteredServices()[0]);
  assertThat(service,is(notNullValue()));
  container.shutdown();
}
