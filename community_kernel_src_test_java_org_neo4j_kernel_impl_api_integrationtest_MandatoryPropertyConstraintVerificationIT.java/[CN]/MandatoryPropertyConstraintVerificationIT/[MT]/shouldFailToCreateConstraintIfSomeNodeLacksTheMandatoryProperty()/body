{
  long nodeId;
  try (Transaction tx=db.beginTx()){
    nodeId=db.createNode(label("Foo")).getId();
    tx.success();
  }
   try {
    try (Transaction tx=db.beginTx()){
      db.schema().constraintFor(label("Foo")).assertPropertyExists("bar").create();
      tx.success();
    }
     fail("expected exception");
  }
 catch (  ConstraintViolationException e) {
    Throwable cause=e.getCause();
    assertThat(cause,instanceOf(CreateConstraintFailureException.class));
    Throwable rootCause=cause.getCause();
    assertThat(rootCause,instanceOf(ConstraintVerificationFailedKernelException.class));
    assertThat(userMessageOf((KernelException)rootCause),containsString("Node(" + nodeId + ")"));
  }
}
