{
  long entityId;
  try (Transaction tx=db.beginTx()){
    entityId=createOffender(db,KEY);
    tx.success();
  }
   try {
    try (Transaction tx=db.beginTx()){
      createConstraint(db,KEY,PROPERTY);
      tx.success();
    }
     fail("expected exception");
  }
 catch (  ConstraintViolationException e) {
    Throwable cause=e.getCause();
    assertThat(cause,instanceOf(CreateConstraintFailureException.class));
    Throwable rootCause=cause.getCause();
    assertThat(rootCause,instanceOf(ConstraintVerificationFailedKernelException.class));
    assertThat(userMessageOf((KernelException)rootCause),containsString(offenderType().getSimpleName() + "(" + entityId+ ")"));
  }
}
