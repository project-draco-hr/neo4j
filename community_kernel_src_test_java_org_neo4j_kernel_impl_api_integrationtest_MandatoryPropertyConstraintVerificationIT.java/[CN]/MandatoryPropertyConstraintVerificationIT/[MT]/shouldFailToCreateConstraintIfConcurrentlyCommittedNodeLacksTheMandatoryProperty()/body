{
  try {
    Future<Void> constraint;
    try (Transaction tx=db.beginTx()){
      db.createNode(label("Foo"));
      constraint=thread.executeAndAwait(db.tx(mandatoryPropertyConstraint(label("Foo"),"bar")),db.getGraphDatabaseService(),waitingWhileIn(OperationsFacade.class,"mandatoryPropertyConstraintCreate"),5,SECONDS);
      tx.success();
    }
     constraint.get();
    fail("expected exception");
  }
 catch (  ExecutionException e) {
    assertThat(e.getCause(),instanceOf(ConstraintViolationException.class));
    assertThat(e.getCause().getCause(),instanceOf(CreateConstraintFailureException.class));
  }
catch (  ConstraintViolationException e) {
    assertThat(e.getCause(),instanceOf(ConstraintViolationTransactionFailureException.class));
  }
}
