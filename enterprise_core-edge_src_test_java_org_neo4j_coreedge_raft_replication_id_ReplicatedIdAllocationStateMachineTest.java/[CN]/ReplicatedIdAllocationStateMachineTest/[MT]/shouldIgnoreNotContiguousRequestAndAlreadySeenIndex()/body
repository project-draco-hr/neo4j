{
  ReplicatedIdAllocationStateMachine stateMachine=new ReplicatedIdAllocationStateMachine(new InMemoryStateStorage<>(new IdAllocationState()),NullLogProvider.getInstance());
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,0L,10),0L);
  assertEquals(10L,stateMachine.firstUnallocated(someType));
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,20L,10),1L);
  assertEquals(10L,stateMachine.firstUnallocated(someType));
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,10L,10),2L);
  assertEquals(20L,stateMachine.firstUnallocated(someType));
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,20L,10),1L);
  assertEquals(20L,stateMachine.firstUnallocated(someType));
}
