{
  ReplicatedIdAllocationStateMachine idAllocationStateMachine=new ReplicatedIdAllocationStateMachine(me,new InMemoryIdAllocationState());
  long index=0;
  idAllocationStateMachine.onReplicated(new ReplicatedIdAllocationRequest(me,someType,0,1024),index++);
  idAllocationStateMachine.onReplicated(new ReplicatedIdAllocationRequest(me,someType,1024,1024),index++);
  idAllocationStateMachine.onReplicated(new ReplicatedIdAllocationRequest(me,someType,2048,1024),index++);
  assertEquals(3072,idAllocationStateMachine.getFirstNotAllocated(someType));
}
