{
  ReplicatedIdAllocationStateMachine stateMachine=new ReplicatedIdAllocationStateMachine(new InMemoryStateStorage<>(new IdAllocationState()),NullLogProvider.getInstance());
  long index=0;
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,0,1024),index++);
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,1024,1024),index++);
  stateMachine.applyCommand(new ReplicatedIdAllocationRequest(me,someType,2048,1024),index);
  assertEquals(3072,stateMachine.firstUnallocated(someType));
}
