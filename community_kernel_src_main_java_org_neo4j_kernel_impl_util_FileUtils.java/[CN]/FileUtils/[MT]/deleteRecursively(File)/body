{
  Stack<File> stack=new Stack<File>();
  List<File> temp=new LinkedList<File>();
  stack.push(directory.getAbsoluteFile());
  while (!stack.isEmpty()) {
    File top=stack.pop();
    if (top.listFiles() != null) {
      for (      File child : top.listFiles()) {
        if (child.isFile()) {
          if (!deleteFile(child)) {
            throw new IOException("Failed to delete " + child.getCanonicalPath());
          }
        }
 else {
          temp.add(child);
        }
      }
    }
    if (top.listFiles() == null || top.listFiles().length == 0) {
      if (!deleteFile(top)) {
        throw new IOException("Failed to delete " + top.getCanonicalPath());
      }
    }
 else {
      stack.push(top);
      for (      File f : temp) {
        stack.push(f);
      }
    }
    temp.clear();
  }
}
