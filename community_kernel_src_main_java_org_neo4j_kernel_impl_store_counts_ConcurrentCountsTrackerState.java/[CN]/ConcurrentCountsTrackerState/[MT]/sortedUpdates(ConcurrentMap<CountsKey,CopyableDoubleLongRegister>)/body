{
  @SuppressWarnings("unchecked") Update<CountsKey>[] result=new Update[updates.size()];
  DoubleLongRegister tmp=newDoubleLongRegister();
  Iterator<Map.Entry<CountsKey,CopyableDoubleLongRegister>> entries=updates.entrySet().iterator();
  for (int i=0; i < result.length; i++) {
    if (!entries.hasNext()) {
      throw new ConcurrentModificationException("fewer entries than expected");
    }
    result[i]=Update.from(entries.next(),tmp);
  }
  if (entries.hasNext()) {
    throw new ConcurrentModificationException("more entries than expected");
  }
  Arrays.sort(result);
  return result;
}
