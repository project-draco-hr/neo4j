{
  long[] lastCommittedTransaction=transactionIdStore.getLastCommittedTransaction();
  long lastCommittedTransactionId=lastCommittedTransaction[0];
  LogPosition logPosition=new LogPosition(lastCommittedTransaction[2],lastCommittedTransaction[3]);
  msgLog.info(prefix(lastCommittedTransactionId) + "Starting check pointing...");
  kernelHealth.assertHealthy(IOException.class);
  msgLog.info(prefix(lastCommittedTransactionId) + " Starting store flush...");
  storeFlusher.forceEverything();
synchronized (logFile) {
synchronized (channel) {
      kernelHealth.assertHealthy(IOException.class);
      try {
        transactionLogWriter.checkPoint(logPosition);
        channel.emptyBufferIntoChannelAndClearIt();
        channel.force();
      }
 catch (      Throwable t) {
        kernelHealth.panic(t);
        throw t;
      }
    }
  }
  threshold.checkPointHappened(lastCommittedTransactionId);
  msgLog.info(prefix(lastCommittedTransactionId) + "Check pointing completed");
  logPruning.pruneLogs(logPosition.getLogVersion());
}
