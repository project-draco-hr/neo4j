{
  if (!tmOk) {
    throw new SystemException("TM has encountered some problem, " + "please perform neccesary action (tx recovery/restart)");
  }
  Thread thread=Thread.currentThread();
  if (txThreadMap.get(thread) != null) {
    throw new IllegalStateException("Transaction already associated");
  }
  TransactionImpl txImpl=(TransactionImpl)tx;
  if (txImpl.getStatus() != Status.STATUS_NO_TRANSACTION) {
    txThreadMap.put(thread,txImpl);
  }
}
