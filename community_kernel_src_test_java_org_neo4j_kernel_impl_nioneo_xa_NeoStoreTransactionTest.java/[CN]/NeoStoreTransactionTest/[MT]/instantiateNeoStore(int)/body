{
  if (neoStore != null) {
    fs.clear();
  }
  config=new Config(stringMap(GraphDatabaseSettings.dense_node_threshold.name(),"" + denseNodeThreshold));
  File storeDir=new File("dir");
  config=configForStoreDir(config,storeDir);
  PageCache pageCache=pageCacheRule.getPageCache(fs.get(),config);
  StoreFactory storeFactory=new StoreFactory(config,idGeneratorFactory,pageCache,fs.get(),DEV_NULL,new Monitors());
  neoStore=storeFactory.createNeoStore();
  lockMocks.clear();
  locks=mock(LockService.class,new Answer(){
    @Override public synchronized Object answer(    final InvocationOnMock invocation) throws Throwable {
      if (invocation.getMethod().getName().equals("acquireNodeLock")) {
        final Lock mock=mock(Lock.class,new Answer(){
          @Override public Object answer(          InvocationOnMock invocationOnMock) throws Throwable {
            return null;
          }
        }
);
        lockMocks.add(mock);
        return mock;
      }
 else {
        return null;
      }
    }
  }
);
  cacheAccessBackDoor=mock(CacheAccessBackDoor.class);
  mockIndexing=mock(IndexingService.class);
}
