{
  if (neoStore != null) {
    fs.clear();
  }
  config=new Config(stringMap(GraphDatabaseSettings.dense_node_threshold.name(),"" + denseNodeThreshold));
  @SuppressWarnings("deprecation") StoreFactory storeFactory=new StoreFactory(config,idGeneratorFactory,windowPoolFactory,fs.get(),DEV_NULL,new DefaultTxHook());
  neoStore=storeFactory.createNeoStore(new File("neostore"));
  locks=mock(LockService.class,new Answer(){
    @Override public synchronized Object answer(    InvocationOnMock invocation) throws Throwable {
      Lock mock=mock(Lock.class);
      lockMocks.add(mock);
      return mock;
    }
  }
);
  cacheAccessBackDoor=mock(CacheAccessBackDoor.class);
}
