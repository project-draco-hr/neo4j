{
  TestGraphDatabaseFactory factory=new TestGraphDatabaseFactory();
  factory.setTransactionInterceptorProviders(asList(interceptorProviderThatBreaksStuff()));
  GraphDatabaseAPI db=(GraphDatabaseAPI)factory.newImpermanentDatabaseBuilder().setConfig(GraphDatabaseSettings.intercept_deserialized_transactions.name(),TRUE.toString()).setConfig(TransactionInterceptorProvider.class.getSimpleName() + ".breaker",TRUE.toString()).newGraphDatabase();
  XaDataSourceManager dsManager=db.getDependencyResolver().resolveDependency(XaDataSourceManager.class);
  XaDataSource ds=dsManager.getXaDataSource(NeoStoreXaDataSource.DEFAULT_DATA_SOURCE_NAME);
  try {
    ds.applyCommittedTransaction(2,simpleTransaction());
    fail("Should have failed");
  }
 catch (  BreakageException e) {
  }
  assertNotOk(beginTransaction(db));
  assertNotOk(applyTransaction(ds));
}
