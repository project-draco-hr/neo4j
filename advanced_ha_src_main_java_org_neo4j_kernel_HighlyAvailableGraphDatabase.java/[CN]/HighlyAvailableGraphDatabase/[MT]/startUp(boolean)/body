{
  StoreId storeId=null;
  if (!new File(storeDir,"neostore").exists()) {
    startupLatch=new CountDownLatch(1);
    try {
      long endTime=System.currentTimeMillis() + 10000;
      MASTER_ARBITRATION:       while (System.currentTimeMillis() < endTime) {
        Pair<Master,Machine> master=broker.getMaster();
        master=master.first() != null ? master : broker.getMasterReally();
        if (master != null && master.first() != null) {
          if (copyStoreFromMaster(master)) {
            break MASTER_ARBITRATION;
          }
        }
 else         if (allowInit) {
          StoreId myStoreId=new StoreId();
          storeId=broker.createCluster(myStoreId);
          if (storeId.equals(myStoreId)) {
            break MASTER_ARBITRATION;
          }
        }
        sleepWithoutInterruption(100,"Startup interrupted");
      }
    }
  finally {
      startupLatch.countDown();
      startupLatch=null;
    }
  }
  newMaster(null,storeId,new Exception());
  localGraph();
}
