{
  SegmentFile segment=new SegmentFile(fileSystem,file,contentMarshal,logProvider,header);
  if (fileSystem.fileExists(file)) {
    throw new IllegalStateException("File was not expected to exist");
  }
  headerMarshal.marshal(header,segment.getOrCreateWriter());
  return segment;
}
