{
  SlaveLocksClient reader=createClient();
  SlaveLocksClient writer=createClient();
  CountDownLatch readerCompletedLatch=new CountDownLatch(1);
  CountDownLatch resourceLatch=new CountDownLatch(1);
  when(master.endLockSession(any(RequestContext.class),anyBoolean())).then(new WaitLatchAnswer(resourceLatch,readerCompletedLatch));
  long nodeId=10l;
  ResourceReader resourceReader=new ResourceReader(reader,ResourceTypes.NODE,nodeId,resourceLatch,readerCompletedLatch);
  ResourceWriter resourceWriter=new ResourceWriter(writer,ResourceTypes.NODE,nodeId);
  executor.submit(resourceReader);
  executor.submit(resourceWriter);
  assertTrue("Reader should wait for writer to release locks before acquire",readerCompletedLatch.await(1000,TimeUnit.MILLISECONDS));
}
