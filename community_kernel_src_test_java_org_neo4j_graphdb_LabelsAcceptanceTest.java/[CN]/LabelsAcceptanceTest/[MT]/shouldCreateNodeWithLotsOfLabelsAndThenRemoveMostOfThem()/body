{
  final int TOTAL_NUMBER_OF_LABELS=200, NUMBER_OF_PRESERVED_LABELS=20;
  GraphDatabaseService db=dbRule.getGraphDatabaseService();
  Node node;
{
    Transaction tx=db.beginTx();
    try {
      node=db.createNode();
      for (int i=0; i < TOTAL_NUMBER_OF_LABELS; i++) {
        node.addLabel(DynamicLabel.label("label:" + i));
      }
      tx.success();
    }
  finally {
      tx.finish();
    }
  }
{
    Transaction tx=db.beginTx();
    try {
      for (int i=NUMBER_OF_PRESERVED_LABELS; i < TOTAL_NUMBER_OF_LABELS; i++) {
        node.removeLabel(DynamicLabel.label("label:" + i));
      }
      tx.success();
    }
  finally {
      tx.finish();
    }
  }
  dbRule.clearCache();
  Transaction transaction=db.beginTx();
  try {
    List<String> labels=new ArrayList<>();
    for (    Label label : node.getLabels()) {
      labels.add(label.name());
    }
    assertEquals("labels on node: " + labels,NUMBER_OF_PRESERVED_LABELS,labels.size());
  }
  finally {
    transaction.finish();
  }
}
