{
  try {
    String root=getRoot();
    String path=root + "/" + MASTER_NOTIFY_CHILD;
    byte[] data=null;
    boolean exists=false;
    try {
      data=zooKeeper.getData(path,true,null);
      exists=true;
      int id=ByteBuffer.wrap(data).getInt();
      if (id == currentMasterId) {
        return;
      }
    }
 catch (    KeeperException e) {
      if (e.code() != KeeperException.Code.NONODE) {
        throw new ZooKeeperException("Couldn't get master notify node",e);
      }
    }
    try {
      data=new byte[4];
      ByteBuffer.wrap(data).putInt(currentMasterId);
      if (!exists) {
        zooKeeper.create(path,data,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      }
 else {
        zooKeeper.setData(path,data,-1);
      }
      System.out.println("master-notify set to " + currentMasterId);
      zooKeeper.getData(path,true,null);
    }
 catch (    KeeperException e) {
      if (e.code() != KeeperException.Code.NODEEXISTS) {
        throw new ZooKeeperException("Couldn't set master notify node",e);
      }
    }
  }
 catch (  InterruptedException e) {
    Thread.interrupted();
    throw new ZooKeeperException("Interrupted",e);
  }
}
