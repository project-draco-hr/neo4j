@can_set_graph
def filter(self, **query):
    lookups = list(self._lookups)
    filters = list(self._filters)
    for key in query:
        attribute = getattr(self._Entity, key.split('__', 1)[0])
        if (attribute is None):
            raise AttributeError(("'%s' has no property matching '%s'" % (self._Entity.__name__, key)))
        attribute.query(key, query[key], lookups, filters)
    return self._create(self._Entity, self._graph, lookups, filters)
