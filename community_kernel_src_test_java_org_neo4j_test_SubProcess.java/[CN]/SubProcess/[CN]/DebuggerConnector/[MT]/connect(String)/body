{
  final com.sun.jdi.VirtualMachine vm;
  try {
    vm=connector.accept(args);
    connector.stopListening(args);
  }
 catch (  Exception e) {
    throw new RuntimeException("Debugger connection failure",e);
  }
  com.sun.jdi.request.EventRequestManager erm=vm.eventRequestManager();
  TYPES:   for (  Map.Entry<String,List<SubProcessBreakPoint>> entry : breakpoints.entrySet()) {
    for (    com.sun.jdi.ReferenceType type : vm.classesByName(entry.getKey())) {
      if (type.name().equals(entry.getKey())) {
        for (        SubProcessBreakPoint breakpoint : entry.getValue()) {
          breakpoint.setup(type);
        }
        continue TYPES;
      }
    }
    com.sun.jdi.request.ClassPrepareRequest prepare=erm.createClassPrepareRequest();
    prepare.addClassFilter(entry.getKey());
    prepare.enable();
  }
  if (vm.canRequestMonitorEvents()) {
    erm.createMonitorContendedEnterRequest().enable();
  }
  DebugDispatch dispatch=new DebugDispatch(vm.eventQueue(),breakpoints);
  new Thread(dispatch,"Debugger: [" + string + "]").start();
  return dispatch;
}
