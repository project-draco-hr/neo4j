{
  WebSocketClient client=mock(WebSocketClient.class);
  WebSocketConnection conn=new WebSocketConnection(client);
  when(client.isStopped()).thenReturn(true,true);
  byte[] data={0,1,2,3};
  conn.onWebSocketBinary(data,0,4);
  expectedException.expect(IOException.class);
  expectedException.expectMessage("Connection closed while waiting for data from the server.");
  conn.recv(10);
}
