{
  if (!slave) {
    throw new IllegalStateException("This is not a slave");
  }
  buffer.clear();
  buffer.limit(8);
  if (byteChannel.read(buffer) != 16) {
    throw new IOException("Unable to read log version");
  }
  buffer.flip();
  long txId=buffer.getLong();
  if (txId != (xaTf.getLastCommittedTx() + 1)) {
    throw new IllegalStateException("Tried to apply tx " + txId + " but expected transaction "+ (xaTf.getCurrentVersion() + 1));
  }
  log.fine("Logical log version: " + logVersion + ", committing tx="+ txId+ ")");
  long logEntriesFound=0;
  LogApplier logApplier=new LogApplier(byteChannel,buffer,xaTf,xaRm,cf,xidIdentMap,recoveredTxMap);
  while (logApplier.readAndApplyEntry()) {
    logEntriesFound++;
  }
  byteChannel.close();
  xaTf.flushAll();
  xaTf.setLastCommittedTx(txId);
  xaRm.reset();
  log.info("Tx[" + txId + "] "+ " applied successfully.");
}
