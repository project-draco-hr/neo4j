{
  if (!backupSlave) {
    throw new IllegalStateException("This is not a backup slave");
  }
  if (xidIdentMap.size() > 0) {
    throw new IllegalStateException("There are active transactions");
  }
  buffer.clear();
  buffer.limit(8);
  if (byteChannel.read(buffer) != 8) {
    throw new IOException("Unable to read log version");
  }
  buffer.flip();
  logVersion=buffer.getLong();
  if (logVersion != xaTf.getCurrentVersion()) {
    throw new IllegalStateException("Tried to apply version " + logVersion + " but expected version "+ xaTf.getCurrentVersion());
  }
  msgLog.logMessage("Applying log version=" + logVersion);
  log.fine("Logical log version: " + logVersion);
  long logEntriesFound=0;
  LogApplier logApplier=new LogApplier(byteChannel,buffer,xaTf,xaRm,cf,xidIdentMap,recoveredTxMap);
  scanIsComplete=false;
  while (logApplier.readAndApplyEntry()) {
    logEntriesFound++;
  }
  scanIsComplete=true;
  byteChannel.close();
  xaTf.flushAll();
  xaTf.getAndSetNewVersion();
  xaRm.reset();
  msgLog.logMessage("Apply of log version=" + logVersion + " successfull, "+ logEntriesFound+ " nr of log entries found.");
  log.info("Log[" + fileName + "] version "+ logVersion+ " applied successfully.");
}
