{
  long version=0;
  ReadableByteChannel log=null;
  TxPosition txPosition=txStartPositionCache.get(txId);
  try {
    if (txPosition != null) {
      version=txPosition.version;
      log=getLogicalLogOrMyself(version,txPosition.position);
    }
 else {
      version=findLogContainingTxId(txId)[0];
      if (version == -1) {
        throw new RuntimeException("txId:" + txId + " not found in any logical log "+ "(starting at "+ logVersion+ " and searching backwards");
      }
      log=getLogicalLogOrMyself(version,0);
      long[] header=readAndAssertLogHeader(buffer,log,version);
      long prevTxId=header[1];
      assertLogCanContainTx(txId,prevTxId);
    }
    return extractTransactionFromLog(txId,version,log,targetBuffer);
  }
  finally {
    if (log != null) {
      log.close();
    }
  }
}
