{
  File storeDir=new File("target/var/oldlog").getAbsoluteFile();
  GraphDatabaseService db=factory.newImpermanentDatabase(storeDir.getPath());
  File logBaseFileName=((GraphDatabaseAPI)db).getDependencyResolver().resolveDependency(Config.class).get(GraphDatabaseSettings.logical_log);
  Transaction tx=db.beginTx();
  db.createNode();
  tx.success();
  tx.finish();
  Pair<Pair<File,File>,Pair<File,File>> copy=copyLogicalLog(logBaseFileName);
  decrementLogFormat(copy.other().other());
  db.shutdown();
  renameCopiedLogicalLog(copy);
  try {
    db=factory.newImpermanentDatabase(storeDir.getPath());
    fail("Shouldn't be able to do recovery (and upgrade log format version) on non-clean shutdown");
  }
 catch (  Exception e) {
  }
}
