{
  String storeDir="target/var/oldlog";
  deleteFileOrDirectory(storeDir);
  GraphDatabaseService db=new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(storeDir).newGraphDatabase();
  Transaction tx=db.beginTx();
  db.createNode();
  tx.success();
  tx.finish();
  Pair<Pair<File,File>,Pair<File,File>> copy=copyLogicalLog(storeDir);
  decrementLogFormat(copy.other().other());
  db.shutdown();
  renameCopiedLogicalLog(storeDir);
  try {
    db=new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(storeDir).newGraphDatabase();
    fail("Shouldn't be able to do recovery (and upgrade log format version) on non-clean shutdown");
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
