{
  if (key == null) {
    throw new IllegalArgumentException("null key");
  }
  ArrayMap<Integer,Property> mapToCheck=null;
  if (cowPropertyMap != null && cowTxId == nodeManager.getTransaction()) {
    mapToCheck=cowPropertyMap;
  }
 else {
    ensureFullProperties();
    mapToCheck=propertyMap;
  }
  for (  PropertyIndex index : nodeManager.index(key)) {
    Property property=mapToCheck.get(index.getKeyId());
    if (property != null) {
      return getPropertyValue(property);
    }
  }
  if (!nodeManager.hasAllPropertyIndexes()) {
    for (    int keyId : mapToCheck.keySet()) {
      if (!nodeManager.hasIndexFor(keyId)) {
        PropertyIndex indexToCheck=nodeManager.getIndexFor(keyId);
        if (indexToCheck.getKey().equals(key)) {
          Property property=mapToCheck.get(indexToCheck.getKeyId());
          return getPropertyValue(property);
        }
      }
    }
  }
  return defaultValue;
}
