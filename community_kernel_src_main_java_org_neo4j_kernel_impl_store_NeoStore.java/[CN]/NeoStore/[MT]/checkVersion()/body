{
  try {
    verifyCorrectTypeDescriptorAndVersion();
    if (!getStoreOk()) {
      String foundVersion=versionLongToString(getRecord(fileSystemAbstraction,configuration.get(Configuration.neo_store),Position.STORE_VERSION));
      if (!CommonAbstractStore.ALL_STORES_VERSION.equals(foundVersion)) {
        throw new IllegalStateException(format("Mismatching store version found (%s while expecting %s). The store cannot be automatically upgraded since it isn't cleanly shutdown." + " Recover by starting the database using the previous Neo4j version, " + "followed by a clean shutdown. Then start with this version again.",foundVersion,CommonAbstractStore.ALL_STORES_VERSION));
      }
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to check version " + getStorageFileName(),e);
  }
}
