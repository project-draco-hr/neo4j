{
  String key1="key1";
  String value1="value1";
  String key2="key2";
  String value2="value2";
  T entity1=creator.create();
  index.add(entity1,key1,value1);
  index.add(entity1,key2,value2);
  T entity2=creator.create();
  index.add(entity2,key1,value1);
  index.add(entity2,key2,value2);
  restartTx();
  assertContains(index.get(key1,value1),entity1,entity2);
  assertContains(index.get(key2,value2),entity1,entity2);
  index.remove(entity1);
  assertContains(index.get(key1,value1),entity2);
  assertContains(index.get(key2,value2),entity2);
  index.add(entity1,key1,value1);
  for (int i=0; i < 2; i++) {
    assertContains(index.get(key1,value1),entity1,entity2);
    assertContains(index.get(key2,value2),entity2);
    restartTx();
  }
}
