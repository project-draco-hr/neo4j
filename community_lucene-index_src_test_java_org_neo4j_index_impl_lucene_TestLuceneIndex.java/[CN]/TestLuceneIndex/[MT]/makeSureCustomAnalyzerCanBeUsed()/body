{
  CustomAnalyzer.called=false;
  Index<Node> index=nodeIndex("w-custom-analyzer",MapUtil.stringMap(IndexManager.PROVIDER,"lucene","analyzer",org.neo4j.index.impl.lucene.CustomAnalyzer.class.getName(),"to_lower_case","true"));
  Node node=graphDb.createNode();
  String key="name";
  String value="The value";
  index.add(node,key,value);
  restartTx();
  assertTrue(CustomAnalyzer.called);
  assertThat(index.query(key,"[A TO Z]"),contains(node));
}
