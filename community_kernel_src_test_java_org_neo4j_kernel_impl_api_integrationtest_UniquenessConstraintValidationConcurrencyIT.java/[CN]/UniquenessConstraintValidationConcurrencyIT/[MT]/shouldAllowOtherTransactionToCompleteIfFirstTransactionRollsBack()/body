{
  database.transaction(createUniquenessConstraint("Label1","key1"));
  Future<Boolean> created=database.failingTransaction(new Function<GraphDatabaseService,Future<Boolean>>(){
    @Override public Future<Boolean> apply(    GraphDatabaseService db){
      db.createNode(label("Label1")).setProperty("key1","value1");
      try {
        return otherThread.execute(createNode(db,"Label1","key1","value1"));
      }
  finally {
        assertThat(otherThread,isWaiting());
      }
    }
  }
);
  assertTrue("Node creation should succeed",created.get());
}
