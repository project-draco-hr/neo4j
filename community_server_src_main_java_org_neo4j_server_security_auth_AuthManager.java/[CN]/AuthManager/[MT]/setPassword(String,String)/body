{
  User existingUser=users.findByName(username);
  if (existingUser == null) {
    return null;
  }
  if (existingUser.credentials().matchesPassword(password)) {
    return existingUser;
  }
  try {
    User updatedUser=existingUser.augment().withCredentials(Credential.forPassword(password)).withRequiredPasswordChange(false).build();
    users.update(existingUser,updatedUser);
    return updatedUser;
  }
 catch (  ConcurrentModificationException e) {
    return setPassword(username,password);
  }
}
