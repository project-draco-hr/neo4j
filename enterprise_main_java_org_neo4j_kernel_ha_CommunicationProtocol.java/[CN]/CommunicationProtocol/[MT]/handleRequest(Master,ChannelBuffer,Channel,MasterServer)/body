{
  RequestType type=RequestType.values()[buffer.readByte()];
  SlaveContext context=null;
  if (type.includesSlaveContext()) {
    context=readSlaveContext(buffer);
    server.mapSlave(channel,context);
  }
  System.out.println(Thread.currentThread() + " Got request from slave: " + type+ ", "+ context);
  Response<?> response=type.caller.callMaster(realMaster,context,buffer);
  System.out.println(Thread.currentThread() + " Handled request and got " + response.response()+ " as response object");
  ChannelBuffer targetBuffer=ChannelBuffers.dynamicBuffer();
  type.serializer.write(response.response(),targetBuffer);
  if (type.includesSlaveContext()) {
    writeTransactionStreams(response.transactions(),targetBuffer);
  }
  return new Pair<ChannelBuffer,SlaveContext>(targetBuffer,context);
}
