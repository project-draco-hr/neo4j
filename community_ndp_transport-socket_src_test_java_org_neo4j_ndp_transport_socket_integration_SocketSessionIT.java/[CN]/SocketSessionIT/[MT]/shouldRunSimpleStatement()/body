{
  NDPConn client=new NDPConn();
  client.connect(server.address()).send(acceptedVersions(1,0,0,0)).send(chunk(run("UNWIND [1,2,3] AS a RETURN a, a * a AS a_squared"),pullAll()));
  assertThat(client,eventuallyRecieves(new byte[]{0,0,0,1}));
  assertThat(client,eventuallyRecieves(msgSuccess(map("fields",asList("a","a_squared"))),msgRecord(eqRecord(equalTo(1l),equalTo(1l))),msgRecord(eqRecord(equalTo(2l),equalTo(4l))),msgRecord(eqRecord(equalTo(3l),equalTo(9l))),msgSuccess()));
}
