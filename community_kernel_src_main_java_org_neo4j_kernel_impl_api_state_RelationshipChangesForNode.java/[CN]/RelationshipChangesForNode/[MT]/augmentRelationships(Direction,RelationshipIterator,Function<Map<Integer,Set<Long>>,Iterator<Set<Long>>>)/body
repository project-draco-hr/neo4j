{
switch (direction) {
case INCOMING:
    if (incoming != null && !incoming.isEmpty()) {
      rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(incoming),relationshipHome);
    }
  break;
case OUTGOING:
if (outgoing != null && !outgoing.isEmpty()) {
  rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(outgoing),relationshipHome);
}
break;
case BOTH:
if (outgoing != null && !outgoing.isEmpty()) {
rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(outgoing),relationshipHome);
}
if (incoming != null && !incoming.isEmpty()) {
rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(incoming),relationshipHome);
}
break;
default :
throw new IllegalArgumentException("Unknown direction: " + direction);
}
if (loops != null && !loops.isEmpty()) {
rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(loops),relationshipHome);
}
return rels;
}
