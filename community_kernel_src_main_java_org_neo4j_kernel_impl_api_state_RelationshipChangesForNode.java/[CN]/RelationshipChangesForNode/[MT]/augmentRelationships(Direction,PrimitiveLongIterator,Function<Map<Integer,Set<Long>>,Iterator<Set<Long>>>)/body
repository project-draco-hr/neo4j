{
switch (direction) {
case INCOMING:
    if (incoming != null) {
      rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(incoming));
    }
  break;
case OUTGOING:
if (outgoing != null) {
  rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(outgoing));
}
break;
case BOTH:
if (outgoing != null) {
rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(outgoing));
}
if (incoming != null) {
rels=diffStrategy.augmentPrimitiveIterator(rels,typeFilter.apply(incoming));
}
break;
}
if (loops != null) {
rels=diffStrategy.augmentPrimitiveIterator(rels,loops.values().iterator());
}
return rels;
}
