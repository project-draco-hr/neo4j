{
  Transaction tx=ragManager.getCurrentTransaction();
  if (tx == null) {
    tx=new PlaceboTransaction();
  }
  TxLockElement tle=txLockElementMap.get(tx);
  if (tle == null) {
    tle=new TxLockElement(tx);
  }
  try {
    tle.movedOn=false;
    while (writeCount > tle.writeCount) {
      ragManager.checkWaitOn(this,tx);
      waitingThreadList.addFirst(new WaitElement(tle,LockType.READ,Thread.currentThread()));
      try {
        wait();
      }
 catch (      InterruptedException e) {
        Thread.interrupted();
      }
      ragManager.stopWaitOn(this,tx);
    }
    if (tle.readCount == 0 && tle.writeCount == 0) {
      ragManager.lockAcquired(this,tx);
    }
    readCount++;
    tle.readCount++;
    tle.movedOn=true;
    txLockElementMap.put(tx,tle);
  }
  finally {
    marked--;
  }
}
