{
  String key="key_get";
  String value="value";
  String name1="Thomas Anderson";
  String name2="Agent Smith";
  String indexName="matrix";
  Index<Node> index=helper.createNodeIndex(indexName);
  URI location1=(URI)service.jsonCreateNode("{\"name\":\"" + name1 + "\"}").getMetadata().getFirst("Location");
  URI location2=(URI)service.jsonCreateNode("{\"name\":\"" + name2 + "\"}").getMetadata().getFirst("Location");
  URI indexLocation1=(URI)service.jsonAddToNodeIndex(indexName,key,value,JsonHelper.createJsonFrom(location1.toString())).getMetadata().getFirst("Location");
  URI indexLocation2=(URI)service.jsonAddToNodeIndex(indexName,key,value,JsonHelper.createJsonFrom(location2.toString())).getMetadata().getFirst("Location");
  Map<String,String> uriToName=new HashMap<String,String>();
  uriToName.put(indexLocation1.toString(),name1);
  uriToName.put(indexLocation2.toString(),name2);
  Response response=service.jsonGetIndexedNodes(indexName,key,value);
  assertEquals(Status.OK.getStatusCode(),response.getStatus());
  Collection<?> items=(Collection<?>)JsonHelper.jsonToSingleValue(entityAsString(response));
  int counter=0;
  for (  Object item : items) {
    Map<?,?> map=(Map<?,?>)item;
    Map<?,?> properties=(Map<?,?>)map.get("data");
    assertNotNull(map.get("self"));
    String indexedUri=(String)map.get("indexed");
    assertEquals(uriToName.get(indexedUri),properties.get("name"));
    counter++;
  }
  assertEquals(2,counter);
}
