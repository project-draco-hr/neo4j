{
  PersistenceWindow window=acquireWindow(record.getId(),OperationType.WRITE);
  try {
    updateRecord(record,window);
  }
  finally {
    releaseWindow(window);
  }
  if (!record.isLight()) {
    for (    DynamicRecord valueRecord : record.getValueRecords()) {
      if (valueRecord.getType() == PropertyType.STRING.intValue()) {
        stringPropertyStore.updateRecord(valueRecord);
      }
 else       if (valueRecord.getType() == PropertyType.ARRAY.intValue()) {
        arrayPropertyStore.updateRecord(valueRecord);
      }
 else {
        throw new InvalidRecordException("Unknown dynamic record");
      }
    }
  }
}
