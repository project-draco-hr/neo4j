{
  File luceneDir=new File("lucene");
  fs.get().mkdir(luceneDir);
  Directory directory=new DirectoryFactory.InMemoryDirectoryFactory().open(luceneDir);
  IndexWriterConfig config=new IndexWriterConfig(null);
  ReservingLuceneIndexWriter indexWriter=new ReservingLuceneIndexWriter(directory,config);
  ReservingLuceneIndexWriter indexWriterSpy=spy(indexWriter);
  when(indexWriterSpy.maxDocLimit()).thenReturn(maxDocLimit);
  return indexWriterSpy;
}
