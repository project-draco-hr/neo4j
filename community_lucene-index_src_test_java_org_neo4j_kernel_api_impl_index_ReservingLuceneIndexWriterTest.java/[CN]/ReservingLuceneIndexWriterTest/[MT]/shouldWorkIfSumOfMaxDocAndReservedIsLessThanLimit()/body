{
  int maxDocLimit=100;
  int toAdd=maxDocLimit / 2;
  int toReserve=maxDocLimit - toAdd - 7;
  LuceneDocumentStructure documentStructure=new LuceneDocumentStructure();
  ReservingLuceneIndexWriter indexWriter=newReservingLuceneIndexWriter(maxDocLimit);
  for (int i=0; i < toAdd; i++) {
    indexWriter.addDocument(documentStructure.reusedDocument(i));
  }
  indexWriter.reserveInsertions(toReserve);
  assertEquals(toAdd,indexWriter.createSearcherManager().acquire().getIndexReader().maxDoc());
}
