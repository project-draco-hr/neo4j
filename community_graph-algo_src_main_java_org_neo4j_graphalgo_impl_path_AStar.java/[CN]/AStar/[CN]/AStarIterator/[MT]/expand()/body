{
  Iterable<Relationship> expand=expander.expand(this,BranchState.NO_STATE);
  for (  Relationship rel : expand) {
    lastMetadata.rels++;
    Node node=rel.getOtherNode(lastNode);
    Visit visit=visitData.get(node.getId());
    if (visit != null && visit.visited) {
      continue;
    }
    Visit lastVisit=visitData.get(lastNode.getId());
    double tentativeGScore=lastVisit.wayLength + lengthEvaluator.getCost(rel,Direction.OUTGOING);
    double estimate=estimateEvaluator.getCost(node,end);
    if (visit == null || !visit.next || tentativeGScore < visit.wayLength) {
      if (visit == null) {
        visit=new Visit(rel.getId(),tentativeGScore,estimate);
        visitData.put(node.getId(),visit);
      }
 else {
        visit.update(rel.getId(),tentativeGScore,estimate);
      }
      addNext(node,estimate + tentativeGScore,visit);
    }
  }
}
