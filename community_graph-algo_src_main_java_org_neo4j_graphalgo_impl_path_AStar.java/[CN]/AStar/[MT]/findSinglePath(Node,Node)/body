{
  lastMetadata=new Metadata();
  AStarIterator iterator=new AStarIterator(start,end);
  while (iterator.hasNext()) {
    Node node=iterator.next();
    GraphDatabaseService graphDb=node.getGraphDatabase();
    if (node.equals(end)) {
      double weight=iterator.visitData.get(node.getId()).wayLength;
      LinkedList<Relationship> rels=new LinkedList<Relationship>();
      Relationship rel=graphDb.getRelationshipById(iterator.visitData.get(node.getId()).cameFromRelationship);
      while (rel != null) {
        rels.addFirst(rel);
        node=rel.getOtherNode(node);
        long nextRelId=iterator.visitData.get(node.getId()).cameFromRelationship;
        rel=nextRelId == -1 ? null : graphDb.getRelationshipById(nextRelId);
      }
      Path path=toPath(start,rels);
      lastMetadata.paths++;
      return new WeightedPathImpl(weight,path);
    }
  }
  return null;
}
