{
  lastMetadata=new Metadata();
  Doer doer=new Doer(start,end);
  while (doer.hasNext()) {
    Node node=doer.next();
    GraphDatabaseService graphDb=node.getGraphDatabase();
    if (node.equals(end)) {
      double weight=doer.score.get(node.getId()).wayLength;
      LinkedList<Relationship> rels=new LinkedList<Relationship>();
      Relationship rel=graphDb.getRelationshipById(doer.cameFrom.get(node.getId()));
      while (rel != null) {
        rels.addFirst(rel);
        node=rel.getOtherNode(node);
        Long nextRelId=doer.cameFrom.get(node.getId());
        rel=nextRelId == null ? null : graphDb.getRelationshipById(nextRelId);
      }
      Path path=toPath(start,rels);
      lastMetadata.paths++;
      return new WeightedPathImpl(weight,path);
    }
  }
  return null;
}
