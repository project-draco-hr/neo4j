{
  String name="name";
  String mattias="Mattias Persson";
  String title="title";
  String hacker="Hacker";
  assertThat(index.get(name,mattias),isEmpty());
  T entity1=creator.create();
  T entity2=creator.create();
  assertNull(index.get(name,mattias).getSingle());
  index.add(entity1,name,mattias);
  assertThat(index.get(name,mattias),contains(entity1));
  assertQueryNotPossible(index);
  assertEquals(entity1,index.get(name,mattias).getSingle());
  assertQueryNotPossible(index);
  commitTx();
  assertThat(index.get(name,mattias),contains(entity1));
  assertThat(index.query(name,"\"" + mattias + "\""),contains(entity1));
  assertThat(index.query("name:\"" + mattias + "\""),contains(entity1));
  assertEquals(entity1,index.get(name,mattias).getSingle());
  assertThat(index.query("name","Mattias*"),contains(entity1));
  beginTx();
  index.add(entity2,title,hacker);
  index.add(entity1,title,hacker);
  assertThat(index.get(name,mattias),contains(entity1));
  assertThat(index.get(title,hacker),contains(entity1,entity2));
  assertQueryNotPossible(index);
  commitTx();
  assertThat(index.get(name,mattias),contains(entity1));
  assertThat(index.get(title,hacker),contains(entity1,entity2));
  assertThat(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),contains(entity1,entity2));
  assertThat(index.query("name:\"" + mattias + "\" AND title:\""+ hacker+ "\""),contains(entity1));
  beginTx();
  index.remove(entity2,title,hacker);
  assertThat(index.get(name,mattias),contains(entity1));
  assertThat(index.get(title,hacker),contains(entity1));
  assertQueryNotPossible(index);
  commitTx();
  assertThat(index.get(name,mattias),contains(entity1));
  assertThat(index.get(title,hacker),contains(entity1));
  assertThat(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),contains(entity1));
  beginTx();
  index.remove(entity1,title,hacker);
  index.remove(entity1,name,mattias);
  index.delete();
  commitTx();
}
