{
  Direction existingDirection=directions.get(type.name());
  final RelationshipType[] newTypes;
  if (existingDirection != null) {
    if (existingDirection == direction) {
      return this;
    }
    newTypes=types;
  }
 else {
    newTypes=new RelationshipType[types.length + 1];
    System.arraycopy(types,0,newTypes,0,types.length);
    newTypes[types.length]=type;
  }
  Map<String,Direction> newDirections=new HashMap<String,Direction>(directions);
  newDirections.put(type.name(),direction);
  return new DefaultExpander(newTypes,newDirections);
}
