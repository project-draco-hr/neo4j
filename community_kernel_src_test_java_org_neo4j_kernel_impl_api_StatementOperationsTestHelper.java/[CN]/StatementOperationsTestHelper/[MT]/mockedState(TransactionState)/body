{
  KernelStatement state=mock(KernelStatement.class);
  Locks.Client lockHolder=mock(Locks.Client.class);
  try {
    IndexReader indexReader=mock(IndexReader.class);
    when(indexReader.indexSeek(Matchers.any())).thenReturn(PrimitiveLongCollections.emptyIterator());
    when(state.getIndexReader(Matchers.<IndexDescriptor>any())).thenReturn(indexReader);
  }
 catch (  IndexNotFoundKernelException e) {
    throw new Error(e);
  }
  when(state.txState()).thenReturn(txState);
  when(state.hasTxStateWithChanges()).thenAnswer(new Answer<Boolean>(){
    @Override public Boolean answer(    InvocationOnMock invocation) throws Throwable {
      return txState.hasChanges();
    }
  }
);
  when(state.locks()).thenReturn(lockHolder);
  return state;
}
