{
  monitor.init();
  directory=directoryFactory.open(directoryLocation);
  if (readOnly) {
    try {
      searcherManager=new SearcherManager(directory,new SearcherFactory());
    }
 catch (    IndexNotFoundException inf) {
      monitor.noIndex();
      throw new IOException("Label scan store not found while database was started in read only mode. " + "To trigger a rebuild please restart database in writable mode.",inf);
    }
catch (    IOException e) {
      monitor.corruptIndex(e);
      throw new IOException("Label scan store could not be read. " + "To trigger a rebuild please restart database in writable mode.",e);
    }
  }
 else {
    try {
      IndexReader.open(directory).close();
      writer=writerFactory.create(directory);
    }
 catch (    IndexNotFoundException e) {
      monitor.noIndex();
      prepareRebuildOfIndex();
      writer=writerFactory.create(directory);
    }
catch (    LockObtainFailedException e) {
      monitor.lockedIndex(e);
      throw e;
    }
catch (    IOException e) {
      monitor.corruptIndex(e);
      throw new IOException("Label scan store could not be read, and needs to be rebuilt. " + "To trigger a rebuild, ensure the database is stopped, delete the files in '" + directoryLocation.getAbsolutePath() + "', and then start the database again.");
    }
    searcherManager=writer.createSearcherManager();
  }
}
