{
  availabilityGuard.deny(this);
  if (txManager instanceof TxManager) {
    long start=Clock.REAL_CLOCK.currentTimeMillis();
    TxManager realTxManager=(TxManager)txManager;
    while (realTxManager.getActiveTxCount() > 0 && Clock.REAL_CLOCK.currentTimeMillis() < start + 20 * 1000) {
      Thread.yield();
    }
  }
}
