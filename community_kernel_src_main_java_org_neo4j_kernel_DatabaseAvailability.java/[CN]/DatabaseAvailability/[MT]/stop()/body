{
  availabilityGuard.deny(this);
  if (txManager instanceof TxManager) {
    long deadline=Clock.SYSTEM_CLOCK.currentTimeMillis() + 20 * 1000;
    TxManager realTxManager=(TxManager)txManager;
    while (realTxManager.getActiveTxCount() > 0 && Clock.SYSTEM_CLOCK.currentTimeMillis() < deadline) {
      Thread.yield();
    }
  }
}
