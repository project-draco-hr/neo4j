{
  TxLockElement tle=getOrCreateLockElement(tx);
  LockRequest lockRequest=null;
  boolean addLockRequest=true;
  try {
    tle.incrementRequests();
    Thread currentThread=currentThread();
    while (!tle.isTerminated() && (totalWriteCount > tle.writeCount)) {
      ragManager.checkWaitOn(this,tx);
      if (addLockRequest) {
        lockRequest=new LockRequest(tle,READ,currentThread);
        waitingThreadList.addFirst(lockRequest);
      }
      try {
        wait();
        addLockRequest=false;
      }
 catch (      InterruptedException e) {
        interrupted();
        addLockRequest=true;
      }
      ragManager.stopWaitOn(this,tx);
    }
    if (!tle.isTerminated()) {
      registerReadLockAcquired(tx,tle);
      return true;
    }
 else {
      if (tle.requests == 1 && tle.isFree()) {
        txLockElementMap.remove(tx);
      }
      return false;
    }
  }
  finally {
    cleanupWaitingListRequests(lockRequest,tle,addLockRequest);
    interrupted();
    tle.decrementRequests();
    unmark();
  }
}
