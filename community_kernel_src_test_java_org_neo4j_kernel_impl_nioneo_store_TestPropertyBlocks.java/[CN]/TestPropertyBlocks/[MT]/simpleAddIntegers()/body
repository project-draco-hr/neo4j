{
  long inUseBefore=propertyRecordsInUse();
  Node node=getGraphDb().createNode();
  for (int i=0; i < PropertyType.getPayloadSizeLongs(); i++) {
    node.setProperty("prop" + i,i);
    assertEquals(inUseBefore + 1,propertyRecordsInUse());
    assertEquals(i,node.getProperty("prop" + i));
  }
  newTransaction();
  clearCache();
  assertEquals(inUseBefore + 1,propertyRecordsInUse());
  for (int i=0; i < PropertyType.getPayloadSizeLongs(); i++) {
    assertEquals(i,node.getProperty("prop" + i));
  }
  for (int i=0; i < PropertyType.getPayloadSizeLongs(); i++) {
    assertEquals(i,node.removeProperty("prop" + i));
    assertFalse(node.hasProperty("prop" + i));
  }
  commit();
  assertEquals(inUseBefore,propertyRecordsInUse());
}
