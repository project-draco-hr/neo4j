{
  StoreReadLayer store=generateStore();
  HeuristicsCollectedData collectedData=new HeuristicsCollectedData();
  RuntimeHeuristicsService service=new RuntimeHeuristicsService(collectedData,store,null);
  HeuristicsCollector collector=new HeuristicsCollector(store,collectedData);
  collector.run();
  service.save(fs,new File(dir.directory(),"somefile"));
  service.save(fs,new File(dir.directory(),"somefile"));
  HeuristicsCollectedData expected=(HeuristicsCollectedData)RuntimeHeuristicsService.load(fs,new File(dir.directory(),"somefile"),store,null).heuristics();
  assertThat(expected,equalTo(collector.collectedData()));
}
