{
  TransactionMarker marker=registry.get(id);
  if (null == marker) {
    throw new IllegalStateException("Trying to suspend unregistered transaction");
  }
  if (marker.isSuspended()) {
    throw new IllegalStateException("Trying to suspend transaction that was already suspended");
  }
  SuspendedTransaction suspendedTx=new SuspendedTransaction(marker.getActiveTransaction(),transactionHandle);
  if (!registry.replace(id,marker,suspendedTx)) {
    throw new IllegalStateException("Trying to suspend transaction that has been concurrently suspended");
  }
  return computeNewExpiryTime(suspendedTx.getLastActiveTimestamp());
}
