{
  long id=idGenerator.incrementAndGet();
  if (null == registry.putIfAbsent(id,ActiveTransaction.INSTANCE)) {
    return id;
  }
 else {
    throw new IllegalStateException("Attempt to begin transaction for id that was already registered");
  }
}
