{
  TransactionRegistry registry=new TransactionHandleRegistry(mock(Clock.class),StringLogger.DEV_NULL);
  TransactionFacade actions=new TransactionFacade(mock(TransitionalPeriodTransactionMessContainer.class),null,registry,null);
  final TransactionHandle transactionHandle=actions.newTransactionHandle();
  final DoubleLatch latch=new DoubleLatch();
  final StatementDeserializer statements=mock(StatementDeserializer.class);
  when(statements.hasNext()).thenAnswer(new Answer<Boolean>(){
    @Override public Boolean answer(    InvocationOnMock invocation) throws Throwable {
      latch.startAndAwaitFinish();
      return false;
    }
  }
);
  new Thread(new Runnable(){
    @Override public void run(){
      transactionHandle.execute(statements,mock(ResultHandler.class));
    }
  }
).start();
  latch.awaitStart();
  try {
    actions.findTransactionHandle(transactionHandle.getId());
    fail("should have thrown exception");
  }
 catch (  ConcurrentTransactionAccessError neo4jError) {
  }
 finally {
    latch.finish();
  }
}
