{
  users=new InMemoryUserRepository();
  authStrategy=mock(AuthenticationStrategy.class);
  logProvider=new AssertableLogProvider();
  Log log=logProvider.getLog(this.getClass());
  InternalFlatFileRealm internalFlatFileRealm=new InternalFlatFileRealm(users,new InMemoryRoleRepository(),mock(PasswordPolicy.class),authStrategy,mock(JobScheduler.class));
  manager=new MultiRealmAuthManager(internalFlatFileRealm,Collections.singleton(internalFlatFileRealm),new MemoryConstrainedCacheManager(),new SecurityLog(log));
  manager.init();
  userManager=manager.getUserManager();
}
