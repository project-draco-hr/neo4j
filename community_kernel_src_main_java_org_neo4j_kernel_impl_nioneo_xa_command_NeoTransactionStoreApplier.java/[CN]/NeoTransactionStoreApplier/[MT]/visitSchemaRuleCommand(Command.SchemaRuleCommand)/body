{
  for (  DynamicRecord record : command.getRecordsAfter()) {
    if (recovery) {
      neoStore.getSchemaStore().setHighId(record.getId());
    }
    neoStore.getSchemaStore().updateRecord(record);
  }
  if (command.getSchemaRule() instanceof IndexRule) {
switch (command.getMode()) {
case UPDATE:
      if (((IndexRule)command.getSchemaRule()).isConstraintIndex()) {
        try {
          indexes.activateIndex(command.getSchemaRule().getId());
        }
 catch (        IndexNotFoundKernelException|IndexActivationFailedKernelException|IndexPopulationFailedKernelException e) {
          throw new IllegalStateException("Unable to enable constraint, backing index is not online.",e);
        }
      }
    break;
case CREATE:
  indexes.createIndex((IndexRule)command.getSchemaRule());
break;
case DELETE:
indexes.dropIndex((IndexRule)command.getSchemaRule());
break;
default :
throw new IllegalStateException(command.getMode().name());
}
}
if (command.getSchemaRule() instanceof UniquenessConstraintRule) {
switch (command.getMode()) {
case UPDATE:
case CREATE:
neoStore.setLatestConstraintIntroducingTx(transactionId);
break;
case DELETE:
break;
default :
throw new IllegalStateException(command.getMode().name());
}
}
switch (command.getMode()) {
case DELETE:
invalidateCache(command);
break;
default :
cacheAccess.addSchemaRule(command.getSchemaRule());
invalidateCache(command);
}
return true;
}
