{
  RecordingCallback<StatementMetadata,Object> responses=new RecordingCallback<>();
  doThrow(new SyntaxException("src/test")).when(runner).run(any(SessionState.class),any(String.class),anyMapOf(String.class,Object.class));
  SessionStateMachine machine=newIdleMachine();
  machine.run("this is nonsense",EMPTY_PARAMS,null,responses);
  assertThat(responses.next(),failedWith(Status.Statement.SyntaxError));
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
}
