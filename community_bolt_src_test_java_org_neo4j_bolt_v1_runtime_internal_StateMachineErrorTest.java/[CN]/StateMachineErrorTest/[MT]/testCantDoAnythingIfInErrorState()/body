{
  RecordingCallback<StatementMetadata,Object> messages=new RecordingCallback<>();
  RecordingCallback<RecordStream,Object> pulling=new RecordingCallback<>();
  RecordingCallback<Boolean,Object> initializing=new RecordingCallback<>();
  SessionStateMachine machine=newIdleMachine();
  machine.commitTransaction();
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  machine.beginTransaction();
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  machine.beginImplicitTransaction();
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  machine.commitTransaction();
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  machine.rollbackTransaction();
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  machine.run("src/test",EMPTY_PARAMS,messages);
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  assertThat(messages.next(),SessionMatchers.ignored());
  machine.pullAll(pulling);
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  assertThat(pulling.next(),SessionMatchers.ignored());
  machine.init("",Collections.emptyMap(),-1,initializing);
  assertThat(machine.state(),equalTo(SessionStateMachine.State.ERROR));
  assertThat(initializing.next(),SessionMatchers.ignored());
  Mockito.verifyNoMoreInteractions(db,runner);
}
