{
  IdGeneratorFactory idGeneratorFactory=(IdGeneratorFactory)config.get(IdGeneratorFactory.class);
  FileSystemAbstraction fileSystem=(FileSystemAbstraction)config.get(FileSystemAbstraction.class);
  StoreId storeId=(StoreId)config.get(StoreId.class);
  if (storeId == null)   storeId=new StoreId();
  createEmptyStore(fileName,buildTypeDescriptorAndVersion(TYPE_DESCRIPTOR),idGeneratorFactory,fileSystem);
  NodeStore.createStore(fileName + ".nodestore.db",config);
  RelationshipStore.createStore(fileName + ".relationshipstore.db",idGeneratorFactory,fileSystem);
  PropertyStore.createStore(fileName + ".propertystore.db",config);
  RelationshipTypeStore.createStore(fileName + ".relationshiptypestore.db",config);
  if (!config.containsKey("neo_store")) {
    Map<Object,Object> newConfig=new HashMap<Object,Object>(config);
    newConfig.put("neo_store",fileName);
    config=newConfig;
  }
  NeoStore neoStore=new NeoStore(config);
  for (int i=0; i < 6; i++)   neoStore.nextId();
  neoStore.setCreationTime(storeId.getCreationTime());
  neoStore.setRandomNumber(storeId.getRandomId());
  neoStore.setVersion(0);
  neoStore.setLastCommittedTx(1);
  neoStore.setStoreVersion(storeId.getStoreVersion());
  neoStore.setGraphNextProp(-1);
  neoStore.close();
}
