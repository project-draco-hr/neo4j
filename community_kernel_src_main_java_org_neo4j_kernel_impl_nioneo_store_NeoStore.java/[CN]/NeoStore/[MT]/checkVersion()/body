{
  try {
    verifyCorrectTypeDescriptorAndVersion();
    if (!getStoreOk()) {
      String foundVersion=versionLongToString(getStoreVersion(fileSystemAbstraction,configuration.get(Configuration.neo_store)));
      if (!CommonAbstractStore.ALL_STORES_VERSION.equals(foundVersion)) {
        throw new IllegalStateException(String.format("Mismatching store version found (%s while expecting %s) and the store is not cleanly shutdown." + " Recover the database with the previous database version and then attempt to upgrade",foundVersion,CommonAbstractStore.ALL_STORES_VERSION));
      }
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to check version " + getStorageFileName(),e);
  }
}
