{
  List<String> nonRecoveredRecording=new ArrayList<>();
  NeoStoreTransaction nonRecoveredTx=newWriteTransaction();
  injectAllPossibleCommands(nonRecoveredTx);
  List<String> recoveredRecording=new ArrayList<>();
  NeoStoreTransaction recoveredTx=newWriteTransaction();
  recoveredTx.setRecovered();
  injectAllPossibleCommands(recoveredTx);
  currentRecording.set(nonRecoveredRecording);
  nonRecoveredTx.doPrepare();
  try (LockGroup lockGroup=new LockGroup()){
    nonRecoveredTx.doCommit(lockGroup);
  }
   currentRecording.set(recoveredRecording);
  recoveredTx.doPrepare();
  try (LockGroup lockGroup=new LockGroup()){
    recoveredTx.doCommit(lockGroup);
  }
   assertThat(nonRecoveredRecording,equalTo(recoveredRecording));
  assertThat(new HashSet<>(recoveredRecording).size(),is(9));
}
