{
  int additionalNodeCount=50;
  setExpectedResults(1 + additionalNodeCount,0,additionalNodeCount * 2,0,0,additionalNodeCount * 2);
  startUpMaster(MapUtil.stringMap());
  for (int i=0; i < additionalNodeCount; i++) {
    executeJobOnMaster(new CommonJobs.CreateNodeAndNewIndexJob("users","the key " + i,"the best value","a key " + i,"the worst value"));
  }
  int slaveId=addDb(MapUtil.stringMap(),true);
  awaitAllStarted();
  shutdownDb(slaveId);
  File slavePath=dbPath(slaveId);
  EmbeddedGraphDatabase slaveDb=new EmbeddedGraphDatabase(slavePath.getAbsolutePath());
  XaDataSource dataSource=slaveDb.getConfig().getTxModule().getXaDataSourceManager().getXaDataSource(Config.DEFAULT_DATA_SOURCE_NAME);
  long lastTxId=dataSource.getLastCommittedTxId();
  LogExtractor extractor=dataSource.getXaContainer().getLogicalLog().getLogExtractor(2,lastTxId);
  for (long txId=2; txId < lastTxId; txId++) {
    long extractedTxId=extractor.extractNext(new InMemoryLogBuffer());
    assertEquals(txId,extractedTxId);
  }
  extractor.close();
  slaveDb.shutdown();
  startDb(slaveId,MapUtil.stringMap(),true);
}
