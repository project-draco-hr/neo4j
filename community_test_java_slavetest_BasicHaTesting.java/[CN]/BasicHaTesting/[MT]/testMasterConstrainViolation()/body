{
  initializeDbs(1);
  GraphDatabaseService haDb=haDbs.get(0);
  Transaction tx=haDb.beginTx();
  Node node1;
  try {
    node1=haDb.createNode();
    Relationship rel1=haDb.getReferenceNode().createRelationshipTo(node1,REL_TYPE);
    node1.setProperty("name","Mattias");
    rel1.setProperty("something else","Somewhat different");
    tx.success();
  }
  finally {
    tx.finish();
  }
  tx=master.getGraphDb().beginTx();
  try {
    master.getGraphDb().getNodeById(node1.getId()).delete();
    tx.success();
  }
  finally {
    try {
      tx.finish();
      fail("Should throw exception");
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
  }
  ((HighlyAvailableGraphDatabase)haDb).pullUpdates();
  assertTrue(haDb.getNodeById(node1.getId()) != null);
}
