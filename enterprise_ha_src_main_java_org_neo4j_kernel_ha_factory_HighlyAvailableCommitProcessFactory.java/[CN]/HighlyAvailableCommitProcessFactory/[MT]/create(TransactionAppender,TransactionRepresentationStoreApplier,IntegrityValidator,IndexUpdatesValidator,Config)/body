{
  if (config.get(GraphDatabaseSettings.read_only)) {
    return new ReadOnlyTransactionCommitProcess();
  }
  TransactionCommitProcess commitProcess=new TransactionRepresentationCommitProcess(appender,storeApplier,indexUpdatesValidator);
  CommitProcessSwitcher commitProcessSwitcher=new CommitProcessSwitcher(transactionPropagator,master,commitProcessDelegate,requestContextFactory,integrityValidator,commitProcess);
  componentSwitcherContainer.add(commitProcessSwitcher);
  return (TransactionCommitProcess)newProxyInstance(TransactionCommitProcess.class.getClassLoader(),new Class[]{TransactionCommitProcess.class},commitProcessDelegate);
}
