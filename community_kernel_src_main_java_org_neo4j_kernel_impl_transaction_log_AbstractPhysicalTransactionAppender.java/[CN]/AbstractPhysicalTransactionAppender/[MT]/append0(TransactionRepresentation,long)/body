{
  channel.getCurrentPosition(positionMarker);
  LogPosition logPosition=positionMarker.newPosition();
  indexCommandDetector.reset();
  transactionLogWriter.append(transaction,transactionId);
  transactionMetadataCache.cacheTransactionMetadata(transactionId,logPosition,transaction.getMasterId(),transaction.getAuthorId(),LogEntryStart.checksum(transaction.additionalHeader(),transaction.getMasterId(),transaction.getAuthorId()));
  channel.emptyBufferIntoChannelAndClearIt();
  if (indexCommandDetector.hasWrittenAnyLegacyIndexCommand()) {
    legacyIndexTransactionOrdering.offer(transactionId);
  }
  return indexCommandDetector.hasWrittenAnyLegacyIndexCommand();
}
