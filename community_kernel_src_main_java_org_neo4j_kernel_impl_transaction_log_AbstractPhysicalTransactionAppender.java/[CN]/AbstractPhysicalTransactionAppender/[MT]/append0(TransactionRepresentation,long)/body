{
  LogPosition logPosition=channel.getCurrentPosition(positionMarker).newPosition();
  indexCommandDetector.reset();
  transactionLogWriter.append(transaction,transactionId);
  long transactionChecksum=LogEntryStart.checksum(transaction.additionalHeader(),transaction.getMasterId(),transaction.getAuthorId());
  transactionMetadataCache.cacheTransactionMetadata(transactionId,logPosition,transaction.getMasterId(),transaction.getAuthorId(),transactionChecksum);
  emptyBufferIntoChannel();
  if (indexCommandDetector.hasWrittenAnyLegacyIndexCommand()) {
    legacyIndexTransactionOrdering.offer(transactionId);
  }
  boolean containsLegacyIndexCommands=indexCommandDetector.hasWrittenAnyLegacyIndexCommand();
  transactionIdStore.transactionCommitted(transactionId,transactionChecksum);
  return containsLegacyIndexCommands;
}
