{
  long transactionId=-1;
  long ticket;
  boolean hasLegacyIndexChanges;
  logRotation.rotateLogIfNeeded();
synchronized (logFile) {
    transactionId=transactionIdStore.nextCommittingTransactionId();
    hasLegacyIndexChanges=append0(transaction,transactionId);
    ticket=getNextTicket();
  }
  forceAfterAppend(ticket);
  coordinateMultipleThreadsApplyingLegacyIndexChanges(hasLegacyIndexChanges,transactionId);
  return transactionId;
}
