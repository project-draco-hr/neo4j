{
  long transactionId=-1;
  long ticket;
  boolean hasLegacyIndexChanges;
synchronized (logFile) {
    logFile.checkRotation();
    transactionId=txIdGenerator.generate(transaction);
    hasLegacyIndexChanges=append(transaction,transactionId);
    ticket=getCurrentTicket();
  }
  force(ticket);
  afterForce(transactionId,hasLegacyIndexChanges);
  return transactionId;
}
