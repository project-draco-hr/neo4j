{
  File storeDir=testDirectory.graphDbDir();
  BatchInserter inserter=BatchInserters.inserter(storeDir);
  inserter.createDeferredSchemaIndex(LABEL).on("name").create();
  inserter.createNode(map("name","Mattias"),LABEL);
  inserter.shutdown();
  GraphDatabaseFactory graphDatabaseFactory=new TestGraphDatabaseFactory();
  GraphDatabaseAPI db=(GraphDatabaseAPI)graphDatabaseFactory.newEmbeddedDatabase(storeDir);
  DependencyResolver dependencyResolver=db.getDependencyResolver();
  SchemaIndexProvider schemaIndexProvider=dependencyResolver.resolveDependency(SchemaIndexProvider.class,HighestSelectionStrategy.getInstance());
  try (Transaction ignore=db.beginTx()){
    IndexDefinition indexDefinition=single(db.schema().getIndexes(LABEL));
    assertThat(db.schema().getIndexState(indexDefinition),is(Schema.IndexState.ONLINE));
    assertThat(schemaIndexProvider,instanceOf(LuceneSchemaIndexProvider.class));
  }
   db.shutdown();
}
