{
  GraphDatabaseService graphDb=db.getGraphDatabaseService();
  Barrier.Control committing=new Barrier.Control();
  Future<Node> node=threading.execute(createNode(committing),graphDb);
  committing.await();
  nodeCache.clear();
  Barrier.Control updateCache=nodeCache.blockThread("create-node");
  threading.threadBlockMonitor(currentThread(),new Release(updateCache));
  committing.release();
  updateCache.await();
  List<String> before=countRelationshipsOfAllNodes(graphDb);
  updateCache.release();
  node.get();
  List<String> after=countRelationshipsOfAllNodes(graphDb);
  assertEquals(join("\n\t",after),before.size(),after.size());
}
