{
  fileSystem.deleteFile(new File(dbDirectory,StringLogger.DEFAULT_NAME));
  fileSystem.mkdir(new File(dbDirectory,StoreUpgrader.MIGRATION_DIRECTORY));
  fileSystem.mkdir(new File(dbDirectory,StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY));
  fileSystem.mkdir(new File(dbDirectory,StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_1"));
  fileSystem.mkdir(new File(dbDirectory,StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_2"));
  fileSystem.mkdir(new File(dbDirectory,StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_42"));
  StoreMigrator migrator=spy(new StoreMigrator(new SilentMigrationProgressMonitor(),fileSystem,DEV_NULL));
  when(migrator.needsMigration(dbDirectory)).thenReturn(false);
  newUpgrader(ALLOW_UPGRADE,migrator,StoreUpgrader.NO_MONITOR).migrateIfNeeded(dbDirectory);
  assertThat(migrationHelperDirs(),is(emptyCollectionOf(File.class)));
}
