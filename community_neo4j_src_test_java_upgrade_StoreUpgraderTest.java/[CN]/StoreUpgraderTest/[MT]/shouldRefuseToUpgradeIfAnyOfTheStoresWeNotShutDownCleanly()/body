{
  File comparisonDirectory=new File("target/" + StoreUpgraderTest.class.getSimpleName() + "shouldRefuseToUpgradeIfAnyOfTheStoresWeNotShutDownCleanly-comparison");
  truncateFile(fileSystem,new File(dbDirectory,"neostore.propertystore.db.index.keys"),"StringPropertyStore v0.9.9");
  fileSystem.deleteRecursively(comparisonDirectory);
  fileSystem.copyRecursively(dbDirectory,comparisonDirectory);
  PageCache pageCache=pageCacheRule.getPageCache(fileSystem);
  UpgradableDatabase upgradableDatabase=new UpgradableDatabase(new StoreVersionCheck(pageCache),new LegacyStoreVersionCheck(fileSystem));
  try {
    newUpgrader(ALLOW_UPGRADE,pageCache).migrateIfNeeded(dbDirectory,upgradableDatabase,schemaIndexProvider);
    fail("Should throw exception");
  }
 catch (  StoreUpgrader.UnableToUpgradeException e) {
  }
  verifyFilesHaveSameContent(fileSystem,comparisonDirectory,dbDirectory);
}
