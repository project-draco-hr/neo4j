{
  fileSystem.deleteFile(new File(dbDirectory,StringLogger.DEFAULT_NAME));
  PageCache pageCache=pageCacheRule.getPageCache(fileSystem);
  newUpgrader(ALLOW_UPGRADE).migrateIfNeeded(dbDirectory,schemaIndexProvider,pageCache);
  NeoStore neoStore=new StoreFactory(fileSystem,dbDirectory,pageCache,StringLogger.DEV_NULL,mock(Monitors.class)).newNeoStore(false,false);
  assertThat(neoStore.getUpgradeTransaction(),equalTo(neoStore.getLastCommittedTransaction()));
  assertThat(neoStore.getUpgradeTime(),not(equalTo(NeoStore.FIELD_NOT_INITIALIZED)));
  long minuteAgo=System.currentTimeMillis() - MINUTES.toMillis(1);
  assertThat(neoStore.getUpgradeTime(),greaterThan(minuteAgo));
  neoStore.close();
}
