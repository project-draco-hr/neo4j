{
  fileSystem.deleteFile(new File(dbDirectory,StoreLogService.INTERNAL_LOG_NAME));
  PageCache pageCache=pageCacheRule.getPageCache(fileSystem);
  newUpgrader(ALLOW_UPGRADE,pageCache).migrateIfNeeded(dbDirectory,schemaIndexProvider);
  NeoStore neoStore=new StoreFactory(fileSystem,dbDirectory,pageCache,NullLogProvider.getInstance(),mock(Monitors.class)).newNeoStore(false);
  assertThat(neoStore.getUpgradeTransaction()[0],equalTo(neoStore.getLastCommittedTransaction()[0]));
  assertThat(neoStore.getUpgradeTransaction()[1],equalTo(neoStore.getLastCommittedTransaction()[1]));
  assertThat(neoStore.getUpgradeTime(),not(equalTo(NeoStore.FIELD_NOT_INITIALIZED)));
  long minuteAgo=System.currentTimeMillis() - MINUTES.toMillis(1);
  assertThat(neoStore.getUpgradeTime(),greaterThan(minuteAgo));
  neoStore.close();
}
