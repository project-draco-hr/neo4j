{
  WorkThread firstTx=createWorker();
  WorkThread secondTx=createWorker();
  firstTx.beginTransaction();
  firstTx.waitForCommandToComplete();
  secondTx.beginTransaction();
  secondTx.waitForCommandToComplete();
  firstTx.createNodeAndIndexBy(key,"some value");
  firstTx.waitForCommandToComplete();
  secondTx.createNodeAndIndexBy(key,"some other value");
  secondTx.waitForCommandToComplete();
  firstTx.deleteIndex();
  firstTx.waitForCommandToComplete();
  firstTx.commit();
  firstTx.waitForCommandToComplete();
  secondTx.queryIndex(key,"some other value");
  secondTx.waitForCommandToComplete();
  assertThat(secondTx,hasThrownException());
  secondTx.rollback();
  secondTx.waitForCommandToComplete();
  rollbackTx();
}
