{
  CacheUpdateListener cacheUpdateListener=mock(CacheUpdateListener.class);
  RelationshipLoader loader=mock(RelationshipLoader.class);
  NodeImpl node=mock(NodeImpl.class);
  when(node.getMoreRelationships(eq(loader),any(DirectionWrapper.class),any(int[].class),any(CacheUpdateListener.class))).thenReturn(LoadStatus.NOTHING);
  ControlledRelIdIterator typeIterator=new ControlledRelIdIterator(0L);
  RelationshipIterator iterator=new RelationshipIterator(new RelIdIterator[]{typeIterator},node,OUTGOING,new int[0],loader,false,false,cacheUpdateListener);
  iterator.next();
  typeIterator.queueHasNextAnswers(false,false,true);
  long otherRelationship=1, thirdRelationship=2;
  typeIterator.add(otherRelationship,thirdRelationship);
  iterator.next();
  long returnedThirdRelationship=iterator.next();
  assertEquals(thirdRelationship,returnedThirdRelationship);
}
