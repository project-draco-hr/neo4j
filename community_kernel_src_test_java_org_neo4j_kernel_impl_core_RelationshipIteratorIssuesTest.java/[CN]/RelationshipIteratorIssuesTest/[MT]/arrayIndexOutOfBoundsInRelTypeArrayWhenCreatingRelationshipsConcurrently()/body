{
  NodeManager nodeManager=mock(NodeManager.class);
  when(nodeManager.newRelationshipProxyById(anyLong())).thenAnswer(relationshipProxyWithId());
  NodeImpl node=mock(NodeImpl.class);
  when(node.getMoreRelationships(eq(nodeManager),any(DirectionWrapper.class),any(RelationshipType[].class))).thenReturn(LoadStatus.NOTHING);
  ControlledRelIdIterator typeIterator=new ControlledRelIdIterator(0L);
  RelationshipIterator iterator=new RelationshipIterator(new RelIdIterator[]{typeIterator},node,OUTGOING,new RelationshipType[0],nodeManager,false,false);
  iterator.next();
  typeIterator.queueHasNextAnswers(false,false,true);
  long otherRelationship=1, thirdRelationship=2;
  typeIterator.add(otherRelationship,thirdRelationship);
  iterator.next();
  Relationship returnedThirdRelationship=iterator.next();
  assertEquals(thirdRelationship,returnedThirdRelationship.getId());
}
