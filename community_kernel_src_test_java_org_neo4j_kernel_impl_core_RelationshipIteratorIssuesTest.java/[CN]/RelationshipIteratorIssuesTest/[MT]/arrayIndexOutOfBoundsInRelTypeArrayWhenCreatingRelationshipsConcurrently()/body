{
  NodeManager nodeManager=mock(NodeManager.class);
  when(nodeManager.newRelationshipProxyById(anyLong())).thenAnswer(relationshipProxyWithId());
  NodeImpl node=mock(NodeImpl.class);
  when(node.getMoreRelationships(eq(nodeManager),any(DirectionWrapper.class),any(int[].class),any(RelationshipChainLoader.class))).thenReturn(LoadStatus.NOTHING);
  ControlledRelIdIterator typeIterator=new ControlledRelIdIterator(0L);
  RelationshipIterator iterator=new RelationshipIterator(new RelIdIterator[]{typeIterator},node,OUTGOING,new int[0],nodeManager,false,false,null);
  iterator.next();
  typeIterator.queueHasNextAnswers(false,false,true);
  long otherRelationship=1, thirdRelationship=2;
  typeIterator.add(otherRelationship,thirdRelationship);
  iterator.next();
  long returnedThirdRelationship=iterator.next();
  assertEquals(thirdRelationship,returnedThirdRelationship);
}
