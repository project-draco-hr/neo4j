{
  MasterImpl.SPI spi=mock(MasterImpl.SPI.class);
  Config config=config(20);
  when(spi.isAccessible()).thenReturn(true);
  when(spi.getMasterIdForCommittedTx(anyLong())).thenReturn(Pair.of(1,1L));
  mockEmptyResponse(spi);
  MasterImpl master=new MasterImpl(spi,mock(MasterImpl.Monitor.class),new DevNullLoggingService(),config);
  master.start();
  HandshakeResult handshake=master.handshake(1,new StoreId()).response();
  RequestContext ctx=new RequestContext(handshake.epoch(),1,2,0,1,0);
  try {
    master.commit(ctx,mock(TransactionRepresentation.class));
    fail("Should have failed.");
  }
 catch (  TransactionNotPresentOnMasterException e) {
    assertThat(e.getMessage(),equalTo(new TransactionNotPresentOnMasterException(ctx).getMessage()));
  }
}
