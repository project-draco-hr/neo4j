{
  Path directory=authFile.getParent();
  if (!Files.exists(directory)) {
    Files.createDirectories(directory);
  }
  Path tempFile=Files.createTempFile(directory,authFile.getFileName().toString() + "-",".tmp");
  try {
    Files.write(tempFile,serialization.serialize(users));
    Files.move(tempFile,authFile,ATOMIC_MOVE,REPLACE_EXISTING);
  }
 catch (  Throwable e) {
    Files.delete(tempFile);
    throw e;
  }
}
