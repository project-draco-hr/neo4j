{
  final long nodeId=createGraph();
  DataWriteOperations write=dataWriteOperationsInNewTransaction();
  final long emptyNodeId=write.nodeCreate();
  commit();
  ReadOperations ops=readOperationsInNewTransaction();
  RelationshipRegister relId=newRelationshipRegister();
  NodeRegister startId=newNodeRegister();
  NeoRegister.RelTypeRegister relType=newRelTypeRegister();
  ObjectRegister<Direction> direction=newObjectRegister();
  NodeRegister neighborId=newNodeRegister();
  final NodeRegister nodeRegister=newNodeRegister();
  final ObjectRegister<int[]> typesRegister=newObjectRegister();
  final ObjectRegister<Direction> directionRegister=newObjectRegister();
  Cursor inputCursor=new Cursor(){
    private int count=0;
    @Override public boolean next(){
switch (count++) {
case 0:
        nodeRegister.write(nodeId);
      typesRegister.write(new int[]{relType1});
    directionRegister.write(INCOMING);
  return true;
case 1:
nodeRegister.write(emptyNodeId);
typesRegister.write(new int[]{relType1});
directionRegister.write(INCOMING);
return true;
case 2:
nodeRegister.write(emptyNodeId + 999);
typesRegister.write(new int[]{relType1});
directionRegister.write(INCOMING);
return true;
case 3:
nodeRegister.write(nodeId);
typesRegister.write(new int[]{relType2});
directionRegister.write(OUTGOING);
return true;
default :
return false;
}
}
@Override public void reset(){
}
@Override public void close(){
}
}
;
Cursor cursor=ops.expand(inputCursor,nodeRegister,typesRegister,directionRegister,relId,relType,direction,startId,neighborId);
assertThat(rows(cursor,relId,relType,direction,startId,neighborId),equalTo(asList(row(0,0,BOTH,0,0),row(1,0,BOTH,0,0),row(4,0,INCOMING,0,1),row(5,0,INCOMING,0,1),row(8,0,INCOMING,0,2),row(9,0,INCOMING,0,2),row(10,1,OUTGOING,0,3),row(11,1,OUTGOING,0,4))));
assertFalse("Should not contain any more rows.",cursor.next());
}
