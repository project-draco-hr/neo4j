{
  SwitchableRaftIdGenerator previous=generators.remove(idType);
  if (previous != null) {
    previous.close();
  }
  long maxValue=idType.getMaxValue();
  boolean aggressiveReuse=idType.allowAggressiveReuse();
  IdGenerator initialIdGenerator=new IdGeneratorImpl(fs,fileName,grabSize,maxValue,aggressiveReuse,highId);
  SwitchableRaftIdGenerator switchableIdGenerator=new SwitchableRaftIdGenerator(initialIdGenerator,idType,idRangeAcquirer,logProvider);
  if (replicatedMode) {
    switchableIdGenerator.switchToRaft();
  }
  generators.put(idType,switchableIdGenerator);
  return switchableIdGenerator;
}
