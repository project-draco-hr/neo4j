{
  NeoStoreDataSource theDataSource=null;
  try {
    KernelHealth kernelHealth=new KernelHealth(mock(KernelPanicEventGenerator.class),DevNullLoggingService.DEV_NULL);
    theDataSource=ds.getDataSource(dir,fs.get(),pageCacheRule.getPageCache(fs.get()),stringMap(),kernelHealth);
    kernelHealth.panic(new Throwable());
    theDataSource.start();
    kernelHealth.assertHealthy(Throwable.class);
  }
  finally {
    if (theDataSource != null) {
      theDataSource.stop();
      theDataSource.shutdown();
    }
  }
}
