{
  determineUri();
  readClustersXml();
  if (clusters != null) {
    Clusters.Cluster clusterConfig=clusters.getCluster(config.get(ClusterSettings.cluster_name));
    if (clusterConfig != null) {
      for (      Clusters.Member member : clusterConfig.getMembers()) {
        URI joinUri=new URI("cluster://" + member.getHost());
        if (!joinUri.equals(serverId)) {
          Future<ClusterConfiguration> config=cluster.join(joinUri);
          try {
            logger.logMessage("Joined cluster:" + config.get());
            try {
              updateMyInfo();
            }
 catch (            TransformerException e) {
              throw new RuntimeException(e);
            }
            return;
          }
 catch (          InterruptedException e) {
            e.printStackTrace();
          }
catch (          ExecutionException e) {
            logger.logMessage("Could not join cluster member " + member.getHost());
          }
        }
      }
    }
    if (clusterConfig == null) {
      clusterConfig=new Clusters.Cluster(config.get(ClusterSettings.cluster_name));
      clusters.getClusters().add(clusterConfig);
    }
    cluster.create(clusterConfig.getName());
    if (clusterConfig.getByUri(serverId) == null) {
      clusterConfig.getMembers().add(new Clusters.Member(serverId.toString()));
      try {
        updateMyInfo();
      }
 catch (      TransformerException e) {
        logger.logMessage("Could not update cluster discovery file:" + clustersUri,e);
      }
    }
  }
}
