{
  Map<String,String> params=tuningConfiguration.getParams();
  params.put(GraphDatabaseSettings.store_dir.name(),storeDir);
  tuningConfiguration.applyChanges(params);
  StoreFactory factory=new StoreFactory(tuningConfiguration,new DefaultIdGeneratorFactory(),tuningConfiguration.get(ConsistencyCheckSettings.consistency_check_window_pool_implementation).windowPoolFactory(tuningConfiguration,logger),new DefaultFileSystemAbstraction(),logger,new DefaultTxHook());
  ConsistencySummaryStatistics summary;
  File reportFile=chooseReportPath(tuningConfiguration);
  StringLogger report=StringLogger.lazyLogger(reportFile);
  NeoStore neoStore=factory.newNeoStore(new File(storeDir,NeoStore.DEFAULT_NAME));
  try {
    neoStore.makeStoreOk();
    StoreAccess store=new StoreAccess(neoStore);
    summary=new FullCheck(tuningConfiguration,progressFactory).execute(store,StringLogger.tee(logger,report));
  }
  finally {
    neoStore.close();
  }
  if (!summary.isConsistent()) {
    logger.logMessage(String.format("See '%s' for a detailed consistency report.",reportFile.getPath()));
  }
  return summary.isConsistent();
}
