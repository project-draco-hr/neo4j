{
  final Node node=createNode();
  Thread thread=null;
  try (Transaction tx=graphDb.beginTx()){
    tx.acquireReadLock(node);
    assertEquals("all locks",1,lockManager.getLocks().size());
    assertEquals("contended locks",0,lockManager.getContendedLocks(0).size());
    thread=new Thread(){
      @Override public void run(){
        try (Transaction tx=graphDb.beginTx()){
          tx.acquireWriteLock(node);
        }
       }
    }
;
    thread.start();
    awaitWaitingStateIn(thread);
    assertEquals("all locks",1,lockManager.getLocks().size());
    assertEquals("contended locks",1,lockManager.getContendedLocks(0).size());
    LockInfo contended=lockManager.getContendedLocks(0).get(0);
    assertEquals("resource type",ResourceType.NODE,contended.getResourceType());
    assertEquals("resource id",Long.toString(node.getId()),contended.getResourceId());
    assertEquals("read count",1,contended.getReadCount());
    assertEquals("write count",0,contended.getWriteCount());
    assertEquals("number of waiting thread",1,contended.getWaitingThreads().size());
    assertEquals("waiting thread name",thread.getName(),contended.getWaitingThreads().get(0).getThreadName());
  }
  finally {
    if (thread != null)     thread.join();
  }
}
