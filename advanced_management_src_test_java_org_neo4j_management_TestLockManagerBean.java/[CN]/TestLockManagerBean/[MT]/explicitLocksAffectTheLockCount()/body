{
  Transaction tx=graphDb.beginTx();
  try {
    Node root=graphDb.getReferenceNode();
    Lock first=tx.acquireReadLock(root);
    LockInfo lock=getSingleLock();
    assertEquals("read count",1,lock.getReadCount());
    assertEquals("write count",0,lock.getWriteCount());
    tx.acquireReadLock(root);
    lock=getSingleLock();
    assertEquals("read count",2,lock.getReadCount());
    assertEquals("write count",0,lock.getWriteCount());
    tx.acquireWriteLock(root);
    lock=getSingleLock();
    assertEquals("read count",2,lock.getReadCount());
    assertEquals("write count",1,lock.getWriteCount());
    first.release();
    lock=getSingleLock();
    assertEquals("read count",1,lock.getReadCount());
    assertEquals("write count",1,lock.getWriteCount());
  }
  finally {
    tx.finish();
  }
  List<LockInfo> locks=lockManager.getLocks();
  assertEquals("unexpected lock count",0,locks.size());
}
