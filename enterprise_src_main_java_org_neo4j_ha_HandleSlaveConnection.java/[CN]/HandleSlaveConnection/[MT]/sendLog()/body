{
  if (retries > 20) {
    close();
  }
  connection.write();
  log("Send log: " + logVersionToSend);
  if (!buffer.hasRemaining()) {
    buffer.clear();
    try {
      if (logToSend.read(buffer) <= 0) {
        releaseWriteBuffer();
        setStatus(Status.GET_MESSAGE);
        if (master.hasLog(logVersionToSend + 1)) {
          logVersionToSend=logVersionToSend++;
          logLength=master.getLogLength(logVersionToSend);
          logToSend=master.getLog(logVersionToSend);
        }
 else {
          logLength=-1;
          logVersionToSend=-1;
          logToSend=null;
        }
        return true;
      }
      buffer.flip();
    }
 catch (    IOException e) {
      log("Error reading log",e);
      close();
      return true;
    }
  }
  retries++;
  return false;
}
