{
  long timeout=80000;
  HighlyAvailableGraphDatabase db=(HighlyAvailableGraphDatabase)new EnterpriseGraphDatabaseFactory().newHighlyAvailableDatabaseBuilder(dir.directory("zkTimeout").getAbsolutePath()).setConfig(HaSettings.server_id,"1").setConfig(HaSettings.coordinators,zoo.getConnectionString()).setConfig(HaSettings.zk_session_timeout,"" + timeout).newGraphDatabase();
  ZooKeeperBroker broker=(ZooKeeperBroker)db.getBroker();
  Field f=broker.getClass().getDeclaredField("zooClient");
  f.setAccessible(true);
  ZooClient zooClient=(ZooClient)f.get(broker);
  Method m=zooClient.getClass().getSuperclass().getDeclaredMethod("getSessionTimeout");
  m.setAccessible(true);
  Integer timeoutParsed=(Integer)m.invoke(zooClient);
  Assert.assertEquals(timeout,timeoutParsed.intValue());
  f=db.getClass().getDeclaredField("clusterClient");
  f.setAccessible(true);
  ZooKeeperClusterClient clusterClient=(ZooKeeperClusterClient)f.get(db);
  m=clusterClient.getClass().getSuperclass().getDeclaredMethod("getSessionTimeout");
  m.setAccessible(true);
  timeoutParsed=(Integer)m.invoke(clusterClient);
  Assert.assertEquals(timeout,timeoutParsed.intValue());
  db.shutdown();
}
