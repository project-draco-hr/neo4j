{
  K key=keyFunction.convert(entity);
  Node<E,P> node=map.get(key);
  boolean result=false;
  if (node != null) {
    if (priority.equals(node.priority)) {
      node.head=new Link<E>(entity,node.head);
      result=true;
    }
 else     if (order.compare(priority,node.priority) < 0) {
      queue.remove(node);
      put(entity,priority,key);
      result=true;
    }
  }
 else {
    put(entity,priority,key);
    result=true;
  }
  return result;
}
