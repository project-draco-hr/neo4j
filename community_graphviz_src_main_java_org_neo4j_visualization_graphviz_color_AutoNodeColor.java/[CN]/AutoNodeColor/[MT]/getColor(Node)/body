{
  if (ncm != null) {
    Color color=ncm.getColor(node);
    if (color != null) {
      return colors.getColor(color);
    }
  }
  Set<String> relationshipTypeAndDirections=new HashSet<String>();
  for (  Direction direction : directions) {
    if (differentiateOnDirectionOnly) {
      if (node.hasRelationship(direction)) {
        relationshipTypeAndDirections.add(direction.name());
      }
    }
 else {
      for (      Relationship relationship : node.getRelationships(direction)) {
        String key=relationship.getType().name();
        if (differentiateOnDirection) {
          key+=direction.name();
        }
        relationshipTypeAndDirections.add(key);
      }
    }
  }
  return colors.getColor(relationshipTypeAndDirections);
}
