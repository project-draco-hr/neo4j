{
  if (config.get(csvEnabled)) {
    File configuredPath=config.get(csvPath);
    if (configuredPath == null) {
      throw new IllegalArgumentException(csvPath.name() + " configuration is required since " + csvEnabled.name()+ " is enabled");
    }
    outputFile=absoluteFileOrRelativeTo(kernelContext.storeDir(),configuredPath);
    MetricsSettings.CsvFile csvFile=config.get(MetricsSettings.csvFile);
switch (csvFile) {
case single:
      csvReporter=CsvReporterSingle.forRegistry(registry).convertRatesTo(TimeUnit.SECONDS).convertDurationsTo(TimeUnit.MILLISECONDS).filter(MetricFilter.ALL).build(outputFile);
    break;
case split:
  csvReporter=CsvReporter.forRegistry(registry).convertRatesTo(TimeUnit.SECONDS).convertDurationsTo(TimeUnit.MILLISECONDS).filter(MetricFilter.ALL).build(ensureDirectoryExists(outputFile));
break;
default :
throw new IllegalArgumentException("Unsupported " + MetricsSettings.csvFile.name() + " setting: "+ csvFile);
}
}
}
