{
  if (config.get(csvEnabled)) {
    File outputFile=config.get(csvPath);
switch (config.get(MetricsSettings.csvFile)) {
case single:
{
        csvReporter=CsvReporterSingle.forRegistry(registry).convertRatesTo(TimeUnit.SECONDS).convertDurationsTo(TimeUnit.MILLISECONDS).filter(MetricFilter.ALL).build(outputFile);
        break;
      }
case split:
{
      if (!outputFile.exists()) {
        if (!outputFile.mkdirs()) {
          throw new IllegalStateException("Could not create path for CSV files:" + outputFile.getAbsolutePath());
        }
      }
      csvReporter=CsvReporter.forRegistry(registry).convertRatesTo(TimeUnit.SECONDS).convertDurationsTo(TimeUnit.MILLISECONDS).filter(MetricFilter.ALL).build(outputFile);
      break;
    }
}
csvReporter.start(config.get(csvInterval),TimeUnit.MILLISECONDS);
logger.info("Sending metrics to CSV file at " + outputFile);
}
}
