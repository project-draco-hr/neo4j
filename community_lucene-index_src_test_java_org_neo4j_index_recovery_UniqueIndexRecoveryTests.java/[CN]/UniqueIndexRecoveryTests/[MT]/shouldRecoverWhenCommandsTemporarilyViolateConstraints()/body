{
  Node unLabeledNode=createUnLabeledNode();
  Node labeledNode=createLabeledNode();
  createUniqueConstraint();
  rotateLog();
  setPropertyOnLabeledNode(labeledNode);
  deletePropertyOnLabeledNode(labeledNode);
  addLabelToUnLabeledNode(unLabeledNode);
  flushAll();
  File newStore=snapshot(storeDir.absolutePath());
  db.shutdown();
  db=(GraphDatabaseAPI)factory.newEmbeddedDatabase(newStore.getAbsolutePath());
  try (Transaction tx=db.beginTx()){
    assertThat(single(db.findNodesByLabelAndProperty(LABEL,PROPERTY_KEY,PROPERTY_VALUE)),equalTo(unLabeledNode));
    tx.success();
  }
 }
