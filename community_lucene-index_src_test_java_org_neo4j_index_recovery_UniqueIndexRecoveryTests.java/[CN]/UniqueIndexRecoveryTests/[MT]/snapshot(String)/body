{
  File snapshotDir=new File(path,"snapshot-" + new Random().nextInt());
  FileUtils.copyRecursively(new File(path),snapshotDir,new FileFilter(){
    @Override public boolean accept(    File pathName){
      String subPath=pathName.getAbsolutePath().substring(path.length()).replace(File.separatorChar,'/');
      if ("/store_lock".equals(subPath)) {
        return false;
      }
      if (subPath.startsWith("/schema/index/lucene/") || subPath.startsWith("/schema/label/lucene/")) {
        return !subPath.endsWith("/write.lock");
      }
      return true;
    }
  }
);
  return snapshotDir;
}
