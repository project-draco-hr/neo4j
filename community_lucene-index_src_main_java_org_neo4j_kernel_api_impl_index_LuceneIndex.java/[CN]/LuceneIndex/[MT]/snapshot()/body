{
  commitCloseLock.lock();
  try {
    List<IndexPartition> partitions=getPartitions();
    List<ResourceIterator<File>> snapshotIterators=new ArrayList<>(partitions.size());
    for (    IndexPartition partition : partitions) {
      snapshotIterators.add(partition.snapshot());
    }
    return Iterables.concatResourceIterators(snapshotIterators.iterator());
  }
  finally {
    commitCloseLock.unlock();
  }
}
