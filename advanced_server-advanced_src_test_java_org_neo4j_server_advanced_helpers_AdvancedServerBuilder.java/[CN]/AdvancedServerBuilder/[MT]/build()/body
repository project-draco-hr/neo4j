{
  if (dbDir == null) {
    this.dbDir=createTempDir().getAbsolutePath();
  }
  final File configFile=createPropertiesFiles();
  if (preflightTasks == null) {
    preflightTasks=new PreFlightTasks(){
      @Override public boolean run(){
        return true;
      }
    }
;
  }
  return new TestAdvancedNeoServer(new PropertyFileConfigurator(new Validator(new DatabaseLocationMustBeSpecifiedRule()),configFile),configFile);
}
