{
  try {
    while (!go) {
      try {
        sleep(100);
      }
 catch (      InterruptedException e) {
      }
    }
    java.util.Stack<Object> lockStack=new java.util.Stack<Object>();
    try {
      for (int i=0; i < numberOfIterations; i++) {
        int depth=depthCount;
        do {
          float f=rand.nextFloat();
          if (f < readWriteRatio) {
            lm.getReadLock(resource);
            lockStack.push(READ);
          }
 else {
            lm.getWriteLock(resource);
            lockStack.push(WRITE);
          }
        }
 while (--depth > 0);
        while (!lockStack.isEmpty()) {
          if (lockStack.pop() == READ) {
            lm.releaseReadLock(resource);
          }
 else {
            lm.releaseWriteLock(resource);
          }
        }
      }
    }
 catch (    DeadlockDetectedException e) {
    }
 finally {
      while (!lockStack.isEmpty()) {
        if (lockStack.pop() == READ) {
          lm.releaseReadLock(resource);
        }
 else {
          lm.releaseWriteLock(resource);
        }
      }
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new RuntimeException(e);
  }
}
