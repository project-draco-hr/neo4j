{
  try {
    Node node=resource instanceof Node ? (Node)resource : null;
    Relationship relationship=resource instanceof Relationship ? (Relationship)resource : null;
    if (node == null && relationship == null) {
      super.getReadLock(resource);
      return;
    }
    LockResult result=null;
    do {
      int eventIdentifier=getLocalTxId();
      result=node != null ? receiver.receive(broker.getMaster().first().acquireNodeReadLock(receiver.getSlaveContext(eventIdentifier),node.getId())) : receiver.receive(broker.getMaster().first().acquireRelationshipReadLock(receiver.getSlaveContext(eventIdentifier),relationship.getId()));
switch (result.getStatus()) {
case OK_LOCKED:
        super.getReadLock(resource);
      return;
case DEAD_LOCKED:
    throw new DeadlockDetectedException(result.getDeadlockMessage());
}
}
 while (result.getStatus() == LockStatus.NOT_LOCKED);
}
 catch (ZooKeeperException e) {
receiver.newMaster(broker.getMaster(),e);
throw e;
}
catch (HaCommunicationException e) {
receiver.newMaster(broker.getMaster(),e);
throw e;
}
}
