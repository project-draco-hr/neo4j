{
  if (newFile == null) {
    throw new IllegalArgumentException("Null filename");
  }
  force();
  Iterator<List<Record>> itr=getDanglingRecords();
  close();
  List<Record> records=new ArrayList<Record>();
  while (itr.hasNext()) {
    records.addAll(itr.next());
  }
  Collections.sort(records,new Comparator<Record>(){
    public int compare(    Record r1,    Record r2){
      return r1.getSequenceNumber() - r2.getSequenceNumber();
    }
  }
);
  msgLog.logMessage("About to rotate " + name + " to "+ newFile+ " with dangling records "+ records,true);
  Iterator<Record> recordItr=records.iterator();
  FileChannel fileChannel=fileSystem.open(newFile,"rw");
  fileChannel.position(fileChannel.size());
  logBuffer=new DirectMappedLogBuffer(fileChannel);
  name=newFile;
  truncate();
  while (recordItr.hasNext()) {
    Record record=recordItr.next();
    writeRecord(record,ForceMode.forced);
  }
  force();
  msgLog.logMessage("Rotated " + name + " to, file channel now at "+ fileChannel.position(),true);
}
