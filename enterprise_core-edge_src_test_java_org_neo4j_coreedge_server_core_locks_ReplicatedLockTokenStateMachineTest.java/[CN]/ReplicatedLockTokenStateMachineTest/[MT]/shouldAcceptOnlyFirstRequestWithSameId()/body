{
  DirectReplicator replicator=new DirectReplicator();
  LockTokenManager stateMachine=new ReplicatedLockTokenStateMachine<>(replicator);
  int firstCandidateId=stateMachine.nextCandidateId();
  replicator.replicate(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId));
  replicator.replicate(new ReplicatedLockTokenRequest<>(member(1),firstCandidateId));
  assertEquals(0,stateMachine.currentToken().id());
  assertEquals(member(0),stateMachine.currentToken().owner());
  replicator.replicate(new ReplicatedLockTokenRequest<>(member(1),firstCandidateId + 1));
  replicator.replicate(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId + 1));
  assertEquals(1,stateMachine.currentToken().id());
  assertEquals(member(1),stateMachine.currentToken().owner());
}
