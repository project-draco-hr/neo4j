{
  ReplicatedLockTokenStateMachine<RaftTestMember> stateMachine=new ReplicatedLockTokenStateMachine<>(new InMemoryStateStorage<>(new ReplicatedLockTokenState<>()));
  int firstCandidateId=LockToken.nextCandidateId(stateMachine.currentToken().id());
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId),1);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(1),firstCandidateId),2);
  assertEquals(0,stateMachine.currentToken().id());
  assertEquals(member(0),stateMachine.currentToken().owner());
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(1),firstCandidateId + 1),3);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId + 1),4);
  assertEquals(1,stateMachine.currentToken().id());
  assertEquals(member(1),stateMachine.currentToken().owner());
}
