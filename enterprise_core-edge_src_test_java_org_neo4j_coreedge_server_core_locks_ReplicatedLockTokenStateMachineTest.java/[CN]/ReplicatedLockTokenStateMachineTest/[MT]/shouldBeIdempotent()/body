{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  StateMarshal<ReplicatedLockTokenState<CoreMember>> marshal=new ReplicatedLockTokenState.Marshal<>(new CoreMember.CoreMemberMarshal());
  DurableStateStorage<ReplicatedLockTokenState<CoreMember>> storage=new DurableStateStorage<>(fsa,testDir.directory(),"state",marshal,100,health(),NullLogProvider.getInstance());
  ReplicatedLockTokenStateMachine stateMachine=new ReplicatedLockTokenStateMachine<>(storage,new PendingLockTokensRequests<>());
  CoreMember memberA=new CoreMember(new AdvertisedSocketAddress("1"),new AdvertisedSocketAddress("2"));
  CoreMember memberB=new CoreMember(new AdvertisedSocketAddress("3"),new AdvertisedSocketAddress("4"));
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(memberA,0),3);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(memberB,1),2);
  assertEquals(memberA,stateMachine.currentToken().owner());
}
