{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  StateMarshal<ReplicatedLockTokenState<RaftTestMember>> marshal=new ReplicatedLockTokenState.Marshal<>(new RaftTestMember.RaftTestMemberMarshal());
  DurableStateStorage<ReplicatedLockTokenState<RaftTestMember>> storage=new DurableStateStorage<>(fsa,testDir.directory(),"state",marshal,100,health(),NullLogProvider.getInstance());
  ReplicatedLockTokenStateMachine<RaftTestMember> stateMachine=new ReplicatedLockTokenStateMachine<>(storage);
  RaftTestMember memberA=new RaftTestMember(0);
  RaftTestMember memberB=new RaftTestMember(1);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(memberA,0),3);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(memberB,1),2);
  assertEquals(memberA,stateMachine.currentToken().owner());
}
