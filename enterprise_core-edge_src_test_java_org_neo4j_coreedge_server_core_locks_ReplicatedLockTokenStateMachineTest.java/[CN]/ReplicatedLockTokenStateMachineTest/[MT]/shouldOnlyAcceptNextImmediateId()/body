{
  ReplicatedLockTokenStateMachine<RaftTestMember> stateMachine=new ReplicatedLockTokenStateMachine<>(new InMemoryStateStorage<>(new ReplicatedLockTokenState<>()));
  int firstCandidateId=LockToken.nextCandidateId(stateMachine.currentToken().id());
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId + 1),1);
  assertEquals(stateMachine.currentToken().id(),LockToken.INVALID_LOCK_TOKEN_ID);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId),2);
  assertEquals(stateMachine.currentToken().id(),firstCandidateId);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId + 1),3);
  assertEquals(stateMachine.currentToken().id(),firstCandidateId + 1);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId),4);
  assertEquals(stateMachine.currentToken().id(),firstCandidateId + 1);
  stateMachine.applyCommand(new ReplicatedLockTokenRequest<>(member(0),firstCandidateId + 3),5);
  assertEquals(stateMachine.currentToken().id(),firstCandidateId + 1);
}
