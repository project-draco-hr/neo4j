{
  ShortArray type=ShortArray.typeOf(array);
  if (type == null) {
    throw new IllegalArgumentException(array + " not a valid array type.");
  }
  int arrayLength=Array.getLength(array);
  int requiredBits=type.calculateRequiredBitsForArray(array);
  int totalBits=requiredBits * arrayLength;
  int bytes=(totalBits - 1) / 8 + 1;
  int bitsUsedInLastByte=totalBits % 8;
  bitsUsedInLastByte=bitsUsedInLastByte == 0 ? 8 : bitsUsedInLastByte;
  bytes+=3;
  Bits bits=Bits.bits(bytes);
  bits.put((byte)type.intValue());
  bits.put((byte)bitsUsedInLastByte);
  bits.put((byte)requiredBits);
  int length=arrayLength;
  for (int i=0; i < length; i++) {
    type.put(Array.get(array,i),bits,requiredBits);
  }
  return allocateRecords(startBlock,bits.asBytes());
}
