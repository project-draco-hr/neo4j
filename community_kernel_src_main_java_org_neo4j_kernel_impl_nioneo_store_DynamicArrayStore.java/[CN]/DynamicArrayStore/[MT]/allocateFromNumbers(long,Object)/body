{
  ShortArray type=ShortArray.typeOf(array);
  int arrayLength=Array.getLength(array);
  int requiredBits=type.calculateRequiredBitsForArray(array);
  int totalBits=requiredBits * arrayLength;
  int bytes=(totalBits - 1) / 8 + 1;
  int bitsUsedInLastByte=totalBits % 8;
  bitsUsedInLastByte=bitsUsedInLastByte == 0 ? 8 : bitsUsedInLastByte;
  bytes+=3;
  Bits bits=Bits.bits(bytes);
  int length=arrayLength;
  for (int i=length - 1; i >= 0; i--) {
    type.pushRight(Array.get(array,i),bits,requiredBits);
  }
  bits.pushRight((byte)requiredBits);
  bits.pushRight((byte)bitsUsedInLastByte);
  bits.pushRight((byte)type.intValue());
  return allocateRecords(startBlock,bits.asLeftBytes());
}
