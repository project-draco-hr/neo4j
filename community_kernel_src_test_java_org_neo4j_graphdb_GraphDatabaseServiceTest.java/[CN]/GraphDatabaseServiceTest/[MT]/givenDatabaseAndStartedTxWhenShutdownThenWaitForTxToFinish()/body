{
  final GraphDatabaseService db=new TestGraphDatabaseFactory().newImpermanentDatabase();
  final CountDownLatch started=new CountDownLatch(1);
  Executors.newSingleThreadExecutor().submit(new Runnable(){
    @Override public void run(){
      final Transaction tx=db.beginTx();
      started.countDown();
      try {
        Thread.sleep(2000);
      }
 catch (      InterruptedException e) {
        throw new RuntimeException(e);
      }
      db.createNode().setProperty("foo","bar");
      tx.success();
      tx.finish();
    }
  }
);
  started.await();
  db.shutdown();
}
