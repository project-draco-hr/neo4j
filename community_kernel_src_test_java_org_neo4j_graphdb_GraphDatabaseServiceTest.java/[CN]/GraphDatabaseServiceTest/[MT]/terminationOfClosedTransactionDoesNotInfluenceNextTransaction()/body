{
  GraphDatabaseService db=cleanup.add(new TestGraphDatabaseFactory().newImpermanentDatabase());
  try (Transaction tx=db.beginTx()){
    db.createNode();
    tx.success();
  }
   Transaction transaction=db.beginTx();
  try (Transaction tx=transaction){
    db.createNode();
    tx.success();
  }
   transaction.terminate();
  try (Transaction tx=db.beginTx()){
    assertEquals(2,Iterables.count(db.getAllNodes()));
    tx.success();
  }
 }
