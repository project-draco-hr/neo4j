{
  PagedFile pages=mapCountsStore(pageCache,storeFile);
  try {
    SortedKeyValueStoreHeader header=SortedKeyValueStoreHeader.read(RECORD_SIZE,pages);
    CountsStore countsStore=new CountsStore(fs,pageCache,storeFile,pages,header);
    final LongRegister keys=Registers.newLongRegister(0);
    countsStore.accept(new KeyValueRecordVisitor<CountsKey,CopyableDoubleLongRegister>(){
      @Override public void visit(      CountsKey key,      CopyableDoubleLongRegister register){
        if (register.hasValues(0,0)) {
          throw new UnderlyingStorageException("Counts store contains unexpected value (0,0)");
        }
        keys.increment(1);
      }
    }
,Registers.newDoubleLongRegister());
    if (keys.read() != header.dataRecords()) {
      throw new UnderlyingStorageException("Counts store is corrupted");
    }
    return countsStore;
  }
 catch (  RuntimeException e) {
    pageCache.unmap(storeFile);
    throw e;
  }
}
