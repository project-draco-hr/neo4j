{
  if (fileChannel == null) {
    return;
  }
  closeStorage();
  if (windowPool != null) {
    windowPool.close();
    windowPool=null;
  }
  int highId=idGenerator.getHighId();
  int recordSize=-1;
  if (this instanceof AbstractDynamicStore) {
    recordSize=((AbstractDynamicStore)this).getBlockSize();
  }
 else   if (this instanceof AbstractStore) {
    recordSize=((AbstractStore)this).getRecordSize();
  }
  closeIdGenerator();
  try {
    fileChannel.position(((long)highId) * recordSize);
    ByteBuffer buffer=ByteBuffer.wrap(getTypeAndVersionDescriptor().getBytes());
    fileChannel.write(buffer);
    fileChannel.truncate(fileChannel.position());
    fileChannel.force(false);
    fileLock.release();
    fileChannel.close();
    fileChannel=null;
  }
 catch (  IOException e) {
    throw new StoreFailureException("Unable to close store " + getStorageFileName(),e);
  }
}
