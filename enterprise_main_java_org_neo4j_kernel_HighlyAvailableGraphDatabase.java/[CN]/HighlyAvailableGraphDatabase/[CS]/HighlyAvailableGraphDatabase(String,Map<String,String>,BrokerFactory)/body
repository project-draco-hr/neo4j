{
  if (config == null) {
    throw new IllegalArgumentException("null config, proper configuration required");
  }
  this.storeDir=storeDir;
  this.config=config;
  config.put(Config.KEEP_LOGICAL_LOGS,"true");
  this.brokerFactory=brokerFactory != null ? brokerFactory : defaultBrokerFactory(storeDir,config);
  this.machineId=getMachineIdFromConfig(config);
  this.broker=this.brokerFactory.create(storeDir,config);
  this.msgLog=StringLogger.getLogger(storeDir + "/messages.log");
  startUp();
}
