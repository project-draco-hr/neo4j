{
  for (  NodePropertyUpdate update : this.updates) {
    long nodeId=update.getNodeId();
switch (update.getUpdateMode()) {
case ADDED:
case CHANGED:
      Fieldable encodedValue=documentStructure.encodeAsFieldable(update.getValueAfter());
    writer.updateDocument(documentStructure.newQueryForChangeOrRemove(nodeId),documentStructure.newDocumentRepresentingProperty(nodeId,encodedValue));
  break;
case REMOVED:
writer.deleteDocuments(documentStructure.newQueryForChangeOrRemove(nodeId));
break;
default :
throw new IllegalStateException("Unknown update mode " + update.getUpdateMode());
}
}
}
