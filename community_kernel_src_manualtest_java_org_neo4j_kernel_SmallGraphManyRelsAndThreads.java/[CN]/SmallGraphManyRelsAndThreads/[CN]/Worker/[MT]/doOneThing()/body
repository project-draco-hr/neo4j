{
  Transaction tx=nodes[0].getGraphDatabase().beginTx();
  try {
    Node node=nodes[random.nextInt(nodes.length)];
    int count=random.nextInt(3) + 3;
switch ((int)(System.currentTimeMillis() % 3)) {
case 0:
      totalCount+=count(node.getRelationships());
    break;
case 1:
  for (int i=0; i < count; i++) {
    Node otherNode=nodes[random.nextInt(nodes.length)];
    node.createRelationshipTo(otherNode,randomRelationshipType());
  }
break;
case 2:
List<Relationship> rels=addToCollection(node.getRelationships(),new ArrayList<Relationship>());
for (int i=0; i < count; i++) {
Relationship rel=null;
int pos=0;
while (rel == null) {
pos=random.nextInt(rels.size());
rel=rels.get(pos);
}
try {
rel.delete();
}
 catch (NotFoundException e) {
}
rels.set(pos,null);
}
break;
}
tx.success();
}
  finally {
tx.finish();
}
}
