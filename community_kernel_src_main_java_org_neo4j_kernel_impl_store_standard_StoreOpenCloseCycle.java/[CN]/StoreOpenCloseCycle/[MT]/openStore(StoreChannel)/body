{
  lock(channel);
  StateDescription result=determineState(channel);
  StoreState state=result.state();
switch (state) {
case CLEAN:
    channel.truncate(channel.size() - UTF8.encode(footer()).length);
  return false;
case UNCLEAN:
return true;
case WRONG_VERSION:
throw new NotCurrentStoreVersionException(result.expectedFooter(),result.foundFooter(),"",false);
default :
throw new IllegalStateException("Unknown store state: " + state);
}
}
