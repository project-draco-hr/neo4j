{
  lock(channel);
  StateDescription result=determineState(channel);
switch (result.state()) {
case CLEAN:
    channel.truncate(channel.size() - UTF8.encode(footer()).length);
  break;
case UNCLEAN:
idGenRebuilder.rebuildIdGenerator();
break;
case WRONG_VERSION:
throw new NotCurrentStoreVersionException(result.expectedFooter(),result.foundFooter(),"",false);
}
}
