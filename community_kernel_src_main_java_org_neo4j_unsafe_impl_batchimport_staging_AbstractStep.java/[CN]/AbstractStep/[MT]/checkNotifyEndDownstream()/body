{
  if (!stillWorking() && !isCompleted()) {
synchronized (this) {
      if (!isCompleted()) {
        if (downstream != null) {
          downstream.endOfUpstream();
        }
        done();
        completed=true;
      }
    }
  }
}
