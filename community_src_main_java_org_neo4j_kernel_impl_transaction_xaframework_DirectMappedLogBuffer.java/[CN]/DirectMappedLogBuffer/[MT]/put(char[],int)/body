{
  int charsToWrite=chars.length - offset;
  if (charsToWrite * 2 > BUFFER_SIZE) {
    charsToWrite=BUFFER_SIZE / 2;
  }
  if (byteBuffer == null || (BUFFER_SIZE - byteBuffer.position()) < (charsToWrite * 2)) {
    getNewDirectBuffer();
  }
  int oldPos=byteBuffer.position();
  byteBuffer.asCharBuffer().put(chars,offset,charsToWrite);
  byteBuffer.position(oldPos + (charsToWrite * 2));
  offset+=charsToWrite;
  if (offset < chars.length) {
    put(chars,offset);
  }
}
