{
  if (providerMap == null || providerMap.getDefaultProvider() == null) {
    throw new IllegalStateException("You cannot run the database without an index provider, " + "please make sure that a valid provider (subclass of " + SchemaIndexProvider.class.getName() + ") is on your classpath.");
  }
  IndexSamplingSetup samplingSetup=new IndexSamplingSetup(samplingConfig,storeView,scheduler,tokenNameLookup,logging);
  return new IndexingService(samplingSetup,new IndexProxySetup(samplingSetup,storeView,providerMap,updateableSchemaState,tokenNameLookup,scheduler,logging),providerMap,storeView,indexRules,logging,monitor);
}
