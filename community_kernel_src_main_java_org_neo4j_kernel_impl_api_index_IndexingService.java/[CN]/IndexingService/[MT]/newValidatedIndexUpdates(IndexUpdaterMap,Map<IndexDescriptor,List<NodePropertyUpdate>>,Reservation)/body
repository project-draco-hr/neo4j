{
  return new ValidatedIndexUpdates(){
    @Override public void flush() throws IOException, IndexEntryConflictException, IndexCapacityExceededException {
      for (      Map.Entry<IndexDescriptor,List<NodePropertyUpdate>> entry : updatesByIndex.entrySet()) {
        IndexDescriptor indexDescriptor=entry.getKey();
        List<NodePropertyUpdate> updates=entry.getValue();
        IndexUpdater updater=indexUpdaters.getUpdater(indexDescriptor);
        for (        NodePropertyUpdate update : updates) {
          updater.process(update);
        }
      }
    }
    @Override public void close(){
      try {
        reservation.release();
      }
  finally {
        indexUpdaters.close();
      }
    }
    @Override public boolean hasChanges(){
      return !updatesByIndex.isEmpty();
    }
  }
;
}
