{
  while (true) {
switch (proxy.getState()) {
case ONLINE:
      return;
case FAILED:
    throw new IllegalStateException("Index entered " + FAILED + " state while recovery waited for it to be fully populated");
case POPULATING:
  Thread.sleep(10);
break;
default :
throw new IllegalStateException(proxy.getState().name());
}
}
}
