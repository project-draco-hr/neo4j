{
  Set<IndexProxy> rebuildingIndexes=new HashSet<IndexProxy>();
  Map<Long,IndexDescriptor> rebuildingIndexDescriptors=new HashMap<Long,IndexDescriptor>();
  for (  Map.Entry<Long,IndexProxy> entry : indexes.entrySet()) {
    long ruleId=entry.getKey();
    IndexProxy indexProxy=entry.getValue();
    InternalIndexState state=indexProxy.getState();
    logger.info("IndexingService.start: " + indexProxy.getDescriptor().toString() + "["+ state.name()+ "]");
switch (state) {
case ONLINE:
      break;
case POPULATING:
    rebuildingIndexes.add(indexProxy);
  rebuildingIndexDescriptors.put(ruleId,indexProxy.getDescriptor());
break;
case FAILED:
break;
}
}
dropIndexes(rebuildingIndexes);
for (Map.Entry<Long,IndexDescriptor> entry : rebuildingIndexDescriptors.entrySet()) {
long ruleId=entry.getKey();
IndexDescriptor descriptor=entry.getValue();
IndexProxy indexProxy=createPopulatingIndexProxy(ruleId,descriptor);
indexProxy.start();
indexes.put(ruleId,indexProxy);
}
serviceRunning=true;
}
