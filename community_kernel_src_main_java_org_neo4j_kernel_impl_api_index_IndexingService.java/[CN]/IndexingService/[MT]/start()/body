{
  Set<IndexProxy> rebuildingIndexes=new HashSet<IndexProxy>();
  Map<Long,Pair<IndexDescriptor,SchemaIndexProvider.Descriptor>> rebuildingIndexDescriptors=new HashMap<Long,Pair<IndexDescriptor,SchemaIndexProvider.Descriptor>>();
  for (  Map.Entry<Long,IndexProxy> entry : indexes.entrySet()) {
    long ruleId=entry.getKey();
    IndexProxy indexProxy=entry.getValue();
    InternalIndexState state=indexProxy.getState();
    logger.info("IndexingService.start: " + indexProxy.getDescriptor().toString() + " is "+ state.name());
switch (state) {
case ONLINE:
      break;
case POPULATING:
    rebuildingIndexes.add(indexProxy);
  Pair<IndexDescriptor,SchemaIndexProvider.Descriptor> descriptors=Pair.of(indexProxy.getDescriptor(),indexProxy.getProviderDescriptor());
rebuildingIndexDescriptors.put(ruleId,descriptors);
break;
case FAILED:
break;
}
}
dropIndexes(rebuildingIndexes);
for (Map.Entry<Long,Pair<IndexDescriptor,SchemaIndexProvider.Descriptor>> entry : rebuildingIndexDescriptors.entrySet()) {
long ruleId=entry.getKey();
Pair<IndexDescriptor,SchemaIndexProvider.Descriptor> descriptors=entry.getValue();
IndexDescriptor indexDescriptor=descriptors.first();
SchemaIndexProvider.Descriptor providerDescriptor=descriptors.other();
IndexProxy indexProxy=createPopulatingIndexProxy(ruleId,indexDescriptor,providerDescriptor);
indexProxy.start();
indexes.put(ruleId,indexProxy);
}
serviceRunning=true;
}
