{
  if (state == State.RUNNING) {
    try (IndexUpdaterMap updaterMap=indexMapReference.getIndexUpdaterMap(IndexUpdateMode.ONLINE)){
      applyUpdates(updates,updaterMap);
    }
   }
 else {
    logger.debug("Updating indexes while " + state + ": "+ updates.changedNodeIds());
    if (state == State.NOT_STARTED) {
      recoveredNodeIds.addAll(updates.changedNodeIds());
    }
 else {
      throw new IllegalStateException("Cannot queue index updates while index service is " + state);
    }
  }
}
