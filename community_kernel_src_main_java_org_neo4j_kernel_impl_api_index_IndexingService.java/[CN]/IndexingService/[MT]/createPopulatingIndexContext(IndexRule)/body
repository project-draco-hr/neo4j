{
  final long ruleId=rule.getId();
  FlippableIndexContext flippableContext=new FlippableIndexContext();
  flippableContext.setFlipTarget(singleContext(new PopulatingIndexContext(scheduler,rule,provider.getPopulator(ruleId,providerDependencies),flippableContext,storeView,logging)));
  flippableContext.flip();
  flippableContext.setFlipTarget(new IndexContextFactory(){
    @Override public IndexContext create(){
      return new OnlineIndexContext(provider.getWriter(ruleId,providerDependencies));
    }
  }
);
  IndexContext result=new RuleUpdateFilterIndexContext(flippableContext,rule);
  result=new ContractCheckingIndexContext(result);
  result=new ServiceStateUpdatingIndexContext(rule,result);
  return result;
}
