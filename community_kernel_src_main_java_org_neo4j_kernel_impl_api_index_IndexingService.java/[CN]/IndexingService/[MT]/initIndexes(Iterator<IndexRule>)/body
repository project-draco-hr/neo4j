{
  for (  IndexRule indexRule : loop(indexRules)) {
    long ruleId=indexRule.getId();
    IndexDescriptor descriptor=createDescriptor(indexRule);
    IndexProxy indexProxy=null;
    SchemaIndexProvider.Descriptor providerDescriptor=indexRule.getProviderDescriptor();
    InternalIndexState initialState=providerMap.apply(providerDescriptor).getInitialState(ruleId);
    logger.info("IndexingService.initIndexes: " + descriptor.toString() + " is "+ initialState.name());
switch (initialState) {
case ONLINE:
      indexProxy=createOnlineIndexProxy(ruleId,descriptor,providerDescriptor,indexRule.isConstraintIndex());
    break;
case POPULATING:
  indexProxy=createRecoveringIndexProxy(ruleId,descriptor,providerDescriptor);
break;
case FAILED:
indexProxy=createFailedIndexProxy(ruleId,descriptor,providerDescriptor,indexRule.isConstraintIndex());
break;
}
indexes.put(ruleId,indexProxy);
}
}
