{
  Collection<ResourceIterator<File>> snapshots=new ArrayList<>();
  Set<SchemaIndexProvider.Descriptor> fromProviders=new HashSet<>();
  for (  IndexProxy indexProxy : indexMapRef.getAllIndexProxies()) {
    Descriptor providerDescriptor=indexProxy.getProviderDescriptor();
    if (fromProviders.add(providerDescriptor)) {
      snapshots.add(providerMap.apply(providerDescriptor).snapshotMetaFiles());
    }
    snapshots.add(indexProxy.snapshotFiles());
  }
  return concatResourceIterators(snapshots.iterator());
}
