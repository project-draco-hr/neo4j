{
  Iterable<IndexProxy> indexesToStop=indexMapRef.clear();
  Collection<Future<Void>> indexStopFutures=new ArrayList<>();
  for (  IndexProxy index : indexesToStop) {
    try {
      indexStopFutures.add(index.close());
    }
 catch (    IOException e) {
      logger.error("Unable to close index",e);
    }
  }
  for (  Future<Void> future : indexStopFutures) {
    try {
      awaitIndexFuture(future);
    }
 catch (    Exception e) {
      logger.error("Error awaiting index to close",e);
    }
  }
}
