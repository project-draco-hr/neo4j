{
  FlippableIndexProxy flippableIndex=new FlippableIndexProxy();
  IndexPopulator populator=getPopulatorFromProvider(ruleId);
  PopulatingIndexProxy populatingIndex=new PopulatingIndexProxy(scheduler,descriptor,populator,flippableIndex,storeView,logging);
  flippableIndex.setFlipTarget(singleProxy(populatingIndex));
  flippableIndex.flip();
  flippableIndex.setFlipTarget(new IndexProxyFactory(){
    @Override public IndexProxy create(){
      return new OnlineIndexProxy(descriptor,getOnlineAccessorFromProvider(ruleId));
    }
  }
);
  IndexProxy result=contractCheckedProxy(flippableIndex,false);
  return serviceDecoratedProxy(ruleId,result);
}
