{
  if (serviceRunning) {
    for (    IndexProxy index : indexes.values()) {
      try {
        try (IndexUpdater updater=index.newUpdater(IndexUpdateMode.ONLINE)){
          for (          NodePropertyUpdate update : updates) {
            updater.process(update);
          }
        }
       }
 catch (      IOException e) {
        throw new UnderlyingStorageException("Unable to update " + index,e);
      }
    }
  }
 else {
    for (    IndexProxy index : indexes.values()) {
      try {
        try (IndexUpdater updater=index.newUpdater(IndexUpdateMode.RECOVERY)){
          for (          NodePropertyUpdate update : updates) {
            updater.process(update);
          }
        }
       }
 catch (      IOException e) {
        throw new UnderlyingStorageException("Unable to update " + index,e);
      }
    }
  }
}
