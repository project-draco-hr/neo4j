{
  IndexUpdateMode mode=serviceRunning ? IndexUpdateMode.ONLINE : IndexUpdateMode.RECOVERY;
  for (  IndexProxy index : indexMapReference.getAllIndexProxies()) {
    try {
      try (IndexUpdater updater=index.newUpdater(mode)){
        for (        NodePropertyUpdate update : updates) {
          updater.process(update);
        }
      }
     }
 catch (    IOException e) {
      throw new UnderlyingStorageException("Unable to update " + index,e);
    }
  }
}
