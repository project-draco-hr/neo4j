{
  IndexUpdateMode mode=serviceRunning ? IndexUpdateMode.ONLINE : IndexUpdateMode.RECOVERY;
  try (IndexUpdaterMap updaterMap=indexMapReference.getIndexUpdaterMap(mode)){
    for (    NodePropertyUpdate update : updates) {
      int propertyKeyId=update.getPropertyKeyId();
switch (update.getUpdateMode()) {
case ADDED:
        for (int len=update.getNumberOfLabelsAfter(), i=0; i < len; i++) {
          processUpdateIfIndexExists(updaterMap,update,propertyKeyId,update.getLabelAfter(i));
        }
      break;
case REMOVED:
    for (int len=update.getNumberOfLabelsBefore(), i=0; i < len; i++) {
      processUpdateIfIndexExists(updaterMap,update,propertyKeyId,update.getLabelBefore(i));
    }
  break;
case CHANGED:
int lenBefore=update.getNumberOfLabelsBefore();
int lenAfter=update.getNumberOfLabelsAfter();
for (int i=0, j=0; i < lenBefore && j < lenAfter; i++, j++) {
int labelBefore=update.getLabelBefore(i);
int labelAfter=update.getLabelAfter(j);
if (labelBefore == labelAfter) {
processUpdateIfIndexExists(updaterMap,update,propertyKeyId,labelAfter);
i++;
j++;
}
 else {
if (labelBefore < labelAfter) {
  i++;
}
 else {
  j++;
}
}
}
break;
}
}
}
 }
