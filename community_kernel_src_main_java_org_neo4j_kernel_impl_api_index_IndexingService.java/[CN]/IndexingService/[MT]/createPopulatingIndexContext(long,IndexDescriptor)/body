{
  FlippableIndexContext flippableContext=new FlippableIndexContext();
  IndexPopulator populator=getPopulator(ruleId);
  PopulatingIndexContext populatingContext=new PopulatingIndexContext(scheduler,descriptor,populator,flippableContext,storeView,logging);
  flippableContext.setFlipTarget(singleContext(populatingContext));
  flippableContext.flip();
  flippableContext.setFlipTarget(new IndexContextFactory(){
    @Override public IndexContext create(){
      return new OnlineIndexContext(descriptor,getOnlineAccessor(ruleId));
    }
  }
);
  IndexContext result=contractCheckedContext(false,flippableContext);
  return serviceDecoratedContext(ruleId,result);
}
