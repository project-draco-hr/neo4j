{
  if (state == State.RUNNING) {
    try {
      updates.flush();
    }
 catch (    IOException|IndexEntryConflictException|IndexCapacityExceededException e) {
      throw new UnderlyingStorageException(e);
    }
  }
 else {
    if (state == State.NOT_STARTED) {
      recoveredNodeIds.addAll(updates.changedNodeIds());
    }
 else {
      throw new IllegalStateException("Cannot queue index updates while index service is " + state);
    }
  }
}
