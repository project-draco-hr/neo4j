{
  dataDirectory=createTempDir();
  dbFactory=mock(LifecycleManagingDatabase.GraphFactory.class);
  when(dbFactory.newGraphDatabase(any(Config.class),any(GraphDatabaseFacadeFactory.Dependencies.class))).thenReturn(dbRule.getGraphDatabaseAPI());
  dbConfig=new Config(stringMap(ServerSettings.data_directory.name(),dataDirectory.getAbsolutePath()));
  theDatabase=newDatabase();
}
