{
  long labelId=2l;
  long propertyKeyId=3l;
  String value="My Value";
  IndexDescriptor indexDescriptor=new IndexDescriptor(labelId,propertyKeyId);
  when(store.nodesGetFromIndexLookup(indexDescriptor,value)).then(asAnswer(asList(2l,3l)));
  when(store.nodeGetProperty(anyLong(),eq(propertyKeyId))).thenReturn(Property.noNodeProperty(1,propertyKeyId));
  when(store.nodeGetAllProperties(anyLong())).thenReturn(IteratorUtil.<Property>emptyIterator());
  when(store.nodeHasLabel(1l,labelId)).thenReturn(false);
  when(oldTxState.getNodesWithChangedProperty(propertyKeyId,value)).thenReturn(new DiffSets<Long>(asSet(1l),Collections.<Long>emptySet()));
  txContext.nodeAddLabel(1l,labelId);
  Iterator<Long> result=txContext.nodesGetFromIndexLookup(indexDescriptor,value);
  assertThat(asSet(result),equalTo(asSet(1l,2l,3l)));
}
