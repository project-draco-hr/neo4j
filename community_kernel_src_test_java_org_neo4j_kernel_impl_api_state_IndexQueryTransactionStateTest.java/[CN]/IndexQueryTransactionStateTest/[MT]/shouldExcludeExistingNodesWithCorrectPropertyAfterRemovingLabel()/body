{
  int labelId=2, propertyKeyId=3;
  String value="My Value";
  IndexDescriptor indexDescriptor=new IndexDescriptor(labelId,propertyKeyId);
  when(store.nodesGetFromIndexLookup(state,indexDescriptor,value)).then(answerAsPrimitiveLongIteratorFrom(asList(1l,2l,3l)));
  when(store.nodeHasLabel(state,1l,labelId)).thenReturn(true);
  DefinedProperty stringProperty=Property.stringProperty(propertyKeyId,value);
  when(store.nodeGetProperty(state,1l,propertyKeyId)).thenReturn(stringProperty);
  when(store.nodeGetAllProperties(eq(state),anyLong())).thenReturn(iterator(stringProperty));
  when(oldTxState.getNodesWithChangedProperty(propertyKeyId,value)).thenReturn(new DiffSets<Long>());
  txContext.nodeRemoveLabel(state,1l,labelId);
  PrimitiveLongIterator result=txContext.nodesGetFromIndexLookup(state,indexDescriptor,value);
  assertThat(asSet(result),equalTo(asSet(2l,3l)));
}
