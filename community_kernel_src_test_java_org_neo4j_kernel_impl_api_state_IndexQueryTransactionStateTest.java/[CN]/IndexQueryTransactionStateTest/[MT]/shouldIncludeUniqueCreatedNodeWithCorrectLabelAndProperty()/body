{
  when(store.nodeGetUniqueFromIndexLookup(state,indexDescriptor,value)).thenReturn(asPrimitiveResourceIterator());
  when(store.nodeGetProperty(anyLong(),eq(propertyKeyId))).thenReturn(noNodeProperty(1,propertyKeyId));
  when(store.nodeGetAllProperties(anyLong())).thenReturn(IteratorUtil.<DefinedProperty>emptyIterator());
  when(store.nodeHasLabel(1l,labelId)).thenReturn(false);
  when(oldTxState.getNodesWithChangedProperty(propertyKeyId,value)).thenReturn(new DiffSets<>(asSet(1l),Collections.<Long>emptySet()));
  state.txState().nodeDoReplaceProperty(1l,noNodeProperty(1l,propertyKeyId),stringProperty(propertyKeyId,value));
  txContext.nodeAddLabel(state,1l,labelId);
  long result=txContext.nodeGetUniqueFromIndexLookup(state,indexDescriptor,value);
  assertThat(result,equalTo(1l));
}
