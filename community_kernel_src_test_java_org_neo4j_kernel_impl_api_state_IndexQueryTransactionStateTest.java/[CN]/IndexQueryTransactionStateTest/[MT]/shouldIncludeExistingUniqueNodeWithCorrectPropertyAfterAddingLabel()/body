{
  when(store.nodeGetUniqueFromIndexLookup(state,indexDescriptor,value)).thenReturn(emptyPrimitiveLongIterator());
  when(store.nodeHasLabel(state,2l,labelId)).thenReturn(false);
  DefinedProperty stringProperty=Property.stringProperty(propertyKeyId,value);
  when(store.nodeGetProperty(state,2l,propertyKeyId)).thenReturn(stringProperty);
  when(store.nodeGetAllProperties(eq(state),anyLong())).thenReturn(iterator(stringProperty));
  when(oldTxState.getNodesWithChangedProperty(propertyKeyId,value)).thenReturn(new DiffSets<Long>());
  txContext.nodeAddLabel(state,2l,labelId);
  long result=txContext.nodeGetUniqueFromIndexLookup(state,indexDescriptor,value);
  assertThat(result,equalTo(2l));
}
