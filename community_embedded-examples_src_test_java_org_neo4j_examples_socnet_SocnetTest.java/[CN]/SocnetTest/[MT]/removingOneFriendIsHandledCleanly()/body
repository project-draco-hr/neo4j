{
  Person person1;
  Person person2;
  int noOfFriends;
  try (Transaction tx=graphDb.beginTx()){
    person1=personRepository.getPersonByName("person#1");
    person2=personRepository.getPersonByName("person#2");
    person1.addFriend(person2);
    noOfFriends=person1.getNrOfFriends();
    tx.success();
  }
   try (Transaction tx=graphDb.beginTx()){
    person1.removeFriend(person2);
    tx.success();
  }
   try (Transaction tx=graphDb.beginTx()){
    int noOfFriendsAfterChange=person1.getNrOfFriends();
    assertThat(noOfFriends,equalTo(noOfFriendsAfterChange + 1));
  }
 }
