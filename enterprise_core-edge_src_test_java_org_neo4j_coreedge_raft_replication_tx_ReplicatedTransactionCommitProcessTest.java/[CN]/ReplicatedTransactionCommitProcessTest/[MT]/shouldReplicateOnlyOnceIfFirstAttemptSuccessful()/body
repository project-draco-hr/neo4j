{
  Replicator replicator=mock(Replicator.class);
  ReplicatedTransactionStateMachine transactionStateMachine=mock(ReplicatedTransactionStateMachine.class);
  CommittingTransaction future=mock(CommittingTransaction.class);
  ReplicatedLockTokenStateMachine<Object> currentReplicatedLockState=mock(ReplicatedLockTokenStateMachine.class);
  when(currentReplicatedLockState.currentToken()).thenReturn(new ReplicatedLockTokenRequest<>(null,0));
  when(future.waitUntilCommitted(anyInt(),any(TimeUnit.class))).thenReturn(23L);
  CommittingTransactions txFutures=mock(CommittingTransactionsRegistry.class);
  when(txFutures.register(any(LocalOperationId.class))).thenReturn(future);
  new ReplicatedTransactionCommitProcess(replicator,new LocalSessionPool(coreMember),new ConstantTimeRetryStrategy(1,SECONDS),NullLogService.getInstance(),txFutures,new Monitors()).commit(tx(),NULL,INTERNAL);
  verify(replicator,times(1)).replicate(any(ReplicatedTransaction.class));
}
