{
  Replicator replicator=mock(Replicator.class);
  doThrow(Replicator.ReplicationFailedException.class).when(replicator).replicate(any(ReplicatedContent.class));
  TransactionCommitProcess commitProcess=new ReplicatedTransactionCommitProcess(replicator,new LocalSessionPool(coreMember),0,NullLogService.getInstance(),mock(CommittingTransactions.class),new Monitors());
  try {
    commitProcess.commit(tx(),NULL,INTERNAL);
    fail("should have thrown exception");
  }
 catch (  TransactionFailureException e) {
    assertEquals(Status.Transaction.CouldNotCommit,e.status());
  }
}
