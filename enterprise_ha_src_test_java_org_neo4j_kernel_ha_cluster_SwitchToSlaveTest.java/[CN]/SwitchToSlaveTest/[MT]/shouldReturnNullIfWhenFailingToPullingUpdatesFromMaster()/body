{
  SwitchToSlave switchToSlave=newSwitchToSlaveSpy();
  when(fs.fileExists(any(File.class))).thenReturn(true);
  when(updatePuller.await(UpdatePuller.NEXT_TICKET,true)).thenThrow(new IllegalStateException("this should not happen"));
  when(updatePuller.await(UpdatePuller.NEXT_TICKET,false)).thenReturn(false);
  URI localhost=new URI("127.0.0.1");
  URI uri=switchToSlave.switchToSlave(mock(LifeSupport.class),localhost,localhost,mock(CancellationRequest.class));
  assertNull(uri);
}
