{
  SwitchToSlave switchToSlave=newSwitchToSlaveSpy();
  MasterClient masterClient=mock(MasterClient.class);
  Response<HandshakeResult> response=mock(Response.class);
  when(response.response()).thenReturn(new HandshakeResult(1,2));
  when(masterClient.handshake(anyLong(),any(StoreId.class))).thenReturn(response);
  StoreId storeId=new StoreId(1,2,3,4);
  TransactionIdStore transactionIdStore=mock(TransactionIdStore.class);
  when(transactionIdStore.getLastCommittedTransaction()).thenReturn(new TransactionId(42,42));
  when(transactionIdStore.getLastCommittedTransactionId()).thenReturn(TransactionIdStore.BASE_TX_ID);
  try {
    switchToSlave.checkDataConsistency(masterClient,transactionIdStore,storeId,new URI("cluster://localhost?serverId=1"));
    fail("Should have thrown " + MismatchingStoreIdException.class.getSimpleName() + " exception");
  }
 catch (  MismatchingStoreIdException e) {
  }
  verify(switchToSlave).stopServicesAndHandleBranchedStore(any(BranchedDataPolicy.class));
}
