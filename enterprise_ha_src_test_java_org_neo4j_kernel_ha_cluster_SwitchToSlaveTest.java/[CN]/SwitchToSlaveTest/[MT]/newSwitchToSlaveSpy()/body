{
  Response<HandshakeResult> response=mock(Response.class);
  when(response.response()).thenReturn(new HandshakeResult(42,2));
  when(masterClient.handshake(anyLong(),any(StoreId.class))).thenReturn(response);
  when(masterClient.getProtocolVersion()).thenReturn(MasterClient214.PROTOCOL_VERSION);
  MasterClientResolver masterClientResolver=mock(MasterClientResolver.class);
  when(masterClientResolver.instantiate(anyString(),anyInt(),anyString(),any(Monitors.class),any(StoreId.class),any(LifeSupport.class))).thenReturn(masterClient);
  return spy(new SwitchToSlave(ConsoleLogger.DEV_NULL,configMock(),neoStoreDataSource.getDependencyResolver(),mock(HaIdGeneratorFactory.class),new DevNullLoggingService(),mock(DelegateInvocationHandler.class),mock(ClusterMemberAvailability.class),mock(RequestContextFactory.class),Iterables.<KernelExtensionFactory<?>>empty(),masterClientResolver,updatePuller,pullerFactory,ByteCounterMonitor.NULL,mock(RequestMonitor.class),mock(SwitchToSlave.Monitor.class),new StoreCopyClient.Monitor.Adapter()));
}
