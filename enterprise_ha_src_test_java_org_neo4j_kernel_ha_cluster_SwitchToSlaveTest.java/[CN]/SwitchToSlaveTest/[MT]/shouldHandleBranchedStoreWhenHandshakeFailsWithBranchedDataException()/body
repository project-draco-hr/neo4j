{
  SwitchToSlave switchToSlave=newSwitchToSlaveSpy();
  MasterClient masterClient=mock(MasterClient.class);
  when(masterClient.handshake(anyLong(),any(StoreId.class))).thenThrow(new BranchedDataException(""));
  try {
    switchToSlave.checkDataConsistency(masterClient,dataSourceMock(),null,true);
    fail("Should have thrown " + BranchedDataException.class.getSimpleName() + " exception");
  }
 catch (  BranchedDataException e) {
  }
  verify(switchToSlave).stopServicesAndHandleBranchedStore(any(BranchedDataPolicy.class));
}
