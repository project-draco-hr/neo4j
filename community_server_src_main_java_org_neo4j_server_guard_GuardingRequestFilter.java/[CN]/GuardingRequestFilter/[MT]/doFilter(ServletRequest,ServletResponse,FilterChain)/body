{
  if (req instanceof HttpServletRequest && res instanceof HttpServletResponse) {
    HttpServletRequest request=(HttpServletRequest)req;
    HttpServletResponse response=(HttpServletResponse)res;
    int timeLimit=getTimeLimit(request);
    if (timeLimit <= 0) {
      guard.clear();
      chain.doFilter(req,res);
    }
 else {
      guard.start(currentTimeMillis() + timeLimit);
      try {
        chain.doFilter(req,res);
      }
 catch (      GuardException e) {
        response.setStatus(SC_REQUEST_TIMEOUT);
      }
 finally {
        guard.stop();
      }
    }
  }
 else {
    chain.doFilter(req,res);
  }
}
