{
  Dependencies dependencies=mock(Dependencies.class);
  TransactionCountingTransactionCommitProcess commitProcess=new TransactionCountingTransactionCommitProcess();
  when(dependencies.commitProcess()).thenReturn(commitProcess);
  when(dependencies.logService()).thenReturn(NullLogService.getInstance());
  KernelTransactions kernelTransactions=mock(KernelTransactions.class);
  when(dependencies.kernelTransactions()).thenReturn(kernelTransactions);
  TransactionCommittingResponseUnpacker unpacker=life.add(new TransactionCommittingResponseUnpacker(dependencies,5,0));
  unpacker.unpackResponse(new DummyTransactionResponse(BASE_TX_ID + 1,7),NO_OP_TX_HANDLER);
  commitProcess.assertBatchSize(5);
  commitProcess.assertBatchSize(2);
  commitProcess.assertNoMoreBatches();
}
