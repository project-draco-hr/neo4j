{
  final TransactionAppender appender=mockedTransactionAppender();
  final BatchingTransactionRepresentationStoreApplier storeApplier=mock(BatchingTransactionRepresentationStoreApplier.class);
  final IndexUpdatesValidator validator=mock(IndexUpdatesValidator.class);
  IOException error=new IOException("error");
  when(validator.validate(any(TransactionRepresentation.class))).thenThrow(error);
  Dependencies deps=new MockedDependencies().indexUpdatesValidator(validator).transactionRepresentationStoreApplier(storeApplier).transactionAppender(appender).kernelHealth(newKernelHealth());
  TransactionCommittingResponseUnpacker unpacker=new TransactionCommittingResponseUnpacker(deps);
  unpacker.start();
  Response<?> response=new DummyTransactionResponse(BASE_TX_ID + 1,1,appender,10);
  try {
    unpacker.unpackResponse(response,NO_OP_TX_HANDLER);
    fail("Should have thrown " + IOException.class.getSimpleName());
  }
 catch (  IOException e) {
    assertSame(error,e);
  }
  verifyZeroInteractions(storeApplier);
}
