{
  final TransactionAppender appender=mockedTransactionAppender();
  final TransactionRepresentationStoreApplier storeApplier=mock(TransactionRepresentationStoreApplier.class);
  final IndexUpdatesValidator validator=mock(IndexUpdatesValidator.class);
  IOException error=new IOException("error");
  when(validator.validate(any(TransactionRepresentation.class),eq(TransactionApplicationMode.EXTERNAL))).thenThrow(error);
  TransactionCommittingResponseUnpacker.Dependencies deps=buildDependencies(mock(TransactionIdStore.class),mock(LogFile.class),mock(LogRotation.class),validator,storeApplier,appender,mock(TransactionObligationFulfiller.class));
  TransactionCommittingResponseUnpacker unpacker=new TransactionCommittingResponseUnpacker(deps);
  unpacker.start();
  Response<?> response=new DummyTransactionResponse(BASE_TX_ID + 1,1,appender,10);
  try {
    unpacker.unpackResponse(response,NO_OP_TX_HANDLER);
    fail("Should have thrown " + IOException.class.getSimpleName());
  }
 catch (  IOException e) {
    assertSame(error,e);
  }
  verifyZeroInteractions(storeApplier);
}
