{
  launch();
  try {
    long endTime=currentTimeMillis() + SECONDS.toMillis(maxSeconds);
    while (currentTimeMillis() < endTime) {
      try {
        return process.exitValue();
      }
 catch (      IllegalThreadStateException e) {
        try {
          Thread.sleep(100);
        }
 catch (        InterruptedException ie) {
          throw new RuntimeException(ie);
        }
      }
    }
    process.destroy();
    throw new RuntimeException("Process " + process + " didn't exit by itself within "+ maxSeconds+ " seconds so I killed it");
  }
  finally {
    done();
  }
}
