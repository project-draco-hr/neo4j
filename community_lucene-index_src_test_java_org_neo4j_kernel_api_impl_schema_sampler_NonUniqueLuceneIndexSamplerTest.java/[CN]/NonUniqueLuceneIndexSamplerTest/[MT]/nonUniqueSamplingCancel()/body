{
  Terms terms=getTerms("test",1);
  Map<String,Terms> fieldTermsMap=MapUtil.genericMap("a",terms,"id",terms,"b",terms);
  IndexReaderStub indexReader=new IndexReaderStub(new SamplingFields(fieldTermsMap));
  when(indexSearcher.getIndexReader()).thenReturn(indexReader);
  expectedException.expect(IndexNotFoundKernelException.class);
  expectedException.expectMessage("Index dropped while sampling.");
  NonUniqueLuceneIndexSampler luceneIndexSampler=createSampler();
  taskControl.cancel();
  luceneIndexSampler.sampleIndex(Registers.newDoubleLongRegister());
}
