{
  Collection<LockReleaseCallback> releaseFailures=null;
  Exception releaseException=null;
  for (  LockReleaseCallback lockElement : locks) {
    try {
      lockElement.release();
    }
 catch (    Exception e) {
      releaseException=e;
      if (releaseFailures == null) {
        releaseFailures=new ArrayList<>();
      }
      releaseFailures.add(lockElement);
    }
  }
  if (releaseException != null) {
    throw new ReleaseLocksFailedKernelException("Unable to release locks: " + describeLockGroups(releaseFailures) + ". "+ "Perhaps we have had a master-switch since the transaction was started?",releaseException);
  }
  locks.clear();
}
