{
  int grabSize=2;
  GraphDatabaseService db=new ImpermanentGraphDatabase("target/test-data/test-db4",stringMap("relationship_grab_size","" + grabSize));
  Transaction tx=db.beginTx();
  Node node1=db.createNode();
  Node node2=db.createNode();
  int count=0;
  RelationshipType type1=DynamicRelationshipType.withName("type");
  RelationshipType type2=DynamicRelationshipType.withName("bar");
  for (int i=0; i < 11; i++) {
    node1.createRelationshipTo(node2,type1);
    count++;
  }
  for (int i=0; i < 10; i++) {
    node1.createRelationshipTo(node2,type2);
    count++;
  }
  tx.success();
  tx.finish();
  tx=db.beginTx();
  ((AbstractGraphDatabase)db).getConfig().getGraphDbModule().getNodeManager().clearCache();
  node1.createRelationshipTo(node2,type1);
  count++;
  Relationship rel1=node1.getRelationships(type1).iterator().next();
  System.out.println("Deleting : " + rel1);
  rel1.delete();
  count--;
  int finalCount=0;
  for (  Relationship rel : node1.getRelationships()) {
    finalCount++;
  }
  assertEquals(count,finalCount);
  tx.success();
  tx.finish();
  db.shutdown();
}
