{
  Node node1=getGraphDb().createNode();
  Node node2=getGraphDb().createNode();
  Relationship relationship=node1.createRelationshipTo(node2,MyRelTypes.TEST);
  node1.delete();
  node2.delete();
  try {
    getTransaction().success();
    getTransaction().finish();
    fail("deleting node with relaitonship should not commit.");
  }
 catch (  Exception e) {
  }
  setTransaction(getGraphDb().beginTx());
}
