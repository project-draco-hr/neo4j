{
  int num_edges=100;
  Node hub;
  GraphDatabaseService graphDB=getGraphDb();
  Node[] nodes=new Node[256];
  for (int num_nodes=0; num_nodes < nodes.length; num_nodes+=1) {
    nodes[num_nodes]=graphDB.createNode();
  }
  newTransaction();
  hub=nodes[4];
  int nextID=7;
  DynamicRelationshipType outtie=DynamicRelationshipType.withName("outtie");
  DynamicRelationshipType innie=DynamicRelationshipType.withName("innie");
  for (int k=0; k < num_edges; k+=1) {
    Node neighbor=nodes[nextID];
    nextID+=7;
    nextID&=255;
    if (nextID == 0)     nextID=1;
    hub.createRelationshipTo(neighbor,outtie);
  }
  newTransaction();
  for (int k=0; k < num_edges; k+=1) {
    Node neighbor=nodes[nextID];
    nextID+=7;
    nextID&=255;
    if (nextID == 0)     nextID=1;
    neighbor.createRelationshipTo(hub,innie);
  }
  commit();
  clearCache();
  hub=graphDB.getNodeById(hub.getId());
  int count=0;
  for (  @SuppressWarnings("unused") Relationship r1 : hub.getRelationships()) {
    count+=count(hub.getRelationships());
  }
  assertEquals(40000,count);
  count=0;
  for (  @SuppressWarnings("unused") Relationship r1 : hub.getRelationships()) {
    count+=count(hub.getRelationships());
  }
  assertEquals(40000,count);
}
