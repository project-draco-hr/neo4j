{
  Transaction tx=db.beginTx();
  ((AbstractGraphDatabase)db).getConfig().getGraphDbModule().getNodeManager().clearCache();
  node1.createRelationshipTo(node2,createType);
  Relationship rel1=node1.getRelationships(deleteType).iterator().next();
  rel1.delete();
  assertEquals(expectedCount,count(node1.getRelationships()));
  assertEquals(expectedCount,count(node2.getRelationships()));
  tx.success();
  tx.finish();
  assertEquals(expectedCount,count(node1.getRelationships()));
  assertEquals(expectedCount,count(node2.getRelationships()));
}
