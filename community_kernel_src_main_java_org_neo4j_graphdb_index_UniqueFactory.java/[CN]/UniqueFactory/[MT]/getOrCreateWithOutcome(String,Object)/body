{
  T result=index.get(key,value).getSingle();
  boolean wasCreated=false;
  if (result == null) {
    Transaction tx=graphDatabase().beginTx();
    try {
      Map<String,Object> properties=Collections.singletonMap(key,value);
      T created=create(properties);
      result=index.putIfAbsent(created,key,value);
      if (result == null) {
        initialize(created,properties);
        result=created;
        wasCreated=true;
      }
 else {
        delete(created);
      }
      tx.success();
    }
  finally {
      tx.finish();
    }
  }
  return new UniqueEntity<T>(result,wasCreated);
}
