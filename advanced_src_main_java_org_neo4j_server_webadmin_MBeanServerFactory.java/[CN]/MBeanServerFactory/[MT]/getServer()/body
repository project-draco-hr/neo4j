{
  GraphDatabaseService db;
  try {
    db=NeoServer.server().database().db;
    if (db != cachedDb) {
      cachedDb=db;
      if (db instanceof EmbeddedGraphDatabase) {
        cachedServer=ManagementFactory.getPlatformMBeanServer();
      }
    }
  }
 catch (  DatabaseBlockedException e1) {
    e1.printStackTrace();
  }
  return cachedServer;
}
