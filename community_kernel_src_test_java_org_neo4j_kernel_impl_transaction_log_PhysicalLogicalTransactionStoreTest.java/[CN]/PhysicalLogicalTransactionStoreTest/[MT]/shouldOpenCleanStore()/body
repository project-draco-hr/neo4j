{
  TransactionIdStore transactionIdStore=new DeadSimpleTransactionIdStore();
  TransactionMetadataCache positionCache=new TransactionMetadataCache(10,1000);
  LifeSupport life=new LifeSupport();
  PhysicalLogFiles logFiles=new PhysicalLogFiles(testDir,DEFAULT_NAME,fs);
  Monitor monitor=new Monitors().newMonitor(PhysicalLogFile.Monitor.class);
  LogFile logFile=life.add(new PhysicalLogFile(fs,logFiles,1000,transactionIdStore,mock(LogVersionRepository.class),monitor,positionCache));
  life.add(new BatchingTransactionAppender(logFile,NO_ROTATION,NO_CHECKPOINT,Consumers.LNOOP,positionCache,transactionIdStore,BYPASS,kernelHealth));
  try {
    life.start();
  }
  finally {
    life.shutdown();
  }
}
