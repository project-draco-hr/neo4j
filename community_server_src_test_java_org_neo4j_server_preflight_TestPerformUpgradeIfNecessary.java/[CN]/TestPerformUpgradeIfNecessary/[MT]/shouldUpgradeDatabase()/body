{
  Configuration serverConfig=buildProperties(true);
  prepareSampleLegacyDatabase(new DefaultFileSystemAbstraction(),new File(STORE_DIRECTORY));
  ByteArrayOutputStream outputStream=new ByteArrayOutputStream();
  PerformUpgradeIfNecessary upgrader=new PerformUpgradeIfNecessary(serverConfig,loadNeo4jProperties(),new PrintStream(outputStream));
  boolean exit=upgrader.run();
  assertEquals(true,exit);
  String[] lines=new String(outputStream.toByteArray()).split("\\r?\\n");
  assertEquals("Starting upgrade of database store files",lines[0]);
  assertEquals(dots(100),lines[1]);
  assertEquals("Finished upgrade of database store files",lines[2]);
}
