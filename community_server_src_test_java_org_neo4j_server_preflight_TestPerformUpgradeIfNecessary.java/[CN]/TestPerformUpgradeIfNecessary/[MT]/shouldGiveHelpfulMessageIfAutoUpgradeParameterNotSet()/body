{
  Config serverProperties=buildProperties(false);
  prepareSampleLegacyDatabase(storeDir);
  Monitor monitor=mock(Monitor.class);
  PerformUpgradeIfNecessary upgrader=new PerformUpgradeIfNecessary(serverProperties,loadNeo4jProperties(),NullLogProvider.getInstance(),monitor);
  boolean exit=upgrader.run();
  assertEquals(false,exit);
  verify(monitor,times(1)).migrationNeeded();
  verify(monitor,times(1)).migrationNotAllowed();
  verifyNoMoreInteractions(monitor);
}
