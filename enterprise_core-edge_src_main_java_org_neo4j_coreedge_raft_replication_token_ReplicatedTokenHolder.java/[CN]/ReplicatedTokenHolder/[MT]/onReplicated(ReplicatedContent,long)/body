{
  if (logIndex <= lastCommittedIndex) {
    return;
  }
  if (content instanceof ReplicatedTokenRequest && ((ReplicatedTokenRequest)content).type().equals(type)) {
    ReplicatedTokenRequest tokenRequest=(ReplicatedTokenRequest)content;
    Integer tokenId=tokenCache.getId(tokenRequest.tokenName());
    if (tokenId == null) {
      try {
        Collection<Command> commands=ReplicatedTokenRequestSerializer.extractCommands(tokenRequest.commandBytes());
        tokenId=applyToStore(commands,logIndex);
      }
 catch (      NoSuchEntryException e) {
        throw new IllegalStateException("Commands did not contain token command");
      }
      tokenCache.put(tokenFactory.newToken(tokenRequest.tokenName(),tokenId));
    }
    tokenFutures.complete(tokenRequest.tokenName(),tokenId);
  }
}
