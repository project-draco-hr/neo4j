{
  if (content instanceof ReplicatedTokenRequest && ((ReplicatedTokenRequest)content).type().equals(type)) {
    if (logIndex > lastCommittedIndex) {
      ReplicatedTokenRequest tokenRequest=(ReplicatedTokenRequest)content;
      Integer tokenId=tokenCache.getId(tokenRequest.tokenName());
      if (tokenId == null) {
        try {
          Collection<StorageCommand> commands=ReplicatedTokenRequestSerializer.extractCommands(tokenRequest.commandBytes());
          tokenId=applyToStore(commands,logIndex);
        }
 catch (        NoSuchEntryException e) {
          throw new IllegalStateException("Commands did not contain token command");
        }
        tokenCache.put(tokenFactory.newToken(tokenRequest.tokenName(),tokenId));
      }
      tokenFutures.complete(tokenRequest.tokenName(),tokenId);
    }
 else {
      log.info("Ignoring content at index %d, since already applied up to %d",logIndex,lastCommittedIndex);
    }
  }
}
