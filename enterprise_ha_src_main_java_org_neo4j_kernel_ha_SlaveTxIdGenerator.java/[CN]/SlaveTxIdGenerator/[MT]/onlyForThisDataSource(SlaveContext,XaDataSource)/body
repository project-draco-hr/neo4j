{
  Tx txForDs=null;
  for (  Tx tx : slaveContext.lastAppliedTransactions()) {
    if (tx.getDataSourceName().equals(dataSource.getName())) {
      txForDs=tx;
      break;
    }
  }
  if (txForDs == null) {
    throw new RuntimeException("Apparently " + slaveContext + " didn't have the XA data source we are commiting ("+ dataSource.getName()+ ")");
  }
  return new SlaveContext(slaveContext.getSessionId(),slaveContext.machineId(),slaveContext.getEventIdentifier(),new Tx[]{txForDs},slaveContext.getMasterId(),slaveContext.getChecksum());
}
