{
  this.graphDbService=graphDb;
  this.cacheManager=cacheManager;
  this.lockManager=lockManager;
  this.transactionManager=transactionManager;
  this.propertyIndexManager=new PropertyIndexManager(transactionManager,persistenceManager,idGenerator);
  this.lockReleaser=lockReleaser;
  lockReleaser.setNodeManager(this);
  lockReleaser.setPropertyIndexManager(propertyIndexManager);
  this.persistenceManager=persistenceManager;
  this.idGenerator=idGenerator;
  this.relTypeHolder=new RelationshipTypeHolder(transactionManager,persistenceManager,idGenerator);
  this.useNewCache=useNewCache;
  this.useNoCache=useNoCache;
  if (this.useNoCache) {
    nodeCache=new NoCache<Integer,NodeImpl>("NodeCache");
    relCache=new NoCache<Integer,RelationshipImpl>("RelationshipCache");
  }
 else   if (useNewCache) {
    nodeCache=new WeakLruCache<Integer,NodeImpl>("NodeCache");
    relCache=new WeakLruCache<Integer,RelationshipImpl>("RelationshipCache");
  }
 else {
    nodeCache=new LruCache<Integer,NodeImpl>("NodeCache",1500,this.cacheManager);
    relCache=new LruCache<Integer,RelationshipImpl>("RelationshipCache",3500,this.cacheManager);
  }
  for (int i=0; i < loadLocks.length; i++) {
    loadLocks[i]=new ReentrantLock();
  }
}
