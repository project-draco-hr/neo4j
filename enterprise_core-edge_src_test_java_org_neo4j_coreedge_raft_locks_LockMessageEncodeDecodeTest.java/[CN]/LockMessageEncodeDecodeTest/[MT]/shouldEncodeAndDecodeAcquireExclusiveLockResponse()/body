{
  CatchupClientProtocol protocol=new CatchupClientProtocol();
  protocol.expect(CatchupClientProtocol.NextMessage.LOCK_RESPONSE);
  EmbeddedChannel channel=new EmbeddedChannel(new LockResponseEncoder(),new LockResponseDecoder(protocol));
  LockSession lockSession=new LockSession(new CoreMember(address("host1:1001"),address("host1:2001")),23);
  Request request=Request.acquireExclusiveLock(lockSession,ResourceTypes.NODE,2001);
  Response sent=new Response(request,new LockResult(LockStatus.OK_LOCKED));
  channel.writeOutbound(sent);
  channel.writeInbound(channel.readOutbound());
  Response received=(Response)channel.readInbound();
  assertNotSame(sent,received);
  assertEquals(sent,received);
}
