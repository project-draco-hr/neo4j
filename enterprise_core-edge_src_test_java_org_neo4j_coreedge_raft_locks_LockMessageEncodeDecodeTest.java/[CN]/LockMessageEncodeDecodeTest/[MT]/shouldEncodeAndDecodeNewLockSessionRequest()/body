{
  CatchupServerProtocol protocol=new CatchupServerProtocol();
  protocol.expect(NextMessage.LOCK_REQUEST);
  EmbeddedChannel channel=new EmbeddedChannel(new LockRequestEncoder(),new LockRequestDecoder(protocol));
  LockSession lockSession=new LockSession(new CoreMember(address("host1:1001"),address("host1:2001")),23);
  Request sent=Request.newLockSession(lockSession);
  channel.writeOutbound(sent);
  channel.writeInbound(channel.readOutbound());
  Request received=(Request)channel.readInbound();
  assertNotSame(sent,received);
  assertEquals(sent,received);
}
