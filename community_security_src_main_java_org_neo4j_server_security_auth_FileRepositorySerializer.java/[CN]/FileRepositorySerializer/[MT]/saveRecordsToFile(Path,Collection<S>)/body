{
  Path directory=recordsFile.getParent();
  if (!Files.exists(directory)) {
    Files.createDirectories(directory);
  }
  Path tempFile=Files.createTempFile(directory,recordsFile.getFileName().toString() + "-",".tmp");
  try {
    Files.write(tempFile,serialize(records));
    Files.move(tempFile,recordsFile,ATOMIC_MOVE,REPLACE_EXISTING);
  }
 catch (  Throwable e) {
    Files.delete(tempFile);
    throw e;
  }
}
