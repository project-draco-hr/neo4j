{
  while (source.hasNext()) {
    Document doc=source.next();
    long id=idFromDoc(doc);
    boolean documentIsFromStore=doc.getFieldable(FullTxData.TX_STATE_KEY) == null;
    boolean idWillBeReturnedByTransactionStateInstead=documentIsFromStore && idsModifiedInTransactionState.contains(id);
    if (removedInTransactionState.contains(id) || idWillBeReturnedByTransactionStateInstead) {
      continue;
    }
    return next(id);
  }
  return endReached();
}
