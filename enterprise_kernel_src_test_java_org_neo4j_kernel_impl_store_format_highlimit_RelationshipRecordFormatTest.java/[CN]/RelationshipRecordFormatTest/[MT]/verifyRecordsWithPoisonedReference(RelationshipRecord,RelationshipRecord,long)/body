{
  boolean nullPoison=poisonedReference == NULL;
  int differentReferences=nullPoison ? 5 : 7;
  List<Long> references=buildReferenceList(differentReferences,poisonedReference);
  for (int i=0; i < differentReferences; i++) {
    cursor.setOffset(0);
    Iterator<Long> iterator=references.iterator();
    source.initialize(true,iterator.next(),nullPoison ? randomFixedReference() : iterator.next(),nullPoison ? randomFixedReference() : iterator.next(),0,iterator.next(),iterator.next(),iterator.next(),iterator.next(),true,true);
    writeReadRecord(source,target);
    if (nullPoison) {
      assertTrue("Record should use fixed reference format.",target.isUseFixedReferences());
    }
 else {
      assertFalse("Record should use variable length reference format.",target.isUseFixedReferences());
    }
    verifySameReferences(source,target);
    Collections.rotate(references,1);
  }
}
