{
  Map<String,String> config=new HashMap<String,String>();
  config.put(GraphDatabaseSettings.tx_manager_impl.name(),JOTMTransactionManager.NAME);
  GraphDatabaseAPI db=null;
  try {
    db=new ImpermanentGraphDatabase(config);
    assertThat(db.getTxManager(),is(instanceOf(JOTMTransactionManager.class)));
    Transaction tx=db.beginTx();
    Node node=null;
    try {
      node=db.createNode();
      tx.success();
    }
  finally {
      tx.finish();
    }
    tx=db.beginTx();
    try {
      assertThat(db.getNodeById(node.getId()),is(node));
    }
  finally {
      tx.finish();
    }
  }
  finally {
    if (db != null) {
      db.shutdown();
    }
  }
}
