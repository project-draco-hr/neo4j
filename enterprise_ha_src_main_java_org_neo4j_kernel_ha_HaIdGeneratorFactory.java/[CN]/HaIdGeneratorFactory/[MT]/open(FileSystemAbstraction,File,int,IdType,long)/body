{
  HaIdGenerator previous=generators.remove(idType);
  if (previous != null)   previous.close();
  IdGenerator initialIdGenerator=null;
switch (globalState) {
case MASTER:
    initialIdGenerator=localFactory.open(fs,fileName,grabSize,idType,highId);
  break;
case SLAVE:
initialIdGenerator=new SlaveIdGenerator(idType,highId,master,logger);
break;
default :
throw new IllegalStateException(globalState.name());
}
HaIdGenerator haIdGenerator=new HaIdGenerator(initialIdGenerator,fs,fileName,grabSize,idType,globalState);
generators.put(idType,haIdGenerator);
return haIdGenerator;
}
