{
  long end=timeout == 0 ? Long.MAX_VALUE : System.currentTimeMillis() + unit.toMillis(timeout);
  Thread thread=getThread();
  while (thread.getState() != Thread.State.WAITING || !executingCommand) {
    try {
      Thread.sleep(1);
    }
 catch (    InterruptedException e) {
    }
    if (System.currentTimeMillis() > end)     throw new IllegalStateException("The executor didn't wait inside an executing command for " + timeout + " "+ unit);
  }
}
