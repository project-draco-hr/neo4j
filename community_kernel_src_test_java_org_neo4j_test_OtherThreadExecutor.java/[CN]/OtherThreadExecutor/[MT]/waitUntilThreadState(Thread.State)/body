{
  Set<Thread.State> stateSet=new HashSet<Thread.State>(asList(possibleStates));
  long end=System.currentTimeMillis() + timeout;
  Thread thread=getThread();
  while (!stateSet.contains(thread.getState()) || executionState == ExecutionState.REQUESTED_EXECUTION) {
    try {
      Thread.sleep(1);
    }
 catch (    InterruptedException e) {
    }
    if (System.currentTimeMillis() > end) {
      throw new TimeoutException("The executor didn't wait inside an executing command for " + timeout + " ms");
    }
  }
}
