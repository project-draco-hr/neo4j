{
  Set<Thread.State> stateSet=new HashSet<Thread.State>(asList(possibleStates));
  long end=System.currentTimeMillis() + timeout;
  Set<Thread.State> seenStates=new HashSet<Thread.State>();
  Thread.State state=null;
  while (!stateSet.contains((state=thread.getState())) || executionState == ExecutionState.REQUESTED_EXECUTION) {
    seenStates.add(state);
    try {
      Thread.sleep(1);
    }
 catch (    InterruptedException e) {
    }
    if (System.currentTimeMillis() > end) {
      throw new TimeoutException("The executor didn't enter any of states " + Arrays.toString(possibleStates) + " inside an executing command for "+ timeout+ " ms. Seen states: "+ seenStates);
    }
  }
}
