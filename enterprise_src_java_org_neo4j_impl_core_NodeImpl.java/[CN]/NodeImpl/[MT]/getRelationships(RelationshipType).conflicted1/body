{
  acquireLock(this,LockType.READ);
  try {
    ensureFullRelationships();
    int size=0;
    for (    RelationshipType type : types) {
      ArrayIntSet relTypeSet=relationshipMap.get(type.name());
      if (relTypeSet != null) {
        size+=relTypeSet.size();
      }
    }
    int[] ids=new int[size];
    int position=0;
    for (    RelationshipType type : types) {
      ArrayIntSet relTypeSet=relationshipMap.get(type.name());
      if (relTypeSet != null) {
        for (        int relId : relTypeSet.values()) {
          ids[position++]=relId;
        }
      }
    }
    return new RelationshipIterator(ids,this,Direction.BOTH);
  }
  finally {
    releaseLock(this,LockType.READ);
  }
}
