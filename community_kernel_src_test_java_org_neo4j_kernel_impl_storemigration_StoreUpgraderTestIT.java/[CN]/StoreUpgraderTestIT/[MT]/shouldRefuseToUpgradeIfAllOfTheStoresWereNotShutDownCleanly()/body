{
  File comparisonDirectory=new File("target/" + StoreUpgraderTestIT.class.getSimpleName() + "shouldRefuseToUpgradeIfAllOfTheStoresWeNotShutDownCleanly-comparison");
  truncateAllFiles(fileSystem,dbDirectory);
  fileSystem.deleteRecursively(comparisonDirectory);
  fileSystem.copyRecursively(dbDirectory,comparisonDirectory);
  try {
    newUpgrader(alwaysAllowed(),new StoreMigrator(new SilentMigrationProgressMonitor()),new DatabaseFiles(fileSystem)).attemptUpgrade(new File(dbDirectory,NeoStore.DEFAULT_NAME));
    fail("Should throw exception");
  }
 catch (  StoreUpgrader.UnableToUpgradeException e) {
  }
  verifyFilesHaveSameContent(fileSystem,comparisonDirectory,dbDirectory);
}
