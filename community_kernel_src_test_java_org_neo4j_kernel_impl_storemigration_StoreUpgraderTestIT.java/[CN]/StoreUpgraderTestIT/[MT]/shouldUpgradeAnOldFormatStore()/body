{
  assertTrue(allStoreFilesHaveVersion(fileSystem,dbDirectory,LegacyStore.LEGACY_VERSION));
  newUpgrader(ALLOW_UPGRADE,new StoreMigrator(new SilentMigrationProgressMonitor(),fileSystem,idGeneratorFactory)).migrateIfNeeded(dbDirectory);
  assertTrue(allStoreFilesHaveVersion(fileSystem,dbDirectory,ALL_STORES_VERSION));
  assertFalse(containsAnyLogicalLogs(fileSystem,dbDirectory));
  assertFalse(containsAnyStoreFiles(fileSystem,isolatedMigrationDirectoryOf(dbDirectory)));
}
