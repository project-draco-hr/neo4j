{
  assertTrue(allStoreFilesHaveVersion(fileSystem,dbDirectory,LegacyStore.LEGACY_VERSION));
  StoreUpgrader upgrader=newUpgrader(alwaysAllowed(),new StoreMigrator(new SilentMigrationProgressMonitor()),new DatabaseFiles(fileSystem));
  upgrader.attemptUpgrade(new File(dbDirectory,NeoStore.DEFAULT_NAME));
  assertTrue(allStoreFilesHaveVersion(fileSystem,dbDirectory,ALL_STORES_VERSION));
  assertThat(countLogicalLogs(fileSystem,dbDirectory),is(1));
  assertFalse(containsAnyStoreFiles(fileSystem,isolatedMigrationDirectoryOf(dbDirectory)));
}
