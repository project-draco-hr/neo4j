{
  PhysicalLogFiles logFiles=new PhysicalLogFiles(sourceDir,fs);
  int startVersion=0;
  ReaderLogVersionBridge versionBridge=new ReaderLogVersionBridge(fs,logFiles);
  PhysicalLogVersionedStoreChannel startingChannel=openForVersion(logFiles,fs,startVersion);
  ReadableVersionableLogChannel channel=new ReadAheadLogChannel(startingChannel,versionBridge);
  long txId=BASE_TX_ID;
  try (IOCursor<CommittedTransactionRepresentation> cursor=new PhysicalTransactionCursor<>(channel,new VersionAwareLogEntryReader<>())){
    while (cursor.next()) {
      txId=cursor.get().getCommitEntry().getTxId();
      TransactionRepresentation transaction=cursor.get().getTransactionRepresentation();
      try (LockGroup locks=new LockGroup();ValidatedIndexUpdates indexUpdates=indexUpdatesValidator.validate(transaction)){
        storeApplier.apply(transaction,indexUpdates,locks,txId,EXTERNAL);
      }
       if (upToTxId != BASE_TX_ID && upToTxId == txId) {
        return txId;
      }
    }
  }
   indexingService.flushAll();
  return txId;
}
