{
  int size=(int)unpackMapHeader();
  if (size == 0) {
    return EMPTY_PROPERTY_MAP;
  }
  Map<String,Object> map;
  if (size == UNKNOWN_SIZE) {
    map=new HashMap<>();
    boolean more=true;
    while (more) {
      PackType keyType=peekNextType();
      if (keyType == PackType.TEXT) {
        String key=unpackText();
        Object val=unpack();
        map.put(key,val);
      }
 else {
        unpack();
        more=false;
      }
    }
  }
 else {
    map=new HashMap<>(size,1);
    for (int j=0; j < size; j++) {
      String key=unpackText();
      Object val=unpack();
      map.put(key,val);
    }
  }
  return map;
}
