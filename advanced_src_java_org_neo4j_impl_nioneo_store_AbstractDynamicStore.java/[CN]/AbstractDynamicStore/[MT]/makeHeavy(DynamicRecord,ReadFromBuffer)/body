{
  int blockId=record.getId();
  if (buffer != null && !hasWindow(blockId) && transferToBuffer(blockId,buffer)) {
    int nrOfBytes=record.getLength();
    ByteBuffer buf=buffer.getByteBuffer();
    byte bytes[]=new byte[nrOfBytes];
    buf.get(bytes);
    record.setData(bytes);
  }
 else {
    PersistenceWindow window=acquireWindow(blockId,OperationType.READ);
    try {
      Buffer buf=window.getBuffer();
      int offset=(int)(blockId - buf.position()) * getBlockSize() + BLOCK_HEADER_SIZE;
      buf.setOffset(offset);
      byte bytes[]=new byte[record.getLength()];
      buf.get(bytes);
      record.setData(bytes);
    }
  finally {
      releaseWindow(window);
    }
  }
}
