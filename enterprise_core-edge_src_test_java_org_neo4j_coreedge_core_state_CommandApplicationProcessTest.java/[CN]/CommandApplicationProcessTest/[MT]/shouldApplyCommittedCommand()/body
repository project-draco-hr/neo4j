{
  RaftLogCommitIndexMonitor listener=mock(RaftLogCommitIndexMonitor.class);
  monitors.addMonitorListener(listener);
  applicationProcess.start();
  InOrder inOrder=inOrder(coreStateMachines,commandDispatcher);
  raftLog.append(new RaftLogEntry(0,operation(nullTx)));
  raftLog.append(new RaftLogEntry(0,operation(nullTx)));
  raftLog.append(new RaftLogEntry(0,operation(nullTx)));
  applicationProcess.notifyCommitted(2);
  applier.sync(false);
  inOrder.verify(coreStateMachines).commandDispatcher();
  inOrder.verify(commandDispatcher).dispatch(eq(nullTx),eq(0L),anyCallback());
  inOrder.verify(commandDispatcher).dispatch(eq(nullTx),eq(1L),anyCallback());
  inOrder.verify(commandDispatcher).dispatch(eq(nullTx),eq(2L),anyCallback());
  inOrder.verify(commandDispatcher).close();
  verify(listener).commitIndex(2);
}
