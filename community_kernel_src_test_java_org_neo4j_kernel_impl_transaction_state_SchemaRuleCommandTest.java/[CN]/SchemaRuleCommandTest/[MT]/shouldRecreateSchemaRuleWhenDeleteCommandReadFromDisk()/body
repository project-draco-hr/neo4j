{
  Collection<DynamicRecord> beforeRecords=serialize(rule,id,true,true);
  Collection<DynamicRecord> afterRecords=serialize(rule,id,false,false);
  SchemaRuleCommand command=new SchemaRuleCommand(beforeRecords,afterRecords,rule);
  InMemoryClosableChannel buffer=new InMemoryClosableChannel();
  when(neoStores.getSchemaStore()).thenReturn(schemaStore);
  command.serialize(buffer);
  Command readCommand=reader.read(buffer);
  assertThat(readCommand,instanceOf(SchemaRuleCommand.class));
  assertSchemaRule((SchemaRuleCommand)readCommand);
}
