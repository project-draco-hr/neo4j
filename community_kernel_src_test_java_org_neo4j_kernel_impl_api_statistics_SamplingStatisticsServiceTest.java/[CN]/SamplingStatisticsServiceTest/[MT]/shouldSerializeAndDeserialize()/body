{
  StoreReadLayer store=generateStore();
  StatisticsCollectedData collectedData=new StatisticsCollectedData();
  SamplingStatisticsService service=new SamplingStatisticsService(collectedData,store,null);
  StatisticsCollector collector=new StatisticsCollector(store,collectedData);
  collector.run();
  service.save(fs,new File(dir.directory(),"somefile"));
  StatisticsCollectedData expected=(StatisticsCollectedData)SamplingStatisticsService.load(fs,new File(dir.directory(),"somefile"),store,null).statistics();
  assertThat(expected,equalTo(collector.collectedData()));
}
