{
  if (isFailed(from) && !failed.contains(from)) {
    getLog(HeartbeatContext.class).info("Ignoring suspicions from failed instance " + from + ": "+ Iterables.toString(suspicions,","));
    return;
  }
  Set<InstanceId> serverSuspicions=suspicionsFor(from);
  Iterator<InstanceId> suspicionsIterator=serverSuspicions.iterator();
  while (suspicionsIterator.hasNext()) {
    InstanceId currentSuspicion=suspicionsIterator.next();
    if (!suspicions.contains(currentSuspicion)) {
      getLog(HeartbeatContext.class).info(from + " is no longer suspecting " + currentSuspicion);
      suspicionsIterator.remove();
    }
  }
  for (  InstanceId suspicion : suspicions) {
    if (!serverSuspicions.contains(suspicion)) {
      getLog(HeartbeatContext.class).info(from + " is now suspecting " + suspicion);
      serverSuspicions.add(suspicion);
    }
  }
  for (  final InstanceId node : suspicions) {
    if (isFailed(node) && !failed.contains(node)) {
      failed.add(node);
      Listeners.notifyListeners(heartBeatListeners,executor,new Listeners.Notification<HeartbeatListener>(){
        @Override public void notify(        HeartbeatListener listener){
          listener.failed(node);
        }
      }
);
    }
  }
}
