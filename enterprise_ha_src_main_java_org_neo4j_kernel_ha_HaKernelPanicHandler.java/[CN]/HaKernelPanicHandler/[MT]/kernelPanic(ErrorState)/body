{
  if (error == ErrorState.TX_MANAGER_NOT_OK) {
    try {
      int myEpoch=epoch.get();
synchronized (dataSourceManager) {
        if (myEpoch != epoch.get()) {
          return;
        }
        availabilityGuard.deny(this);
        try {
          txManager.stop();
          dataSourceManager.stop();
          dataSourceManager.start();
          txManager.start();
          txManager.doRecovery();
          masterDelegateInvocationHandler.harden();
          epoch.incrementAndGet();
        }
  finally {
          availabilityGuard.grant(this);
        }
      }
    }
 catch (    Throwable t) {
      throw new RuntimeException("error while handling kernel panic for TX_MANAGER_NOT_OK",t);
    }
  }
 else   if (error == ErrorState.STORAGE_MEDIA_FULL) {
    availabilityGuard.shutdown();
  }
}
