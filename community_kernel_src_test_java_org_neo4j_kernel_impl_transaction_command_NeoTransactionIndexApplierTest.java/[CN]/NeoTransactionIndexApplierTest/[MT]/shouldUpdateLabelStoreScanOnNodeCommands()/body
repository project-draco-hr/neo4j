{
  final ValidatedIndexUpdates indexUpdates=mock(ValidatedIndexUpdates.class);
  final IndexTransactionApplier applier=new IndexTransactionApplier(indexingService,indexUpdates,labelScanStore,cacheAccess);
  final NodeRecord before=new NodeRecord(11);
  before.setLabelField(17,emptyDynamicRecords);
  final NodeRecord after=new NodeRecord(12);
  after.setLabelField(18,emptyDynamicRecords);
  final Command.NodeCommand command=new Command.NodeCommand().init(before,after);
  when(labelScanStore.newWriter()).thenReturn(mock(LabelScanWriter.class));
  final boolean result=applier.visitNodeCommand(command);
  applier.apply();
  assertFalse(result);
  final NodeLabelUpdate update=NodeLabelUpdate.labelChanges(command.getKey(),new long[]{},new long[]{});
  final Collection<NodeLabelUpdate> labelUpdates=Arrays.asList(update);
  verify(cacheAccess,times(1)).applyLabelUpdates(eq(labelUpdates));
  verify(indexUpdates,times(1)).flush();
}
