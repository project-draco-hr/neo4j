{
  String name="log";
  LogRotationControl logRotationControl=mock(LogRotationControl.class);
  LifeSupport life=new LifeSupport();
  PhysicalLogFiles logFiles=new PhysicalLogFiles(directory.directory(),name,fs);
  Monitor monitor=mock(Monitor.class);
  LogFile logFile=life.add(new PhysicalLogFile(fs,logFiles,1000,LogPruneStrategyFactory.NO_PRUNING,transactionIdStore,logVersionRepository,monitor,logRotationControl,new TransactionMetadataCache(10,100),NO_RECOVERY_EXPECTED));
  try {
    life.start();
    verify(monitor).recoveryCompleted();
    WritableLogChannel writer=logFile.getWriter();
    LogPositionMarker positionMarker=new LogPositionMarker();
    writer.getCurrentPosition(positionMarker);
    int intValue=45;
    long longValue=4854587;
    writer.putInt(intValue);
    writer.putLong(longValue);
    writer.emptyBufferIntoChannelAndClearIt();
    writer.force();
    try (ReadableLogChannel reader=logFile.getReader(positionMarker.newPosition())){
      assertEquals(intValue,reader.getInt());
      assertEquals(longValue,reader.getLong());
    }
   }
  finally {
    life.shutdown();
  }
}
