{
  Cluster cluster=mock(Cluster.class);
  Heartbeat heartbeat=mock(Heartbeat.class);
  ClusterMemberEvents memberEvents=mock(ClusterMemberEvents.class);
  ObservedClusterMembers members=new ObservedClusterMembers(logging,cluster,heartbeat,memberEvents,null);
  ArgumentCaptor<ClusterListener> listener=ArgumentCaptor.forClass(ClusterListener.class);
  verify(cluster).addClusterListener(listener.capture());
  listener.getValue().enteredCluster(clusterConfiguration(clusterUri1,clusterUri2,clusterUri3));
  ArgumentCaptor<HeartbeatListener> heartBeatListener=ArgumentCaptor.forClass(HeartbeatListener.class);
  verify(heartbeat).addHeartbeatListener(heartBeatListener.capture());
  heartBeatListener.getValue().failed(clusterId1);
  heartBeatListener.getValue().alive(clusterId1);
  assertThat(members.getMembers(),hasItem(sameMemberAs(new ClusterMember(clusterId1))));
}
