{
  if (visitor instanceof Visitor<?>) {
    for (    Type iface : visitor.getClass().getGenericInterfaces()) {
      if (iface instanceof ParameterizedType) {
        ParameterizedType paramType=(ParameterizedType)iface;
        if (paramType.getRawType() == Visitor.class) {
          return (Visitor<? super T>)visitor;
        }
      }
    }
  }
  return null;
}
