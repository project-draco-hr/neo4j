{
  long id=entityId instanceof Long ? (Long)entityId : ((RelationshipId)entityId).id;
  DocumentContext context=documents.get(id);
  if (context != null) {
    return context;
  }
  Document document=LuceneDataSource.findDocument(indexType,searcher,id);
  if (document != null) {
    context=new DocumentContext(document,true,id);
    documents.put(id,context);
  }
 else   if (allowCreate) {
    context=new DocumentContext(identifier.entityType.newDocument(entityId),false,id);
    documents.put(id,context);
  }
  return context;
}
