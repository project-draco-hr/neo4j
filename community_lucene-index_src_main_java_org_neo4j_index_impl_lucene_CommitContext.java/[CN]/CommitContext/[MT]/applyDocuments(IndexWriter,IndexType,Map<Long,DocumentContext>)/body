{
  for (  Map.Entry<Long,DocumentContext> entry : documents.entrySet()) {
    DocumentContext context=entry.getValue();
    if (context.exists) {
      if (LuceneDataSource.documentIsEmpty(context.document)) {
        writer.deleteDocuments(type.idTerm(context.entityId));
      }
 else {
        writer.updateDocument(type.idTerm(context.entityId),context.document);
      }
    }
 else {
      writer.addDocument(context.document);
    }
  }
}
