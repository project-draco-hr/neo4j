{
  Path userStoreFile=getUserStoreFile(config);
  File authStoreDir=config.get(DatabaseManagementSystemSettings.auth_store_directory);
  File roleStoreFile=new File(authStoreDir,ROLE_STORE_FILENAME);
  final UserRepository userRepository=new FileUserRepository(userStoreFile,logProvider);
  final RoleRepository roleRepository=new FileRoleRepository(roleStoreFile.toPath(),logProvider);
  final PasswordPolicy passwordPolicy=new BasicPasswordPolicy();
  AuthenticationStrategy authenticationStrategy=new RateLimitedAuthenticationStrategy(systemUTC(),3);
  return new InternalFlatFileRealm(userRepository,roleRepository,passwordPolicy,authenticationStrategy,config.get(SecuritySettings.internal_authentication_enabled),config.get(SecuritySettings.internal_authorization_enabled));
}
