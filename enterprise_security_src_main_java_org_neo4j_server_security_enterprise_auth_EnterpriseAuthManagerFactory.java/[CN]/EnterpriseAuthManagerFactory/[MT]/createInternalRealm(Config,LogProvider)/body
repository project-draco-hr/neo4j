{
  File authStoreDir=config.get(DatabaseManagementSystemSettings.auth_store_directory);
  File userStoreFile=config.get(GraphDatabaseSettings.auth_store);
  if (userStoreFile == null) {
    userStoreFile=new File(authStoreDir,USER_STORE_FILENAME);
  }
  File roleStoreFile=new File(authStoreDir,ROLE_STORE_FILENAME);
  final UserRepository userRepository=new FileUserRepository(userStoreFile.toPath(),logProvider);
  final RoleRepository roleRepository=new FileRoleRepository(roleStoreFile.toPath(),logProvider);
  final PasswordPolicy passwordPolicy=new BasicPasswordPolicy();
  AuthenticationStrategy authenticationStrategy=new RateLimitedAuthenticationStrategy(systemUTC(),3);
  return new InternalFlatFileRealm(userRepository,roleRepository,passwordPolicy,authenticationStrategy,config.get(SecuritySettings.internal_authentication_enabled),config.get(SecuritySettings.internal_authorization_enabled));
}
