{
  List<Realm> realms=new ArrayList<>(2);
  SecurityLog securityLog=getSecurityLog(allegedSecurityLog);
  InternalFlatFileRealm internalRealm=createInternalRealm(config,logProvider,fileSystem,jobScheduler);
  if (config.get(SecuritySettings.internal_authentication_enabled) || config.get(SecuritySettings.internal_authorization_enabled)) {
    realms.add(internalRealm);
  }
  if (config.get(SecuritySettings.ldap_authentication_enabled) || config.get(SecuritySettings.ldap_authorization_enabled)) {
    realms.add(new LdapRealm(config,securityLog));
  }
  realms.addAll(createPluginRealms(config,logProvider));
  return new MultiRealmAuthManager(internalRealm,realms,createCacheManager(config),securityLog,config.get(EnterpriseEditionSettings.security_log_successful_authentication));
}
