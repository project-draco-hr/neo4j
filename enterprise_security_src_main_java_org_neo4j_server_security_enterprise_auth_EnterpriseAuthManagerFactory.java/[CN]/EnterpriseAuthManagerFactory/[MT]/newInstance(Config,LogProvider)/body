{
  File authStoreDir=config.get(GraphDatabaseSettings.auth_store_dir);
  File userStoreFile;
  if (authStoreDir != null) {
    userStoreFile=new File(authStoreDir,USER_STORE_FILENAME);
  }
 else {
    userStoreFile=config.get(GraphDatabaseSettings.auth_store);
    authStoreDir=userStoreFile.getParentFile();
  }
  File roleStoreFile=new File(authStoreDir,ROLE_STORE_FILENAME);
  final UserRepository userRepository=new FileUserRepository(userStoreFile.toPath(),logProvider);
  final RoleRepository roleRepository=new FileRoleRepository(roleStoreFile.toPath(),logProvider);
  final PasswordPolicy passwordPolicy=new BasicPasswordPolicy();
  return new EnterpriseAuthManager(userRepository,roleRepository,passwordPolicy,systemUTC(),config.get(GraphDatabaseSettings.auth_enabled));
}
