{
  lock.writeLock().lock();
  try {
    if (closed) {
      if (!flipOnlyIfOpen) {
        throw new IllegalStateException(this.getClass().getSimpleName() + " has been closed. No more interactions allowed");
      }
    }
 else {
      try {
        actionDuringFlip.call();
        this.delegate=flipTarget.create();
      }
 catch (      Exception e) {
        this.delegate=failureDelegate.create(e);
        throw new FlipFailedKernelException(e);
      }
    }
  }
  finally {
    lock.writeLock().unlock();
  }
}
