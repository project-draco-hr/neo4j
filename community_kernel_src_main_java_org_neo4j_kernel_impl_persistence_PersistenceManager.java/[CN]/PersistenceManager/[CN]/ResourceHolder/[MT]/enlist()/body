{
  try {
    XAResource xaResource=connection.getXaResource();
    if (!tx.enlistResource(xaResource)) {
      throw new ResourceAcquisitionFailedException(xaResource);
    }
    TransactionEventsSyncHook hook=syncHookFactory.create();
    if (hook != null) {
      tx.registerSynchronization(hook);
    }
  }
 catch (  RollbackException|SystemException re) {
    throw new ResourceAcquisitionFailedException(re);
  }
}
