{
  try {
    XaConnection xaConnection=persistenceSource.getXaDataSource().getXaConnection();
    NeoStoreTransaction resource=persistenceSource.createTransaction(xaConnection);
    ResourceHolder result=new ResourceHolder(syncHookFactory,tx,xaConnection,resource);
    TransactionState state=transactionManager.getTransactionState();
    tx.registerSynchronization(new ResourceCleanupHook(tx,state,result));
    return result;
  }
 catch (  RollbackException|SystemException e) {
    throw new ResourceAcquisitionFailedException(e);
  }
}
