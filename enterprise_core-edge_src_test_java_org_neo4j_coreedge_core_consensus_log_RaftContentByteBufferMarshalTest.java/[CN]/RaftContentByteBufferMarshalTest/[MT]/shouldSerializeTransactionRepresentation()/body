{
  CoreReplicatedContentMarshal serializer=new CoreReplicatedContentMarshal();
  Collection<StorageCommand> commands=new ArrayList<>();
  IndexCommand.AddNodeCommand addNodeCommand=new IndexCommand.AddNodeCommand();
  addNodeCommand.init(0,0,0,0);
  commands.add(addNodeCommand);
  byte[] extraHeader=new byte[0];
  PhysicalTransactionRepresentation txIn=new PhysicalTransactionRepresentation(commands);
  txIn.setHeader(extraHeader,-1,-1,0,0,0,0);
  ReplicatedTransaction in=ReplicatedTransactionFactory.createImmutableReplicatedTransaction(txIn);
  ByteBuf buf=Unpooled.buffer();
  serializer.marshal(in,new NetworkFlushableByteBuf(buf));
  ReplicatedTransaction out=(ReplicatedTransaction)serializer.unmarshal(new NetworkReadableClosableChannelNetty4(buf));
  TransactionRepresentation txOut=ReplicatedTransactionFactory.extractTransactionRepresentation(out,extraHeader);
  assertEquals(in,out);
  assertEquals(txIn,txOut);
}
