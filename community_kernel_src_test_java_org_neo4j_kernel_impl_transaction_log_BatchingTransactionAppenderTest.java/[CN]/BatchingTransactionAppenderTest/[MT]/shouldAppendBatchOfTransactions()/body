{
  when(logFile.getWriter()).thenReturn(channel);
  TransactionAppender appender=life.add(new BatchingTransactionAppender(logFile,NO_ROTATION,positionCache,transactionIdStore,BYPASS,databaseHealth));
  when(transactionIdStore.nextCommittingTransactionId()).thenReturn(2L,3L,4L);
  TransactionToApply batch=batchOf(transaction(singleCreateNodeCommand(0),new byte[0],0,0,0,1,0),transaction(singleCreateNodeCommand(1),new byte[0],0,0,0,1,0),transaction(singleCreateNodeCommand(2),new byte[0],0,0,0,1,0));
  appender.append(batch,logAppendEvent);
  TransactionToApply tx=batch;
  assertEquals(2L,tx.transactionId());
  tx=tx.next();
  assertEquals(3L,tx.transactionId());
  tx=tx.next();
  assertEquals(4L,tx.transactionId());
  assertNull(tx.next());
}
