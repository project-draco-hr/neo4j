{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabase();
  try {
    TransactionCounters counts=db.getDependencyResolver().resolveDependency(TransactionCounters.class);
    TransactionCountersChecker checker=new TransactionCountersChecker(counts);
    try (Transaction tx=db.beginTx()){
      dbConsumer.accept(db);
      tx.failure();
    }
     checker.verifyRolledBacked(isWriteTx,counts);
  }
  finally {
    db.shutdown();
  }
}
