{
  long maxSize=1000;
  XaLogicalLog log=new XaLogicalLog(new File("log"),mock(XaResourceManager.class),new FixedSizeXaCommandFactory(),new VersionRespectingXaTransactionFactory(),ephemeralFs.get(),new Monitors(),new DevNullLoggingService(),NO_PRUNING,mock(TransactionStateFactory.class),mock(KernelHealth.class),maxSize);
  log.open();
  long initialLogVersion=log.getHighestLogVersion();
  for (int i=0; i < 10; i++) {
    int identifier=log.start(xid,-1,-1);
    log.writeStartEntry(identifier);
    log.writeCommand(new FixedSizeXaCommand(100),identifier);
    log.commitOnePhase(identifier,i + 1,forced);
    log.done(identifier);
  }
  assertEquals(initialLogVersion + 1,log.getHighestLogVersion());
}
