{
  ProtocolVersionCombo incomingCombo=new ProtocolVersionCombo(applicationProtocol,internalProtocol);
  MasterClientFactory candidate=protocolToFactoryMapping.get(incomingCombo);
  if ((candidate != null) && (currentVersion == null || !downgradeForbidden || currentVersion.compareTo(incomingCombo) <= 0)) {
    currentFactory=candidate;
    currentVersion=incomingCombo;
  }
  return candidate;
}
