{
  if (configuration.get(generate_graph)) {
    DataGenerator.run(configuration);
  }
  File storeDir=new File(configuration.get(DataGenerator.store_dir));
  new GraphDatabaseFactory().newEmbeddedDatabase(storeDir).shutdown();
  ProgressMonitorFactory progress;
  if (configuration.get(DataGenerator.report_progress)) {
    progress=ProgressMonitorFactory.textual(System.out);
  }
 else {
    progress=ProgressMonitorFactory.NONE;
  }
  if (configuration.get(wait_before_check)) {
    System.out.println("Press return to start the checker...");
    System.in.read();
  }
  Config tuningConfiguration=buildTuningConfiguration(configuration);
  fileSystem=new DefaultFileSystemAbstraction();
  ConfiguringPageCacheFactory pageCacheFactory=new ConfiguringPageCacheFactory(fileSystem,tuningConfiguration,PageCacheTracer.NULL);
  pageCache=pageCacheFactory.getOrCreatePageCache();
  DirectStoreAccess directStoreAccess=createScannableStores(storeDir,tuningConfiguration);
  JsonReportWriter reportWriter=new JsonReportWriter(configuration,tuningConfiguration);
  TimingProgress progressMonitor=new TimingProgress(new TimeLogger(reportWriter),progress);
  try {
    configuration.get(checker_version).run(progressMonitor,directStoreAccess,tuningConfiguration);
  }
  finally {
    directStoreAccess.close();
    pageCache.close();
  }
}
