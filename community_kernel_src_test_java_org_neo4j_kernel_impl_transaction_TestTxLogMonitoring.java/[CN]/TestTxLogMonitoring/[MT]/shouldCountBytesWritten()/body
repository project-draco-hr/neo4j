{
  File directory=target.cleanDirectory("shouldCountBytesWritten");
  File theLogFile=new File(directory,"theLog");
  Monitors monitors=new Monitors();
  TxLog txLog=new TxLog(theLogFile,new DefaultFileSystemAbstraction(),monitors);
  final AtomicLong bytesWritten=new AtomicLong();
  monitors.addMonitorListener(new ByteCounterMonitor(){
    @Override public void bytesWritten(    long numberOfBytes){
      bytesWritten.addAndGet(numberOfBytes);
    }
    @Override public void bytesRead(    long numberOfBytes){
    }
  }
,TxLog.class.getName());
  byte[] globalId={1,2,3};
  txLog.txStart(globalId);
  txLog.addBranch(globalId,new byte[]{4,5,6});
  txLog.close();
  assertTrue(bytesWritten.get() > 0);
  assertEquals(theLogFile.length(),bytesWritten.get());
}
