{
  long transactionId=-1;
  try {
    long ticket;
synchronized (this) {
      logFile.checkRotation();
      transactionId=txIdGenerator.generate(transaction);
      append(transaction,transactionId);
      ticket=getCurrentTicket();
    }
    force(ticket);
    transactionIdStore.transactionCommitted(transactionId);
    return transactionId;
  }
 catch (  Exception e) {
    throw new TransactionAppendException(e,transactionId);
  }
}
