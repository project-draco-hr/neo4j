{
  boolean result=false;
  long ticket;
synchronized (this) {
    logFile.checkRotation();
    long txId=transaction.getCommitEntry().getTxId();
    long lastCommittedTxId=transactionIdStore.getLastCommittedTransactionId();
    if (lastCommittedTxId + 1 == txId) {
      txIdGenerator.generate(transaction.getTransactionRepresentation());
      append(transaction.getTransactionRepresentation(),txId);
      ticket=getCurrentTicket();
      result=true;
    }
 else     if (lastCommittedTxId + 1 < txId) {
      throw new IOException("Tried to apply transaction with txId=" + txId + " but last committed txId="+ lastCommittedTxId);
    }
 else {
      return false;
    }
  }
  force(ticket);
  return result;
}
