{
  long transactionId;
  boolean result=false;
  long ticket;
synchronized (this) {
    logFile.checkRotation();
    long lastCommittedTxId=transactionIdStore.getLastCommittedTransactionId();
    long candidateTransactionId=transaction.getCommitEntry().getTxId();
    if (lastCommittedTxId + 1 == candidateTransactionId) {
      transactionId=txIdGenerator.generate(transaction.getTransactionRepresentation());
      append(transaction.getTransactionRepresentation(),transactionId);
      ticket=getCurrentTicket();
      result=true;
    }
 else     if (lastCommittedTxId + 1 < candidateTransactionId) {
      throw new IOException("Tried to apply transaction with txId=" + candidateTransactionId + " but last committed txId="+ lastCommittedTxId);
    }
 else {
      return false;
    }
  }
  force(ticket);
  transactionIdStore.transactionCommitted(transactionId);
  return result;
}
