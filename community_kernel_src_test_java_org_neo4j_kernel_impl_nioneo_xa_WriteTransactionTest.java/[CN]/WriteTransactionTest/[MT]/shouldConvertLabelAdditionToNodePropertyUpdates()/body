{
  long nodeId=1, labelId=3;
  long[] labelIds=new long[]{labelId};
  WriteTransaction writeTransaction=newWriteTransaction(NO_INDEXING);
  PropertyIndex propertyIndex1=new PropertyIndex("key",1), propertyIndex2=new PropertyIndex("key2",2);
  Object value1=LONG_STRING, value2=LONG_STRING.getBytes();
  writeTransaction.nodeCreate(nodeId);
  writeTransaction.nodeAddProperty(nodeId,propertyIndex1,value1);
  writeTransaction.nodeAddProperty(nodeId,propertyIndex2,value2);
  prepareAndCommit(writeTransaction);
  CapturingIndexingService indexingService=new CapturingIndexingService();
  writeTransaction=newWriteTransaction(indexingService);
  writeTransaction.addLabelToNode(labelId,nodeId);
  prepareAndCommit(writeTransaction);
  assertEquals(asSet(add(nodeId,propertyIndex1.getKeyId(),value1,labelIds),add(nodeId,propertyIndex2.getKeyId(),value2,labelIds)),indexingService.updates);
}
