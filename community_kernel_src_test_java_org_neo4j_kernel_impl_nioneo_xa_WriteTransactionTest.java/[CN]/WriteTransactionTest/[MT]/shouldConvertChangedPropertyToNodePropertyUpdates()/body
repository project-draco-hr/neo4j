{
  int nodeId=1;
  WriteTransaction writeTransaction=newWriteTransaction(NO_INDEXING);
  Token propertyKeyToken1=new Token("key",1), propertyKeyToken2=new Token("key2",2);
  Object value1="first", value2=4;
  writeTransaction.nodeCreate(nodeId);
  PropertyData property1=writeTransaction.nodeAddProperty(nodeId,propertyKeyToken1,value1);
  PropertyData property2=writeTransaction.nodeAddProperty(nodeId,propertyKeyToken2,value2);
  prepareAndCommit(writeTransaction);
  CapturingIndexingService indexingService=new CapturingIndexingService();
  Object newValue1="new", newValue2="new 2";
  writeTransaction=newWriteTransaction(indexingService);
  writeTransaction.nodeChangeProperty(nodeId,property1,newValue1);
  writeTransaction.nodeChangeProperty(nodeId,property2,newValue2);
  prepareAndCommit(writeTransaction);
  assertEquals(asSet(change(nodeId,propertyKeyToken1.id(),value1,none,newValue1,none),change(nodeId,propertyKeyToken2.id(),value2,none,newValue2,none)),indexingService.updates);
}
