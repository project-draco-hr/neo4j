{
  NeoStoreTransaction tx=newWriteTransaction(mockIndexing);
  tx.nodeCreate(1);
  tx.addLabelToNode(1,1);
  tx.nodeAddProperty(1,1,"foo");
  tx.nodeCreate(2);
  tx.addLabelToNode(2,2);
  tx.nodeAddProperty(2,2,"bar");
  tx.prepare();
  ArgumentCaptor<IndexUpdates> captor=ArgumentCaptor.forClass(IndexUpdates.class);
  verify(mockIndexing).validate(captor.capture());
  IndexUpdates updates=captor.getValue();
  assertEquals(asSet(add(1,1,"foo",new long[]{1}),add(2,2,"bar",new long[]{2})),asSet(updates));
  assertEquals(asSet(1L,2L),updates.changedNodeIds());
}
