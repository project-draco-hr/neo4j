{
  int nodeId=1;
  WriteTransaction writeTransaction=newWriteTransaction(MOCK_INDEXING);
  int propertyKey1=1, propertyKey2=2;
  Object value1="first", value2=4;
  writeTransaction.nodeCreate(nodeId);
  DefinedProperty property1=writeTransaction.nodeAddProperty(nodeId,propertyKey1,value1);
  DefinedProperty property2=writeTransaction.nodeAddProperty(nodeId,propertyKey2,value2);
  prepareAndCommit(writeTransaction);
  CapturingIndexingService indexingService=new CapturingIndexingService();
  writeTransaction=newWriteTransaction(indexingService);
  writeTransaction.nodeRemoveProperty(nodeId,property1.propertyKeyId());
  writeTransaction.nodeRemoveProperty(nodeId,property2.propertyKeyId());
  prepareAndCommit(writeTransaction);
  assertEquals(asSet(remove(nodeId,propertyKey1,value1,none),remove(nodeId,propertyKey2,value2,none)),indexingService.updates);
}
