{
  Visitor<XaCommand,RuntimeException> verifier=new Visitor<XaCommand,RuntimeException>(){
    @Override public boolean visit(    XaCommand element){
      if (element instanceof PropertyCommand) {
        PropertyRecord before=((PropertyCommand)element).getBefore();
        assertFalse(before.inUse());
        assertEquals(Collections.<PropertyBlock>emptyList(),before.getPropertyBlocks());
        PropertyRecord after=((PropertyCommand)element).getAfter();
        assertTrue(after.inUse());
        assertEquals(1,count(after.getPropertyBlocks()));
      }
      return true;
    }
  }
;
  WriteTransaction writeTransaction=newWriteTransaction(NO_INDEXING,verifier);
  int nodeId=1;
  writeTransaction.setCommitTxId(nodeId);
  writeTransaction.nodeCreate(nodeId);
  Token propertyKeyToken=new Token("key",1);
  Object value=5;
  writeTransaction.nodeAddProperty(nodeId,propertyKeyToken,value);
  writeTransaction.doPrepare();
}
