{
  long nodeId=1, labelId1=3, labelId2=4;
  WriteTransaction writeTransaction=newWriteTransaction(NO_INDEXING);
  PropertyKeyToken propertyKeyToken1=new PropertyKeyToken("key",1), propertyKeyToken2=new PropertyKeyToken("key2",2);
  Object value1="first", value2=4;
  writeTransaction.nodeCreate(nodeId);
  PropertyData property1=writeTransaction.nodeAddProperty(nodeId,propertyKeyToken1,value1);
  writeTransaction.nodeAddProperty(nodeId,propertyKeyToken2,value2);
  writeTransaction.addLabelToNode(labelId1,nodeId);
  writeTransaction.addLabelToNode(labelId2,nodeId);
  prepareAndCommit(writeTransaction);
  CapturingIndexingService indexingService=new CapturingIndexingService();
  writeTransaction=newWriteTransaction(indexingService);
  writeTransaction.nodeRemoveProperty(nodeId,property1);
  writeTransaction.removeLabelFromNode(labelId2,nodeId);
  prepareAndCommit(writeTransaction);
  assertEquals(asSet(remove(nodeId,propertyKeyToken1.getKeyId(),value1,new long[]{labelId1,labelId2}),remove(nodeId,propertyKeyToken2.getKeyId(),value2,new long[]{labelId2})),indexingService.updates);
}
