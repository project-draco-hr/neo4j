{
  if (!isRecovered() && !prepared) {
    throw new XAException("Cannot commit non prepared transaction[" + getIdentifier() + "]");
  }
  if (isRecovered()) {
    boolean wasInRecovery=neoStore.isInRecoveryMode();
    neoStore.setRecoveredStatus(true);
    try {
      applyCommit(true);
      return;
    }
 catch (    IOException e) {
      throw Exceptions.withCause(new XAException(),e);
    }
 finally {
      neoStore.setRecoveredStatus(wasInRecovery);
    }
  }
  if (getCommitTxId() != neoStore.getLastCommittedTx() + 1) {
    throw new RuntimeException("Tx id: " + getCommitTxId() + " not next transaction ("+ neoStore.getLastCommittedTx()+ ")");
  }
  try {
    applyCommit(false);
  }
 catch (  IOException e) {
    throw Exceptions.withCause(new XAException(),e);
  }
}
