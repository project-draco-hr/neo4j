{
  timeout=new Date().getTime() + timeout;
  while ((new Date().getTime()) < timeout) {
    try {
      Thread.sleep(50);
    }
 catch (    InterruptedException e) {
      throw new RuntimeException(e);
    }
    if (matcher.matches(state)) {
      return;
    }
  }
  throw new TimeoutException(errorMessage);
}
