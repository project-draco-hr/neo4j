{
  if (token == null) {
    return UNAUTHENTICATED;
  }
  User user=usersByToken.get(token);
  if (user != null) {
    return user;
  }
  for (  User candidate : users) {
    if (candidate.tokenEquals(token)) {
      usersByToken.putIfAbsent(candidate.token(),candidate);
      return candidate;
    }
  }
  return UNAUTHENTICATED;
}
