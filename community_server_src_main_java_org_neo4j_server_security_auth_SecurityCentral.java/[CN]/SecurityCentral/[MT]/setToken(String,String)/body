{
  assertValidToken(token);
  User existingUser=users.findByName(name);
  if (existingUser == null) {
    return null;
  }
  User updatedUser=existingUser.augment().withToken(token).build();
  try {
    users.update(existingUser,updatedUser);
    return updatedUser;
  }
 catch (  ConcurrentModificationException e) {
    return setToken(name,token);
  }
}
