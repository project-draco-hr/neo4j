{
  try {
    Transaction runningTransaction=txManager.suspend();
    try {
      txManager.begin(ForceMode.unforced);
      int id=createKey(idGenerator,persistence,name);
      txManager.commit();
      return id;
    }
 catch (    Throwable t) {
      logger.error("Unable to create key '" + name + "'",t);
      try {
        txManager.rollback();
      }
 catch (      Throwable tt) {
        logger.error("Unable to rollback after failure to create key '" + name + "'",t);
      }
      throw new TransactionFailureException("Unable to create key '" + name + "'",t);
    }
 finally {
      if (runningTransaction != null)       txManager.resume(runningTransaction);
    }
  }
 catch (  SystemException e) {
    throw new TransactionFailureException("Unable to resume or suspend running transaction",e);
  }
catch (  InvalidTransactionException e) {
    throw new TransactionFailureException("Unable to resume or suspend running transaction",e);
  }
}
