{
  String databaseLocation="undefined";
  try {
    this.configurator=new Configurator(new Validator(new DatabaseLocationMustBeSpecifiedRule()),getConfigFile());
    webServerPort=configurator.configuration().getInt(WEBSERVER_PORT_PROPERTY_KEY,DEFAULT_WEBSERVER_PORT);
    databaseLocation=configurator.configuration().getString(DATABASE_LOCATION_PROPERTY_KEY);
    this.database=new Database(databaseLocation);
    this.webServer=new Jetty6WebServer();
    this.webServer.setServer(this);
    log.info("Starting Neo Server on port [%s]",webServerPort);
    webServer.setPort(webServerPort);
    log.info("Mounting webadmin at [%s]",WEB_ADMIN_PATH);
    webServer.addStaticContent(STATIC_CONTENT_LOCATION,WEB_ADMIN_PATH);
    log.info("Mounting management API at [%s]",WEB_ADMIN_REST_API_SERVICE_NAME);
    webServer.addJAXRSPackages(listFrom(new String[]{WEB_ADMIN_REST_API_PACKAGE}),WEB_ADMIN_REST_API_SERVICE_NAME);
    log.info("Mounting REST API at [%s]",REST_API_SERVICE_NAME);
    webServer.addJAXRSPackages(listFrom(new String[]{REST_API_PACKAGE}),REST_API_SERVICE_NAME);
    boolean osgiServerShouldStart=configurator.configuration().getBoolean(ENABLE_OSGI_SERVER_PROPERTY_KEY,false);
    if (osgiServerShouldStart) {
      String bundleDirectory=configurator.configuration().getString(OSGI_BUNDLE_DIR_PROPERTY_KEY,"../");
      String cacheDirectory=configurator.configuration().getString(OSGI_CACHE_DIR_PROPERTY_KEY,"../");
      OSGiContainer container=new OSGiContainer(bundleDirectory,cacheDirectory);
      container.start();
    }
    RrdDb rrdDb=createRrdDbAndStartSampler();
    database.setRrdDb(rrdDb);
    webServer.start();
    log.info("Started Neo Server on port [%s]",restApiUri().getPort());
    return null;
  }
 catch (  TransactionFailureException tfe) {
    log.error(String.format("Failed to start Neo Server on port [%d], because ",restApiUri().getPort()) + tfe + ". Another process may be using database location "+ databaseLocation);
    tfe.printStackTrace();
    return GRAPH_DATABASE_STARTUP_ERROR_CODE;
  }
catch (  Exception e) {
    e.printStackTrace();
    log.error("Failed to start Neo Server on port [%s]",webServerPort);
    e.printStackTrace();
    return WEB_SERVER_STARTUP_ERROR_CODE;
  }
}
