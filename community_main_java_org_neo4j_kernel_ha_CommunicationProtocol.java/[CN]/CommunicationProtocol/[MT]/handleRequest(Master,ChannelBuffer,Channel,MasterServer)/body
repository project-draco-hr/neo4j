{
  RequestType type=RequestType.values()[buffer.readByte()];
  SlaveContext context=null;
  if (type.includesSlaveContext()) {
    context=readSlaveContext(buffer);
  }
  Pair<ChannelBuffer,ByteBuffer> targetBuffers=server.mapSlave(channel,context);
  targetBuffers.first().clear();
  Response<?> response=type.caller.callMaster(realMaster,context,buffer);
  type.serializer.write(response.response(),targetBuffers.first());
  if (type.includesSlaveContext()) {
    writeTransactionStreams(response.transactions(),targetBuffers.first(),targetBuffers.other());
  }
  if (type == RequestType.FINISH || type == RequestType.PULL_UPDATES) {
    server.unmapSlave(channel,context);
  }
  return targetBuffers.first();
}
