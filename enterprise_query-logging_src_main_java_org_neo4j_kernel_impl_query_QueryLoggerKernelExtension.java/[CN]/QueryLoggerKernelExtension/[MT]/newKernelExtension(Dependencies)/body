{
  Config config=dependencies.config();
  boolean queryLogEnabled=config.get(GraphDatabaseSettings.log_queries);
  final File queryLogFile=config.get(GraphDatabaseSettings.log_queries_filename);
  if (!queryLogEnabled) {
    return createEmptyAdapter();
  }
  if (queryLogFile == null) {
    dependencies.logger().warn(GraphDatabaseSettings.log_queries.name() + " is enabled but no " + GraphDatabaseSettings.log_queries_filename.name()+ " has not been provided in configuration, hence query logging is suppressed");
    return createEmptyAdapter();
  }
  Long rotationThreshold=config.get(GraphDatabaseSettings.log_queries_rotation_threshold);
  long thresholdMillis=config.get(GraphDatabaseSettings.log_queries_threshold);
  LoggerFactory loggerFactory=new LoggerFactory(dependencies.filesystem(),queryLogFile,rotationThreshold);
  QueryLogger logger=new QueryLogger(Clock.SYSTEM_CLOCK,loggerFactory,thresholdMillis);
  dependencies.monitoring().addMonitorListener(logger);
  return logger;
}
