{
  boolean queryLogEnabled=deps.config().get(GraphDatabaseSettings.log_queries);
  final File queryLogFile=deps.config().get(GraphDatabaseSettings.log_queries_filename);
  if (!queryLogEnabled || queryLogFile == null) {
    if (queryLogFile == null) {
      deps.logger().getInternalLog(getClass()).warn(GraphDatabaseSettings.log_queries.name() + " is enabled but no " + GraphDatabaseSettings.log_queries_filename.name()+ " has not been provided in configuration, hence query logging is suppressed");
    }
    return new LifecycleAdapter();
  }
  return new LifecycleAdapter(){
    OutputStream logOutputStream;
    @Override public void init() throws Throwable {
      final FileSystemAbstraction filesystem=deps.filesystem();
      logOutputStream=createOrOpenAsOuputStream(filesystem,queryLogFile,true);
      Long thresholdMillis=deps.config().get(GraphDatabaseSettings.log_queries_threshold);
      QueryLogger logger=new QueryLogger(Clock.SYSTEM_CLOCK,FormattedLog.withUTCTimeZone().toOutputStream(logOutputStream),thresholdMillis);
      deps.monitoring().addMonitorListener(logger);
    }
    @Override public void shutdown() throws Throwable {
      logOutputStream.close();
    }
  }
;
}
