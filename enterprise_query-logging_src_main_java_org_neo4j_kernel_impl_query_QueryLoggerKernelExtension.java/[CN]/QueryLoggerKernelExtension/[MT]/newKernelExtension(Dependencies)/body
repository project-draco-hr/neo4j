{
  Config config=the.config();
  if (config.get(GraphDatabaseSettings.log_queries)) {
    File logFilename=config.get(GraphDatabaseSettings.log_queries_filename);
    if (logFilename == null) {
      the.logger().warn(GraphDatabaseSettings.log_queries.name() + " is enabled but no " + GraphDatabaseSettings.log_queries_filename.name()+ " has not been provided in configuration, hence query logging is suppressed");
      return null;
    }
    long thresholdMillis=config.get(GraphDatabaseSettings.log_queries_threshold);
    LoggerFactory loggerFactory=new LoggerFactory(the.filesystem(),logFilename);
    QueryLogger logger=new QueryLogger(Clock.SYSTEM_CLOCK,loggerFactory,thresholdMillis);
    the.monitoring().addMonitorListener(logger);
    return logger;
  }
  return null;
}
