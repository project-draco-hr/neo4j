{
  if (!deps.config().get(GraphDatabaseSettings.log_queries)) {
    return null;
  }
  return new LifecycleAdapter(){
    OutputStream logOutputStream;
    @Override public void init() throws Throwable {
      final FileSystemAbstraction filesystem=deps.filesystem();
      final File logFile=deps.config().get(GraphDatabaseSettings.log_queries_filename);
      logOutputStream=createOrOpenAsOuputStream(filesystem,logFile,true);
      Long thresholdMillis=deps.config().get(GraphDatabaseSettings.log_queries_threshold);
      QueryLogger logger=new QueryLogger(Clock.SYSTEM_CLOCK,FormattedLog.toOutputStream(logOutputStream),thresholdMillis);
      deps.monitoring().addMonitorListener(logger);
    }
    @Override public void shutdown() throws Throwable {
      logOutputStream.close();
    }
  }
;
}
