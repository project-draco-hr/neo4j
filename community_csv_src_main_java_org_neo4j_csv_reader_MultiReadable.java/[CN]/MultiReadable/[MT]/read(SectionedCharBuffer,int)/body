{
  buffer.compact(buffer,from);
  while (current != null) {
    buffer.readFrom(current);
    if (buffer.hasAvailable()) {
      position+=buffer.available();
      char lastReadChar=buffer.array()[buffer.front() - 1];
      requiresNewLine=lastReadChar != '\n' && lastReadChar != '\r';
      return buffer;
    }
    if (requiresNewLine) {
      buffer.append('\n');
      position++;
      requiresNewLine=false;
      return buffer;
    }
    if (!goToNextSource()) {
      break;
    }
  }
  return buffer;
}
