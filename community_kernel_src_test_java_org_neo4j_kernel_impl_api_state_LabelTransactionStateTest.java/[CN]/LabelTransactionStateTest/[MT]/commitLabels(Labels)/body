{
  Map<Long,Collection<Long>> allLabels=new HashMap<Long,Collection<Long>>();
  for (  Labels nodeLabels : labels) {
    when(store.nodeGetLabels(nodeLabels.nodeId)).then(asAnswer(Arrays.<Long>asList(nodeLabels.labelIds)));
    for (    long label : nodeLabels.labelIds) {
      when(store.nodeHasLabel(nodeLabels.nodeId,label)).thenReturn(true);
      when(store.nodeRemoveLabel(nodeLabels.nodeId,label)).thenReturn(true);
      when(store.nodeAddLabel(nodeLabels.nodeId,label)).thenReturn(false);
      Collection<Long> nodes=allLabels.get(label);
      if (nodes == null) {
        nodes=new ArrayList<Long>();
        allLabels.put(label,nodes);
      }
      nodes.add(nodeLabels.nodeId);
    }
  }
  for (  Map.Entry<Long,Collection<Long>> entry : allLabels.entrySet()) {
    when(store.nodesGetForLabel(entry.getKey())).then(asAnswer(entry.getValue()));
  }
}
