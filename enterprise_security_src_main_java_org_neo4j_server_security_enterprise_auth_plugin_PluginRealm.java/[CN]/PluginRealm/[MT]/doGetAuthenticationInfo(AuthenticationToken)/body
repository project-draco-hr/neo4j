{
  if (token instanceof ShiroAuthToken) {
    try {
      if (authPlugin != null) {
        AuthInfo authInfo=authPlugin.getAuthInfo(((ShiroAuthToken)token).getAuthTokenMap());
        if (authInfo != null) {
          PluginAuthInfo pluginAuthInfo=PluginAuthInfo.create(authInfo,getName());
          cacheAuthorizationInfo(pluginAuthInfo);
          return pluginAuthInfo;
        }
      }
 else       if (authenticationPlugin != null) {
        org.neo4j.server.security.enterprise.auth.plugin.spi.AuthenticationInfo authenticationInfo=authenticationPlugin.getAuthenticationInfo(((ShiroAuthToken)token).getAuthTokenMap());
        if (authenticationInfo != null) {
          if (authenticationInfo instanceof CacheableAuthenticationInfo) {
            byte[] credentials=((CacheableAuthenticationInfo)authenticationInfo).getCredentials();
            SimpleHash hashedCredentials=secureHasher.hash(credentials);
            return PluginAuthenticationInfo.create(authenticationInfo,hashedCredentials,getName());
          }
 else {
            return PluginAuthenticationInfo.create(authenticationInfo,getName());
          }
        }
      }
    }
 catch (    org.neo4j.server.security.enterprise.auth.plugin.api.AuthenticationException e) {
      throw new AuthenticationException(e.getMessage(),e.getCause());
    }
  }
  return null;
}
