{
  slaveDir=TargetDirectory.forTest(TestStoreCopy.class).directory("slave-sandboxed",true);
  sandboxed=new File(slaveDir,HighlyAvailableGraphDatabase.COPY_FROM_MASTER_TEMP);
  master=new HighlyAvailableGraphDatabase(TargetDirectory.forTest(TestStoreCopy.class).directory("master-sandboxed",true).getAbsolutePath(),MapUtil.stringMap(HaConfig.CONFIG_KEY_COORDINATORS,zoo.getConnectionString(),HaConfig.CONFIG_KEY_SERVER_ID,"1"));
  Transaction masterTx=master.beginTx();
  Node n=master.createNode();
  n.setProperty("foo","bar");
  nodeId=n.getId();
  masterTx.success();
  masterTx.finish();
  slave=new HighlyAvailableGraphDatabase(slaveDir.getAbsolutePath(),MapUtil.stringMap(HaConfig.CONFIG_KEY_COORDINATORS,zoo.getConnectionString(),HaConfig.CONFIG_KEY_SERVER_ID,"2"));
  Assert.assertEquals(1,master.getBroker().getMaster().other().getMachineId());
  Assert.assertEquals(1,slave.getBroker().getMaster().other().getMachineId());
  Assert.assertEquals("bar",slave.getNodeById(nodeId).getProperty("foo"));
}
