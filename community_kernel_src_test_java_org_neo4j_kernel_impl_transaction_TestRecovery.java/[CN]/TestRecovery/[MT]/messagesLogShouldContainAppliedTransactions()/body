{
  String path="target/test-data/recovery";
  deleteRecursively(new File(path));
  int numberOfTransactions=10;
  Process process=Runtime.getRuntime().exec(new String[]{"java","-cp",System.getProperty("java.class.path"),DoSomeTransactionsThenWait.class.getName(),path,"" + numberOfTransactions});
  waitForFileToExist(path,"done");
  process.destroy();
  process.waitFor();
  Collection<String> toLookFor=asList("Injected one phase commit");
  assertEquals(0,countMentionsInMessagesLog(path,toLookFor));
  new EmbeddedGraphDatabase(path).shutdown();
  assertEquals(numberOfTransactions,countMentionsInMessagesLog(path,toLookFor));
}
