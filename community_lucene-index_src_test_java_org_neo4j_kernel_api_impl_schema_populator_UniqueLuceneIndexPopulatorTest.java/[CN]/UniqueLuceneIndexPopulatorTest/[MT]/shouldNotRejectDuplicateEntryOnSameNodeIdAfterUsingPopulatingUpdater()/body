{
  populator=newPopulator();
  when(propertyAccessor.getProperty(1,PROPERTY_KEY_ID)).thenReturn(stringProperty(PROPERTY_KEY_ID,"value1"));
  IndexUpdater updater=populator.newPopulatingUpdater(propertyAccessor);
  updater.process(NodePropertyUpdate.add(1,PROPERTY_KEY_ID,"value1",new long[]{}));
  updater.process(NodePropertyUpdate.change(1,PROPERTY_KEY_ID,"value1",new long[]{},"value1",new long[]{}));
  updater.close();
  addUpdate(populator,2,"value2");
  addUpdate(populator,3,"value3");
  populator.verifyDeferredConstraints(propertyAccessor);
  populator.close(true);
  assertEquals(asList(1l),getAllNodes(getDirectory(),"value1"));
  assertEquals(asList(2l),getAllNodes(getDirectory(),"value2"));
  assertEquals(asList(3l),getAllNodes(getDirectory(),"value3"));
}
