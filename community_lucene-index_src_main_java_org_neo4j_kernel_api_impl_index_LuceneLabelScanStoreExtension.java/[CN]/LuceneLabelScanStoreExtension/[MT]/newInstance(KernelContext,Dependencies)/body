{
  boolean ephemeral=dependencies.getConfig().get(GraphDatabaseFacadeFactory.Configuration.ephemeral);
  DirectoryFactory directoryFactory=directoryFactory(ephemeral,context.fileSystem());
  IndexStorageFactory storageFactory=new IndexStorageFactory(directoryFactory,context.fileSystem(),LabelScanStoreProvider.getStoreDirectory(context.storeDir()));
  IndexStorage indexStorage=storageFactory.labelScanStorage();
  LuceneLabelScanStore scanStore=new LuceneLabelScanStore(new NodeRangeDocumentLabelScanStorageStrategy(),indexStorage,standard(),fullStoreLabelUpdateStream(dependencies.indexStoreView()),monitor != null ? monitor : loggerMonitor(dependencies.getLogService().getInternalLogProvider()));
  return new LabelScanStoreProvider(scanStore,priority);
}
