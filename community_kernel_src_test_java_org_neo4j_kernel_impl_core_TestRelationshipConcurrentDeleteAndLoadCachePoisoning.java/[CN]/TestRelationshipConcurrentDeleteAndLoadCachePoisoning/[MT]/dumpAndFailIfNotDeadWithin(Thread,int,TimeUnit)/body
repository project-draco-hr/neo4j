{
  thread.join(MILLISECONDS.convert(duration,unit));
  if (thread.isAlive()) {
    File dumpDirectory=targetDir.cleanDirectory("dump");
    dumpVmInfo(dumpDirectory);
    new DumpProcessInformation(new SystemOutLogging(),dumpDirectory).doThreadDump(stringContains(SubProcess.class.getSimpleName()));
    fail("Test didn't complete within a reasonable time, dumping process information to " + dumpDirectory);
  }
}
