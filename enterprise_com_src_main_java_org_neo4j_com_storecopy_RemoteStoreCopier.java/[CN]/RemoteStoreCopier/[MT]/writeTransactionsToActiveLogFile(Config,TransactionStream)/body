{
  Map<String,LogBufferFactory> logWriters=createLogWriters(tempConfig);
  Map<String,LogBuffer> logFiles=new HashMap<>();
  try {
    while (transactions.hasNext()) {
      Triplet<String,Long,TxExtractor> next=transactions.next();
      String dsName=next.first();
      Long txId=next.second();
      LogBuffer log=getOrCreateLogBuffer(logFiles,logWriters,dsName,txId,tempConfig);
      next.third().extract(log);
    }
  }
  finally {
    for (    LogBuffer buf : logFiles.values()) {
      buf.force();
      buf.getFileChannel().close();
    }
  }
}
