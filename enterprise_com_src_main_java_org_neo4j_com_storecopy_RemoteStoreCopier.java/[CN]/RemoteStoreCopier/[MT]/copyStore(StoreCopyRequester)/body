{
  File storeDir=config.get(InternalAbstractGraphDatabase.Configuration.store_dir);
  File tempStore=new File(storeDir,COPY_FROM_MASTER_TEMP);
  cleanDirectory(tempStore);
  try (Response response=requester.copyStore(decorateWithProgressIndicator(new ToFileStoreWriter(tempStore)))){
    long highestLogVersion=logVersionRepository.getCurrentLogVersion();
    if (highestLogVersion > -1) {
      NeoStore.setVersion(fs,new File(tempStore,NeoStore.DEFAULT_NAME),highestLogVersion + 1);
    }
    writeTransactionsToActiveLogFile(tempStore,response.getTxs());
  }
  finally {
    requester.done();
  }
  newTempDatabase(tempStore).shutdown();
  for (  File candidate : tempStore.listFiles(STORE_FILE_FILTER)) {
    FileUtils.moveFileToDirectory(candidate,storeDir);
  }
}
