{
  Map<Object,Object> config=new HashMap<Object,Object>();
  config.put("store_dir","target/var");
  config.put(LogBufferFactory.class,CommonFactories.defaultLogBufferFactory(config));
  xaDsMgr.registerDataSource("dummy_datasource",new DummyXaDataSource(config),"DDDDDD".getBytes());
  XaDataSource xaDs=xaDsMgr.getXaDataSource("dummy_datasource");
  DummyXaConnection xaC=null;
  try {
    xaC=(DummyXaConnection)xaDs.getXaConnection();
    try {
      xaC.doStuff1();
      fail("Non enlisted resource should throw exception");
    }
 catch (    XAException e) {
    }
    Xid xid=new XidImpl(new byte[0],new byte[0]);
    xaC.getXaResource().start(xid,XAResource.TMNOFLAGS);
    try {
      xaC.doStuff1();
      xaC.doStuff2();
    }
 catch (    XAException e) {
      fail("Enlisted resource should not throw exception");
    }
    xaC.getXaResource().end(xid,XAResource.TMSUCCESS);
    xaC.getXaResource().prepare(xid);
    xaC.getXaResource().commit(xid,false);
  }
  finally {
    xaDsMgr.unregisterDataSource("dummy_datasource");
    if (xaC != null) {
      xaC.destroy();
    }
  }
  File dir=new File(".");
  File files[]=dir.listFiles(new FilenameFilter(){
    public boolean accept(    File dir,    String fileName){
      return fileName.startsWith(resourceFile());
    }
  }
);
  for (int i=0; i < files.length; i++) {
    files[i].delete();
  }
}
