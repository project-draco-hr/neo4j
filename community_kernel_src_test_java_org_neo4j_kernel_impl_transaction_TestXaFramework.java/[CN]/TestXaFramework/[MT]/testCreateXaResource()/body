{
  Map<String,String> config=new HashMap<String,String>();
  config.put("store_dir","target/var");
  FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();
  xaDsMgr.registerDataSource(new DummyXaDataSource(config,UTF8.encode("DDDDDD"),"dummy_datasource",new XaFactory(new Config(StringLogger.DEV_NULL,fileSystem,config),TxIdGenerator.DEFAULT,new PlaceboTm(),CommonFactories.defaultLogBufferFactory(),fileSystem,StringLogger.DEV_NULL,CommonFactories.defaultRecoveryVerifier())));
  XaDataSource xaDs=xaDsMgr.getXaDataSource("dummy_datasource");
  DummyXaConnection xaC=null;
  try {
    xaC=(DummyXaConnection)xaDs.getXaConnection();
    try {
      xaC.doStuff1();
      fail("Non enlisted resource should throw exception");
    }
 catch (    XAException e) {
    }
    Xid xid=new XidImpl(new byte[0],new byte[0]);
    xaC.getXaResource().start(xid,XAResource.TMNOFLAGS);
    try {
      xaC.doStuff1();
      xaC.doStuff2();
    }
 catch (    XAException e) {
      fail("Enlisted resource should not throw exception");
    }
    xaC.getXaResource().end(xid,XAResource.TMSUCCESS);
    xaC.getXaResource().prepare(xid);
    xaC.getXaResource().commit(xid,false);
  }
  finally {
    xaDsMgr.unregisterDataSource("dummy_datasource");
    if (xaC != null) {
      xaC.destroy();
    }
  }
  File dir=new File(".");
  File files[]=dir.listFiles(new FilenameFilter(){
    public boolean accept(    File dir,    String fileName){
      return fileName.startsWith(resourceFile());
    }
  }
);
  for (int i=0; i < files.length; i++) {
    files[i].delete();
  }
}
