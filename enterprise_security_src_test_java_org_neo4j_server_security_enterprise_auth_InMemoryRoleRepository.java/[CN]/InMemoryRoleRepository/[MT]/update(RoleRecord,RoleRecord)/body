{
  if (!existingRole.name().equals(updatedRole.name())) {
    throw new IllegalArgumentException("updated role has a different name");
  }
synchronized (this) {
    boolean foundRole=false;
    for (    RoleRecord other : roles.values()) {
      if (other.equals(existingRole)) {
        foundRole=true;
      }
    }
    if (!foundRole) {
      throw new ConcurrentModificationException();
    }
    roles.put(updatedRole.name(),updatedRole);
    removeFromUserMap(existingRole);
    populateUserMap(updatedRole);
  }
}
