{
  GraphDatabaseService db=new GraphDatabaseFactory().newEmbeddedDatabase(directory.absolutePath());
  try (Transaction tx=db.beginTx()){
    int nodeCount=0, relationshipCount=0;
    for (    Node node : GlobalGraphOperations.at(db).getAllNodes()) {
      assertTrue(node.hasProperty("name"));
      nodeAdditionalValidation.validate(node);
      nodeCount++;
    }
    assertEquals(NODE_COUNT,nodeCount);
    for (    Relationship relationship : GlobalGraphOperations.at(db).getAllRelationships()) {
      assertTrue(relationship.hasProperty("created"));
      relationshipAdditionalValidation.validate(relationship);
      relationshipCount++;
    }
    assertEquals(RELATIONSHIP_COUNT,relationshipCount);
    tx.success();
  }
  finally {
    db.shutdown();
  }
}
