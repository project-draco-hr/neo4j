{
  EnterpriseAuthSubject enterpriseSubject=EnterpriseAuthSubject.castOrFail(authSubject);
  if (enterpriseSubject.doesUsernameMatch(username)) {
    enterpriseSubject.setPassword(newPassword,false);
  }
 else   if (!enterpriseSubject.isAdmin()) {
    throw new AuthorizationViolationException(PERMISSION_DENIED);
  }
 else {
    enterpriseSubject.getUserManager().setUserPassword(username,newPassword,requirePasswordChange);
    terminateTransactionsForValidUser(username);
    terminateConnectionsForValidUser(username);
  }
}
