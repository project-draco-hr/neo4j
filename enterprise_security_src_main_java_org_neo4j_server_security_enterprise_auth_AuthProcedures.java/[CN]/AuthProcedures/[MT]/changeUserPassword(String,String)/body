{
  EnterpriseAuthSubject enterpriseSubject=EnterpriseAuthSubject.castOrFail(authSubject);
  if (enterpriseSubject.doesUsernameMatch(username)) {
    enterpriseSubject.getUserManager().setPassword(enterpriseSubject,username,newPassword);
  }
 else   if (!enterpriseSubject.isAdmin()) {
    throw new AuthorizationViolationException(PERMISSION_DENIED);
  }
 else {
    enterpriseSubject.getUserManager().setUserPassword(username,newPassword);
  }
}
