{
  if (!data.hasNext()) {
    return null;
  }
  @SuppressWarnings("unchecked") T[] batch=(T[])Array.newInstance(itemClass,batchSize);
  int i=0;
  for (; i < batchSize && data.hasNext(); i++) {
    batch[i]=data.next();
  }
  return i == batchSize ? batch : Arrays.copyOf(batch,i);
}
