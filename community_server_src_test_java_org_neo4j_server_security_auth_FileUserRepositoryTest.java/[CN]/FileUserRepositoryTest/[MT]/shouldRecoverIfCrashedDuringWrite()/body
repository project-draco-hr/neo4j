{
  File dbFile=new File("dbms/auth.db");
  FileUserRepository users=new FileUserRepository(fsRule.get(),dbFile,DEV_NULL);
  User user=new User("jake",Credential.INACCESSIBLE,true);
  users.create(user);
  File tempFile=new File(dbFile.getAbsolutePath() + ".tmp");
  fsRule.get().renameFile(dbFile,tempFile);
  users=new FileUserRepository(fsRule.get(),dbFile,DEV_NULL);
  users.start();
  assertFalse(fsRule.get().fileExists(tempFile));
  assertTrue(fsRule.get().fileExists(dbFile));
  assertThat(users.findByName(user.name()),equalTo(user));
}
