{
  File dbFile=new File("dbms/auth.db");
  FileUserRepository users=new FileUserRepository(fsRule.get(),dbFile);
  User user=new User("jake","af123",Privileges.ADMIN,Credentials.INACCESSIBLE,true);
  users.save(user);
  File tempFile=new File(dbFile.getAbsolutePath() + ".tmp");
  fsRule.get().renameFile(dbFile,tempFile);
  users=new FileUserRepository(fsRule.get(),dbFile);
  users.start();
  assertFalse(fsRule.get().fileExists(tempFile));
  assertTrue(fsRule.get().fileExists(dbFile));
  assertThat(users.findByName(user.name()),equalTo(user));
}
