{
  assertTmOk();
  Transaction associatedTx=txThreadMap.get();
  if (associatedTx != null) {
    throw new ThreadAssociatedWithOtherTransactionException(Thread.currentThread(),associatedTx,tx);
  }
  TransactionImpl txImpl=(TransactionImpl)tx;
  if (txImpl.getStatus() != Status.STATUS_NO_TRANSACTION) {
    if (txImpl.isActive()) {
      throw new TransactionAlreadyActiveException(Thread.currentThread(),tx);
    }
    txImpl.markAsActive();
    txThreadMap.set(txImpl);
  }
}
