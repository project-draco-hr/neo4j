{
  if (blocked) {
    throw new SystemException("TxManager is preventing new transactions from starting " + "due a shutdown is imminent");
  }
  assertTmOk("tx begin");
  Thread thread=Thread.currentThread();
  TransactionImpl tx=txThreadMap.get(thread);
  if (tx != null) {
    throw logAndReturn("TM error tx begin",new NotSupportedException("Nested transactions not supported"));
  }
  tx=new TransactionImpl(this,forceMode);
  txThreadMap.put(thread,tx);
  int concurrentTxCount=txThreadMap.size();
  if (concurrentTxCount > peakConcurrentTransactions) {
    peakConcurrentTransactions=concurrentTxCount;
  }
  startedTxCount.incrementAndGet();
}
