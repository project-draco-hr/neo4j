{
  try {
    Iterable<List<TxLog.Record>> danglingRecordList=txLog.getDanglingRecords();
    for (    List<TxLog.Record> tx : danglingRecordList) {
      for (      TxLog.Record rec : tx) {
        if (rec.getType() == TxLog.BRANCH_ADD) {
          RecoveredBranchInfo branchId=new RecoveredBranchInfo(rec.getBranchId());
          if (branches.containsKey(branchId)) {
            continue;
          }
          branches.put(branchId,false);
        }
      }
    }
  }
 catch (  IOException e) {
    log.logMessage("Unable to recover pending branches",e);
    throw logAndReturn("TM startup failure",new TransactionFailureException("Unable to start TM",e));
  }
}
