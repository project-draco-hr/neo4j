{
  int oldReaderIndex=buffer.readerIndex();
  if (hasMarkedReaderIndex) {
    buffer.resetReaderIndex();
  }
  int bytesToDiscard=buffer.readerIndex();
  buffer.discardReadBytes();
  if (hasMarkedReaderIndex) {
    buffer.readerIndex(oldReaderIndex - bytesToDiscard);
  }
}
