{
  try (LuceneSchemaIndex uniqueIndex=LuceneSchemaIndexBuilder.create().uniqueIndex().withIndexRootFolder(testDir.directory("singlePartitionIndex")).withIndexIdentifier("uniqueSingle").build()){
    uniqueIndex.open();
    assertEquals(0,uniqueIndex.allDocumentsReader().maxCount());
    assertFalse(uniqueIndex.exists());
    try (LuceneIndexAccessor indexAccessor=new LuceneIndexAccessor(uniqueIndex)){
      int affectedNodes=7;
      generateUpdates(indexAccessor,affectedNodes);
      indexAccessor.force();
      assertTrue(uniqueIndex.isOnline());
      try (IndexReader indexReader=indexAccessor.newReader()){
        long[] nodes=PrimitiveLongCollections.asArray(indexReader.scan());
        assertEquals(affectedNodes,nodes.length);
        IndexSampler indexSampler=indexReader.createSampler();
        Register.DoubleLongRegister sampleRegister=Registers.newDoubleLongRegister();
        assertEquals(affectedNodes,indexSampler.sampleIndex(sampleRegister));
        assertEquals(affectedNodes,sampleRegister.readFirst());
        assertEquals(affectedNodes,sampleRegister.readSecond());
      }
     }
   }
 }
