{
  Properties systemProperties=buildProperties(true);
  prepareSampleLegacyDatabase(new File(STORE_DIRECTORY));
  ByteArrayOutputStream outputStream=new ByteArrayOutputStream();
  PreStartupStoreUpgrader upgrader=new PreStartupStoreUpgrader(systemProperties,new PrintStream(outputStream));
  int exit=upgrader.run();
  assertEquals(0,exit);
  String[] lines=new String(outputStream.toByteArray()).split("\\r?\\n");
  assertEquals("Starting upgrade of database store files",lines[0]);
  assertEquals(dots(100),lines[1]);
  assertEquals("Finished upgrade of database store files",lines[2]);
}
