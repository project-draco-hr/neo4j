{
  DeferredConstraintVerificationUniqueLuceneIndexPopulator populator=newPopulator();
  populator.add(1,"value1");
  IndexUpdater updater=populator.newPopulatingUpdater(propertyAccessor);
  updater.process(NodePropertyUpdate.remove(1,PROPERTY_KEY_ID,"value1",new long[]{}));
  updater.process(NodePropertyUpdate.add(1,PROPERTY_KEY_ID,"value1",new long[]{}));
  populator.close(true);
  assertEquals(asList(1l),getAllNodes(indexStorage.getDirectory(),"value1"));
}
