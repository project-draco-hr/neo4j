{
  SearcherManagerFactory searcherManagerFactory=mock(SearcherManagerFactory.class);
  SearcherManagerStub searcherManager=spy(new SearcherManagerStub(mock(IndexSearcher.class)));
  when(searcherManagerFactory.create(any(LuceneIndexWriter.class))).thenReturn(searcherManager);
  DeferredConstraintVerificationUniqueLuceneIndexPopulator populator=newPopulator(searcherManagerFactory);
  populator.close(true);
  verify(searcherManager).afterClose();
}
