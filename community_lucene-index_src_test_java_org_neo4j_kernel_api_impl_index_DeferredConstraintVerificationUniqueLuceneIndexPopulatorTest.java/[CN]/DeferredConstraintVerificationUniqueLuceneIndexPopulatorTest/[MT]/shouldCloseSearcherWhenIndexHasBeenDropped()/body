{
  SearcherManagerFactory searcherManagerFactory=mock(SearcherManagerFactory.class);
  SearcherManagerStub searcherManager=spy(new SearcherManagerStub(mock(IndexSearcher.class)));
  when(searcherManagerFactory.create(any(IndexWriter.class))).thenReturn(searcherManager);
  DeferredConstraintVerificationUniqueLuceneIndexPopulator populator=newPopulator(searcherManagerFactory);
  populator.drop();
  verify(searcherManager).afterClose();
}
