{
  DeferredConstraintVerificationUniqueLuceneIndexPopulator populator=newPopulator();
  populator.add(1,"value1");
  populator.add(2,"value2");
  populator.add(3,"value3");
  populator.verifyDeferredConstraints(propertyAccessor);
  populator.close(true);
  assertEquals(asList(1l),getAllNodes(directoryFactory,indexDirectory,"value1"));
  assertEquals(asList(2l),getAllNodes(directoryFactory,indexDirectory,"value2"));
  assertEquals(asList(3l),getAllNodes(directoryFactory,indexDirectory,"value3"));
}
