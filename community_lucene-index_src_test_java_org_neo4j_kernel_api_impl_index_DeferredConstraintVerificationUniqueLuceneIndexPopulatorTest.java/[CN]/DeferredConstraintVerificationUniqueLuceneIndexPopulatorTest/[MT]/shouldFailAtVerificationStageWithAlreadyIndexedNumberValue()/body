{
  File indexDirectory=new File("target/whatever");
  final LuceneDocumentStructure documentLogic=new LuceneDocumentStructure();
  DeferredConstraintVerificationUniqueLuceneIndexPopulator populator=new DeferredConstraintVerificationUniqueLuceneIndexPopulator(documentLogic,standard(),new IndexWriterStatus(),directoryFactory,indexDirectory,failureStorage,indexId);
  populator.create();
  populator.add(1,1);
  populator.add(2,2);
  populator.add(3,1);
  try {
    populator.verifyDeferredConstraints();
    fail("should have thrown exception");
  }
 catch (  PreexistingIndexEntryConflictException conflict) {
    assertEquals(1,conflict.getExistingNodeId());
    assertEquals(1.0,conflict.getPropertyValue());
    assertEquals(3,conflict.getAddedNodeId());
  }
}
