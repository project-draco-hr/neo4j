{
  InMemoryCountsStore countStore=new InMemoryCountsStore();
  IntermediateStateTestManager intermediateStateTestManager=new IntermediateStateTestManager();
  Map<CountsKey,long[]> snapshotMap;
  ConcurrentHashMap<CountsKey,long[]> updateMap=new ConcurrentHashMap<>();
  Map<CountsKey,long[]> map=new ConcurrentHashMap<>();
  long txId=intermediateStateTestManager.getNextUpdateMap(updateMap);
  updateMapByDiff(map,updateMap);
  countStore.updateAll(txId,updateMap);
  CountsSnapshot countsSnapshot=countStore.snapshot(txId);
  snapshotMap=countsSnapshot.getMap();
  assertMapEquals(map,snapshotMap);
}
