{
  InMemoryCountsStore countStore=new InMemoryCountsStore();
  IntermediateStateTestManager intermediateStateTestManager=new IntermediateStateTestManager();
  ExecutorService executor=Executors.newFixedThreadPool(10);
  ExecutorCompletionService<Void> ecs=new ExecutorCompletionService<>(executor);
  List<Runnable> workers=new ArrayList<>(10);
  AtomicBoolean stop=new AtomicBoolean();
  for (int i=0; i < 9; i++) {
    workers.add(new UpdateWorker(stop,intermediateStateTestManager,countStore));
  }
  workers.add(new SnapshotWorker(10,stop,intermediateStateTestManager,countStore));
  for (  Runnable worker : workers) {
    ecs.submit(worker,null);
  }
  for (int i=0; i < workers.size(); i++) {
    ecs.take().get();
  }
  executor.shutdown();
}
