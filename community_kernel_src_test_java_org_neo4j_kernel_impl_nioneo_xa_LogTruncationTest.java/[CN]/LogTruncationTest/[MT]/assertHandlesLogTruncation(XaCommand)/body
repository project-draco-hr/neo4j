{
  inMemoryBuffer.reset();
  writer.write(cmd,inMemoryBuffer);
  int bytesSuccessfullyWritten=inMemoryBuffer.bytesWritten();
  try {
    assertEquals(cmd,reader.read(inMemoryBuffer));
  }
 catch (  Exception e) {
    throw new AssertionError("Failed to deserialize " + cmd.toString() + ", because: ",e);
  }
  bytesSuccessfullyWritten--;
  while (bytesSuccessfullyWritten-- > 0) {
    inMemoryBuffer.reset();
    writer.write(cmd,inMemoryBuffer);
    inMemoryBuffer.truncateTo(bytesSuccessfullyWritten);
    XaCommand deserialized=reader.read(inMemoryBuffer);
    assertNull("Deserialization did not detect log truncation! Record: " + cmd + ", deserialized: "+ deserialized,deserialized);
  }
}
