{
  return new CollectingIndexUpdater(){
    @Override public void close() throws IOException, IndexEntryConflictException {
switch (mode) {
case ONLINE:
        regularUpdates.addAll(updates);
      break;
case RECOVERY:
    recoveredUpdates.addAll(updates);
  break;
default :
throw new UnsupportedOperationException();
}
}
@Override public void remove(PrimitiveLongSet nodeIds) throws IOException {
nodeIds.visitKeys(new PrimitiveLongVisitor<RuntimeException>(){
@Override public boolean visited(long nodeId) throws RuntimeException {
recoveredNodes.add(nodeId);
return false;
}
}
);
}
}
;
}
