{
  return new CollectingIndexUpdater(){
    @Override public void close() throws IOException, IndexEntryConflictException {
switch (mode) {
case ONLINE:
        regularUpdates.addAll(updates);
      break;
case RECOVERY:
    recoveredUpdates.addAll(updates);
  break;
default :
throw new UnsupportedOperationException();
}
}
}
;
}
