{
  try (BatchTransactionApplier batchApplier=applier(mode)){
    TransactionToApply tx=batch;
    while (tx != null) {
      try (LockGroup locks=new LockGroup()){
        ensureValidatedIndexUpdates(tx);
        try (TransactionApplier txApplier=batchApplier.startTx(tx,locks)){
          tx.transactionRepresentation().accept(txApplier);
        }
         tx=tx.next();
      }
 catch (      Throwable cause) {
        databaseHealth.panic(cause);
        throw cause;
      }
    }
  }
 }
