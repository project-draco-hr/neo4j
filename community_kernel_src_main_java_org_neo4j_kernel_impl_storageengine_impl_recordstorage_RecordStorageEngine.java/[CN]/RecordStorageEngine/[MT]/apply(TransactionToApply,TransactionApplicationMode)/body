{
  try (CommandApplierFacade applier=applier(mode)){
    TransactionToApply tx=batch;
    while (tx != null) {
      try (LockGroup locks=new LockGroup()){
        ensureValidatedIndexUpdates(tx);
        applier.begin(tx,locks);
        try {
          tx.transactionRepresentation().accept(applier);
        }
  finally {
          applier.end();
        }
        tx=tx.next();
      }
 catch (      Throwable cause) {
        databaseHealth.panic(cause);
        throw cause;
      }
    }
  }
 }
