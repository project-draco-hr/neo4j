{
  ArrayList<BatchTransactionApplier> appliers=new ArrayList<>();
  appliers.add(new NeoStoreBatchTransactionApplier(neoStores,cacheAccess,lockService));
  if (mode.needsHighIdTracking()) {
    appliers.add(new HighIdBatchTransactionApplier(neoStores));
  }
  if (mode.needsCacheInvalidationOnUpdates()) {
    appliers.add(new CacheInvalidationBatchTransactionApplier(neoStores,cacheAccess));
  }
  appliers.add(new IndexBatchTransactionApplier(indexingService,labelScanStoreSync,indexUpdatesSync,neoStores.getNodeStore(),neoStores.getPropertyStore(),new PropertyLoader(neoStores),indexUpdatesConverter,mode));
  appliers.add(new LegacyBatchIndexApplier(indexConfigStore,legacyIndexApplierLookup,legacyIndexTransactionOrdering,mode));
  appliers.add(new CountsStoreBatchTransactionApplier(neoStores.getCounts(),mode));
  return new BatchTransactionApplierFacade(appliers.toArray(new BatchTransactionApplier[appliers.size()]));
}
