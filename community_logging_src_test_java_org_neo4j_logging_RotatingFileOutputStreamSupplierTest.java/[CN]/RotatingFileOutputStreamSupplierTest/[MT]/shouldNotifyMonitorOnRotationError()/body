{
  RotationListener rotationListener=mock(RotationListener.class);
  FileSystemAbstraction fs=spy(fileSystem);
  RotatingFileOutputStreamSupplier supplier=new RotatingFileOutputStreamSupplier(fs,logFile,10,0,10,DIRECT_EXECUTOR,rotationListener);
  OutputStream outputStream=supplier.get();
  IOException exception=new IOException("text exception");
  doThrow(exception).when(fs).renameFile(any(File.class),any(File.class));
  write(outputStream,"A string longer than 10 bytes");
  assertThat(supplier.get(),is(outputStream));
  verify(rotationListener).rotationError(exception,outputStream);
}
