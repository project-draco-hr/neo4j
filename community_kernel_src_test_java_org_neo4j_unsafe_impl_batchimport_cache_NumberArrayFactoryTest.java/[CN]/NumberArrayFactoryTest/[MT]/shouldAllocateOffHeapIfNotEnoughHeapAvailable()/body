{
  AvailableMemoryCalculator memory=mock(AvailableMemoryCalculator.class);
  when(memory.availableHeapMemory()).thenReturn(1 * MEGA);
  when(memory.availableOffHeapMemory()).thenReturn(10 * MEGA);
  NumberArrayFactory factory=new NumberArrayFactory.Auto(memory,10 * KILO);
  LongArray array=factory.newLongArray(1 * MEGA,0);
  array.set(1 * MEGA - 10,12345);
  assertTrue(array instanceof OffHeapLongArray);
  assertEquals(12345,array.get(1 * MEGA - 10));
}
