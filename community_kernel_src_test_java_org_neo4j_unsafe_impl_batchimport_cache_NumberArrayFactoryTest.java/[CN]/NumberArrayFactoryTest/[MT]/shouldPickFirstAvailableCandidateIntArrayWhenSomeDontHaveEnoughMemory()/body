{
  NumberArrayFactory lowMemoryFactory=mock(NumberArrayFactory.class);
  doThrow(OutOfMemoryError.class).when(lowMemoryFactory).newIntArray(anyLong(),anyInt());
  NumberArrayFactory factory=new NumberArrayFactory.Auto(lowMemoryFactory,NumberArrayFactory.HEAP);
  IntArray array=factory.newIntArray(1 * KILO,-1);
  array.set(1 * KILO - 10,12345);
  verify(lowMemoryFactory,times(1)).newIntArray(1 * KILO,-1);
  assertTrue(array instanceof HeapIntArray);
  assertEquals(12345,array.get(1 * KILO - 10));
}
