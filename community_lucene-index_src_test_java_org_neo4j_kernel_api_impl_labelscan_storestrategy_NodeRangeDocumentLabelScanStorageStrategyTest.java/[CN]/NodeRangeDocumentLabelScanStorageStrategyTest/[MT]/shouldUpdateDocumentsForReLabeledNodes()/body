{
  Document givenDoc=new Document();
  format.addRangeValuesField(givenDoc,0);
  format.addLabelFields(givenDoc,"7",0x70L);
  WritableLuceneLabelScanIndex index=mock(WritableLuceneLabelScanIndex.class);
  IndexWriter indexWriter=mock(IndexWriter.class);
  WritableIndexPartition partition=newIndexPartitionMock(indexWriter,givenDoc);
  when(index.getPartitions()).thenReturn(Collections.singletonList(partition));
  LabelScanWriter writer=new PartitionedLuceneLabelScanWriter(index,format);
  writer.write(labelChanges(0,labels(),labels(7,8)));
  writer.close();
  Document thenDoc=new Document();
  format.addRangeValuesField(thenDoc,0);
  format.addLabelFields(thenDoc,"7",0x71L);
  format.addLabelAndSearchFields(thenDoc,8,new Bitmap(0x01L));
  verify(indexWriter).updateDocument(eq(format.rangeTerm(0)),match(thenDoc));
}
