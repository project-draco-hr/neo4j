{
  Node node=null;
  Transaction tx=db.beginTx();
  try {
    node=db.createNode();
    setProperties(properties,node);
    for (int t=0; t < nrOfTypes; t++) {
      RelationshipType type=DynamicRelationshipType.withName(relTypeName(t));
      for (int i=0, dir=0; i < nrOfRelationships; i++, dir=(dir + directionStride) % 3) {
switch (dir) {
case 0:
          node.createRelationshipTo(db.createNode(),type);
        break;
case 1:
      db.createNode().createRelationshipTo(node,type);
    break;
case 2:
  node.createRelationshipTo(node,type);
break;
default :
throw new IllegalArgumentException("Invalid direction " + dir);
}
}
}
tx.success();
}
  finally {
tx.finish();
}
clearCache();
if (!properties.isEmpty()) loadProperties(node);
if (nrOfRelationships * nrOfTypes > 0) count(node.getRelationships());
return node;
}
