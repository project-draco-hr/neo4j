{
  if (!fileSystem.fileExists(logFileName)) {
    throw new IOException("Logical log[" + logFileName + "] not found");
  }
  FileChannel channel=fileSystem.open(logFileName,"rw");
  long[] header=VersionAwareLogEntryReader.readLogHeader(ByteBuffer.allocate(16),channel,false);
  try {
    FileUtils.truncateFile(channel,endPosition);
  }
 catch (  IOException e) {
    msgLog.warn("Failed to truncate log at correct size",e);
  }
  channel.close();
  File newName;
  if (header == null) {
    newName=new File(getFileName(-1).getPath() + "_empty_header_log_" + System.currentTimeMillis());
  }
 else {
    newName=getFileName(header[0]);
  }
  if (!fileSystem.renameFile(logFileName,newName)) {
    throw new IOException("Failed to rename log to: " + newName);
  }
}
