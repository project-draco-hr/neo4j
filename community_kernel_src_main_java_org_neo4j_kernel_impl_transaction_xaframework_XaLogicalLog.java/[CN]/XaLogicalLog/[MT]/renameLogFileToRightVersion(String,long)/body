{
  if (!fileSystem.fileExists(logFileName)) {
    throw new IOException("Logical log[" + logFileName + "] not found");
  }
  FileChannel channel=fileSystem.open(logFileName,"rw");
  long[] header=LogIoUtils.readLogHeader(ByteBuffer.allocate(16),channel,false);
  try {
    FileUtils.truncateFile(channel,endPosition);
  }
 catch (  IOException e) {
    log.log(Level.WARNING,"Failed to truncate log at correct size",e);
  }
  channel.close();
  String newName;
  if (header == null) {
    newName=getFileName(-1) + "_empty_header_log_" + System.currentTimeMillis();
  }
 else {
    newName=getFileName(header[0]);
  }
  if (!fileSystem.renameFile(logFileName,newName)) {
    throw new IOException("Failed to rename log to: " + newName);
  }
}
