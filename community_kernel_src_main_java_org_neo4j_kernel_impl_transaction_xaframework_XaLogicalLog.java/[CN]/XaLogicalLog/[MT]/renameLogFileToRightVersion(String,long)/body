{
  File file=new File(logFileName);
  if (!file.exists()) {
    throw new IOException("Logical log[" + logFileName + "] not found");
  }
  FileChannel channel=new RandomAccessFile(logFileName,"rw").getChannel();
  long[] header=LogIoUtils.readLogHeader(ByteBuffer.allocate(16),channel,false);
  try {
    FileUtils.truncateFile(channel,endPosition);
  }
 catch (  IOException e) {
    log.log(Level.WARNING,"Failed to truncate log at correct size",e);
  }
  channel.close();
  String newName;
  if (header == null) {
    newName=getFileName(-1) + "_empty_header_log_" + System.currentTimeMillis();
  }
 else {
    newName=getFileName(header[0]);
  }
  File newFile=new File(newName);
  boolean renamed=FileUtils.renameFile(file,newFile);
  if (!renamed) {
    throw new IOException("Failed to rename log to: " + newName);
  }
}
