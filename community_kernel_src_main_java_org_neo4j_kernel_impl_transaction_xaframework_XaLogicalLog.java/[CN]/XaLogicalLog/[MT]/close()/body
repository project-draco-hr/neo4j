{
  if (fileChannel == null || !fileChannel.isOpen()) {
    msgLog.debug("Logical log: " + fileName + " already closed");
    return;
  }
  long endPosition=writeBuffer.getFileChannelPosition();
  if (xidIdentMap.size() > 0) {
    msgLog.info("Close invoked with " + xidIdentMap.size() + " running transaction(s). ");
    writeBuffer.force();
    fileChannel.close();
    msgLog.info("Dirty log: " + fileName + "."+ currentLog+ " now closed. Recovery will be started automatically next "+ "time it is opened.");
    return;
  }
  releaseCurrentLogFile();
  char logWas=currentLog;
  if (currentLog != CLEAN) {
    setActiveLog(CLEAN);
  }
  xaTf.flushAll();
  File activeLogFileName=new File(fileName.getPath() + "." + logWas);
  renameLogFileToRightVersion(activeLogFileName,endPosition);
  xaTf.getAndSetNewVersion();
  pruneStrategy.prune(this);
  msgLog.info("Closed log " + fileName);
}
