{
  if (nextTxId != (xaTf.getLastCommittedTx() + 1)) {
    throw new IllegalStateException("Tried to apply tx " + nextTxId + " but expected transaction "+ (xaTf.getCurrentVersion() + 1));
  }
  logRecoveryMessage("applyTxWithoutTxId log version: " + logVersion + ", committing tx="+ nextTxId+ ") @ pos "+ writeBuffer.getFileChannelPosition());
  scanIsComplete=false;
  logWriterSPI.bind(forceMode,nextTxId);
  LogReader<ReadableByteChannel> reader=new LogDeserializer(logDeserializerMonitor,sharedBuffer);
  reader.setXidIdentifier(getNextIdentifier());
  reader.setLogHandler(new LogFilter(interceptor,new MasterLogWriter(new LogApplier(),logWriterSPI,injectedTxValidator)));
  reader.setXaCommandReader(commandReader);
  reader.read(byteChannel);
  byteChannel.close();
  scanIsComplete=true;
  logRecoveryMessage("Applied external tx and generated tx id=" + nextTxId);
  checkLogRotation();
}
