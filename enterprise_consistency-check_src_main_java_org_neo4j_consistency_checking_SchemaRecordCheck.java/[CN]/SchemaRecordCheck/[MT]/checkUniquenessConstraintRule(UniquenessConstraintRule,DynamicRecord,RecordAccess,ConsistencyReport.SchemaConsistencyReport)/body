{
  if (phase == Phase.CHECK_RULES) {
    report.forReference(records.propertyKey((int)rule.getPropertyKey()),VALID_PROPERTY_KEY);
    DynamicRecord previousObligation=indexObligations.put(rule.getOwnedIndex(),record);
    if (null != previousObligation) {
      report.duplicateObligation(previousObligation);
    }
  }
 else   if (phase == Phase.CHECK_OBLIGATIONS) {
    DynamicRecord obligation=constraintObligations.get(rule.getId());
    if (null == obligation) {
      report.missingObligation(SchemaRule.Kind.CONSTRAINT_INDEX_RULE);
    }
 else {
      if (obligation.getId() != rule.getOwnedIndex()) {
        report.uniquenessConstraintNotReferencingBack(obligation);
      }
    }
  }
}
