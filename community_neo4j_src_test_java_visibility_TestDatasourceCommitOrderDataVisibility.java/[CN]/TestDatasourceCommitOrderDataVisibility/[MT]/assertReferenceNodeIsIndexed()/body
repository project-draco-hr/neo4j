{
  final Collection<Exception> problems=new HashSet<>();
  Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      Transaction transaction=graphDatabaseService.beginTx();
      try {
        Node node=graphDatabaseService.index().forNodes(INDEX_NAME).get(INDEX_KEY,INDEX_VALUE).getSingle();
        assertThat(node,is(graphDatabaseService.getReferenceNode()));
      }
 catch (      Throwable t) {
        problems.add(new Exception(t));
      }
 finally {
        transaction.finish();
      }
    }
  }
);
  thread.start();
  thread.join();
  if (problems.size() > 0) {
    throw problems.iterator().next();
  }
}
