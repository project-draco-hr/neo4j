{
  Node commonNode;
  try (Transaction tx=graphDatabaseService.beginTx()){
    commonNode=graphDatabaseService.createNode();
    tx.success();
  }
   try (Transaction transaction=graphDatabaseService.beginTx()){
    graphDatabaseService.index().forNodes(INDEX_NAME).add(commonNode,INDEX_KEY,INDEX_VALUE);
    commonNode.setProperty(PROPERTY_NAME,PROPERTY_VALUE);
    assertNodeIsNotIndexedOutsideThisTransaction();
    assertNodeIsUnchangedOutsideThisTransaction(commonNode);
    transaction.success();
    assertNodeIsNotIndexedOutsideThisTransaction();
    assertNodeIsUnchangedOutsideThisTransaction(commonNode);
  }
   assertNodeIsIndexed(commonNode);
  assertNodeHasBeenUpdated(commonNode);
}
