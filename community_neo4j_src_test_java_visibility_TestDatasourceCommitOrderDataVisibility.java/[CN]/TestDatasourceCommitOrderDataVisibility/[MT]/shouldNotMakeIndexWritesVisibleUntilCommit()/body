{
  Transaction transaction=graphDatabaseService.beginTx();
  try {
    graphDatabaseService.index().forNodes(INDEX_NAME).add(graphDatabaseService.getReferenceNode(),INDEX_KEY,INDEX_VALUE);
    graphDatabaseService.getReferenceNode().setProperty(PROPERTY_NAME,PROPERTY_VALUE);
    assertReferenceNodeIsNotIndexedOutsideThisTransaction();
    assertReferenceNodeIsUnchangedOutsideThisTransaction();
    transaction.success();
    assertReferenceNodeIsNotIndexedOutsideThisTransaction();
    assertReferenceNodeIsUnchangedOutsideThisTransaction();
  }
  finally {
    transaction.finish();
  }
  assertReferenceNodeIsIndexed();
  assertReferenceNodeHasBeenUpdated();
}
