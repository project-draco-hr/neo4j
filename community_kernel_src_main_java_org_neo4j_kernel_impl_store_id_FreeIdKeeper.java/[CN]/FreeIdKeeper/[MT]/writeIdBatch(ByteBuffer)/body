{
  try {
    positionChannel(channel.size());
    writeBuffer.clear();
    while (!freeIds.isEmpty()) {
      long id=freeIds.removeFirst();
      if (id == NO_RESULT) {
        continue;
      }
      writeBuffer.putLong(id);
      if (writeBuffer.position() == writeBuffer.capacity()) {
        writeBuffer.flip();
        while (writeBuffer.hasRemaining()) {
          channel.write(writeBuffer);
        }
        writeBuffer.clear();
      }
    }
    writeBuffer.flip();
    while (writeBuffer.hasRemaining()) {
      channel.write(writeBuffer);
    }
    if (aggressiveReuse) {
      maxReadPosition=channel.size();
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to write defragged id " + " batch",e);
  }
}
