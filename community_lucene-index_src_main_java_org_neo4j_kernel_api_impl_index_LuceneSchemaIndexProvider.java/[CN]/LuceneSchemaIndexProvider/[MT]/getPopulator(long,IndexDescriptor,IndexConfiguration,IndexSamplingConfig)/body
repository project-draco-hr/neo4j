{
  if (readOnly) {
    throw new UnsupportedOperationException("Index population is not supported in read only mode.");
  }
  if (config.isUnique()) {
    return new DeferredConstraintVerificationUniqueLuceneIndexPopulator(documentStructure,logging,IndexWriterFactories.tracking(),SearcherManagerFactories.standard(),directoryFactory,folderLayout.getFolder(indexId),archiveFailedIndex,failureStorage,indexId,descriptor);
  }
 else {
    return new NonUniqueLuceneIndexPopulator(NonUniqueLuceneIndexPopulator.DEFAULT_QUEUE_THRESHOLD,documentStructure,logging,IndexWriterFactories.tracking(),directoryFactory,folderLayout.getFolder(indexId),archiveFailedIndex,failureStorage,indexId,samplingConfig);
  }
}
