{
  final UpdatePullerClient puller=new UpdatePullerClient(1,scheduler,logging,updatePuller,availabilityGuard);
  puller.init();
  puller.start();
  updatePuller.unpause();
  scheduler.runJob();
  verify(lastUpdateTime,times(1)).setLastUpdateTime(anyLong());
  verify(availabilityGuard,times(1)).isAvailable(anyLong());
  verify(master,times(1)).pullUpdates(Matchers.<RequestContext>any());
  stateMachine.masterIsElected();
  scheduler.runJob();
  updatePuller.unpause();
  scheduler.runJob();
  verify(lastUpdateTime,times(2)).setLastUpdateTime(anyLong());
  verify(availabilityGuard,times(2)).isAvailable(anyLong());
  verify(master,times(2)).pullUpdates(Matchers.<RequestContext>any());
}
