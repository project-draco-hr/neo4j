{
  for (int i=0; i < threads; i++) {
    executor.submit(worker);
  }
  long now=System.currentTimeMillis();
  long previousReportTime=System.currentTimeMillis();
  long finishLine=runningTimeMillis + now;
  long sampleRate=TimeUnit.SECONDS.toMillis(10);
  long lastReport=sampleRate + now;
  long previousTransactionCount=0;
  Thread.sleep(sampleRate);
  do {
    now=System.currentTimeMillis();
    if (lastReport <= now) {
      long currentTransactionCount=sync.transactions();
      long diff=currentTransactionCount - previousTransactionCount;
      throughput.report(diff,now - previousReportTime);
      previousReportTime=now;
      previousTransactionCount=currentTransactionCount;
      lastReport=sampleRate + now;
      Thread.sleep(sampleRate);
    }
 else {
      Thread.sleep(10);
    }
  }
 while (now < finishLine);
  if (lastReport < now) {
    long diff=sync.transactions() - previousTransactionCount;
    throughput.report(diff,now - previousReportTime);
  }
  sync.stopAndWaitWorkers();
}
