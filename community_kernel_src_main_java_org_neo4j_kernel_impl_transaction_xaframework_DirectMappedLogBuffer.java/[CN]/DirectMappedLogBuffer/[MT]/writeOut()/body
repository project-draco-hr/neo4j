{
  byteBuffer.flip();
  long expectedEndPosition=bufferStartPosition + byteBuffer.limit();
  long bytesWritten;
  while ((bufferStartPosition+=(bytesWritten=fileChannel.write(byteBuffer,bufferStartPosition))) < expectedEndPosition) {
    if (bytesWritten <= 0) {
      throw new IOException("Unable to write to disk, reported bytes written was " + bytesWritten);
    }
  }
  monitor.bytesWritten(bytesWritten);
  byteBuffer.clear();
}
