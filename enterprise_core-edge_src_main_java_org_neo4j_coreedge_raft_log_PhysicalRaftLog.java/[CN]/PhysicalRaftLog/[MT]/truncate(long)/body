{
  if (fromIndex <= commitIndex) {
    throw new IllegalArgumentException(format("cannot truncate (%d) at or before the commit index (%d)",fromIndex,commitIndex));
  }
  if (appendIndex.get() < fromIndex) {
    throw new IllegalArgumentException("Cannot truncate at index " + fromIndex + " when append index is "+ appendIndex);
  }
  long newAppendIndex=fromIndex - 1;
  long newTerm=readEntryTerm(newAppendIndex);
  entryCache.clear();
  metadataCache.removeUpwardsFrom(fromIndex);
  appendIndex.set(newAppendIndex);
  logRotation.rotateLogFile();
  term=newTerm;
  RaftLogContinuationRecord.write(writer,newAppendIndex - 1,term);
  writer.prepareForFlush().flush();
}
