{
  long lowestLogVersion=logFiles.getLowestLogVersion();
  ReadableLogChannel reader=logFile.getReader(new LogPosition(lowestLogVersion,LogHeader.LOG_HEADER_SIZE));
  try (RaftRecordCursor<ReadableLogChannel> recordCursor=new RaftRecordCursor<>(reader,marshal)){
    while (recordCursor.next()) {
      RaftLogRecord record=recordCursor.get();
switch (record.getType()) {
case COMMIT:
        commitIndex=record.getLogIndex();
      break;
case APPEND:
    appendIndex.set(record.getLogIndex());
  break;
case TRUNCATE:
long truncateAtIndex=record.getLogIndex() - 1;
appendIndex.set(truncateAtIndex);
commitIndex=Math.min(commitIndex,truncateAtIndex);
break;
default :
throw new IllegalStateException("Record is of unknown type " + record);
}
}
}
 log.info("Restored commit index at %d, append index at %d, started at version %d (largest is %d)",commitIndex,appendIndex.get(),lowestLogVersion,logFiles.getHighestLogVersion());
}
