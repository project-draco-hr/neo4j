{
  String filename=new File(directory.directory(),"mapped.file").getAbsolutePath();
  RandomAccessFile file=resources.add(new RandomAccessFile(filename,"rw"));
  StoreChannel channel=new StoreFileChannel(file.getChannel());
  PersistenceRow window=new PersistenceRow(0l,10,channel);
  ConcurrentMap<Long,PersistenceRow> map=mock(ConcurrentMap.class);
  when(map.get(0l)).then(returnNullFirstTimeButAWindowSecondTime(window));
  when(map.putIfAbsent(eq(0l),any(PersistenceRow.class))).thenReturn(window);
  PersistenceWindowPool pool=new PersistenceWindowPool(new File("test.store"),8,channel,0,false,false,map,BrickElementFactory.DEFAULT,StringLogger.DEV_NULL);
  PersistenceWindow acquiredWindow=pool.acquire(0l,OperationType.READ);
  assertEquals(window,acquiredWindow);
  pool.close();
  file.close();
}
