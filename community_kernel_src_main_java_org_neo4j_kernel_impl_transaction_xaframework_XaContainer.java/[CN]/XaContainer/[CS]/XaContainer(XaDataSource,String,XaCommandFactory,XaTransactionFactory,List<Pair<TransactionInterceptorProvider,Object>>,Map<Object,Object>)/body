{
  this.cf=cf;
  this.tf=tf;
  TxIdGenerator txIdFactory=config != null ? (TxIdGenerator)config.get(TxIdGenerator.class) : TxIdGenerator.DEFAULT;
  txIdFactory=txIdFactory != null ? txIdFactory : TxIdGenerator.DEFAULT;
  rm=new XaResourceManager(dataSource,tf,txIdFactory,logicalLog);
  log=providers == null || providers.isEmpty() ? new XaLogicalLog(logicalLog,rm,cf,tf,config) : new InterceptingXaLogicalLog(logicalLog,rm,cf,tf,config,providers);
  rm.setLogicalLog(log);
  tf.setLogicalLog(log);
}
