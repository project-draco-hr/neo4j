{
  this.cf=cf;
  this.tf=tf;
  TxIdGenerator txIdFactory=config != null ? (TxIdGenerator)config.get(TxIdGenerator.class) : TxIdGenerator.DEFAULT;
  txIdFactory=txIdFactory != null ? txIdFactory : TxIdGenerator.DEFAULT;
  AbstractTransactionManager txManager=(AbstractTransactionManager)config.get(TransactionManager.class);
  rm=new XaResourceManager(dataSource,tf,txIdFactory,txManager,logicalLog);
  if ("true".equalsIgnoreCase((String)config.get(Config.INTERCEPT_DESERIALIZED_TRANSACTIONS)) && providers != null) {
    log=new InterceptingXaLogicalLog(logicalLog,rm,cf,tf,config,providers);
  }
 else {
    log=new XaLogicalLog(logicalLog,rm,cf,tf,config);
  }
  rm.setLogicalLog(log);
  tf.setLogicalLog(log);
}
