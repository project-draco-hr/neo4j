{
  db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabase();
  DependencyResolver resolver=db.getDependencyResolver();
  @SuppressWarnings("deprecation") NeoStoreXaDataSource neoStoreDataSource=resolver.resolveDependency(XaDataSourceManager.class).getNeoStoreDataSource();
  StoreKernelTransaction txContext=new StoreKernelTransaction(resolver.resolveDependency(AbstractTransactionManager.class),resolver.resolveDependency(PersistenceManager.class),resolver.resolveDependency(PropertyKeyTokenHolder.class),resolver.resolveDependency(LabelTokenHolder.class),neoStoreDataSource.getNeoStore(),resolver.resolveDependency(IndexingService.class));
  statement=txContext.newStatementOperations().asStatementOperations();
  state=txContext.newStatementState();
}
