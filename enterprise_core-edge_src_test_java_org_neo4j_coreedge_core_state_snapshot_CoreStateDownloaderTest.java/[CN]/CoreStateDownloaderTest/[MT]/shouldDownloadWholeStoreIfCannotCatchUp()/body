{
  when(localDatabase.isEmpty()).thenReturn(false);
  when(storeFetcher.getStoreIdOf(remoteMember)).thenReturn(storeId);
  when(storeFetcher.tryCatchingUp(remoteMember,storeId,storeDir)).thenReturn(E_TRANSACTION_PRUNED);
  downloader.downloadSnapshot(remoteMember,coreState);
  verify(storeFetcher).tryCatchingUp(remoteMember,storeId,storeDir);
  verify(storeFetcher).copyStore(remoteMember,storeId,tempDir);
  verify(localDatabase).replaceWith(tempDir);
}
