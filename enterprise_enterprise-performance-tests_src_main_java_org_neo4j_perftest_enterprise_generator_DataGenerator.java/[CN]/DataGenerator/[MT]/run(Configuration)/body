{
  File storeDir=new File(configuration.get(store_dir));
  FileUtils.deleteRecursively(storeDir);
  DataGenerator generator=new DataGenerator(configuration);
  Map<String,String> config=batchInserterConfig(configuration);
  BatchInserter batchInserter=BatchInserters.inserter(storeDir.getAbsoluteFile(),new DefaultFileSystemAbstraction(),config);
  try {
    generator.generateData(batchInserter);
  }
  finally {
    batchInserter.shutdown();
  }
  ConfiguringPageCacheFactory pageCacheFactory=new ConfiguringPageCacheFactory(new DefaultFileSystemAbstraction(),new Config(config),PageCacheTracer.NULL);
  PageCache pageCache=pageCacheFactory.getOrCreatePageCache();
  StoreAccess stores=new StoreAccess(pageCache,storeDir);
  try {
    printCount(stores.getNodeStore());
    printCount(stores.getRelationshipStore());
    printCount(stores.getPropertyStore());
    printCount(stores.getStringStore());
    printCount(stores.getArrayStore());
    if (configuration.get(report_stats)) {
      PropertyStats stats=new PropertyStats();
      stats.applyFiltered(stores.getPropertyStore(),RecordStore.IN_USE);
      System.out.println(stats);
    }
  }
  finally {
    stores.close();
    pageCache.flushAndForce();
    pageCache.close();
  }
}
