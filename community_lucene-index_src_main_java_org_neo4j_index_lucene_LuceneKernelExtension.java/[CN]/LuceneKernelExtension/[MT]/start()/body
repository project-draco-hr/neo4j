{
  LuceneDataSource luceneDataSource=new LuceneDataSource(config,indexStore,fileSystemAbstraction,xaFactory,txIdGenerator,logging);
  xaDataSourceManager.registerDataSource(luceneDataSource);
  IndexConnectionBroker<LuceneXaConnection> broker=config.get(Configuration.read_only) ? new ReadOnlyIndexConnectionBroker<LuceneXaConnection>(txManager) : new ConnectionBroker(txManager,luceneDataSource);
  LuceneIndexImplementation indexImplementation=new LuceneIndexImplementation(gdb,luceneDataSource,broker);
  indexProviders.registerIndexProvider(LuceneIndexImplementation.SERVICE_NAME,indexImplementation);
}
