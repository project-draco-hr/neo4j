{
  boolean fail=false;
  if (!rel.inUse()) {
    RelationshipRecord old=rels.forceGetRaw(rel);
    if (old.inUse()) {
      for (      RelationshipChainField field : relFields) {
        long otherId=field.relOf(old);
        if (otherId == field.none) {
          Long nodeId=field.nodeOf(old);
          if (nodeId != null) {
            NodeRecord node=nodes.forceGetRecord(nodeId);
            if (node.inUse() && node.getNextRel() == old.getId())             fail|=report.inconsistent(rels,rel,nodes,node,REMOVED_RELATIONSHIP_STILL_REFERENCED);
          }
        }
 else {
          RelationshipRecord other=rels.forceGetRecord(otherId);
          if (other.inUse() && field.invConsistent(old,other))           fail|=report.inconsistent(rels,rel,other,REMOVED_RELATIONSHIP_STILL_REFERENCED);
        }
      }
      fail|=checkPropertyReference(rel,rels,new PropertyOwner.OwningRelationship(rel.getId()));
    }
    return fail;
  }
  if (rel.getType() < 0)   fail|=report.inconsistent(rels,rel,INVALID_TYPE_ID);
 else {
    RelationshipTypeTokenRecord type=relTypes.forceGetRecord(rel.getType());
    if (!type.inUse())     fail|=report.inconsistent(rels,rel,relTypes,type,TYPE_NOT_IN_USE);
  }
  for (  RelationshipChainField field : relFields) {
    long otherId=field.relOf(rel);
    if (otherId == field.none) {
      Long nodeId=field.nodeOf(rel);
      if (nodeId != null) {
        NodeRecord node=nodes.forceGetRecord(nodeId);
        if (!node.inUse() || node.getNextRel() != rel.getId())         fail|=report.inconsistent(rels,rel,nodes,node,field.noBackReference);
      }
    }
 else {
      RelationshipRecord other=rels.forceGetRecord(otherId);
      if (!other.inUse())       fail|=report.inconsistent(rels,rel,other,field.notInUse);
 else       if (!field.invConsistent(rel,other))       fail|=report.inconsistent(rels,rel,other,field.differentChain);
    }
  }
  for (  RelationshipNodeField field : nodeFields) {
    long nodeId=field.get(rel);
    if (nodeId < 0)     fail|=report.inconsistent(rels,rel,field.invalidReference);
 else {
      NodeRecord node=nodes.forceGetRecord(nodeId);
      if (!node.inUse())       fail|=report.inconsistent(rels,rel,nodes,node,field.notInUse);
    }
  }
  fail|=checkPropertyReference(rel,rels,new PropertyOwner.OwningRelationship(rel.getId()));
  return fail;
}
