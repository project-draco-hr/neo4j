{
  Collection<DynamicRecord> beforeRecords=serialize(rule,id,true,true);
  Collection<DynamicRecord> afterRecords=serialize(rule,id,false,false);
  SchemaRuleCommand command=new SchemaRuleCommand();
  command.init(beforeRecords,afterRecords,rule);
  InMemoryLogChannel buffer=new InMemoryLogChannel();
  when(neoStore.getSchemaStore()).thenReturn(store);
  new CommandWriter(buffer).visitSchemaRuleCommand(command);
  Command readCommand=reader.read(buffer);
  assertThat(readCommand,instanceOf(SchemaRuleCommand.class));
  assertSchemaRule((SchemaRuleCommand)readCommand);
}
