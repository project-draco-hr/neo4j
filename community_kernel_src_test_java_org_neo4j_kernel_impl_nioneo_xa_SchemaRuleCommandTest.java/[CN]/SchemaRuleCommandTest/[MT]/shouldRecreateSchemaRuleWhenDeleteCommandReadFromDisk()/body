{
  Collection<DynamicRecord> beforeRecords=serialize(rule,id,true,true);
  Collection<DynamicRecord> afterRecords=serialize(rule,id,false,false);
  SchemaRuleCommand command=new SchemaRuleCommand();
  command.init(beforeRecords,afterRecords,rule,txId);
  InMemoryLogBuffer buffer=new InMemoryLogBuffer();
  when(neoStore.getSchemaStore()).thenReturn(store);
  writer.write(command,buffer);
  XaCommand readCommand=reader.read(buffer);
  assertThat(readCommand,instanceOf(SchemaRuleCommand.class));
  SchemaRuleCommand readSchemaCommand=(SchemaRuleCommand)readCommand;
  assertThat(readSchemaCommand.getTxId(),equalTo(txId));
  assertThat(readSchemaCommand.getSchemaRule(),equalTo((SchemaRule)rule));
}
