{
  ProgressMonitorFactory.MultiPartBuilder progressBuilder=mock(ProgressMonitorFactory.MultiPartBuilder.class);
  ProgressListener progressListener=mock(ProgressListener.class);
  when(progressBuilder.progressForPart(anyString(),anyLong())).thenReturn(progressListener);
  @SuppressWarnings("unchecked") BoundedIterable<Integer> store=mock(BoundedIterable.class);
  when(store.iterator()).thenReturn(asList(42,75,192).iterator());
  @SuppressWarnings("unchecked") RecordProcessor<Integer> recordProcessor=mock(RecordProcessor.class);
  RecordScanner scanner=new RecordScanner<>(store,"our test task",progressBuilder,recordProcessor);
  scanner.run();
  verify(recordProcessor).process(42);
  verify(recordProcessor).process(75);
  verify(recordProcessor).process(192);
  verify(recordProcessor).close();
  verify(store).close();
  verify(progressListener).set(0);
  verify(progressListener).set(1);
  verify(progressListener).set(2);
  verify(progressListener).done();
}
