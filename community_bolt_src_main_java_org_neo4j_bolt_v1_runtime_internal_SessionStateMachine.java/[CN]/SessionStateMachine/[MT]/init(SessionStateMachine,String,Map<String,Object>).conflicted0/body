{
  try {
    AuthenticationResult authResult=ctx.spi.authenticate(authToken);
    ctx.authSubject=authResult.getAuthSubject();
    ctx.credentialsExpired=authResult.credentialsExpired();
    ctx.result(authResult.credentialsExpired());
    ctx.spi.udcRegisterClient(clientName);
    ctx.setQuerySourceFromClientNameAndPrincipal(clientName,authToken.get(AuthToken.PRINCIPAL));
    return IDLE;
  }
 catch (  AuthenticationException e) {
    return error(ctx,new Neo4jError(e.status(),e.getMessage(),e));
  }
catch (  Throwable e) {
    return error(ctx,e);
  }
}
