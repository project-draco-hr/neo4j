{
  try {
    AuthenticationResult authResult=ctx.spi.authenticate(authToken);
    ctx.accessMode=authResult.getAccessMode();
    ctx.credentialsExpired=authResult.credentialsExpired();
    ctx.result(authResult.credentialsExpired());
    ctx.spi.udcRegisterClient(clientName);
    ctx.setQuerySourceFromClientNameAndPrincipal(clientName,authToken.get(Authentication.PRINCIPAL));
    return IDLE;
  }
 catch (  AuthenticationException e) {
    ctx.error(new Neo4jError(e.status(),e.getMessage()));
    return AUTH_FAILURE;
  }
catch (  Throwable e) {
    ctx.error(new Neo4jError(Status.General.UnknownError,e.getMessage()));
    return halt(ctx);
  }
}
