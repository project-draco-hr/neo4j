{
  ClassLoader contextClassLoader=Thread.currentThread().getContextClassLoader();
  try {
    if (mainMethod == null) {
      luceneLoader=jarLoaderSupplier.get();
      Thread.currentThread().setContextClassLoader(luceneLoader.getJarsClassLoader());
      Class<?> upgrader=luceneLoader.loadEmbeddedClass(LUCENE_INDEX_UPGRADER_CLASS_NAME);
      MethodHandles.Lookup lookup=MethodHandles.lookup();
      mainMethod=lookup.findStatic(upgrader,"main",MethodType.methodType(void.class,String[].class));
    }
    mainMethod.invokeExact(new String[]{indexPath.toString()});
  }
  finally {
    Thread.currentThread().setContextClassLoader(contextClassLoader);
  }
}
