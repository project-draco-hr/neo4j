{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().setFileSystem(fileSystem).newImpermanentDatabase(storeDir);
  for (int i=0; i < 4; i++) {
    Transaction tx=db.beginTx();
    db.createNode();
    tx.success();
    tx.finish();
  }
  db.shutdown();
  final AtomicInteger brokenTxIdentifier=new AtomicInteger();
  LogHookAdapter<LogEntry> filter=new LogTestUtils.LogHookAdapter<LogEntry>(){
    int doneRecordCount=0;
    @Override public boolean accept(    LogEntry item){
      if (item instanceof LogEntry.Done) {
        doneRecordCount++;
        if (doneRecordCount == 2) {
          brokenTxIdentifier.set(item.getIdentifier());
          return false;
        }
      }
      return true;
    }
  }
;
  File brokenLogFile=filterNeostoreLogicalLog(fileSystem,new File(storeDir,"nioneo_logical.log.v0"),filter);
  return Pair.of(brokenLogFile,brokenTxIdentifier.get());
}
