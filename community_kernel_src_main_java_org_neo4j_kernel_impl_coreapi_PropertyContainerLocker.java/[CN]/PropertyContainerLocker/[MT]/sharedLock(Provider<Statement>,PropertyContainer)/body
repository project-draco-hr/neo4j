{
  try (Statement statement=stmtProvider.instance()){
    if (container instanceof Node) {
      statement.readOperations().acquireShared(ResourceTypes.NODE,((Node)container).getId());
      return new CoreAPILock(stmtProvider,ResourceTypes.NODE,((Node)container).getId()){
        @Override void release(        Statement statement,        Locks.ResourceType type,        long resourceId){
          statement.readOperations().releaseShared(type,resourceId);
        }
      }
;
    }
 else     if (container instanceof Relationship) {
      statement.readOperations().acquireShared(ResourceTypes.RELATIONSHIP,((Relationship)container).getId());
      return new CoreAPILock(stmtProvider,ResourceTypes.RELATIONSHIP,((Node)container).getId()){
        @Override void release(        Statement statement,        Locks.ResourceType type,        long resourceId){
          statement.readOperations().releaseShared(type,resourceId);
        }
      }
;
    }
 else {
      throw new UnsupportedOperationException("Only relationships and nodes can be locked.");
    }
  }
 }
