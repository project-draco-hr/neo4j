{
switch (mode) {
case MISMATCH:
    long logIndex=max(min(lastSentIndex - 1,lastRemoteAppendIndex),0);
  sendSingle(logIndex,leaderContext);
break;
case PIPELINE:
case CATCHUP:
log.info("%s: mismatch in mode %s from follower %s, moving to MISMATCH mode",statusAsString(),mode,follower);
mode=Mode.MISMATCH;
sendSingle(lastSentIndex,leaderContext);
break;
default :
throw new IllegalStateException("Unknown mode: " + mode);
}
lastLeaderContext=leaderContext;
}
