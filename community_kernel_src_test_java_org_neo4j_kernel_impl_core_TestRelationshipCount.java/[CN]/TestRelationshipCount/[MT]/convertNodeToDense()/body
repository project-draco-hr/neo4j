{
  Node node=getGraphDb().createNode();
  EnumMap<MyRelTypes,Set<Relationship>> rels=new EnumMap<>(MyRelTypes.class);
  for (  MyRelTypes type : MyRelTypes.values()) {
    rels.put(type,new HashSet<Relationship>());
  }
  int expectedRelCount=0;
  for (int i=0; i < 6; i++, expectedRelCount++) {
    MyRelTypes type=MyRelTypes.values()[i % MyRelTypes.values().length];
    Relationship rel=node.createRelationshipTo(getGraphDb().createNode(),type);
    rels.get(type).add(rel);
  }
  newTransaction();
  for (int i=0; i < 1000; i++, expectedRelCount++) {
    node.createRelationshipTo(getGraphDb().createNode(),MyRelTypes.TEST);
  }
  clearCache();
  assertEquals(expectedRelCount,node.getDegree());
  assertEquals(expectedRelCount,node.getDegree(Direction.BOTH));
  assertEquals(expectedRelCount,node.getDegree(Direction.OUTGOING));
  assertEquals(0,node.getDegree(Direction.INCOMING));
  assertEquals(rels.get(MyRelTypes.TEST2),asSet(node.getRelationships(MyRelTypes.TEST2)));
  assertEquals(join(rels.get(MyRelTypes.TEST_TRAVERSAL),rels.get(MyRelTypes.TEST2)),asSet(node.getRelationships(MyRelTypes.TEST_TRAVERSAL,MyRelTypes.TEST2)));
}
