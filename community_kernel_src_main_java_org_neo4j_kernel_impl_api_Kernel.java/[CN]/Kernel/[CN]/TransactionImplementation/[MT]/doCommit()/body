{
  try {
    boolean success=false;
    try {
      try {
        createTransactionCommands();
      }
 catch (      RuntimeException e) {
        transactionManager.rollback();
        throw new TransactionForcefullyRolledBackException(e);
      }
      transactionManager.commit();
      success=true;
    }
  finally {
      if (!success) {
        dropCreatedConstraintIndexes();
      }
    }
    if (hasTxStateWithChanges()) {
      persistenceCache.apply(this.txState());
    }
  }
 catch (  HeuristicMixedException e) {
    throw new TransactionFailureException(e);
  }
catch (  HeuristicRollbackException e) {
    throw new TransactionFailureException(e);
  }
catch (  RollbackException e) {
    throw new TransactionFailureException(e);
  }
catch (  SystemException e) {
    throw new TransactionFailureException(e);
  }
 finally {
    try {
      lockHolder.releaseLocks();
    }
 catch (    ReleaseLocksFailedKernelException e) {
      throw new TransactionFailureException(new RuntimeException(e.getMessage(),e));
    }
  }
}
