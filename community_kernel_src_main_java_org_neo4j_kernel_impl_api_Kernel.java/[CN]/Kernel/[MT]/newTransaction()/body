{
  checkIfShutdown();
  StoreTransactionContext storeTransactionContext=new StoreTransactionContext(transactionManager,persistenceManager,propertyKeyTokenHolder,labelTokenHolder,neoStore,indexService);
  KernelTransaction result=new StateHandlingTransactionContext(storeTransactionContext,new SchemaStorage(neoStore.getSchemaStore()),newTxState(),providerMap,persistenceCache,schemaCache,persistenceManager,schemaState,new ConstraintIndexCreator(new Transactor(transactionManager),indexService),propertyKeyTokenHolder,nodeManager);
  result=new ConstraintValidatingTransactionContext(result);
  result=new LockingTransactionContext(result,lockManager,transactionManager,nodeManager);
  if (highlyAvailableInstance) {
    result=new UniquenessConstraintStoppingTransactionContext(result);
  }
  result=new ReferenceCountingTransactionContext(result,statementLogic != null ? statementLogic.lifecycleOperations() : null);
  return result;
}
