{
  nodeManager=dependencyResolver.resolveDependency(NodeManager.class);
  dataSourceManager.addDataSourceRegistrationListener(neoStoreListener(new DataSourceRegistrationListener(){
    @Override public void registeredDataSource(    XaDataSource ds){
      NeoStoreXaDataSource neoDataSource=(NeoStoreXaDataSource)ds;
      neoStore=neoDataSource.getNeoStore();
      indexService=neoDataSource.getIndexService();
      labelScanStore=neoDataSource.getLabelScanStore();
      providerMap=neoDataSource.getProviderMap();
      persistenceCache=neoDataSource.getPersistenceCache();
      schemaCache=neoDataSource.getSchemaCache();
      for (      SchemaRule schemaRule : loop(neoStore.getSchemaStore().loadAllSchemaRules())) {
        schemaCache.addSchemaRule(schemaRule);
      }
    }
    @Override public void unregisteredDataSource(    XaDataSource ds){
      neoStore=null;
    }
  }
));
}
