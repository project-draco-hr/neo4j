{
  AbstractTransactionManager txManager=mock(AbstractTransactionManager.class);
  javax.transaction.Transaction existingTransaction=mock(javax.transaction.Transaction.class);
  when(txManager.suspend()).thenReturn(existingTransaction);
  StatementOperationParts operations=mock(StatementOperationParts.class);
  Statement statement=mock(Statement.class);
  StubKernelTransaction kernelTransaction=spy(new StubKernelTransaction(operations,statement));
  when(txManager.getKernelTransaction()).thenReturn(kernelTransaction);
  @SuppressWarnings("unchecked") Transactor.Work<Object,KernelException> work=mock(Transactor.Work.class);
  Object expectedResult=new Object();
  when(work.perform(eq(operations),any(Statement.class))).thenReturn(expectedResult);
  Transactor transactor=new Transactor(txManager);
  Object result=transactor.execute(work);
  assertEquals(expectedResult,result);
  InOrder order=inOrder(txManager,kernelTransaction,statement,work);
  order.verify(txManager).suspend();
  order.verify(txManager).begin();
  order.verify(txManager).getKernelTransaction();
  order.verify(kernelTransaction).newStatement();
  order.verify(work).perform(operations,statement);
  order.verify(statement).close();
  order.verify(kernelTransaction).commit();
  order.verify(txManager).resume(existingTransaction);
  order.verifyNoMoreInteractions();
}
