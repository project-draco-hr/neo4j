{
  AbstractTransactionManager txManager=mock(AbstractTransactionManager.class);
  Transaction existingTransaction=mock(Transaction.class);
  when(txManager.suspend()).thenReturn(existingTransaction);
  TransactionContext txContext=mock(TransactionContext.class);
  when(txManager.getTransactionContext()).thenReturn(txContext);
  StatementContextParts stmtContext=mockedParts(txContext);
  @SuppressWarnings("unchecked") Transactor.Statement<Object,KernelException> statement=mock(Transactor.Statement.class);
  Object expectedResult=new Object();
  when(statement.perform(stmtContext)).thenReturn(expectedResult);
  Transactor transactor=new Transactor(txManager);
  Object result=transactor.execute(statement);
  assertEquals(expectedResult,result);
  InOrder order=inOrder(txManager,txContext,stmtContext.lifecycleOperations(),statement);
  order.verify(txManager).suspend();
  order.verify(txManager).begin();
  order.verify(txManager).getTransactionContext();
  order.verify(txContext).newStatementContext();
  order.verify(statement).perform(stmtContext);
  order.verify(stmtContext.lifecycleOperations()).close();
  order.verify(txContext).commit();
  order.verify(txManager).resume(existingTransaction);
  order.verifyNoMoreInteractions();
}
