{
  if (onePhase) {
    txStatus.markAsPrepared();
  }
  if (!txStatus.prepared() || txStatus.rollback()) {
    throw new XAException("Transaction not prepared or " + "(marked as) rolledbacked");
  }
  if (!xaTransaction.isRecovered()) {
    log.forget(xaTransaction.getIdentifier());
  }
  xidMap.remove(xid);
  if (xaTransaction.isRecovered()) {
    recoveredTxCount--;
    checkIfRecoveryComplete();
  }
}
