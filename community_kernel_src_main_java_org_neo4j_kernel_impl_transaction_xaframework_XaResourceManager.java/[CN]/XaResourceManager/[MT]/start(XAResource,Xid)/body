{
  ResourceTransaction tx=xaResourceMap.get(xaResource);
  if (tx == null) {
    createTransaction(xaResource);
    tx=xaResourceMap.get(xaResource);
  }
  if (xidMap.get(xid) == null) {
    int identifier=log.start(xid,txIdGenerator.getCurrentMasterId(),txIdGenerator.getMyId(),dataSource.getLastCommittedTxId());
    tx.xaTx.setIdentifier(identifier);
    xidMap.put(xid,new XidStatus(tx.xaTx));
    tx.xid=xid;
  }
}
