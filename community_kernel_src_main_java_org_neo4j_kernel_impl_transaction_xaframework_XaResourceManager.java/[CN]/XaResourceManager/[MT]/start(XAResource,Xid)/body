{
  if (xaResourceMap.get(xaResource) != null) {
    throw new XAException("Resource[" + xaResource + "] already enlisted or suspended");
  }
  xaResourceMap.put(xaResource,xid);
  if (xidMap.get(xid) == null) {
    int identifier=log.start(xid,txIdGenerator.getCurrentMasterId(),txIdGenerator.getMyId(),dataSource.getLastCommittedTxId());
    XaTransaction xaTx=tf.create(identifier,dataSource.getLastCommittedTxId(),transactionManager.getTransactionState());
    xidMap.put(xid,new XidStatus(xaTx));
  }
}
