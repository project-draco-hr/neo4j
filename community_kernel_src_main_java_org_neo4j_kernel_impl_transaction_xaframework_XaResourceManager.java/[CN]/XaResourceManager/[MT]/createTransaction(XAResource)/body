{
  XaTransaction xaTx=tf.create(dataSource.getLastCommittedTxId(),transactionManager.getTransactionState());
  if (xaResourceMap.putIfAbsent(xaResource,new ResourceTransaction(xaTx)) != null) {
    throw new XAException("Resource[" + xaResource + "] already enlisted or suspended");
  }
  return xaTx;
}
