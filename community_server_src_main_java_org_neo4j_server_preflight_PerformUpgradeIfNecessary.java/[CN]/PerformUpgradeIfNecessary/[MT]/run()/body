{
  try {
    String dbLocation=new File(config.getString(Configurator.DATABASE_LOCATION_PROPERTY_KEY)).getAbsolutePath();
    if (new CurrentDatabase(new StoreVersionCheck(new DefaultFileSystemAbstraction())).storeFilesAtCurrentVersion(new File(dbLocation))) {
      return true;
    }
    File store=new File(dbLocation,NeoStore.DEFAULT_NAME);
    dbConfig.put("store_dir",dbLocation);
    dbConfig.put("neo_store",store.getPath());
    FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();
    UpgradableDatabase upgradableDatabase=new UpgradableDatabase(new StoreVersionCheck(fileSystem));
    if (!upgradableDatabase.storeFilesUpgradeable(store)) {
      return true;
    }
    Config conf=new Config(dbConfig,GraphDatabaseSettings.class);
    StoreUpgrader storeUpgrader=new StoreUpgrader(conf,new ConfigMapUpgradeConfiguration(conf),upgradableDatabase,new StoreMigrator(new VisibleMigrationProgressMonitor(StringLogger.DEV_NULL,out)),new DatabaseFiles(fileSystem),new DefaultIdGeneratorFactory(),fileSystem);
    try {
      storeUpgrader.attemptUpgrade(store);
    }
 catch (    UpgradeNotAllowedByConfigurationException e) {
      log.log(e.getMessage());
      out.println(e.getMessage());
      failureMessage=e.getMessage();
      return false;
    }
catch (    StoreUpgrader.UnableToUpgradeException e) {
      log.error("Unable to upgrade store",e);
      return false;
    }
    return true;
  }
 catch (  Exception e) {
    log.error("Unknown error",e);
    return false;
  }
}
