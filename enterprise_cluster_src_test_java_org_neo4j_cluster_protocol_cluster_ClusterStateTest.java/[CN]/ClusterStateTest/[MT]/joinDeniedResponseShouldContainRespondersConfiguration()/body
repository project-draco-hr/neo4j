{
  ClusterContext context=mock(ClusterContext.class);
  Map<InstanceId,URI> existingMembers=members(1,2);
  when(context.isCurrentlyAlive(any(InstanceId.class))).thenReturn(true);
  when(context.getMembers()).thenReturn(existingMembers);
  when(context.getConfiguration()).thenReturn(clusterConfiguration(existingMembers));
  when(context.getLog(any(Class.class))).thenReturn(NullLog.getInstance());
  TrackingMessageHolder outgoing=new TrackingMessageHolder();
  Message<ClusterMessage> message=to(configurationRequest,uri(1),configuration(2)).setHeader(Message.FROM,uri(2).toString());
  ClusterState.entered.handle(context,message,outgoing);
  Message<ClusterMessage> response=outgoing.single();
  assertTrue(response.getPayload() instanceof ConfigurationResponseState);
  ConfigurationResponseState responseState=response.getPayload();
  assertEquals(existingMembers,responseState.getMembers());
}
