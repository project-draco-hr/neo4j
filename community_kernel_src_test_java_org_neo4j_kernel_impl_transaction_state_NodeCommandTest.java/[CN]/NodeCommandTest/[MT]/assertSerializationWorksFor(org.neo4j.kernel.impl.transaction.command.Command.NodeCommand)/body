{
  channel.reset();
  cmd.serialize(channel);
  Command.NodeCommand result=(Command.NodeCommand)commandReader.read(channel);
  assertThat(result,equalTo(cmd));
  assertThat(result.getMode(),equalTo(cmd.getMode()));
  assertThat(result.getBefore(),equalTo(cmd.getBefore()));
  assertThat(result.getAfter(),equalTo(cmd.getAfter()));
  assertThat(result.getBefore().isCreated(),equalTo(cmd.getBefore().isCreated()));
  assertThat(result.getAfter().isCreated(),equalTo(cmd.getAfter().isCreated()));
  assertThat(result.getBefore().isDense(),equalTo(cmd.getBefore().isDense()));
  assertThat(result.getAfter().isDense(),equalTo(cmd.getAfter().isDense()));
  assertThat(labels(result.getBefore()),equalTo(labels(cmd.getBefore())));
  assertThat(labels(result.getAfter()),equalTo(labels(cmd.getAfter())));
  assertThat(result.getBefore().getDynamicLabelRecords(),equalTo(cmd.getBefore().getDynamicLabelRecords()));
  assertThat(result.getAfter().getDynamicLabelRecords(),equalTo(cmd.getAfter().getDynamicLabelRecords()));
  assertThat(result.getBefore().requiresSecondaryUnit(),equalTo(cmd.getBefore().requiresSecondaryUnit()));
  assertThat(result.getBefore().hasSecondaryUnitId(),equalTo(cmd.getBefore().hasSecondaryUnitId()));
  assertThat(result.getBefore().getSecondaryUnitId(),equalTo(cmd.getBefore().getSecondaryUnitId()));
  assertThat(result.getAfter().requiresSecondaryUnit(),equalTo(cmd.getAfter().requiresSecondaryUnit()));
  assertThat(result.getAfter().hasSecondaryUnitId(),equalTo(cmd.getAfter().hasSecondaryUnitId()));
  assertThat(result.getAfter().getSecondaryUnitId(),equalTo(cmd.getAfter().getSecondaryUnitId()));
}
