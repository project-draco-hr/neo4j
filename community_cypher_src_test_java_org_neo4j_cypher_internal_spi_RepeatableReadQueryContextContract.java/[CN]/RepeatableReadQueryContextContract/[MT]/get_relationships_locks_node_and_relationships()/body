{
  RepeatableReadQueryContext lockingContext=new RepeatableReadQueryContext(innerContext,locker);
  Iterable<Relationship> rels=lockingContext.getRelationshipsFor(node,Direction.OUTGOING);
  int count_the_matching_rows=count(rels);
  lockingContext.close();
  verify(locker).readLock(node);
  for (  Relationship rel : rels) {
    verify(locker).readLock(rel);
  }
  verify(locker).releaseAllReadLocks();
  assertThat(count_the_matching_rows,is(2));
}
