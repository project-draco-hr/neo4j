{
  RelationshipRecord relRecord=getRelationshipRecord(relId);
  if (relRecord == null) {
    relRecord=getRelationshipStore().getRecord(relId);
  }
  if (!relRecord.inUse()) {
    throw new IllegalStateException("Property remove on relationship[" + relId + "] illegal since it has been deleted.");
  }
  PropertyRecord propRecord=getPropertyRecord(propertyId);
  if (propRecord == null) {
    propRecord=getPropertyStore().getRecord(propertyId);
    addPropertyRecord(propRecord);
  }
  propRecord.setRelId(relId);
  if (propRecord.isLight()) {
    getPropertyStore().makeHeavy(propRecord);
  }
  propRecord.setInUse(false);
  for (  DynamicRecord valueRecord : propRecord.getValueRecords()) {
    if (valueRecord.inUse()) {
      valueRecord.setInUse(false,propRecord.getType().intValue());
    }
  }
  int prevProp=propRecord.getPrevProp();
  int nextProp=propRecord.getNextProp();
  if (relRecord.getNextProp() == propertyId) {
    relRecord.setNextProp(nextProp);
    addRelationshipRecord(relRecord);
  }
  if (prevProp != Record.NO_PREVIOUS_PROPERTY.intValue()) {
    PropertyRecord prevPropRecord=getPropertyRecord(prevProp);
    if (prevPropRecord == null) {
      prevPropRecord=getPropertyStore().getLightRecord(prevProp);
      addPropertyRecord(prevPropRecord);
    }
    prevPropRecord.setNextProp(nextProp);
  }
  if (nextProp != Record.NO_NEXT_PROPERTY.intValue()) {
    PropertyRecord nextPropRecord=getPropertyRecord(nextProp);
    if (nextPropRecord == null) {
      nextPropRecord=getPropertyStore().getLightRecord(nextProp);
      addPropertyRecord(nextPropRecord);
    }
    nextPropRecord.setPrevProp(prevProp);
  }
}
