{
  NodeRecord nodeRecord=getNodeRecord(nodeId);
  if (nodeRecord == null) {
    nodeRecord=getNodeStore().getRecord(nodeId);
  }
 else   if (!nodeRecord.inUse()) {
    throw new StoreFailureException("Node[" + nodeId + "] not in use");
  }
  int nextProp=nodeRecord.getNextProp();
  List<PropertyData> properties=new ArrayList<PropertyData>();
  while (nextProp != Record.NO_NEXT_PROPERTY.intValue()) {
    PropertyRecord propRecord=getPropertyRecord(nextProp);
    if (propRecord == null) {
      propRecord=getPropertyStore().getLightRecord(nextProp);
    }
    properties.add(new PropertyData(propRecord.getId(),propRecord.getKeyIndexId(),propertyGetValueOrNull(propRecord)));
    nextProp=propRecord.getNextProp();
  }
  return properties.toArray(new PropertyData[properties.size()]);
}
