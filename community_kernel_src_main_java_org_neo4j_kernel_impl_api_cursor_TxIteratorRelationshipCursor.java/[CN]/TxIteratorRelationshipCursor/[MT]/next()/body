{
  if (added == null) {
    while (cursor.next()) {
      long id=cursor.getId();
      if (state.relationshipIsDeletedInThisTx(id)) {
        continue;
      }
      visit(id,cursor.getType(),cursor.getStartNode(),cursor.getEndNode());
      relationshipState=state.getRelationshipState(cursor.getId());
      return true;
    }
    added=addedRelationshipIterator;
    relationshipIsAddedInThisTx=true;
  }
  if (added.hasNext()) {
    relationshipState=state.getRelationshipState(added.next());
    relationshipState.accept(this);
    return true;
  }
 else {
    visit(-1,-1,-1,-1);
    relationshipState=null;
    return false;
  }
}
