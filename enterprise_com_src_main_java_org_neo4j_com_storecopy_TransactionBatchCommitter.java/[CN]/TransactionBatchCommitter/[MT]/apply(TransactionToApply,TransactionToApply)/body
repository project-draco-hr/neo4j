{
  if (batchSizeExceedsSafeZone(first,last)) {
    kernelTransactions.blockNewTransactions();
    try {
      markUnsafeTransactionsForTermination(last);
      commit(first);
    }
  finally {
      kernelTransactions.unblockNewTransactions();
    }
  }
 else {
    markUnsafeTransactionsForTermination(last);
    commit(first);
  }
}
