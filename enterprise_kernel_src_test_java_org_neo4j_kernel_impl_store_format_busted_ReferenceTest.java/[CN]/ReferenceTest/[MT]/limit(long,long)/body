{
  boolean positive=true;
  if (reference < 0) {
    positive=false;
    reference=~reference;
  }
  reference&=mask;
  if (!positive) {
    reference=~reference;
  }
  return reference;
}
