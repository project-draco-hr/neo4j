{
  WebServer webServer=mock(WebServer.class);
  CommunityNeoServer neoServer=mock(CommunityNeoServer.class);
  when(neoServer.baseUri()).thenReturn(new URI("http://localhost:7575"));
  when(neoServer.getWebServer()).thenReturn(webServer);
  Database db=mock(Database.class);
  AbstractGraphDatabase graph=mock(AbstractGraphDatabase.class);
  when(db.getGraph()).thenReturn(graph);
  Kernel mockKernel=mock(Kernel.class);
  ObjectName mockObjectName=mock(ObjectName.class);
  when(mockKernel.getMBeanQuery()).thenReturn(mockObjectName);
  DependencyResolver resolver=mock(DependencyResolver.class);
  JmxKernelExtension extension=mock(JmxKernelExtension.class);
  when(graph.getDependencyResolver()).thenReturn(resolver);
  when(resolver.resolveDependency(JmxKernelExtension.class)).thenReturn(extension);
  when(extension.getManagementBeans(Kernel.class)).thenReturn(Collections.singleton(mockKernel));
  when(neoServer.getDatabase()).thenReturn(db);
  when(neoServer.getConfiguration()).thenReturn(new MapConfiguration(new HashMap<Object,Object>()));
  CompositeDataSupport result=mock(CompositeDataSupport.class);
  when(result.get("used")).thenReturn(50L);
  when(result.get("max")).thenReturn(1000L);
  MBeanServer mbeanServer=mock(MBeanServer.class);
  when(mbeanServer.getAttribute(any(ObjectName.class),eq("HeapMemoryUsage"))).thenReturn(result);
  setStaticFinalField(JmxUtils.class.getDeclaredField("mbeanServer"),mbeanServer);
  WebAdminModule module=new WebAdminModule(webServer,neoServer.getConfiguration(),DEV_NULL,db);
  module.start();
  verify(db).setRrdDb(any(RrdDb.class));
}
