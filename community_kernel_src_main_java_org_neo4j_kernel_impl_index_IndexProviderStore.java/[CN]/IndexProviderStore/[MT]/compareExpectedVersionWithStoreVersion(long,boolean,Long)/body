{
  boolean versionDiffers=readIndexVersion == null || readIndexVersion.longValue() != expectedVersion;
  if (versionDiffers) {
    if (readIndexVersion != null && expectedVersion < readIndexVersion.longValue()) {
      String expected=versionLongToString(expectedVersion);
      String readVersion=versionLongToString(readIndexVersion.longValue());
      throw new NotCurrentStoreVersionException(expected,readVersion,"Your index has been upgraded to " + readVersion + " and cannot run with an older version "+ expected,false);
    }
 else     if (!allowUpgrade) {
      throw new UpgradeNotAllowedByConfigurationException();
    }
  }
  if (versionDiffers) {
    writeOut();
  }
}
