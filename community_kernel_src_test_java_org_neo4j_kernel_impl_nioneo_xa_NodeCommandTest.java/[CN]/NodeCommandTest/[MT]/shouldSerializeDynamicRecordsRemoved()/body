{
  NodeRecord before=new NodeRecord(12,1,2);
  before.setInUse(true);
  List<DynamicRecord> beforeDyn=asList(dynamicRecord(0,true,true,-1l,LONG.intValue(),new byte[]{1,2,3,4,5,6,7,8}));
  before.setLabelField(dynamicPointer(beforeDyn),beforeDyn);
  NodeRecord after=new NodeRecord(12,2,1);
  after.setInUse(true);
  List<DynamicRecord> dynamicRecords=asList(dynamicRecord(0,false,true,-1l,LONG.intValue(),new byte[]{1,2,3,4,5,6,7,8}));
  after.setLabelField(dynamicPointer(dynamicRecords),dynamicRecords);
  Command.NodeCommand cmd=new Command.NodeCommand(null,before,after);
  InMemoryLogBuffer buffer=new InMemoryLogBuffer();
  cmd.writeToFile(buffer);
  Command.NodeCommand result=(Command.NodeCommand)readCommand(null,null,buffer,allocate(64));
  assertThat(result,equalTo(cmd));
  assertThat(result.getMode(),equalTo(cmd.getMode()));
  assertThat(result.getBefore(),equalTo(cmd.getBefore()));
  assertThat(result.getAfter(),equalTo(cmd.getAfter()));
  assertThat(result.getBefore().getDynamicLabelRecords(),equalTo(cmd.getBefore().getDynamicLabelRecords()));
  assertThat(result.getAfter().getDynamicLabelRecords(),equalTo(cmd.getAfter().getDynamicLabelRecords()));
}
