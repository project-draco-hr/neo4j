{
  channel.reset();
  cmd.handle(commandWriter);
  Command.NodeCommand result=(Command.NodeCommand)commandReader.read(channel);
  assertThat(result,equalTo(cmd));
  assertThat(result.getMode(),equalTo(cmd.getMode()));
  assertThat(result.getBefore(),equalTo(cmd.getBefore()));
  assertThat(result.getAfter(),equalTo(cmd.getAfter()));
  assertThat(labels(result.getBefore()),equalTo(labels(cmd.getBefore())));
  assertThat(labels(result.getAfter()),equalTo(labels(cmd.getAfter())));
  assertThat(result.getBefore().getDynamicLabelRecords(),equalTo(result.getBefore().getDynamicLabelRecords()));
  assertThat(result.getAfter().getDynamicLabelRecords(),equalTo(result.getAfter().getDynamicLabelRecords()));
}
