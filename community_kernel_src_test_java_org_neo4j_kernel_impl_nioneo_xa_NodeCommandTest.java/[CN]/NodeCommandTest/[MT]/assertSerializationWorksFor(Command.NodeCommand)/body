{
  InMemoryLogBuffer buffer=new InMemoryLogBuffer();
  cmd.writeToFile(buffer);
  Command.NodeCommand result=(Command.NodeCommand)readCommand(null,null,buffer,allocate(64));
  assertThat(result,equalTo(cmd));
  assertThat(result.getMode(),equalTo(cmd.getMode()));
  assertThat(result.getBefore(),equalTo(cmd.getBefore()));
  assertThat(result.getAfter(),equalTo(cmd.getAfter()));
  assertThat(labels(result.getBefore()),equalTo(labels(cmd.getBefore())));
  assertThat(labels(result.getAfter()),equalTo(labels(cmd.getAfter())));
  assertThat(result.getBefore().getDynamicLabelRecords(),equalTo(result.getBefore().getDynamicLabelRecords()));
  assertThat(result.getAfter().getDynamicLabelRecords(),equalTo(result.getAfter().getDynamicLabelRecords()));
}
