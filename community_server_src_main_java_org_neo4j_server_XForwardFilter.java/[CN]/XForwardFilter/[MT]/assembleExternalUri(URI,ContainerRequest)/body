{
  UriBuilder builder=UriBuilder.fromUri(theUri);
  ForwardedHost xForwardedHost=new ForwardedHost(containerRequest.getHeaderValue(X_FORWARD_HOST_HEADER_KEY));
  ForwardedProto xForwardedProto=new ForwardedProto(containerRequest.getHeaderValue(X_FORWARD_PROTO_HEADER_KEY));
  if (xForwardedHost.isValid) {
    builder.host(xForwardedHost.getHost());
    if (xForwardedHost.hasExplicitlySpecifiedPort()) {
      builder.port(xForwardedHost.getPort());
    }
  }
  if (xForwardedProto.isValid()) {
    builder.scheme(xForwardedProto.getScheme());
  }
  return builder.build();
}
