{
  Map<Integer,List<String>> lengthMap=new HashMap<Integer,List<String>>();
  int longest=0;
  for (  String key : data.keySet()) {
    int length=key.length();
    if (length > longest) {
      longest=length;
    }
    List<String> innerList=null;
    Integer innerKey=Integer.valueOf(length);
    if (lengthMap.containsKey(innerKey)) {
      innerList=lengthMap.get(innerKey);
    }
 else {
      innerList=new ArrayList<String>();
      lengthMap.put(innerKey,innerList);
    }
    innerList.add(key);
  }
  String result=templateString;
  for (int i=longest; i >= 0; i--) {
    Integer lengthKey=Integer.valueOf(i);
    if (!lengthMap.containsKey(lengthKey)) {
      continue;
    }
    List<String> list=lengthMap.get(lengthKey);
    for (    String key : list) {
      Object value=data.get(key);
      if (value != null) {
        String replacement=data.get(key).toString();
        String regExpMatchString=variablePrefix + key;
        result=result.replaceAll(regExpMatchString,replacement);
      }
    }
  }
  return result;
}
