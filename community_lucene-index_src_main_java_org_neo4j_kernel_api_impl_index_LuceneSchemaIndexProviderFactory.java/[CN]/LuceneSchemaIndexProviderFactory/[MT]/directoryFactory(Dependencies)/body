{
  FileSystemAbstraction fileSystem=dependencies.getFileSystem();
  if (dependencies.getConfig().get(InternalAbstractGraphDatabase.Configuration.ephemeral)) {
    return fileSystem.getOrCreateThirdPartyFileSystem(DirectoryFactory.class,IN_MEMORY_FACTORY);
  }
 else {
    return fileSystem.getOrCreateThirdPartyFileSystem(DirectoryFactory.class,Functions.<Class<DirectoryFactory>,DirectoryFactory>constant(DirectoryFactory.PERSISTENT));
  }
}
