{
  Iterable<String> propertyKeys;
  try {
    NodeImpl relImpl=nodeManager.getNodeForProxy(nodeId,null);
    propertyKeys=relImpl.getPropertyKeys(nodeManager);
  }
 catch (  IllegalStateException e) {
    throw new EntityNotFoundException("node",nodeId,e);
  }
catch (  NotFoundException e) {
    throw new EntityNotFoundException("node",nodeId,e);
  }
  return map(new Function<String,Property>(){
    @Override public Property apply(    String propertyKey){
      try {
        long propertyKeyId=propertyKeyGetForName(propertyKey);
        return nodeGetProperty(nodeId,propertyKeyId);
      }
 catch (      PropertyKeyNotFoundException e) {
        throw new ThisShouldNotHappenError("Tobias/Stefan","Property key came from the store - should be known.",e);
      }
catch (      PropertyKeyIdNotFoundException e) {
        throw new ThisShouldNotHappenError("Tobias/Stefan","Property key id came from the store - should be known.",e);
      }
catch (      EntityNotFoundException e) {
        throw new ThisShouldNotHappenError("Tobias/Stefan","Node existance already verified.",e);
      }
    }
  }
,propertyKeys).iterator();
}
