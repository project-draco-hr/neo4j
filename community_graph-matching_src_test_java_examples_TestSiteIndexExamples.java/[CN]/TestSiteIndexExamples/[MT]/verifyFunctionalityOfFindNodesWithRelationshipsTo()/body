{
  final RelationshipType type=DynamicRelationshipType.withName("RELATED");
  Node[] nodes=createGraph(new GraphDefinition<Node[]>(){
    public Node[] create(    GraphDatabaseService graphdb){
      Node[] nodes=new Node[5];
      for (int i=0; i < nodes.length; i++) {
        nodes[i]=graphdb.createNode();
      }
      for (int i=0; i < 3; i++) {
        Node node=graphdb.createNode();
        for (int j=0; j < nodes.length; j++) {
          nodes[j].createRelationshipTo(node,type);
        }
      }
      return nodes;
    }
  }
);
  Transaction tx=graphDb.beginTx();
  try {
    assertEquals(3,count(findNodesWithRelationshipsTo(type,nodes)));
    tx.success();
  }
  finally {
    tx.finish();
  }
}
