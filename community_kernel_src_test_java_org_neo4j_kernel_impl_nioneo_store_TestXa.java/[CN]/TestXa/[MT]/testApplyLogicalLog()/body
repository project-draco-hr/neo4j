{
  ds.keepLogicalLogs(true);
  Xid xid=new XidImpl(new byte[1],new byte[1]);
  XAResource xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  long node1=ds.nextId(Node.class);
  xaCon.getWriteTransaction().nodeCreate(node1);
  long node2=ds.nextId(Node.class);
  xaCon.getWriteTransaction().nodeCreate(node2);
  long n1prop1=ds.nextId(PropertyStore.class);
  xaCon.getWriteTransaction().nodeAddProperty(node1,n1prop1,index("prop1"),"string1");
  xaCon.getWriteTransaction().nodeLoadProperties(node1,false);
  int relType1=(int)ds.nextId(RelationshipType.class);
  xaCon.getWriteTransaction().createRelationshipType(relType1,"relationshiptype1");
  long rel1=ds.nextId(Relationship.class);
  xaCon.getWriteTransaction().relationshipCreate(rel1,relType1,node1,node2);
  long r1prop1=ds.nextId(PropertyStore.class);
  xaCon.getWriteTransaction().relAddProperty(rel1,r1prop1,index("prop1"),"string1");
  xaCon.getWriteTransaction().nodeChangeProperty(node1,n1prop1,"string2");
  xaCon.getWriteTransaction().relChangeProperty(rel1,r1prop1,"string2");
  xaCon.getWriteTransaction().nodeRemoveProperty(node1,n1prop1);
  xaCon.getWriteTransaction().relRemoveProperty(rel1,r1prop1);
  xaCon.getWriteTransaction().relDelete(rel1);
  xaCon.getWriteTransaction().nodeDelete(node1);
  xaCon.getWriteTransaction().nodeDelete(node2);
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.commit(xid,true);
  long currentVersion=ds.getCurrentLogVersion();
  ds.keepLogicalLogs(true);
  ds.rotateLogicalLog();
  ds.rotateLogicalLog();
  ds.rotateLogicalLog();
  ds.setCurrentLogVersion(currentVersion);
  ds.setLastCommittedTxId(0);
  ds.makeBackupSlave();
  ds.applyLog(ds.getLogicalLog(currentVersion));
  ds.applyLog(ds.getLogicalLog(currentVersion + 1));
  ds.applyLog(ds.getLogicalLog(currentVersion + 2));
  ds.keepLogicalLogs(false);
}
