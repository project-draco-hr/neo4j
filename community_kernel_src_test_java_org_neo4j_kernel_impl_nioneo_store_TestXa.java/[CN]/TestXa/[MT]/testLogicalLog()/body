{
  Xid xid=new XidImpl(new byte[1],new byte[1]);
  XAResource xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  long node1=ds.getNeoStore().getNodeStore().nextId();
  kernelTransaction.getTransactionRecordState().nodeCreate(node1);
  long node2=ds.getNeoStore().getNodeStore().nextId();
  kernelTransaction.getTransactionRecordState().nodeCreate(node2);
  DefinedProperty n1prop1=kernelTransaction.getTransactionRecordState().nodeAddProperty(node1,index("prop1"),"string1");
  kernelTransaction.getTransactionRecordState().nodeLoadProperties(node1,false,VOID);
  int relType1=(int)ds.getNeoStore().getRelationshipTypeStore().nextId();
  kernelTransaction.getTransactionRecordState().createRelationshipTypeToken(relType1,"relationshiptype1");
  long rel1=ds.getNeoStore().getRelationshipStore().nextId();
  kernelTransaction.getTransactionRecordState().relationshipCreate(rel1,relType1,node1,node2);
  DefinedProperty r1prop1=kernelTransaction.getTransactionRecordState().relAddProperty(rel1,index("prop1"),"string1");
  n1prop1=kernelTransaction.getTransactionRecordState().nodeChangeProperty(node1,n1prop1.propertyKeyId(),"string2");
  r1prop1=kernelTransaction.getTransactionRecordState().relChangeProperty(rel1,r1prop1.propertyKeyId(),"string2");
  kernelTransaction.getTransactionRecordState().nodeRemoveProperty(node1,n1prop1.propertyKeyId());
  kernelTransaction.getTransactionRecordState().relRemoveProperty(rel1,r1prop1.propertyKeyId());
  kernelTransaction.getTransactionRecordState().relDelete(rel1);
  kernelTransaction.getTransactionRecordState().nodeDelete(node1);
  kernelTransaction.getTransactionRecordState().nodeDelete(node2);
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.commit(xid,true);
  Pair<Pair<File,File>,Pair<File,File>> copies=copyLogicalLog(fileSystem,logBaseFileName);
  xaCon.clearAllTransactions();
  ds.stop();
  deleteLogicalLogIfExist();
  renameCopiedLogicalLog(fileSystem,copies);
  ds=newNeoStore();
  xaCon=ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  assertEquals(0,xaRes.recover(XAResource.TMNOFLAGS).length);
  xaCon.clearAllTransactions();
}
