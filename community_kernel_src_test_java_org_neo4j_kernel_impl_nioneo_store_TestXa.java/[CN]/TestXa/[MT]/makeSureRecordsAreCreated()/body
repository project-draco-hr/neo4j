{
  Xid xid=new XidImpl(new byte[2],new byte[2]);
  XAResource xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  long node1=ds.nextId(Node.class);
  xaCon.getWriteTransaction().nodeCreate(node1);
  xaCon.getWriteTransaction().nodeAddProperty(node1,index("prop1"),new long[]{1 << 63,1,1});
  xaCon.getWriteTransaction().nodeAddProperty(node1,index("prop2"),new long[]{1 << 63,1,1});
  PropertyData toRead=xaCon.getWriteTransaction().nodeAddProperty(node1,index("prop3"),new long[]{1 << 63,1,1});
  PropertyData toDelete=xaCon.getWriteTransaction().nodeAddProperty(node1,index("prop4"),new long[]{1 << 63,1,1});
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.commit(xid,true);
  ds.rotateLogicalLog();
  copyLogicalLog(path());
  xaCon.clearAllTransactions();
  ds.close();
  deleteLogicalLogIfExist();
  renameCopiedLogicalLog(path());
  ds=newNeoStore();
  xaCon=(NeoStoreXaConnection)ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  xid=new XidImpl(new byte[2],new byte[2]);
  xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  xaCon.getWriteTransaction().nodeRemoveProperty(node1,toDelete);
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.commit(xid,true);
  ds.rotateLogicalLog();
  copyLogicalLog(path());
  xaCon.clearAllTransactions();
  ds.close();
  deleteLogicalLogIfExist();
  renameCopiedLogicalLog(path());
  ds=newNeoStore();
  xaCon=(NeoStoreXaConnection)ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  xid=new XidImpl(new byte[2],new byte[2]);
  xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  assertTrue(Arrays.equals((long[])toRead.getValue(),(long[])xaCon.getWriteTransaction().nodeLoadProperties(node1,false).get(toRead.getIndex()).getValue()));
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.prepare(xid);
  xaCon.clearAllTransactions();
  ds.close();
  deleteLogicalLogIfExist();
  renameCopiedLogicalLog(path());
}
