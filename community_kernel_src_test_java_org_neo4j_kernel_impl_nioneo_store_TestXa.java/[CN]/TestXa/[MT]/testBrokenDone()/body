{
  Xid xid=new XidImpl(new byte[4],new byte[4]);
  XAResource xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  long node1=ds.nextId(Node.class);
  kernelTransaction.getTransactionRecordState().nodeCreate(node1);
  long node2=ds.nextId(Node.class);
  kernelTransaction.getTransactionRecordState().nodeCreate(node2);
  kernelTransaction.getTransactionRecordState().nodeAddProperty(node1,index("prop1"),"string value 1");
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.prepare(xid);
  xaRes.commit(xid,false);
  copyClearRename(false);
  truncateLogicalLog(318);
  ds=newNeoStore();
  xaCon=ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  assertEquals(1,xaRes.recover(XAResource.TMNOFLAGS).length);
  xaCon.clearAllTransactions();
}
