{
  Xid xid=new XidImpl(new byte[2],new byte[2]);
  XAResource xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  long node1=ds.nextId(Node.class);
  xaCon.getTransaction().nodeCreate(node1);
  DefinedProperty toChange=xaCon.getTransaction().nodeAddProperty(node1,index("prop1"),"hi");
  DefinedProperty toRead=xaCon.getTransaction().nodeAddProperty(node1,index("prop2"),new long[]{1 << 23,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1});
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.prepare(xid);
  ds.rotateLogicalLog();
  copyClearRename();
  ds=newNeoStore();
  xaCon=ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  assertEquals(1,xaRes.recover(XAResource.TMNOFLAGS).length);
  xaRes.commit(xid,true);
  xaCon.clearAllTransactions();
  xid=new XidImpl(new byte[2],new byte[2]);
  xaRes=xaCon.getXaResource();
  xaRes.start(xid,XAResource.TMNOFLAGS);
  xaCon.getTransaction().nodeChangeProperty(node1,toChange.propertyKeyId(),"hI");
  xaRes.end(xid,XAResource.TMSUCCESS);
  xaRes.prepare(xid);
  ds.rotateLogicalLog();
  copyClearRename();
  ds=newNeoStore();
  xaCon=ds.getXaConnection();
  xaRes=xaCon.getXaResource();
  assertEquals(1,xaRes.recover(XAResource.TMNOFLAGS).length);
  xaRes.commit(xid,true);
  xaCon.clearAllTransactions();
  assertTrue(Arrays.equals(new long[]{1 << 23,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},(long[])loadNodeProperty(xaCon.getTransaction(),node1,toRead.propertyKeyId())));
}
