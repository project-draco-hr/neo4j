{
  JMXServiceURL url=null;
  StringLogger logger=kernel.graphDatabase().getDependencyResolver().resolveDependency(Logging.class).getLogger(HotspotManagementSupport.class);
  try {
    Class<?> cal=Class.forName("sun.management.ConnectorAddressLink");
    try {
      Method importRemoteFrom=cal.getMethod("importRemoteFrom",int.class);
      @SuppressWarnings("unchecked") Map<String,String> remote=(Map<String,String>)importRemoteFrom.invoke(null,Integer.valueOf(0));
      url=getUrlFrom(remote);
    }
 catch (    NoSuchMethodException ex) {
    }
    if (url == null) {
      Method importFrom=cal.getMethod("importFrom",int.class);
      url=getUrlFrom((String)importFrom.invoke(null,Integer.valueOf(0)));
    }
  }
 catch (  InvocationTargetException e) {
    logger.warn("Failed to load local JMX connection URL.",e.getTargetException());
  }
catch (  LinkageError e) {
    logger.warn("Failed to load local JMX connection URL.",e);
  }
catch (  Exception e) {
    logger.warn("Failed to load local JMX connection URL.",e);
  }
  if (url == null) {
    String portObj=kernel.getConfig().getParams().get("jmx.port");
    int port=0;
    try {
      port=Integer.parseInt((String)portObj);
    }
 catch (    NumberFormatException ok) {
    }
    if (port > 0) {
      Object useSslObj=kernel.getConfig().getParams().get("jmx.use_ssl");
      boolean useSSL=false;
      if (useSslObj instanceof Boolean) {
        useSSL=((Boolean)useSslObj).booleanValue();
      }
 else       if (useSslObj instanceof String) {
        useSSL=Boolean.parseBoolean((String)useSslObj);
      }
      logger.debug(String.format("Creating new MBean server on port %s%s",new Object[]{Integer.valueOf(port),useSSL ? " using ssl" : ""}));
      JMXConnectorServer server=createServer(port,useSSL,logger);
      if (server != null) {
        try {
          server.start();
        }
 catch (        IOException e) {
          logger.warn("Failed to start MBean server",e);
          server=null;
        }
        if (server != null) {
          try {
            server.getMBeanServer().registerMBean(server,KernelProxy.createObjectName(kernel.instanceId(),"JMX Server"));
          }
 catch (          Exception e) {
            logger.warn("Failed to register MBean server as JMX bean",e);
          }
          url=server.getAddress();
        }
      }
    }
  }
  return url;
}
