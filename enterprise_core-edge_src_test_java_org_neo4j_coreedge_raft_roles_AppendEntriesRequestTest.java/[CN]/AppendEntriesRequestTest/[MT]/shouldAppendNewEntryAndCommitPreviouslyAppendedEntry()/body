{
  InMemoryRaftLog raftLog=new InMemoryRaftLog();
  RaftState<RaftTestMember> state=raftState().entryLog(raftLog).myself(myself).build();
  long leaderTerm=state.term() + leaderTermDifference;
  RaftLogEntry previouslyAppendedEntry=new RaftLogEntry(leaderTerm,content());
  raftLog.append(previouslyAppendedEntry);
  RaftLogEntry newLogEntry=new RaftLogEntry(leaderTerm,content());
  Outcome<RaftTestMember> outcome=role.handler.handle(appendEntriesRequest().from(leader).leaderTerm(leaderTerm).prevLogIndex(raftLog.appendIndex()).prevLogTerm(leaderTerm).logEntry(newLogEntry).leaderCommit(0).build(),state,log());
  assertTrue(((Response)messageFor(outcome,leader)).success());
  assertThat(outcome.getLogCommands(),hasItem(new CommitCommand(0)));
  assertThat(outcome.getLogCommands(),hasItem(new BatchAppendLogEntries(1,0,new RaftLogEntry[]{newLogEntry})));
}
