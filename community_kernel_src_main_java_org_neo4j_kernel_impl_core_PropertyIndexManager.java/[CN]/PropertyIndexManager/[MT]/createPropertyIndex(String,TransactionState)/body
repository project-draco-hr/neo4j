{
  if (state == null) {
    throw new NotInTransactionException("Unable to create property index for " + key);
  }
  PropertyIndex index=state.getPropertyIndex(key);
  if (index != null) {
    return index;
  }
  int id=(int)idGenerator.nextId(PropertyIndex.class);
  index=new PropertyIndex(key,id);
  state.addPropertyIndex(index);
  persistenceManager.createPropertyIndex(key,id);
  return index;
}
