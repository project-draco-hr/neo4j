{
  NodeRecord node=nodeStore.loadRecord(nodeId,null);
  if (node == null) {
    throw new EntityNotFoundException(EntityType.NODE,nodeId);
  }
  if (node.isDense()) {
    long groupId=node.getNextRel();
    while (groupId != Record.NO_NEXT_RELATIONSHIP.intValue()) {
      RelationshipGroupRecord group=relationshipGroupStore.getRecord(groupId);
      if (group.getType() == relType) {
        return (int)nodeDegreeByDirection(nodeId,group,direction);
      }
      groupId=group.getNext();
    }
    return 0;
  }
  return count(nodeListRelationships(statement,nodeId,direction,new int[]{relType}));
}
