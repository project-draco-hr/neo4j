{
  NodeRecord node=nodeStore.loadRecord(nodeId,null);
  if (node == null) {
    throw new EntityNotFoundException(EntityType.NODE,nodeId);
  }
  if (node.isDense()) {
    long groupId=node.getNextRel();
    long count=0;
    while (groupId != Record.NO_NEXT_RELATIONSHIP.intValue()) {
      RelationshipGroupRecord group=relationshipGroupStore.getRecord(groupId);
      count+=countByFirstPrevPointer(nodeId,group.getFirstLoop());
switch (direction) {
case OUTGOING:
        count+=countByFirstPrevPointer(nodeId,group.getFirstOut());
      break;
case INCOMING:
    count+=countByFirstPrevPointer(nodeId,group.getFirstIn());
  break;
case BOTH:
count+=countByFirstPrevPointer(nodeId,group.getFirstOut()) + countByFirstPrevPointer(nodeId,group.getFirstIn());
break;
}
groupId=group.getNext();
}
return (int)count;
}
StoreRelationshipIterator relationships=nodeListRelationships(nodeId,direction);
int degree=0;
while (relationships.hasNext()) {
relationships.next();
degree++;
}
return degree;
}
