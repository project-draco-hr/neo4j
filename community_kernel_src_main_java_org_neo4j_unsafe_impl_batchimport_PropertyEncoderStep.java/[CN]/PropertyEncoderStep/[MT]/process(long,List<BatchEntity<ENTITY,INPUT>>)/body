{
  RelativeIdRecordAllocator stringAllocator=new RelativeIdRecordAllocator(stringDataSize);
  RelativeIdRecordAllocator arrayAllocator=new RelativeIdRecordAllocator(arrayDataSize);
  PropertyCreator propertyCreator=new PropertyCreator(stringAllocator,arrayAllocator,null,null);
  for (  BatchEntity<ENTITY,INPUT> entity : batch) {
    INPUT input=entity.input();
    stringAllocator.initialize();
    arrayAllocator.initialize();
    if (input.hasFirstPropertyId()) {
      long nextProp=input.firstPropertyId();
      entity.record().setNextProp(nextProp);
    }
 else {
      PropertyBlock[] blocks=propertyKeyHolder.propertyKeysAndValues(entity.input().properties(),propertyCreator);
      entity.setPropertyBlocks(blocks);
    }
  }
  return batch;
}
