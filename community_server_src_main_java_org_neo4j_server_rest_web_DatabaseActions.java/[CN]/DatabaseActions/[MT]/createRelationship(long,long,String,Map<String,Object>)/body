{
  Node start, end;
  try {
    start=node(startNodeId);
  }
 catch (  NodeNotFoundException e) {
    throw new StartNodeNotFoundException();
  }
  try {
    end=node(endNodeId);
  }
 catch (  NodeNotFoundException e) {
    throw new EndNodeNotFoundException();
  }
  final RelationshipRepresentation result;
  Transaction tx=beginTx();
  try {
    Relationship rel=start.createRelationshipTo(end,DynamicRelationshipType.withName(type));
    propertySetter.setProperties(rel,properties);
    result=new RelationshipRepresentation(rel);
    tx.success();
  }
  finally {
    tx.finish();
  }
  return result;
}
