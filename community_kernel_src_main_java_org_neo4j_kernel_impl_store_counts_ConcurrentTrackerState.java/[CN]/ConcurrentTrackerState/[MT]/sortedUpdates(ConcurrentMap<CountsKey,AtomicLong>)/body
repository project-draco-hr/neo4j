{
  Update[] result=new Update[updates.size()];
  Iterator<Entry<CountsKey,AtomicLong>> iterator=updates.entrySet().iterator();
  for (int i=0; i < result.length; i++) {
    if (!iterator.hasNext()) {
      throw new ConcurrentModificationException("fewer entries than expected");
    }
    result[i]=new Update(iterator.next());
  }
  if (iterator.hasNext()) {
    throw new ConcurrentModificationException("more entries than expected");
  }
  Arrays.sort(result);
  return result;
}
