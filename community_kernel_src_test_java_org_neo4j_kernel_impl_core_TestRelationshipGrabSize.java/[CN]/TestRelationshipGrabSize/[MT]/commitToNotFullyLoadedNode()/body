{
  beginTx();
  Node node1=db.createNode();
  Node node2=db.createNode();
  RelationshipType type=DynamicRelationshipType.withName("type");
  for (int i=0; i < GRAB_SIZE + 2; i++) {
    node1.createRelationshipTo(node2,type);
  }
  tx.success();
  tx.finish();
  clearCache();
  tx=db.beginTx();
  node1.getRelationships().iterator().next().delete();
  node1.setProperty("foo","bar");
  int relCount=0;
  for (  Relationship rel : node2.getRelationships()) {
    relCount++;
  }
  assertEquals(relCount,GRAB_SIZE + 1);
  relCount=0;
  for (  Relationship rel : node1.getRelationships()) {
    relCount++;
  }
  assertEquals(relCount,GRAB_SIZE + 1);
  assertEquals("bar",node1.getProperty("foo"));
  tx.success();
  tx.finish();
}
