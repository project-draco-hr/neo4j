{
  ClusterManager.ManagedCluster cluster=clusterRule.withSharedSetting(HaSettings.read_timeout,"4000s").startCluster();
  HighlyAvailableGraphDatabase slave=cluster.getAnySlave();
  HighlyAvailableGraphDatabase master=cluster.getMaster();
  ThreadToStatementContextBridge txBridge=threadToStatementContextBridge(slave);
  createEntityInTx(master,TYPE,PROPERTY_KEY,"Foo");
  slave.beginTx();
  createConstraintViolation(slave,TYPE,PROPERTY_KEY,"Foo");
  TopLevelTransaction slaveTx=txBridge.getTopLevelTransactionBoundToThisThread(true);
  txBridge.unbindTransactionFromCurrentThread();
  try (Transaction tx=master.beginTx()){
    createConstraint(master,TYPE,PROPERTY_KEY);
    tx.success();
  }
   txBridge.bindTransactionToCurrentThread(slaveTx);
  try {
    slaveTx.success();
    slaveTx.close();
    fail("Expected this commit to fail :(");
  }
 catch (  org.neo4j.graphdb.TransactionFailureException e) {
    assertThat(e.getCause().getCause(),instanceOf(org.neo4j.kernel.api.exceptions.TransactionFailureException.class));
  }
  assertConstraintHolds(master,TYPE,PROPERTY_KEY,"Foo");
  cluster.sync();
  assertConstraintHolds(slave,TYPE,PROPERTY_KEY,"Foo");
  createEntityInTx(slave,TYPE,PROPERTY_KEY,"Bar");
  createEntityInTx(master,TYPE,PROPERTY_KEY,"Baz");
}
