{
  assumeFalse("We haven't found a way to reliably tests permissions on Windows",SystemUtils.IS_OS_WINDOWS);
  Path directory=testDirectory.directory("a-directory").toPath();
  Path archive=testDirectory.file("subdir/the-archive.dump").toPath();
  Files.createDirectories(archive.getParent());
  try (Closeable ignored=TestUtils.withPermissions(archive.getParent(),emptySet())){
    new Dumper().dump(directory,archive);
    fail("Expected an exception");
  }
 catch (  AccessDeniedException e) {
    assertEquals(archive.getParent().toString(),e.getMessage());
  }
}
