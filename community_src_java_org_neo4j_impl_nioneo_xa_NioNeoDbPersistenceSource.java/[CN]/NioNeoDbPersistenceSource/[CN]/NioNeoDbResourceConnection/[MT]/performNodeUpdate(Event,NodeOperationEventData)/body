{
  try {
    if (event == Event.NODE_ADD_PROPERTY) {
      int propertyId=propStore.nextId();
      nodeConsumer.addProperty(data.getNodeId(),propertyId,data.getPropertyKey(),data.getProperty());
      data.setNewPropertyId(propertyId);
    }
 else     if (event == Event.NODE_CHANGE_PROPERTY) {
      nodeConsumer.changeProperty(data.getNodeId(),data.getPropertyId(),data.getProperty());
    }
 else     if (event == Event.NODE_REMOVE_PROPERTY) {
      nodeConsumer.removeProperty(data.getNodeId(),data.getPropertyId());
    }
 else     if (event == Event.NODE_DELETE) {
      int nodeId=data.getNodeId();
      PropertyData[] propData=nodeConsumer.getProperties(nodeId);
      nodeConsumer.deleteNode(nodeId);
      for (int i=propData.length - 1; i >= 0; i--) {
        nodeConsumer.removeProperty(nodeId,propData[i].getId());
      }
    }
 else     if (event == Event.NODE_CREATE) {
      int nodeId=data.getNodeId();
      nodeConsumer.createNode(nodeId);
    }
 else {
      throw new PersistenceUpdateFailedException("Unkown event: " + event);
    }
  }
 catch (  Exception t) {
    throw new PersistenceUpdateFailedException("Event[" + event + "]",t);
  }
}
