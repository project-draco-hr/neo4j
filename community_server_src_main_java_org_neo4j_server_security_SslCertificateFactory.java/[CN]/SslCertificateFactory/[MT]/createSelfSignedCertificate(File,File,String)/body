{
  FileOutputStream fos=null;
  try {
    KeyPairGenerator keyPairGenerator=KeyPairGenerator.getInstance(KEY_ENCRYPTION);
    keyPairGenerator.initialize(2048);
    KeyPair keyPair=keyPairGenerator.generateKeyPair();
    X509V3CertificateGenerator certGenertor=new X509V3CertificateGenerator();
    certGenertor.setSerialNumber(BigInteger.valueOf(new SecureRandom().nextInt()).abs());
    certGenertor.setIssuerDN(new X509Principal("CN=" + hostName + ", OU=None, O=None L=None, C=None"));
    certGenertor.setNotBefore(new Date(System.currentTimeMillis() - 1000L * 60 * 60* 24* 30));
    certGenertor.setNotAfter(new Date(System.currentTimeMillis() + (1000L * 60 * 60* 24* 365* 10)));
    certGenertor.setSubjectDN(new X509Principal("CN=" + hostName + ", OU=None, O=None L=None, C=None"));
    certGenertor.setPublicKey(keyPair.getPublic());
    certGenertor.setSignatureAlgorithm("RIPEMD256withRSA");
    Certificate certificate=certGenertor.generate(keyPair.getPrivate(),"BC");
    ensureFolderExists(certificatePath.getParentFile());
    ensureFolderExists(privateKeyPath.getParentFile());
    fos=new FileOutputStream(certificatePath);
    fos.write(certificate.getEncoded());
    fos.close();
    fos=new FileOutputStream(privateKeyPath);
    fos.write(keyPair.getPrivate().getEncoded());
    fos.close();
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to create self signed SSL certificate, please see nested exception.",e);
  }
 finally {
    if (fos != null) {
      try {
        fos.close();
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
}
