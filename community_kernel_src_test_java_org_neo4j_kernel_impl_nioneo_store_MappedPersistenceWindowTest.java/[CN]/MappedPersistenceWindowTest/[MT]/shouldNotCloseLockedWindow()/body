{
  String filename=new File(directory.directory(),"mapped.file").getAbsolutePath();
  RandomAccessFile file=resources.add(new RandomAccessFile(filename,"rw"));
  StoreChannel channel=new StoreFileChannel(file.getChannel());
  final MappedPersistenceWindow window=new MappedPersistenceWindow(0,8,16,channel,READ_WRITE);
  window.markAsInUse();
  OtherThreadExecutor<Void> executor=new OtherThreadExecutor<>("other thread",null);
  executor.execute(new WorkerCommand<Void,Void>(){
    @Override public Void doWork(    Void state){
      window.lock(OperationType.WRITE);
      return null;
    }
  }
);
  boolean wasClosed=window.writeOutAndCloseIfFree(false);
  file.close();
  assertFalse(wasClosed);
  executor.close();
}
