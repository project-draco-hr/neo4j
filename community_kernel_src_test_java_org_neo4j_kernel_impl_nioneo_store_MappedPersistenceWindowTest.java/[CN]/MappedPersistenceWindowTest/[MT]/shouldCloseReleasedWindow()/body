{
  String filename=new File(directory.directory(),"mapped.file").getAbsolutePath();
  RandomAccessFile file=resources.add(new RandomAccessFile(filename,"rw"));
  StoreChannel channel=new StoreFileChannel(file.getChannel());
  MappedPersistenceWindow window=new MappedPersistenceWindow(0,8,16,channel,READ_WRITE);
  window.markAsInUse();
  window.lock(OperationType.WRITE);
  window.unLock();
  boolean wasClosed=window.writeOutAndCloseIfFree(false);
  file.close();
  assertTrue(wasClosed);
}
