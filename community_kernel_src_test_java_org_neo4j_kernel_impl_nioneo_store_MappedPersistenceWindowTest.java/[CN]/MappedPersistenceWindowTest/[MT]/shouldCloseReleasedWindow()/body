{
  String filename=new File(directory.directory(),"mapped.file").getAbsolutePath();
  RandomAccessFile file=resources.add(new RandomAccessFile(filename,"rw"));
  MappedPersistenceWindow window=new MappedPersistenceWindow(0,8,16,file.getChannel(),READ_WRITE);
  window.markAsInUse();
  window.lock();
  window.unLock();
  boolean wasClosed=window.writeOutAndCloseIfFree(false);
  assertTrue(wasClosed);
}
