{
  Node node1=getGraphDb().createNode();
  Node node2=getGraphDb().createNode();
  node1.createRelationshipTo(node2,DynamicRelationshipType.withName("KNOWS"));
  getTransaction().success();
  getTransaction().close();
  setTransaction(getGraphDb().beginTx());
  node1.delete();
  getTransaction().success();
  TransactionFailureException exc=null;
  try {
    getTransaction().close();
    Assert.fail();
  }
 catch (  TransactionFailureException e) {
    exc=e;
  }
  Assert.assertNotEquals(exc.getCause().getMessage().indexOf("still has relationships"),-1);
}
