{
  List<TestProtocolServer> protocolServers=network.getServers();
  for (int j=0; j < protocolServers.size(); j++) {
    ConnectedStateMachines connectedStateMachines=protocolServers.get(j).getServer().getConnectedStateMachines();
    State<?,?> clusterState=connectedStateMachines.getStateMachine(ClusterMessage.class).getState();
    if (!clusterState.equals(ClusterState.entered)) {
      logger.getLogger().warn("Instance " + (j + 1) + " is not in the cluster ("+ clusterState+ ")");
      continue;
    }
    ClusterContext context=(ClusterContext)connectedStateMachines.getStateMachine(ClusterMessage.class).getContext();
    ClusterConfiguration clusterConfiguration=context.getConfiguration();
    roles.putAll(clusterConfiguration.getRoles());
  }
}
