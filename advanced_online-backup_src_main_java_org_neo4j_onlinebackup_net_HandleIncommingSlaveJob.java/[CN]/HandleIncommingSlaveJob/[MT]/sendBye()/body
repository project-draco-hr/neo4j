{
  if (retries > 20) {
    close();
  }
  if (!acquireWriteBuffer()) {
    retries++;
    return false;
  }
  try {
    log("Send bye");
    buffer.put(HeaderConstants.BYE);
    buffer.flip();
    connection.write();
    return true;
  }
  finally {
    releaseWriteBuffer();
    close();
  }
}
