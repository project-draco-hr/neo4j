{
  final GraphDatabaseAPI db=(GraphDatabaseAPI)dbBuilder.newGraphDatabase();
  final CountsState countsState=CountsComputer.computeCounts(db);
  long lastCommittedTransactionId=getLastTxId(db);
  db.shutdown();
  cleanupCountsForRebuilding();
  rebuildCounts(countsState,lastCommittedTransactionId);
  try (CountsStore<CountsKey,Register.Long.Out> store=CountsStore.open(fs,pageCache,alphaStoreFile(),RECORD_SERIALIZER,WRITER_FACTORY)){
    assertEquals(BASE_TX_ID,store.lastTxId());
    assertEquals(0,store.totalRecordsStored());
  }
 }
