{
  @SuppressWarnings("deprecation") final GraphDatabaseAPI db=(GraphDatabaseAPI)dbBuilder.newGraphDatabase();
  final CountsRecordState countsState=CountsComputer.computeCounts(db);
  long lastCommittedTransactionId=getLastTxId(db);
  db.shutdown();
  cleanupCountsForRebuilding();
  rebuildCounts(countsState,lastCommittedTransactionId);
  try (Lifespan life=new Lifespan()){
    CountsTracker store=life.add(new CountsTracker(StringLogger.DEV_NULL,fs,pageCache,new File(dir,COUNTS_STORE_BASE)));
    assertEquals(BASE_TX_ID,store.txId());
    assertEquals(0,store.totalEntriesStored());
  }
 }
