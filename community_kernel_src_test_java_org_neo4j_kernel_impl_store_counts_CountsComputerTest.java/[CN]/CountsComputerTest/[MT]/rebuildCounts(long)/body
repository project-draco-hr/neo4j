{
  cleanupCountsForRebuilding();
  StoreFactory storeFactory=new StoreFactory(fs,dir,pageCache,StringLogger.DEV_NULL,new Monitors());
  try (Lifespan life=new Lifespan();NodeStore nodeStore=storeFactory.newNodeStore();RelationshipStore relationshipStore=storeFactory.newRelationshipStore()){
    CountsTracker tracker=life.add(tracker=storeFactory.newCountsStore());
    CountsComputer.computeCounts(nodeStore,relationshipStore,tracker,(int)storeFactory.getHighId(StoreFile.LABEL_TOKEN_STORE,LabelTokenStore.RECORD_SIZE),(int)storeFactory.getHighId(StoreFile.RELATIONSHIP_TYPE_TOKEN_STORE,RelationshipTypeTokenStore.RECORD_SIZE));
    tracker.rotate(lastCommittedTransactionId);
  }
 }
