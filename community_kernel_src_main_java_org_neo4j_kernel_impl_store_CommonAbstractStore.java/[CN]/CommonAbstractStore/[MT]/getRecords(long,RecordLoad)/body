{
  List<RECORD> recordList=new LinkedList<>();
  long currentId=firstId;
  try (PageCursor cursor=storeFile.io(0,PF_SHARED_READ_LOCK)){
    while (!NULL_REFERENCE.is(currentId) && cursor.next(pageIdForRecord(currentId))) {
      RECORD record=newRecord();
      readRecordWithRetry(cursor,currentId,record,mode,offsetForId(currentId));
      if (!record.inUse()) {
        break;
      }
      recordList.add(record);
      currentId=getNextRecordReference(record);
    }
    return recordList;
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException(e);
  }
}
