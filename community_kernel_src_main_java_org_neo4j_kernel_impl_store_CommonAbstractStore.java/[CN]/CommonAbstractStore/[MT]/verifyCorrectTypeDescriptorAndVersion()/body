{
  String expectedTypeDescriptorAndVersion=getTypeAndVersionDescriptor();
  try (PagedFile pagedFile=pageCache.map(storageFileName,pageCache.pageSize())){
    readTypeDescriptorAndVersion=StoreVersionTrailerUtil.readTrailer(pagedFile,expectedTypeDescriptorAndVersion);
  }
   if (readTypeDescriptorAndVersion == null) {
    setStoreNotOk(new IllegalStateException("No trailer present in store, expected " + expectedTypeDescriptorAndVersion));
    return;
  }
  if (!expectedTypeDescriptorAndVersion.equals(readTypeDescriptorAndVersion)) {
    if (readTypeDescriptorAndVersion.startsWith(getTypeDescriptor())) {
      versionMismatchHandler.mismatch(ALL_STORES_VERSION,readTypeDescriptorAndVersion);
    }
 else {
      setStoreNotOk(new IllegalStateException("Unexpected version " + readTypeDescriptorAndVersion + ", expected "+ expectedTypeDescriptorAndVersion));
    }
  }
}
