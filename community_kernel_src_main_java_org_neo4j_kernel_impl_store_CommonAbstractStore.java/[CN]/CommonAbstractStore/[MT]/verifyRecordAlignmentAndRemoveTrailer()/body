{
  String versionTrailer=buildTypeDescriptorAndVersion(getTypeDescriptor());
  int expectedVersionLength=UTF8.encode(versionTrailer).length;
  try (PagedFile pagedFile=pageCache.map(getStorageFileName(),pageCache.pageSize() - pageCache.pageSize() % getRecordSize())){
    long trailerPosition=getTrailerPosition(pagedFile,versionTrailer.split(" ")[0]);
    if (trailerPosition != -1 && trailerPosition % getRecordSize() == 0) {
      writeTrailer(pagedFile,new byte[expectedVersionLength],trailerPosition);
    }
 else {
      setStoreNotOk(new IllegalStateException("Misaligned trailer position " + trailerPosition + " for "+ this+ ", expected version length: "+ expectedVersionLength+ " bytes."));
    }
  }
 }
