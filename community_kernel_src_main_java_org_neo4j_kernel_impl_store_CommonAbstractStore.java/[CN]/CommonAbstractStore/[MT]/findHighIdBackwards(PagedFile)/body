{
  try (PageCursor cursor=pagedFile.io(0,PF_SHARED_LOCK)){
    long lastPageId=pagedFile.getLastPageId();
    long nextPageId=lastPageId;
    int recordsPerPage=recordsPerPage();
    int recordSize=getRecordSize();
    while (nextPageId >= 0 && cursor.next(nextPageId)) {
      nextPageId--;
      do {
        int currentRecord=recordsPerPage;
        while (currentRecord-- > 0) {
          cursor.setOffset(currentRecord * recordSize);
          if (isRecordInUse(cursor)) {
            return (cursor.getCurrentPageId() * recordsPerPage) + currentRecord + 1;
          }
        }
      }
 while (cursor.shouldRetry());
    }
    return getNumberOfReservedLowIds();
  }
 }
