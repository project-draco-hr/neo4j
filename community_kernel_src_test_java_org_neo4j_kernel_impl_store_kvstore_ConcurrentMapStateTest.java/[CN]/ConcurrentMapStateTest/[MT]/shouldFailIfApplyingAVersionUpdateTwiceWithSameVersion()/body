{
  long initialVersion=42;
  when(store.version()).thenReturn(initialVersion);
  ConcurrentMapState<?> state=new ConcurrentMapState<>(store,file);
  EntryUpdater<?> updater;
  long updateVersion=45;
  updater=state.updater(updateVersion,lock);
  updater.close();
  try {
    state.updater(updateVersion,lock);
    fail("should have thrown");
  }
 catch (  IllegalStateException ex) {
    assertEquals("Cannot apply update with given version " + updateVersion + " when base version is "+ initialVersion,ex.getMessage());
  }
}
