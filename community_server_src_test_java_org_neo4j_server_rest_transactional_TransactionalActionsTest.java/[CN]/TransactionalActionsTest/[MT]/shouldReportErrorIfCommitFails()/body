{
  Throwable exc=new RuntimeException("HA");
  doThrow(exc).when(ctx).commit();
  TransactionalActions actions=new TransactionalActions(mess,engine,registry,logger);
  Map<String,Object> parameters=map();
  TestResultHandler results=new TestResultHandler();
  actions.findTransaction(txId).commit(request(new Statement("My Cypher Query",parameters)),results);
  assertThat(results.results.get(0),equalTo(result));
  assertThat(results.errors.get(0).getErrorCode(),equalTo(UNKNOWN_COMMIT_ERROR));
  verify(engine).execute("My Cypher Query",parameters);
  verify(ctx).commit();
  verify(registry).resume(txId);
  verify(registry).finish(txId);
  verifyNoMoreInteractions(mess,registry,engine,ctx);
  logger.assertExactly(error("Failed to commit transaction.",exc));
}
