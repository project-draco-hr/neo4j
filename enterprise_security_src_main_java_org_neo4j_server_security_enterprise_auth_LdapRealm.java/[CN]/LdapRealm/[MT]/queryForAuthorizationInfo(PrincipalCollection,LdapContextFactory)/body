{
  if (authorizationEnabled) {
    Collection realmPrincipals=principals.fromRealm(getName());
    if (!CollectionUtils.isEmpty(realmPrincipals)) {
      String username=(String)realmPrincipals.iterator().next();
      if (useSystemAccountForAuthorization) {
        LdapContext ldapContext=useStartTls ? getSystemLdapContextUsingStartTls(ldapContextFactory) : ldapContextFactory.getSystemLdapContext();
        Set<String> roleNames;
        try {
          roleNames=findRoleNamesForUser(username,ldapContext);
        }
  finally {
          LdapUtils.closeContext(ldapContext);
        }
        return new SimpleAuthorizationInfo(roleNames);
      }
 else {
        Cache<Object,AuthorizationInfo> authorizationCache=getAuthorizationCache();
        AuthorizationInfo authorizationInfo=authorizationCache.get(username);
        if (authorizationInfo == null) {
          throw new AuthExpirationException("LDAP authorization info expired.");
        }
        return authorizationInfo;
      }
    }
  }
  return null;
}
