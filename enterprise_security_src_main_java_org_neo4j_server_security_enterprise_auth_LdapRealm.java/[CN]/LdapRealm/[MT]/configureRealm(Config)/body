{
  JndiLdapContextFactory contextFactory=new JndiLdapContextFactory();
  contextFactory.setUrl(parseLdapServerUrl(config.get(SecuritySettings.ldap_server)));
  contextFactory.setAuthenticationMechanism(config.get(SecuritySettings.ldap_auth_mechanism));
  contextFactory.setReferral(config.get(SecuritySettings.ldap_referral));
  contextFactory.setSystemUsername(config.get(SecuritySettings.ldap_system_username));
  contextFactory.setSystemPassword(config.get(SecuritySettings.ldap_system_password));
  setContextFactory(contextFactory);
  String userDnTemplate=config.get(SecuritySettings.ldap_user_dn_template);
  if (userDnTemplate != null) {
    setUserDnTemplate(userDnTemplate);
  }
  authenticationEnabled=config.get(SecuritySettings.ldap_authentication_enabled);
  authorizationEnabled=config.get(SecuritySettings.ldap_authorization_enabled);
  useStartTls=config.get(SecuritySettings.ldap_use_starttls);
  userSearchBase=config.get(SecuritySettings.ldap_authorization_user_search_base);
  userSearchFilter=config.get(SecuritySettings.ldap_authorization_user_search_filter);
  membershipAttributeNames=config.get(SecuritySettings.ldap_authorization_group_membership_attribute_names);
  useSystemAccountForAuthorization=config.get(SecuritySettings.ldap_authorization_use_system_account);
  groupToRoleMapping=parseGroupToRoleMapping(config.get(SecuritySettings.ldap_authorization_group_to_role_mapping));
  if (authorizationEnabled) {
    assertValidUserSearchSettings();
  }
}
