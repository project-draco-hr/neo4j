{
  Node node1, node2;
  try (org.neo4j.graphdb.Transaction tx=db.beginTx()){
    assertEquals(Collections.<ConstraintDefinition>emptyList(),asList(db.schema().getConstraints()));
    assertEquals(Collections.<IndexDefinition,Schema.IndexState>emptyMap(),indexesWithState(db.schema()));
    (node1=db.createNode(label("Foo"))).setProperty("bar","baz");
    (node2=db.createNode(label("Foo"))).setProperty("bar","baz");
    tx.success();
  }
   try (org.neo4j.graphdb.Transaction tx=db.beginTx()){
    db.schema().constraintFor(label("Foo")).assertPropertyIsUnique("bar").create();
    tx.success();
    fail("expected failure");
  }
 catch (  ConstraintViolationException e) {
    assertTrue(e.getMessage().startsWith("Unable to create CONSTRAINT"));
  }
  try (org.neo4j.graphdb.Transaction tx=db.beginTx()){
    node1.delete();
    node2.delete();
    tx.success();
  }
   try (org.neo4j.graphdb.Transaction tx=db.beginTx()){
    db.schema().constraintFor(label("Foo")).assertPropertyIsUnique("bar").create();
    tx.success();
  }
 }
