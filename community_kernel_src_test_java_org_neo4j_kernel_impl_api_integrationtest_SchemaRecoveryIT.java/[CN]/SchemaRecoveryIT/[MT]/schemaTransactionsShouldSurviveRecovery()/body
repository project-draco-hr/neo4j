{
  Process process=new CreateConstraintButDoNotShutDown().start(testDirectory.absolutePath());
  process.waitForSchemaTransactionCommitted();
  SubProcess.kill(process);
  GraphDatabaseService recoveredDatabase=new GraphDatabaseFactory().newEmbeddedDatabase(testDirectory.absolutePath());
  assertEquals(1,constraints(recoveredDatabase).size());
  assertEquals(1,indexes(recoveredDatabase).size());
  recoveredDatabase.shutdown();
}
