{
  WeakReference<MappedByteBuffer> bufferWeakRef=null;
  if (writeBuffer != null) {
    writeBuffer.force();
    MappedByteBuffer mappedBuffer=writeBuffer.getMappedBuffer();
    if (mappedBuffer != null) {
      bufferWeakRef=new WeakReference<MappedByteBuffer>(mappedBuffer);
      mappedBuffer=null;
    }
    writeBuffer=null;
  }
  fileChannel.close();
  fileChannel=null;
  return bufferWeakRef;
}
