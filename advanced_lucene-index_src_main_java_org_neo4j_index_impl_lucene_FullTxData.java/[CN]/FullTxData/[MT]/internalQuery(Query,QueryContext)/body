{
  if (this.directory == null) {
    return Pair.<Collection<Long>,TxData>of(Collections.<Long>emptySet(),this);
  }
  try {
    Sort sorting=contextOrNull != null ? contextOrNull.getSorting() : null;
    boolean prioritizeCorrectness=contextOrNull == null || !contextOrNull.getTradeCorrectnessForSpeed();
    query=includeOrphans(query);
    Hits hits=new Hits(searcher(prioritizeCorrectness),query,null,sorting,prioritizeCorrectness);
    Collection<Long> result=new ArrayList<Long>();
    for (int i=0; i < hits.length(); i++) {
      result.add(Long.parseLong(hits.doc(i).getField(LuceneIndex.KEY_DOC_ID).stringValue()));
    }
    return Pair.<Collection<Long>,TxData>of(result,this);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
