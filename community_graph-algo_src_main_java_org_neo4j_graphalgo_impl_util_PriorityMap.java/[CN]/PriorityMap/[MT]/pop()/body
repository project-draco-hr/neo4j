{
  Node<E,P> node=queue.peek();
  Entry<E,P> result=null;
  if (node == null) {
    return null;
  }
 else   if (node.head.next == null) {
    node=queue.poll();
    map.remove(keyFunction.convert(node.head.entity));
    result=new Entry<E,P>(node);
  }
 else {
    result=new Entry<E,P>(node);
    node.head=node.head.next;
    if (order.compare(result.priority,node.head.priority) == 0) {
    }
 else {
      reinsert(node);
    }
  }
  return result;
}
