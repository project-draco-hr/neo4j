{
  int expectedVersionLength=UTF8.encode(buildTypeDescriptorAndVersion(getTypeDescriptor())).length;
  long fileSize=getFileChannel().size();
  if ((fileSize - expectedVersionLength) % blockSize != 0 && !isReadOnly()) {
    setStoreNotOk(new IllegalStateException("Misaligned file size " + fileSize + " for "+ this+ ", expected version length "+ expectedVersionLength));
  }
  if (getStoreOk() && !isReadOnly()) {
    getFileChannel().truncate(fileSize - expectedVersionLength);
    typeDescriptorAndVersionTruncated=true;
  }
}
