{
  List<DynamicRecord> recordList=new LinkedList<>();
  long blockId=startBlockId;
  while (blockId != Record.NO_NEXT_BLOCK.intValue()) {
    DynamicRecord record=new DynamicRecord(blockId);
    long pageId=pageIdForRecord(blockId);
    try (PageCursor cursor=storeFile.io(pageId,PF_SHARED_LOCK | PF_SINGLE_PAGE)){
      while (cursor.next()) {
        int offset=offsetForId(record.getId());
        cursor.setOffset(offset);
        if (readRecordHeader(cursor,record,false) && readBothHeaderAndData) {
          readRecordData(cursor,record);
        }
      }
    }
 catch (    IOException e) {
      throw new UnderlyingStorageException(e);
    }
    if (!record.inUse()) {
      return recordList;
    }
    recordList.add(record);
    blockId=record.getNextBlock();
  }
  return recordList;
}
