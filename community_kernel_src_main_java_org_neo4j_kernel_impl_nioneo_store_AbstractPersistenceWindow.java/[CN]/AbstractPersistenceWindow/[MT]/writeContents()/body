{
  ByteBuffer byteBuffer=buffer.getBuffer();
  byteBuffer.clear();
  try {
    int written=0;
    while (byteBuffer.hasRemaining()) {
      int writtenThisTime=getFileChannel().write(byteBuffer,position * recordSize + written);
      if (writtenThisTime == 0)       throw new IOException("Unable to write to disk, reported bytes written was " + writtenThisTime);
      written+=writtenThisTime;
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to write record[" + position + "] @["+ position * recordSize + "]",e);
  }
}
