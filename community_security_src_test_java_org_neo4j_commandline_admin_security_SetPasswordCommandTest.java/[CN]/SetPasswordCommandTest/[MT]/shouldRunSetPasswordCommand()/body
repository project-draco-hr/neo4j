{
  String password_change_required="password_change_required";
  File graphDir=testDir.graphDbDir();
  File authFile=new File(new File(new File(graphDir,"data"),"dbms"),"auth.db");
  FileUserRepository beforeUsers=new FileUserRepository(authFile.toPath(),NullLogProvider.getInstance());
  User before=new User.Builder("neo4j",Credential.forPassword("neo4j")).withRequiredPasswordChange(true).build();
  beforeUsers.create(before);
  assertThat("User should require password change",before.getFlags(),hasItem(password_change_required));
  File confDir=new File(graphDir,"conf");
  SetPasswordCommand setPasswordCommand=new SetPasswordCommand(graphDir.toPath(),confDir.toPath());
  setPasswordCommand.execute(new String[]{"neo4j","abc"});
  FileUserRepository afterUsers=new FileUserRepository(authFile.toPath(),NullLogProvider.getInstance());
  afterUsers.start();
  User after=afterUsers.getUserByName("neo4j");
  assertThat("User should require password change",after.getFlags(),not(hasItem(password_change_required)));
}
