{
  try {
    for (    TxState.LabelState labelState : state.getLabelStates()) {
      long labelId=labelState.getId();
      DiffSets<Long> indexRuleDiffSets=labelState.getIndexRuleDiffSets();
      for (      long propertyKey : indexRuleDiffSets.getAdded())       delegate.addIndexRule(labelId,propertyKey);
      for (      long propertyKey : indexRuleDiffSets.getRemoved())       delegate.dropIndexRule(labelId,propertyKey);
    }
  }
 catch (  ConstraintViolationKernelException e) {
    throw new TransactionFailureException("Late unexpected schema exception",e);
  }
}
