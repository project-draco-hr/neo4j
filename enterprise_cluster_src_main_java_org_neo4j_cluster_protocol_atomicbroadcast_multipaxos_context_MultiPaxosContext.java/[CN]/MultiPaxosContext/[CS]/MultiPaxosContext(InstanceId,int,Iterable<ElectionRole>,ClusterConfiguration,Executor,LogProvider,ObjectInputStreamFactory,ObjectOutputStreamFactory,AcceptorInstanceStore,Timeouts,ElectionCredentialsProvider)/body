{
  commonState=new CommonContextState(configuration,maxAcceptors);
  paxosInstances=new PaxosInstanceStore();
  heartbeatContext=new HeartbeatContextImpl(me,commonState,logging,timeouts,executor);
  learnerContext=new LearnerContextImpl(me,commonState,logging,timeouts,paxosInstances,instanceStore,objectInputStreamFactory,objectOutputStreamFactory,heartbeatContext);
  clusterContext=new ClusterContextImpl(me,commonState,logging,timeouts,executor,objectOutputStreamFactory,objectInputStreamFactory,learnerContext,heartbeatContext);
  electionContext=new ElectionContextImpl(me,commonState,logging,timeouts,roles,clusterContext,heartbeatContext,electionCredentialsProvider);
  proposerContext=new ProposerContextImpl(me,commonState,logging,timeouts,paxosInstances,heartbeatContext);
  acceptorContext=new AcceptorContextImpl(me,commonState,logging,timeouts,instanceStore);
  atomicBroadcastContext=new AtomicBroadcastContextImpl(me,commonState,logging,timeouts,executor,heartbeatContext);
  heartbeatContext.setCircularDependencies(clusterContext,learnerContext);
}
