{
  String json=super.toString();
  StringWriter w=new StringWriter();
  String indent="\n";
  boolean inString=false, escaped=false;
  for (  char c : json.toCharArray()) {
    if (c == '\\') {
      escaped=!escaped;
      w.append(c);
    }
 else     if (c == '"' && !escaped) {
      inString=!inString;
      w.append(c);
    }
 else     if (inString) {
      w.append(c);
    }
 else     if (c == '[' || c == '{') {
      w.append(c);
      indent+=INDENTATION;
      w.append(indent);
    }
 else     if (c == ']' || c == '}') {
      indent=indent.substring(0,indent.length() - INDENTATION.length());
      w.append(indent);
      w.append(c);
    }
 else     if (c == ',') {
      w.append(c);
      w.append(indent);
    }
 else {
      w.append(c);
    }
  }
  return w.toString();
}
