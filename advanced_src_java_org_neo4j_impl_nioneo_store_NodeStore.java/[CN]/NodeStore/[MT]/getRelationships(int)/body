{
  PersistenceWindow window=acquireWindow(nodeId,OperationType.READ);
  int nextRelId=Record.NO_NEXT_RELATIONSHIP.intValue();
  try {
    nextRelId=getNextRelationshipId(nodeId,window.getBuffer());
  }
  finally {
    releaseWindow(window);
  }
  ArrayList<RelationshipData> rels=new ArrayList<RelationshipData>();
  while (nextRelId != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    RelationshipData relData=relStore.getRelationship(nextRelId);
    rels.add(relData);
    if (relData.firstNode() == nodeId) {
      nextRelId=relData.firstNodeNextRelationshipId();
    }
 else     if (relData.secondNode() == nodeId) {
      nextRelId=relData.secondNodeNextRelationshipId();
    }
 else {
      throw new RuntimeException("GAH");
    }
  }
  return rels.toArray(new RelationshipData[rels.size()]);
}
