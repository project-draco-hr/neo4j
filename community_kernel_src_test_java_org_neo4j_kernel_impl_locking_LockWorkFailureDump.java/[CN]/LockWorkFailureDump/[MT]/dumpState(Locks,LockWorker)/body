{
  LifeSupport life=new LifeSupport();
  File file=forTest(testClass).file("failure-dump-" + currentTimeMillis());
  Logging logging=life.add(new SingleLoggingService(logger(file)));
  life.start();
  try {
    lm.accept(new DumpLocksVisitor(logging.getMessagesLog(LockWorkFailureDump.class)));
    for (    LockWorker worker : workers) {
      logging.getMessagesLog(getClass()).logLongMessage("Worker " + worker,worker);
    }
    return file;
  }
  finally {
    life.shutdown();
  }
}
