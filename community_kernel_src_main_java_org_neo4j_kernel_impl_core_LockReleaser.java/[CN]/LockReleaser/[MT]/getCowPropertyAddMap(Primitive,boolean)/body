{
  if (!create) {
    return getCowPropertyAddMap(primitive);
  }
  PrimitiveElement primitiveElement=getAndSetupPrimitiveElement();
  if (primitive instanceof NodeImpl) {
    ArrayMap<Long,CowNodeElement> cowElements=primitiveElement.nodes;
    CowNodeElement element=cowElements.get(primitive.getId());
    if (element != null && element.deleted) {
      throw new IllegalStateException("Node[" + primitive.getId() + "] has been deleted in this tx");
    }
    if (element == null) {
      element=new CowNodeElement();
      cowElements.put(primitive.getId(),element);
    }
    if (element.propertyAddMap == null) {
      element.propertyAddMap=new ArrayMap<Integer,PropertyData>();
    }
    return element.propertyAddMap;
  }
 else   if (primitive instanceof RelationshipImpl) {
    ArrayMap<Long,CowRelElement> cowElements=primitiveElement.relationships;
    CowRelElement element=cowElements.get(primitive.getId());
    if (element != null && element.deleted) {
      throw new IllegalStateException("Relationship[" + primitive.getId() + "] has been deleted in this tx");
    }
    if (element == null) {
      element=new CowRelElement();
      cowElements.put(primitive.getId(),element);
    }
    if (element.propertyAddMap == null) {
      element.propertyAddMap=new ArrayMap<Integer,PropertyData>();
    }
    return element.propertyAddMap;
  }
 else   if (primitive instanceof GraphProperties) {
    if (primitiveElement.graph == null) {
      primitiveElement.graph=new CowGraphElement();
    }
    if (primitiveElement.graph.propertyAddMap == null) {
      primitiveElement.graph.propertyAddMap=new ArrayMap<Integer,PropertyData>();
    }
    return primitiveElement.graph.propertyAddMap;
  }
 else {
    throw new IllegalArgumentException(primitive + " not recognized");
  }
}
