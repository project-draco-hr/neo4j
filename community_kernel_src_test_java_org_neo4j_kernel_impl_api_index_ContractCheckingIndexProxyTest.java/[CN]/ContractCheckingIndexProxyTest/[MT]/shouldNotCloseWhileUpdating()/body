{
  final DoubleLatch latch=new DoubleLatch();
  final IndexProxy inner=new IndexProxy.Adapter(){
    @Override public void update(    Iterable<NodePropertyUpdate> updates){
      latch.startAndAwaitFinish();
    }
  }
;
  final IndexProxy outer=new ContractCheckingIndexProxy(inner);
  outer.create();
  runInSeparateThread(new ThrowingRunnable(){
    @Override public void run() throws IOException {
      outer.update(null);
    }
  }
);
  try {
    latch.awaitStart();
    outer.close();
  }
  finally {
    latch.finish();
  }
}
