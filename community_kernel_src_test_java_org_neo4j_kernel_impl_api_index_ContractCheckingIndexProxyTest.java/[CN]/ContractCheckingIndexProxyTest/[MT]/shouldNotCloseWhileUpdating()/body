{
  final DoubleLatch latch=new DoubleLatch();
  final IndexProxy inner=new IndexProxyAdapter(){
    @Override public IndexUpdater newUpdater(    IndexUpdateMode mode,    long transactionId){
      return super.newUpdater(mode,transactionId);
    }
  }
;
  final IndexProxy outer=newContractCheckingIndexProxy(inner);
  outer.start();
  runInSeparateThread(new ThrowingRunnable(){
    @Override public void run() throws IOException {
      try (IndexUpdater updater=outer.newUpdater(IndexUpdateMode.ONLINE,transactionId)){
        updater.process(null);
        latch.startAndAwaitFinish();
      }
 catch (      IndexEntryConflictException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  try {
    latch.awaitStart();
    outer.close();
  }
  finally {
    latch.finish();
  }
}
