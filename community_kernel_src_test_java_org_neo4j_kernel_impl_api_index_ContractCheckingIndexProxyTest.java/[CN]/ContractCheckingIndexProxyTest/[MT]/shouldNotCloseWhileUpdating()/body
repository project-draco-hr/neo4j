{
  final DoubleLatch latch=new DoubleLatch();
  final IndexProxy inner=new IndexProxyAdapter(){
    @Override public IndexUpdater newUpdater(    IndexUpdateMode mode){
      return super.newUpdater(mode);
    }
  }
;
  final IndexProxy outer=newContractCheckingIndexProxy(inner);
  outer.start();
  runInSeparateThread(new ThrowingRunnable(){
    @Override public void run() throws IOException {
      try (IndexUpdater updater=outer.newUpdater(IndexUpdateMode.ONLINE)){
        updater.process(null);
        latch.startAndAwaitFinish();
      }
     }
  }
);
  try {
    latch.awaitStart();
    outer.close();
  }
  finally {
    latch.finish();
  }
}
