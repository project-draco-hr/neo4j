{
  assumeTrue(Settings.osIsWindows());
  FileSystemAbstraction fs=new DefaultFileSystemAbstraction();
  File fileName=new File(path,StoreLocker.STORE_LOCK_FILENAME);
  StoreChannel channel=fs.open(fileName,"rw");
  FileLock lock=fs.tryLock(fileName,channel);
  assertTrue(new File(path,"lock").exists());
  try {
    fs.tryLock(fileName,channel);
    fail("Should have thrown IOException");
  }
 catch (  IOException e) {
  }
  StoreChannel tempChannel=fs.open(new File(fileName.getPath() + "1"),"rw");
  FileLock tempLock=fs.tryLock(new File(fileName.getPath() + "1"),tempChannel);
  assertNotNull(tempLock);
  tempLock.release();
  tempChannel.close();
  lock.release();
  assertFalse(new File(path,"lock").exists());
  fs.tryLock(fileName,channel).release();
  assertFalse(new File(path,"lock").exists());
}
