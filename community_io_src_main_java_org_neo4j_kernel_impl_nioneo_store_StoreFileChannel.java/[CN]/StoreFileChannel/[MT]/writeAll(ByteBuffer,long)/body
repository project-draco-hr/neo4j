{
  long bufferStartPosition=position;
  long expectedEndPosition=src.limit() - src.position();
  int bytesWritten;
  while ((bufferStartPosition+=(bytesWritten=write(src,bufferStartPosition))) < expectedEndPosition) {
    if (bytesWritten <= 0) {
      throw new IOException("Unable to write to disk, reported bytes written was " + bytesWritten);
    }
  }
}
