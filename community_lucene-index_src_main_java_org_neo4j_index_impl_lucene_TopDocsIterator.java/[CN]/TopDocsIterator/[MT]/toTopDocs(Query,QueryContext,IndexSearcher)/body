{
  Sort sorting=context != null ? context.getSorting() : null;
  TopDocs topDocs=null;
  if (sorting == null && context != null) {
    topDocs=searcher.search(query,context.getTop());
  }
 else {
    boolean forceScore=context == null || !context.getTradeCorrectnessForSpeed();
    if (forceScore) {
      TopFieldCollector collector=LuceneDataSource.scoringCollector(sorting,context.getTop());
      searcher.search(query,collector);
      topDocs=collector.topDocs();
    }
 else {
      topDocs=searcher.search(query,null,context.getTop(),sorting);
    }
  }
  return topDocs;
}
