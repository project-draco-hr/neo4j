{
  Args parsedArgs=Args.parse(args);
  if (parsedArgs.orphans().size() < 2) {
    throw new IncorrectUsage("Missing arguments: expected username and password");
  }
  String username=parsedArgs.orphans().get(0);
  String password=parsedArgs.orphans().get(1);
  boolean shouldCreate=parsedArgs.asMap().containsKey("create");
  try {
    Config config=loadNeo4jConfig(homeDir,configDir);
    File authDir=config.get(auth_store_directory);
    FileUserRepository userRepository=new FileUserRepository(new File(authDir,"auth.db").toPath(),NullLogProvider.getInstance());
    userRepository.start();
    PasswordPolicy passwordPolicy=new BasicPasswordPolicy();
    BasicAuthManager authManager=new BasicAuthManager(userRepository,passwordPolicy,systemUTC());
    try {
      authManager.setUserPassword(username,password);
    }
 catch (    InvalidArgumentsException e) {
      if (shouldCreate) {
        authManager.getUserManager().newUser(username,password,false);
      }
 else {
        throw e;
      }
    }
  }
 catch (  Exception e) {
    throw new CommandFailed("Failed to set password for '" + username + "': "+ e.getMessage(),e);
  }
catch (  Throwable t) {
    throw new CommandFailed("Failed to set password for '" + username + "': "+ t.getMessage(),new RuntimeException(t.getMessage()));
  }
}
