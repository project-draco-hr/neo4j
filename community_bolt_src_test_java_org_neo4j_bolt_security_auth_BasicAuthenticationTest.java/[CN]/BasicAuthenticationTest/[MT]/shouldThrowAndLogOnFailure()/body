{
  BasicAuthManager manager=mock(BasicAuthManager.class);
  Log log=mock(Log.class);
  LogProvider logProvider=mock(LogProvider.class);
  when(logProvider.getLog(BasicAuthentication.class)).thenReturn(log);
  BasicAuthentication authentication=new BasicAuthentication(manager,logProvider);
  when(manager.authenticate(anyString(),anyString())).thenReturn(AuthenticationResult.FAILURE);
  exception.expect(AuthenticationException.class);
  exception.expect(hasStatus(Status.Security.AuthenticationFailed));
  exception.expectMessage("The client provided an incorrect username and/or password.");
  authentication.authenticate(map("scheme","basic","principal","bob","credentials","secret"));
  verify(log).warn("Failed authentication attempt for 'bob')");
}
