{
  Transaction tx=graphdb.beginTx();
  try {
    RelationshipType type=DynamicRelationshipType.withName(relationshipType);
    Index<Node> sourceIndex=graphdb.index().forNodes(sourceEntity);
    Index<Node> targetIndex=graphdb.index().forNodes(targetEntity);
    for (    Object[] relationship : relationships) {
      Node sourceNode=sourceIndex.get(sourceMatchAttribute,relationship[0]).getSingle();
      Node targetNode=targetIndex.get(targetMatchAttribute,relationship[1]).getSingle();
      sourceNode.createRelationshipTo(targetNode,type);
    }
    tx.success();
  }
  finally {
    tx.finish();
  }
}
