{
  long currentVersion=-1;
  long prevIndex=-1;
  long prevTerm=-1;
  long appendIndex=-1;
  VersionIndexRanges ranges=new VersionIndexRanges();
  for (  File file : files.filesInVersionOrder()) {
    Header header=headerReader.readHeader(file);
    if (currentVersion < 0) {
      prevIndex=header.prevIndex;
      prevTerm=header.prevTerm;
    }
    ranges.add(header.version,header.prevIndex);
    appendIndex=header.prevIndex;
    currentVersion=header.version;
  }
  if (currentVersion >= 0) {
    try (IOCursor<RaftLogAppendRecord> entryCursor=reader.readEntriesInVersion(currentVersion)){
      while (entryCursor.next()) {
        appendIndex=entryCursor.get().logIndex();
      }
    }
   }
  return new LogState(currentVersion,prevIndex,prevTerm,appendIndex,ranges);
}
