{
  tearDownTest();
  config=new HashMap<String,String>();
  config.put(Config.NODE_KEYS_INDEXABLE,"nodeProp1, nodeProp2");
  config.put(Config.RELATIONSHIP_KEYS_INDEXABLE,"relProp1, relProp2");
  setUpTest();
  newTransaction();
  Node node1=getGraphDb().createNode();
  Node node2=getGraphDb().createNode();
  Node node3=getGraphDb().createNode();
  Relationship rel12=node1.createRelationshipTo(node2,DynamicRelationshipType.withName("DYNAMIC"));
  Relationship rel23=node2.createRelationshipTo(node3,DynamicRelationshipType.withName("DYNAMIC"));
  Relationship rel31=node3.createRelationshipTo(node1,DynamicRelationshipType.withName("DYNAMIC"));
  node1.setProperty("nodeProp1","node1Value1");
  node1.setProperty("nodePropNonIndexable1","node1ValueNonIndexable");
  node2.setProperty("nodeProp2","node2Value1");
  node2.setProperty("nodePropNonIndexable2","node2ValueNonIndexable");
  node3.setProperty("nodeProp1","node3Value1");
  node3.setProperty("nodeProp2","node3Value2");
  node3.setProperty("nodePropNonIndexable3","node3ValueNonIndexable");
  rel12.setProperty("relProp1","rel12Value1");
  rel12.setProperty("relPropNonIndexable1","rel12ValueNonIndexable");
  rel23.setProperty("relProp2","rel23Value1");
  rel23.setProperty("nodePropNonIndexable2","rel23ValueNonIndexable");
  rel31.setProperty("relProp1","rel31Value1");
  rel31.setProperty("relProp2","rel31Value2");
  rel31.setProperty("relPropNonIndexable3","rel31ValueNonIndexable");
  newTransaction();
  AutoIndexer autoIndexer=getGraphDb().index().getAutoIndexer();
  assertEquals(node1,autoIndexer.getNodesFor("nodeProp1","node1Value1").getSingle());
  assertEquals(node2,autoIndexer.getNodesFor("nodeProp2","node2Value1").getSingle());
  assertEquals(node3,autoIndexer.getNodesFor("nodeProp1","node3Value1").getSingle());
  assertEquals(node3,autoIndexer.getNodesFor("nodeProp2","node3Value2").getSingle());
  assertFalse(autoIndexer.getNodesFor("nodePropNonIndexable1","node1ValueNonIndexable").hasNext());
  assertFalse(autoIndexer.getNodesFor("nodePropNonIndexable2","node2ValueNonIndexable").hasNext());
  assertFalse(autoIndexer.getNodesFor("nodePropNonIndexable3","node3ValueNonIndexable").hasNext());
  assertEquals(rel12,autoIndexer.getNodesFor("relProp1","rel12Value1").getSingle());
  assertEquals(rel23,autoIndexer.getNodesFor("relProp2","rel23Value1").getSingle());
  assertEquals(rel31,autoIndexer.getNodesFor("relProp1","rel31Value1").getSingle());
  assertEquals(rel31,autoIndexer.getNodesFor("relProp2","rel31Value2").getSingle());
  assertFalse(autoIndexer.getNodesFor("relPropNonIndexable1","rel12ValueNonIndexable").hasNext());
  assertFalse(autoIndexer.getNodesFor("relPropNonIndexable2","rel23ValueNonIndexable").hasNext());
  assertFalse(autoIndexer.getNodesFor("relPropNonIndexable3","rel31ValueNonIndexable").hasNext());
}
