{
  stopDb();
  config=new HashMap<String,String>();
  config.put(Config.NODE_KEYS_NON_INDEXABLE,"nodeProp1, nodeProp2");
  config.put(Config.RELATIONSHIP_KEYS_NON_INDEXABLE,"relProp1, relProp2");
  config.put(Config.NODE_AUTO_INDEXING,"true");
  config.put(Config.RELATIONSHIP_AUTO_INDEXING,"true");
  startDb();
  assertTrue(graphDb.index().getNodeAutoIndexer().isEnabled());
  assertTrue(graphDb.index().getRelationshipAutoIndexer().isEnabled());
  newTransaction();
  Node node1=graphDb.createNode();
  Node node2=graphDb.createNode();
  Node node3=graphDb.createNode();
  Relationship rel12=node1.createRelationshipTo(node2,DynamicRelationshipType.withName("DYNAMIC"));
  Relationship rel23=node2.createRelationshipTo(node3,DynamicRelationshipType.withName("DYNAMIC"));
  Relationship rel31=node3.createRelationshipTo(node1,DynamicRelationshipType.withName("DYNAMIC"));
  node1.setProperty("nodeProp1","node1Value1");
  node1.setProperty("nodePropIndexable1","node1ValueIndexable");
  node2.setProperty("nodeProp2","node2Value1");
  node2.setProperty("nodePropIndexable2","node2ValueIndexable");
  node3.setProperty("nodeProp1","node3Value1");
  node3.setProperty("nodeProp2","node3Value2");
  node3.setProperty("nodePropIndexable3","node3ValueIndexable");
  rel12.setProperty("relProp1","rel12Value1");
  rel12.setProperty("relPropIndexable1","rel12ValueIndexable");
  rel23.setProperty("relProp2","rel23Value1");
  rel23.setProperty("relPropIndexable2","rel23ValueIndexable");
  rel31.setProperty("relProp1","rel31Value1");
  rel31.setProperty("relProp2","rel31Value2");
  rel31.setProperty("relPropIndexable3","rel31ValueIndexable");
  newTransaction();
  AutoIndex<Node> nodeIndex=graphDb.index().getNodeAutoIndexer().getAutoIndex();
  assertFalse(nodeIndex.get("nodeProp1","node1Value1").hasNext());
  assertFalse(nodeIndex.get("nodeProp2","node2Value1").hasNext());
  assertFalse(nodeIndex.get("nodeProp1","node3Value1").hasNext());
  assertFalse(nodeIndex.get("nodeProp2","node3Value2").hasNext());
  assertEquals(node1,nodeIndex.get("nodePropIndexable1","node1ValueIndexable").getSingle());
  assertEquals(node2,nodeIndex.get("nodePropIndexable2","node2ValueIndexable").getSingle());
  assertEquals(node3,nodeIndex.get("nodePropIndexable3","node3ValueIndexable").getSingle());
  AutoIndex<Relationship> relIndex=graphDb.index().getRelationshipAutoIndexer().getAutoIndex();
  assertFalse(relIndex.get("relProp1","rel12Value1").hasNext());
  assertFalse(relIndex.get("relProp2","rel23Value1").hasNext());
  assertFalse(relIndex.get("relProp1","rel31Value1").hasNext());
  assertFalse(relIndex.get("relProp2","rel31Value2").hasNext());
  assertEquals(rel12,relIndex.get("relPropIndexable1","rel12ValueIndexable").getSingle());
  assertEquals(rel23,relIndex.get("relPropIndexable2","rel23ValueIndexable").getSingle());
  assertEquals(rel31,relIndex.get("relPropIndexable3","rel31ValueIndexable").getSingle());
}
