{
  StageControl control=mock(StageControl.class);
  ProcessorStep<Batch<InputRelationship,RelationshipRecord>> step=new ParallelizeByNodeIdStep(control,Configuration.DEFAULT);
  int batchSize=Configuration.DEFAULT.batchSize();
  Batch<InputRelationship,RelationshipRecord> a=new Batch<>(new InputRelationship[batchSize]);
  setIds(a,0,2,batchSize * 2);
  Batch<InputRelationship,RelationshipRecord> b=new Batch<>(new InputRelationship[batchSize]);
  setIds(b,1,2,batchSize * 2);
  Batch<InputRelationship,RelationshipRecord> aa=new Batch<>(new InputRelationship[batchSize]);
  setIds(aa,0,2,batchSize * 2);
  Batch<InputRelationship,RelationshipRecord> bb=new Batch<>(new InputRelationship[batchSize]);
  setIds(bb,1,2,batchSize * 2);
  BatchSender sender=mock(BatchSender.class);
  step.process(a,sender);
  step.process(b,sender);
  step.process(aa,sender);
  step.process(bb,sender);
  assertTrue(a.parallelizableWithPrevious);
  assertTrue(b.parallelizableWithPrevious);
  assertFalse(aa.parallelizableWithPrevious);
  assertTrue(bb.parallelizableWithPrevious);
}
