{
  final CoreTopologyService topologyService=mock(CoreTopologyService.class);
  Map<CoreMember,CoreAddresses> coreMembers=new HashMap<>();
  CoreMember theLeader=coreMemberAtRaftPort(9000);
  coreMembers.put(theLeader,coreAddresses(0));
  final ClusterTopology clusterTopology=new ClusterTopology(false,coreMembers,addresses(1));
  when(topologyService.currentTopology()).thenReturn(clusterTopology);
  LeaderLocator leaderLocator=mock(LeaderLocator.class);
  when(leaderLocator.getLeader()).thenReturn(theLeader);
  AcquireEndpointsProcedure procedure=new AcquireEndpointsProcedure(topologyService,leaderLocator,NullLogProvider.getInstance());
  final List<Object[]> members=asList(procedure.apply(null,new Object[0]));
  MatcherAssert.assertThat(members,containsInAnyOrder(new Object[]{coreAddresses(0).getRaftServer().toString(),"write"},new Object[]{coreAddresses(1).getRaftServer().toString(),"read"}));
}
