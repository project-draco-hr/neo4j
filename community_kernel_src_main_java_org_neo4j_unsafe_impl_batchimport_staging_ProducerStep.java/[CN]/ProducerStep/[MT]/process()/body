{
  Object batch=null;
  long startTime=nanoTime();
  while ((batch=nextBatchOrNull(doneBatches.get(),batchSize)) != null) {
    totalProcessingTime.add(nanoTime() - startTime);
    downstreamIdleTime.addAndGet(downstream.receive(doneBatches.getAndIncrement(),batch));
    assertHealthy();
    startTime=nanoTime();
  }
}
