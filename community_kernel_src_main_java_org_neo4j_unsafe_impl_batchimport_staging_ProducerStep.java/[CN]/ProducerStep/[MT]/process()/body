{
  Object batch=null;
  long startTime=currentTimeMillis();
  while ((batch=nextBatchOrNull(batchSize)) != null) {
    totalProcessingTime.add(currentTimeMillis() - startTime);
    sendDownstream(doneBatches.incrementAndGet(),batch);
    assertHealthy();
    startTime=currentTimeMillis();
  }
}
