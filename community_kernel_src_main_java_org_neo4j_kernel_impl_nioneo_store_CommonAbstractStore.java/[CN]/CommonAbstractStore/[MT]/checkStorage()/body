{
  readOnly=configuration.read_only(false);
  backupSlave=configuration.backup_slave(false);
  if (!fileSystemAbstraction.fileExists(storageFileName)) {
    throw new IllegalStateException("No such store[" + storageFileName + "]");
  }
  try {
    this.fileChannel=fileSystemAbstraction.open(storageFileName,readOnly ? "r" : "rw");
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to open file " + storageFileName,e);
  }
  try {
    if ((!readOnly || backupSlave) && grabFileLock) {
      this.fileLock=fileSystemAbstraction.tryLock(storageFileName,fileChannel);
      if (fileLock == null) {
        throw new IllegalStateException("Unable to lock store [" + storageFileName + "], this is usually a result of some "+ "other Neo4j kernel running using the same store.");
      }
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to lock store[" + storageFileName + "]",e);
  }
catch (  OverlappingFileLockException e) {
    throw new IllegalStateException("Unable to lock store [" + storageFileName + "], this is usually caused by another Neo4j kernel already running in "+ "this JVM for this particular store");
  }
}
