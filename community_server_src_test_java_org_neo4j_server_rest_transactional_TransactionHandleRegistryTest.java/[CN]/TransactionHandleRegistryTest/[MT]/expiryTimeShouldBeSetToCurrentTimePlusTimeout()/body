{
  TestLogger log=new TestLogger();
  FakeClock clock=new FakeClock();
  int timeoutLength=123;
  TransactionHandleRegistry registry=new TransactionHandleRegistry(clock,timeoutLength,log);
  TransactionHandle handle=mock(TransactionHandle.class);
  long id=registry.begin(handle);
  long timesOutAt=registry.release(id,handle);
  assertThat(timesOutAt,equalTo(clock.currentTimeMillis() + timeoutLength));
  clock.forward(1337,TimeUnit.MILLISECONDS);
  registry.acquire(id);
  timesOutAt=registry.release(id,handle);
  assertThat(timesOutAt,equalTo(clock.currentTimeMillis() + timeoutLength));
}
