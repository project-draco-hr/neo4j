{
  AssertableLogProvider logProvider=new AssertableLogProvider();
  FakeClock clock=Clocks.fakeClock();
  int timeoutLength=123;
  TransactionHandleRegistry registry=new TransactionHandleRegistry(clock,timeoutLength,logProvider);
  TransactionHandle handle=mock(TransactionHandle.class);
  long id=registry.begin(handle);
  long timesOutAt=registry.release(id,handle);
  assertThat(timesOutAt,equalTo(clock.millis() + timeoutLength));
  clock.forward(1337,TimeUnit.MILLISECONDS);
  registry.acquire(id);
  timesOutAt=registry.release(id,handle);
  assertThat(timesOutAt,equalTo(clock.millis() + timeoutLength));
}
