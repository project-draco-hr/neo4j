{
  Node node=getGraphDb().createNode();
  node.setProperty("someproptest","testing");
  Node node1=getGraphDb().createNode();
  node1.setProperty("someotherproptest",2);
  commit();
  EmbeddedGraphDatabase graphDb=(EmbeddedGraphDatabase)getGraphDb();
  TransactionManager txManager=graphDb.getConfig().getTxModule().getTxManager();
  NodeManager nodeManager=graphDb.getConfig().getGraphDbModule().getNodeManager();
  txManager.begin();
  node.setProperty("someotherproptest","testing2");
  Relationship rel=node.createRelationshipTo(node1,MyRelTypes.TEST);
  javax.transaction.Transaction txA=txManager.suspend();
  txManager.begin();
  assertEquals("testing",node.getProperty("someproptest"));
  assertTrue(!node.hasProperty("someotherproptest"));
  assertTrue(!node.hasRelationship());
  nodeManager.clearCache();
  assertEquals("testing",node.getProperty("someproptest"));
  assertTrue(!node.hasProperty("someotherproptest"));
  javax.transaction.Transaction txB=txManager.suspend();
  txManager.resume(txA);
  assertEquals("testing",node.getProperty("someproptest"));
  assertTrue(node.hasProperty("someotherproptest"));
  assertTrue(node.hasRelationship());
  nodeManager.clearCache();
  assertEquals("testing",node.getProperty("someproptest"));
  assertTrue(node.hasProperty("someotherproptest"));
  assertTrue(node.hasRelationship());
  txManager.suspend();
  txManager.resume(txB);
  assertEquals("testing",node.getProperty("someproptest"));
  assertTrue(!node.hasProperty("someotherproptest"));
  assertTrue(!node.hasRelationship());
  txManager.rollback();
  txManager.resume(txA);
  node.delete();
  node1.delete();
  rel.delete();
  txManager.commit();
  newTransaction();
}
