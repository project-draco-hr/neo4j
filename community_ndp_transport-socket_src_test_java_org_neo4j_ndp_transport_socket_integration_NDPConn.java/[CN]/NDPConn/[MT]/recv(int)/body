{
  long timeout=System.currentTimeMillis() + 1000 * 30;
  byte[] bytes=new byte[length];
  int left=length, read;
  waitUntilAvailable(bytes,timeout,left);
  while ((read=in.read(bytes,length - left,left)) != -1 && left > 0) {
    left-=read;
    if (left > 0) {
      waitUntilAvailable(bytes,timeout,left);
    }
  }
  return bytes;
}
