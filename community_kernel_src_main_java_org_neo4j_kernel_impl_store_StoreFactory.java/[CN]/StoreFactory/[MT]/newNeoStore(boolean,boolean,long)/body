{
  boolean storeExists=storeExists();
  if (!storeExists && allowCreateEmpty) {
    return createNeoStore();
  }
  if (txId == -1) {
    txId=NeoStore.getRecord(fileSystemAbstraction,neoStoreFileName,Position.LAST_TRANSACTION);
  }
  if (storeExists && allowRebuild && !countsStoreExists()) {
    stringLogger.warn("Missing counts store, rebuilding it.");
    rebuildCountsStore(txId);
  }
  return new NeoStore(neoStoreFileName,config,idGeneratorFactory,pageCache,fileSystemAbstraction,stringLogger,newRelationshipTypeTokenStore(),newLabelTokenStore(),newPropertyStore(),newRelationshipStore(),newNodeStore(),newSchemaStore(),newRelationshipGroupStore(),newCountsStore(txId),versionMismatchHandler,monitors);
}
