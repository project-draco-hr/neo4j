{
  try (StandalonePageCache pageCache=createPageCache(fileSystemAbstraction,"build-counts")){
    final File storeFileBase=storeFileName(COUNTS_STORE);
    final String storeVersion=buildTypeDescriptorAndVersion(CountsTracker.STORE_DESCRIPTOR);
    CountsTracker.createEmptyCountsStore(pageCache,storeFileBase,storeVersion);
    try (NodeStore nodeStore=newNodeStore();RelationshipStore relationshipStore=newRelationshipStore();CountsTracker tracker=new CountsTracker(stringLogger,fileSystemAbstraction,pageCache,storeFileBase)){
      CountsComputer.computeCounts(nodeStore,relationshipStore).accept(new CountsAccessor.Initializer(tracker));
      try {
        tracker.rotate(txId);
      }
 catch (      IOException e) {
        throw new UnderlyingStorageException("Unable to recreate CountsStore",e);
      }
    }
   }
 }
