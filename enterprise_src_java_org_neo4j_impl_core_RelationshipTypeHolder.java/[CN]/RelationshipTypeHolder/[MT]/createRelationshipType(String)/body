{
  boolean txStarted=TransactionUtil.beginTx();
  boolean success=false;
  int id=IdGenerator.getGenerator().nextId(RelationshipType.class);
  try {
    addRelType(name,id);
    EventManager em=EventManager.getManager();
    EventData eventData=new EventData(new RelTypeOpData(id,name));
    if (!em.generateProActiveEvent(Event.RELATIONSHIPTYPE_CREATE,eventData)) {
      setRollbackOnly();
      throw new RuntimeException("Generate pro-active event failed.");
    }
    log.fine("Created relationship type: " + name + "("+ id+ ")");
    em.generateReActiveEvent(Event.RELATIONSHIPTYPE_CREATE,eventData);
    success=true;
    return id;
  }
  finally {
    TransactionUtil.finishTx(success,txStarted);
  }
}
