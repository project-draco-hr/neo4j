{
  NeoCommandHandler storeApplier=new NeoStoreTransactionApplier(neoStore,cacheAccess,lockService,locks,transactionId);
  if (mode.needsIdTracking()) {
    storeApplier=new HighIdTransactionApplier(storeApplier,neoStore);
  }
  if (mode.needsCacheInvalidationOnUpdates()) {
    storeApplier=new CacheInvalidationTransactionApplier(storeApplier,neoStore,cacheAccess);
  }
  IndexTransactionApplier indexApplier=new IndexTransactionApplier(indexingService,labelScanStore,neoStore.getNodeStore(),neoStore.getPropertyStore(),cacheAccess,propertyLoader,mode);
  LegacyIndexApplier legacyIndexApplier=new LegacyIndexApplier(indexConfigStore,legacyIndexProviderLookup,legacyIndexTransactionOrdering,transactionId,mode);
  NeoCommandHandler countsStoreApplier=getCountsStoreApplier(transactionId,mode);
  try (CommandApplierFacade applier=new CommandApplierFacade(storeApplier,indexApplier,legacyIndexApplier,countsStoreApplier)){
    representation.accept(applier);
  }
 }
