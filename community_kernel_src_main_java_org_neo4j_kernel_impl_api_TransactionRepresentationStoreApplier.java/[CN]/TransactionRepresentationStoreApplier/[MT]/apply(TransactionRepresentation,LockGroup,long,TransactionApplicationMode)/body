{
  NeoCommandHandler storeApplier=new NeoStoreTransactionApplier(neoStore,cacheAccess,lockService,locks,transactionId);
  if (mode.needsIdTracking()) {
    storeApplier=new HighIdTransactionApplier(storeApplier,neoStore);
  }
  if (mode.needsCacheInvalidationOnUpdates()) {
    storeApplier=new CacheInvalidationTransactionApplier(storeApplier,neoStore,cacheAccess);
  }
  NeoCommandHandler countStoreApplier=new CountsStoreApplier(neoStore.getCounts(),neoStore.getNodeStore());
  IndexTransactionApplier indexApplier=new IndexTransactionApplier(indexingService,labelScanStore,neoStore.getNodeStore(),neoStore.getPropertyStore(),cacheAccess,propertyLoader,mode);
  LegacyIndexApplier legacyIndexApplier=new LegacyIndexApplier(indexConfigStore,legacyIndexProviderLookup,legacyIndexTransactionOrdering,transactionId,mode);
  try (CommandApplierFacade applier=new CommandApplierFacade(storeApplier,countStoreApplier,indexApplier,legacyIndexApplier)){
    representation.accept(applier);
  }
 }
