{
  final ConsistencyReporter reporter=new ConsistencyReporter(recordAccess,report);
  StoreProcessor processEverything=new StoreProcessor(decorator,reporter);
  ProgressMonitorFactory.MultiPartBuilder progress=progressFactory.multipleParts("Full consistency check");
  final StoreAccess nativeStores=directStoreAccess.nativeStores();
  try (IndexAccessors indexes=new IndexAccessors(directStoreAccess.indexes(),nativeStores.getSchemaStore(),samplingConfig)){
    MultiPassStore.Factory multiPass=new MultiPassStore.Factory(decorator,totalMappedMemory,nativeStores,recordAccess,report);
    List<StoppableRunnable> tasks=new ConsistencyCheckTasks(progress,order,processEverything).createTasks(nativeStores,directStoreAccess.labelScanStore(),indexes,multiPass,reporter,checkLabelScanStore,checkIndexes);
    order.execute(tasks,progress.build());
  }
 catch (  Exception e) {
    throw new ConsistencyCheckIncompleteException(e);
  }
}
