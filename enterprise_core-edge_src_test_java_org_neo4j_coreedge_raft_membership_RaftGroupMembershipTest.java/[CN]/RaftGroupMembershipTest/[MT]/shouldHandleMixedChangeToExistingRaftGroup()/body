{
  DirectNetworking net=new DirectNetworking();
  final long leader=0;
  final long stable=1;
  final long toBeRemoved1=2;
  final long toBeRemoved2=3;
  final long toBeAdded1=4;
  final long toBeAdded2=5;
  final long[] everyone={leader,stable,toBeRemoved1,toBeRemoved2,toBeAdded1,toBeAdded2};
  final long[] initialMembers={leader,stable,toBeRemoved1,toBeRemoved2};
  final long[] finalMembers={leader,stable,toBeAdded1,toBeAdded2};
  RaftTestFixture fixture=new RaftTestFixture(net,3,everyone);
  fixture.members().withId(leader).raftInstance().bootstrapWithInitialMembers(new RaftTestGroup(initialMembers));
  fixture.members().withId(leader).timeoutService().invokeTimeout(ELECTION);
  net.processMessages();
  fixture.members().withId(leader).raftInstance().setTargetMembershipSet(new RaftTestGroup(finalMembers).getMembers());
  net.processMessages();
  fixture.members().withId(leader).timeoutService().invokeTimeout(HEARTBEAT);
  net.processMessages();
  fixture.members().withId(leader).timeoutService().invokeTimeout(HEARTBEAT);
  net.processMessages();
  fixture.members().withId(leader).timeoutService().invokeTimeout(HEARTBEAT);
  net.processMessages();
  assertThat(fixture.members().withIds(finalMembers),hasCurrentMembers(new RaftTestGroup(finalMembers)));
  assertEquals(1,fixture.members().withIds(finalMembers).withRole(LEADER).size());
  assertEquals(3,fixture.members().withIds(finalMembers).withRole(FOLLOWER).size());
}
