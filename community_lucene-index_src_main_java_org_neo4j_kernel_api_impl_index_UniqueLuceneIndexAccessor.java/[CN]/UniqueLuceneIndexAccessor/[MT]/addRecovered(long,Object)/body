{
  IndexSearcher searcher=searcherManager.acquire();
  try {
    TopDocs hits=searcher.search(new TermQuery(documentStructure.newQueryForChangeOrRemove(nodeId)),1);
    if (hits.totalHits > 0) {
      writer.updateDocument(documentStructure.newQueryForChangeOrRemove(nodeId),documentStructure.newDocument(nodeId,value));
    }
 else {
      try {
        add(nodeId,value,new HashMap<Object,Long>());
      }
 catch (      IndexEntryConflictException e) {
        throw new IOException("Should not have conflicting entries during recovery.",e);
      }
    }
  }
  finally {
    searcherManager.release(searcher);
  }
}
