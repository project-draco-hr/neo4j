{
  long endTimeMillis=timeoutMillis + System.currentTimeMillis();
  CoreClusterMember db;
  while ((db=getDbWithRole(role)) == null && (System.currentTimeMillis() < endTimeMillis)) {
    LockSupport.parkNanos(MILLISECONDS.toNanos(100));
  }
  if (db == null) {
    throw new TimeoutException();
  }
  return db;
}
