{
  GlobalSessionTracker sessionTracker=new GlobalSessionTracker();
  LocalOperationId localOperationId=new LocalOperationId(0,0);
  ReplicatedTransaction tx=ReplicatedTransactionFactory.createImmutableReplicatedTransaction(mock(PhysicalTransactionRepresentation.class),globalSession,localOperationId);
  TransactionCommitProcess localCommitProcess=mock(TransactionCommitProcess.class);
  ReplicatedTransactionStateMachine listener=new ReplicatedTransactionStateMachine(localCommitProcess,sessionTracker,globalSession);
  listener.onReplicated(tx);
  listener.onReplicated(tx);
  verify(localCommitProcess).commit(any(TransactionRepresentation.class),any(LockGroup.class),any(CommitEvent.class),eq(TransactionApplicationMode.EXTERNAL));
}
