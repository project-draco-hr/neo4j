{
  try {
    List<com.sun.jdi.StackFrame> frames=thread.frames();
    StackTraceElement[] trace=new StackTraceElement[frames.size()];
    Iterator<com.sun.jdi.StackFrame> iter=frames.iterator();
    for (int i=0; iter.hasNext(); i++) {
      com.sun.jdi.Location loc=iter.next().location();
      com.sun.jdi.Method method=loc.method();
      String fileName;
      try {
        fileName=loc.sourceName();
      }
 catch (      com.sun.jdi.AbsentInformationException e) {
        fileName=null;
      }
      trace[i]=new StackTraceElement(method.declaringType().name(),method.name(),fileName,loc.lineNumber());
    }
    return trace;
  }
 catch (  com.sun.jdi.IncompatibleThreadStateException e) {
    return new StackTraceElement[0];
  }
}
