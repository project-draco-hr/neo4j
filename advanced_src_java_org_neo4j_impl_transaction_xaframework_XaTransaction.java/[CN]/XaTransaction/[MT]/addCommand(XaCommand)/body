{
  if (committed) {
    throw new RuntimeException("Cannot add command to committed transaction");
  }
  if (rolledback) {
    throw new RuntimeException("Cannot add command to rolled back transaction");
  }
  doAddCommand(command);
  try {
    log.writeCommand(command,identifier);
  }
 catch (  IOException e) {
    throw new RuntimeException("Unable to write command to logical log.",e);
  }
}
