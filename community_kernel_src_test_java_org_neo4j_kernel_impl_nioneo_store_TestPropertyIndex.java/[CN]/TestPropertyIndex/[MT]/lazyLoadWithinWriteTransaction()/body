{
  File dir=new File("dir");
  EphemeralFileSystemAbstraction fileSystem=new EphemeralFileSystemAbstraction();
  BatchInserter inserter=BatchInserters.inserter(dir.getPath(),fileSystem);
  int count=3000;
  long nodeId=inserter.createNode(mapWithManyProperties(count));
  inserter.shutdown();
  GraphDatabaseService db=new TestGraphDatabaseFactory().setFileSystem(fileSystem).newImpermanentDatabase(dir.getPath());
  Transaction tx=db.beginTx();
  try {
    db.createNode();
    Node node=db.getNodeById(nodeId);
    assertEquals(count,IteratorUtil.count(node.getPropertyKeys()));
    tx.success();
  }
  finally {
    tx.finish();
    db.shutdown();
  }
}
