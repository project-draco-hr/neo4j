{
  ClusterId commonClusterId=topology.clusterId();
  if (commonClusterId != null) {
    if (localClusterId == null) {
      log.info("Binding to discovered cluster: " + commonClusterId);
    }
 else     if (commonClusterId.equals(localClusterId)) {
      log.info("Found expected cluster: " + commonClusterId);
    }
 else {
      throw new BindingException(String.format("Cluster mismatch. Is the configuration correct? " + "Expected: %s Discovered: %s",localClusterId,commonClusterId));
    }
  }
 else   if (topology.canBeBootstrapped()) {
    if (localClusterId == null) {
      commonClusterId=new ClusterId(UUID.randomUUID());
      log.info("Bootstrapping cluster: " + commonClusterId);
    }
 else {
      commonClusterId=localClusterId;
    }
  }
  return commonClusterId;
}
