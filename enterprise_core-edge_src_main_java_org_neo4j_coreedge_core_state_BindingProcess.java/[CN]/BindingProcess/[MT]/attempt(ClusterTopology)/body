{
  ClusterId commonClusterId=topology.clusterId();
  if (commonClusterId != null) {
    if (localClusterId == null) {
      log.info("Discovered cluster id: " + commonClusterId);
    }
 else     if (commonClusterId.equals(localClusterId)) {
      log.info("Found matching cluster id: " + commonClusterId);
    }
 else {
      throw new BindingException(String.format("Cluster mismatch. Is the configuration correct? " + "Expected: %s Discovered: %s",localClusterId,commonClusterId));
    }
  }
 else   if (localClusterId != null) {
    commonClusterId=localClusterId;
    log.info("No common cluster id found, using local: " + commonClusterId);
  }
 else   if (topology.canBeBootstrapped()) {
    commonClusterId=new ClusterId(UUID.randomUUID());
    log.info("Creating new cluster id: " + commonClusterId);
  }
  return commonClusterId;
}
