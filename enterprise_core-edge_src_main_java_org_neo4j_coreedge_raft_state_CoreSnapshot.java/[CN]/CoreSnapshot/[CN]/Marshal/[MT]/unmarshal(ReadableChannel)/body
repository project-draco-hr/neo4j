{
  long prevIndex=source.getLong();
  long prevTerm=source.getLong();
  CoreSnapshot coreSnapshot=new CoreSnapshot(prevIndex,prevTerm);
  int snapshotCount=source.getInt();
  for (int i=0; i < snapshotCount; i++) {
    int typeOrdinal=source.getInt();
    try {
      CoreStateType type=CoreStateType.values()[typeOrdinal];
      Object state=type.marshal.unmarshal(source);
      coreSnapshot.add(type,state);
    }
 catch (    IOException e) {
      throw new RuntimeException("Not possible");
    }
  }
  return coreSnapshot;
}
