{
  long prevIndex=source.readLong();
  long prevTerm=source.readLong();
  CoreSnapshot coreSnapshot=new CoreSnapshot(prevIndex,prevTerm);
  int snapshotCount=source.readInt();
  for (int i=0; i < snapshotCount; i++) {
    int typeOrdinal=source.readInt();
    try {
      CoreStateType type=CoreStateType.values()[typeOrdinal];
      Object state=type.marshal.unmarshal(new NetworkReadableClosableByteBuf(source));
      coreSnapshot.add(type,state);
    }
 catch (    IOException e) {
      throw new RuntimeException("Not possible");
    }
  }
  return coreSnapshot;
}
