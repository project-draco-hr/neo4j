{
  ShellServerExtension shell=(ShellServerExtension)Service.load(KernelExtension.class,"shell");
  if (shell == null)   throw new UnsupportedOperationException("Shell server not found");
  try {
    ShellServer server=shell.getShellServer(graph.getKernelData());
    if (server == null) {
      server=getFallbackServer(graph);
    }
    output=new CollectingOutput();
    client=new SameJvmClient(server,output);
    output.asString();
  }
 catch (  RemoteException e) {
    throw new RuntimeException("Unable to start shell client",e);
  }
}
