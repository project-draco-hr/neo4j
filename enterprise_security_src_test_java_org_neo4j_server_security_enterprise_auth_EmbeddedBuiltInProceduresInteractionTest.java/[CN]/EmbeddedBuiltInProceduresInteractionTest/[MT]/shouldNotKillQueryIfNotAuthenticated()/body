{
  EnterpriseAuthSubject authy=createFakeAnonymousEnterpriseAuthSubject();
  GraphDatabaseFacade graph=neo.getLocalGraph();
  DoubleLatch latch=new DoubleLatch(2);
  ThreadedTransaction<EnterpriseAuthSubject> read=new ThreadedTransaction<>(neo,latch);
  String query=read.execute(threading,authy,"UNWIND [1,2,3] AS x RETURN x");
  latch.startAndWaitForAllToStart();
  String id=extractQueryId(query);
  try (InternalTransaction tx=graph.beginTransaction(KernelTransaction.Type.explicit,AuthSubject.ANONYMOUS)){
    graph.execute(tx,"CALL dbms.killQuery('" + id + "')",Collections.emptyMap());
    throw new AssertionError("Expected exception to be thrown");
  }
 catch (  QueryExecutionException e) {
    assertThat(e.getMessage(),containsString(PERMISSION_DENIED));
  }
  latch.finishAndWaitForAllToFinish();
  read.closeAndAssertSuccess();
}
