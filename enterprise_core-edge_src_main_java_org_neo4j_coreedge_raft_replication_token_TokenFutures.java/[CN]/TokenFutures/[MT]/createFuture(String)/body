{
  CompletableFutureTokenId completableFutureTokenId=new CompletableFutureTokenId(){
    @Override public void close() throws Exception {
      disposeFuture(key,this);
    }
  }
;
  waitListLock.writeLock().lock();
  try {
    ArrayList<CompletableFuture<Integer>> waitList=waitLists.get(key);
    if (waitList == null) {
      waitList=new ArrayList<>();
      waitLists.put(key,waitList);
    }
    waitList.add(completableFutureTokenId);
  }
  finally {
    waitListLock.writeLock().unlock();
  }
  return completableFutureTokenId;
}
