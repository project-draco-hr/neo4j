{
  ReferenceCache<TestCacheTypes.Entity> cache=new ReferenceCache<TestCacheTypes.Entity>("MyCache!",spyFactory);
  for (int i=0; i < MAX_NUM_PUT_BEFORE_POLL / 2; i++) {
    cache.put(new TestCacheTypes.Entity(i));
  }
  for (int i=0; i < MAX_NUM_PUT_BEFORE_POLL / 3; i++) {
    spyFactory.clearAndQueueReferenceNo(i);
  }
  List<TestCacheTypes.Entity> entities=new ArrayList<TestCacheTypes.Entity>();
  for (int i=MAX_NUM_PUT_BEFORE_POLL / 2; i < MAX_NUM_PUT_BEFORE_POLL + 1; i++) {
    entities.add(new TestCacheTypes.Entity(i));
  }
  cache.putAll(entities);
  assertEquals(MAX_NUM_PUT_BEFORE_POLL - (MAX_NUM_PUT_BEFORE_POLL / 3) + 1,cache.size());
  for (int i=0; i < MAX_NUM_PUT_BEFORE_POLL / 3; i++) {
    assertNull(cache.get(i));
  }
}
