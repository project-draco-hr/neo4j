{
  ObjectMapper mapper=new ObjectMapper();
  if (value.startsWith("Struct")) {
    DocStructExample struct=new DocStructExample(value);
    packer.packStructHeader(struct.size(),(byte)struct.signature());
    for (    String s : struct) {
      pack(s,packer,writer);
    }
  }
 else   if (value.equals("FAILURE { \"code\": \"Neo.ClientError.Statement.InvalidSyntax\",                  \"message\": \"Invalid input 'T': expected" + " <init> (line 1, column 1 (offset: 0))                          \"This will cause a syntax error\"                          " + " ^\"}")) {
    writer.handleFailureMessage(Status.Statement.InvalidSyntax,"Invalid input 'T': expected <init> (line 1, column 1 (offset: 0))\n" + "\"This will cause a syntax error\"\n" + " ^");
  }
 else {
    try {
      Object scalar=mapper.readValue(value,Object.class);
      packer.pack(scalar);
    }
 catch (    JsonParseException e) {
      String[] parts=value.split(" ",2);
      List<Object> args=new ArrayList<>();
      String type=parts[0];
      if (parts.length == 2) {
        JsonParser parser=mapper.getJsonFactory().createJsonParser(new ByteArrayInputStream(parts[1].getBytes(StandardCharsets.UTF_8)));
        try {
          while (!parser.isClosed()) {
            Object e1=mapper.readValue(parser,Object.class);
            args.add(e1);
          }
        }
 catch (        EOFException ignore) {
        }
catch (        JsonParseException je) {
          throw new RuntimeException("Unable to parse documented protocol exchange in '" + value + "': "+ je.getMessage(),je);
        }
      }
      if (type.equals("DISCARD_ALL")) {
        writer.handleIgnoredMessage();
      }
 else       if (type.equals("PULL_ALL")) {
        writer.handlePullAllMessage();
      }
 else       if (type.equals("ACK_FAILURE")) {
        writer.handleAckFailureMessage();
      }
 else       if (type.equals("IGNORED")) {
        writer.handleIgnoredMessage();
      }
 else       if (type.equals("RUN")) {
        writer.handleRunMessage((String)args.get(0),(Map<String,Object>)args.get(1));
      }
 else       if (type.equals("RECORD")) {
        writer.handleRecordMessage(new ImmutableRecord(Iterables.toArray(Object.class,(List<Object>)args.get(0))));
      }
 else       if (type.equals("SUCCESS")) {
        writer.handleSuccessMessage((Map<String,Object>)args.get(0));
      }
 else       if (type.equals("FAILURE")) {
        Map<String,Object> meta=(Map<String,Object>)args.get(0);
        writer.handleFailureMessage(Neo4jError.codeFromString((String)meta.get("code")),(String)meta.get("message"));
      }
 else       if (type.equals("INIT")) {
        writer.handleInitMessage((String)args.get(0));
      }
 else {
        throw new RuntimeException("Unknown value: " + type);
      }
    }
  }
}
