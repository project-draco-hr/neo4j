{
  if (!isStorePresent(resolver.resolveDependency(FileSystemAbstraction.class),config)) {
    LifeSupport copyLife=new LifeSupport();
    try {
      MasterClient masterClient=copyLife.add(newMasterClient(masterUri,null));
      copyLife.start();
      boolean masterIsOld=MasterClient.CURRENT.compareTo(masterClient.getProtocolVersion()) > 0;
      if (masterIsOld) {
        throw new UnableToCopyStoreFromOldMasterException(MasterClient.CURRENT.getApplicationProtocol(),masterClient.getProtocolVersion().getApplicationProtocol());
      }
 else {
        copyStoreFromMaster(masterClient,cancellationRequest);
      }
    }
  finally {
      copyLife.shutdown();
    }
  }
}
