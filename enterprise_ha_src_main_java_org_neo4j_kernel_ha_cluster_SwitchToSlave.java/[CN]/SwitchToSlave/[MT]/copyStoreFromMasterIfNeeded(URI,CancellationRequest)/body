{
  if (!isStorePresent(resolver.resolveDependency(FileSystemAbstraction.class),config)) {
    boolean success=false;
    monitor.storeCopyStarted();
    LifeSupport copyLife=new LifeSupport();
    try {
      MasterClient masterClient=newMasterClient(masterUri,null,copyLife);
      copyLife.start();
      boolean masterIsOld=MasterClient.CURRENT.compareTo(masterClient.getProtocolVersion()) > 0;
      if (masterIsOld) {
        throw new UnableToCopyStoreFromOldMasterException(MasterClient.CURRENT.getApplicationProtocol(),masterClient.getProtocolVersion().getApplicationProtocol());
      }
 else {
        copyStoreFromMaster(masterClient,cancellationRequest);
        success=true;
      }
    }
  finally {
      monitor.storeCopyCompleted(success);
      copyLife.shutdown();
    }
  }
}
