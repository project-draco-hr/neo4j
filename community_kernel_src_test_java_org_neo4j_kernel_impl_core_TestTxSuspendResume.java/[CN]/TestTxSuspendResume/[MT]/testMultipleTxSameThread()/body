{
  GraphDatabaseAPI graphdb=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabase();
  TransactionManager tm=graphdb.getDependencyResolver().resolveDependency(TransactionManager.class);
  tm.begin();
  Node refNode=graphdb.createNode();
  tm.commit();
  tm.begin();
  Transaction tx1=tm.suspend();
  tm.begin();
  refNode.setProperty("test2","test");
  Transaction tx2=tm.suspend();
  tm.resume(tx1);
  CommitThread thread=new CommitThread(tm,tx2,Thread.currentThread());
  thread.start();
  refNode.removeProperty("test2");
  assertTrue(thread.success());
  tm.commit();
  graphdb.shutdown();
}
