{
  if (newProperty.isDefined()) {
    DiffSets<SafeProperty> diffSets=nodePropertyDiffSets(nodeId);
    if (replacedProperty.isDefined()) {
      diffSets.remove((SafeProperty)replacedProperty);
    }
    diffSets.add(newProperty);
    legacyState.nodeSetProperty(nodeId,newProperty.asPropertyDataJustForIntegration());
    hasChanges=true;
  }
}
