{
  if (newProperty.isDefined()) {
    DiffSets<SafeProperty> diffSets=relationshipPropertyDiffSets(relationshipId);
    if (replacedProperty.isDefined()) {
      diffSets.replace((SafeProperty)replacedProperty,newProperty);
    }
 else {
      diffSets.add(newProperty);
    }
    legacyState.relationshipSetProperty(relationshipId,newProperty.asPropertyDataJustForIntegration());
    hasChanges=true;
  }
}
