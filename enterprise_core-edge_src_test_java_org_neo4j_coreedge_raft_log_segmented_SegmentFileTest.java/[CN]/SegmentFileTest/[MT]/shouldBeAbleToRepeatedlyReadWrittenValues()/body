{
  try (SegmentFile segment=create(fsRule.get(),fileNames.getForVersion(0),readerPool,0,contentMarshal,logProvider,segmentHeader)){
    segment.write(0,entry1);
    segment.write(1,entry2);
    segment.write(2,entry3);
    segment.flush();
    for (int i=0; i < 3; i++) {
      IOCursor<EntryRecord> reader=segment.getReader(0);
      assertTrue(reader.next());
      assertEquals(entry1,reader.get().logEntry());
      assertTrue(reader.next());
      assertEquals(entry2,reader.get().logEntry());
      assertTrue(reader.next());
      assertEquals(entry3,reader.get().logEntry());
      assertFalse(reader.next());
      reader.close();
    }
  }
 }
