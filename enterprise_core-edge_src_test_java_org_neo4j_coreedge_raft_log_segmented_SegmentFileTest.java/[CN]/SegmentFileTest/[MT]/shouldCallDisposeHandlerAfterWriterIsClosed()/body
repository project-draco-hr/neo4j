{
  try (SegmentFile segment=create(fsRule.get(),raftLogFile,contentMarshal,logProvider,segmentHeader)){
    Runnable onDisposeHandler=mock(Runnable.class);
    segment.write(0,entry1);
    segment.flush();
    segment.markForDisposal(onDisposeHandler);
    verify(onDisposeHandler,never()).run();
    segment.closeWriter();
    assertTrue(segment.isDisposed());
    verify(onDisposeHandler).run();
  }
 }
