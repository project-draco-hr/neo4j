{
  try (SegmentFile segment=create(fsRule.get(),rafLogFile,contentMarshal,logProvider,segmentHeader)){
    Runnable onDisposeHandler=mock(Runnable.class);
    IOCursor<EntryRecord> reader0=segment.getReader(0);
    IOCursor<EntryRecord> reader1=segment.getReader(1);
    IOCursor<EntryRecord> reader2=segment.getReader(1);
    segment.write(0,entry1);
    segment.markForDisposal(onDisposeHandler);
    reader0.close();
    reader1.close();
    segment.closeWriter();
    verify(onDisposeHandler,never()).run();
    reader2.close();
    assertTrue(segment.isDisposed());
    verify(onDisposeHandler).run();
  }
 }
