{
  if (!startIsOk) {
    return;
  }
  boolean useNewCache=true;
  if (params.containsKey("use_old_cache") && params.get("use_old_cache").equals("true")) {
    useNewCache=false;
  }
  boolean useNoCache=false;
  if (params.containsKey("use_no_cache") && params.get("use_no_cache").equals("true")) {
    useNoCache=true;
  }
  if (!readOnly) {
    nodeManager=new NodeManager(graphDbService,cacheManager,lockManager,lockReleaser,transactionManager,persistenceManager,idGenerator,useNewCache,useNoCache);
  }
 else {
    nodeManager=new ReadOnlyNodeManager(graphDbService,cacheManager,lockManager,lockReleaser,transactionManager,persistenceManager,idGenerator,useNewCache,useNoCache);
  }
  RelationshipTypeData relTypes[]=null;
  PropertyIndexData propertyIndexes[]=null;
  beginTx();
  relTypes=persistenceManager.loadAllRelationshipTypes();
  propertyIndexes=persistenceManager.loadPropertyIndexes(INDEX_COUNT);
  commitTx();
  nodeManager.addRawRelationshipTypes(relTypes);
  nodeManager.addPropertyIndexes(propertyIndexes);
  if (propertyIndexes.length < INDEX_COUNT) {
    nodeManager.setHasAllpropertyIndexes(true);
  }
  nodeManager.start(params);
  startIsOk=false;
}
