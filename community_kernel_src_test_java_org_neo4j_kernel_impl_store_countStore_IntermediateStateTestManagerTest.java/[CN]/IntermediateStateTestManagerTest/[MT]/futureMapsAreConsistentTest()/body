{
  int numberOfUpdates=1000;
  IntermediateStateTestManager intermediateStateTestManager=new IntermediateStateTestManager(numberOfUpdates);
  ConcurrentHashMap<CountsKey,long[]> testMap=new ConcurrentHashMap<>();
  Map nextDiff=new ConcurrentHashMap<>();
  for (int i=1; i < numberOfUpdates; i++) {
    intermediateStateTestManager.getNextUpdateMap(nextDiff);
    IntermediateStateTestManager.applyDiffToMap(testMap,nextDiff);
    Assert.assertTrue(countStoreMapsAreEqual(intermediateStateTestManager.getIntermediateMap(i),testMap));
  }
}
