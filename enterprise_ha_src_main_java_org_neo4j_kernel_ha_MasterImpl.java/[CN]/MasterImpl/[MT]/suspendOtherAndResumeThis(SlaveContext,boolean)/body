{
  try {
    TransactionManager txManager=getGraphDbConfig().getTxModule().getTxManager();
    Transaction otherTx=txManager.getTransaction();
    Transaction transaction=getTx(txId);
    if (otherTx != null && otherTx == transaction) {
      return null;
    }
 else {
      if (otherTx != null) {
        txManager.suspend();
      }
      if (transaction == null) {
        if (allowBegin) {
          beginTx(txId);
        }
 else {
          throw new IllegalStateException("Transaction for " + txId + " not started on this master. There may have been a master switch between the"+ " time this transaction started and up to now. This transaction cannot continue"+ " since the state from the previous master isn't transferred.");
        }
      }
 else {
        txManager.resume(transaction);
      }
      return otherTx;
    }
  }
 catch (  Exception e) {
    throw Exceptions.launderedException(e);
  }
}
