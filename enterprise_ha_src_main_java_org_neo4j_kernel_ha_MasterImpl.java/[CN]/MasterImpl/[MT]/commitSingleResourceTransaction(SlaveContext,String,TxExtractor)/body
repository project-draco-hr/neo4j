{
  Transaction otherTx=suspendOtherAndResumeThis(context);
  try {
    XaDataSource dataSource=graphDbConfig.getTxModule().getXaDataSourceManager().getXaDataSource(resource);
    final long txId=dataSource.applyPreparedTransaction(txGetter.extract());
    Predicate<Long> upUntilThisTx=new Predicate<Long>(){
      public boolean accept(      Long item){
        return item < txId;
      }
    }
;
    return packResponse(context,txId,upUntilThisTx);
  }
 catch (  IOException e) {
    e.printStackTrace();
    return new FailedResponse<Long>();
  }
 finally {
    suspendThisAndResumeOther(otherTx,context);
  }
}
