{
  ClassHandle handle;
  try (ClassGenerator simple=generateClass("SimpleClass")){
    try (CodeBlock create=simple.generateMethod(NamedBase.class,"createNamedBase",param(String.class,"foo"),param(String.class,"bar"))){
      create.assign(NamedBase.class,"bean",invoke(newInstance(NamedBase.class),constructorReference(SomeBean.class)));
      create.expression(invoke(create.load("bean"),methodReference(NamedBase.class,void.class,"setFoo",String.class),create.load("foo")));
      create.expression(invoke(create.load("bean"),methodReference(NamedBase.class,void.class,"setBar",String.class),create.load("bar")));
      create.returns(create.load("bean"));
    }
     handle=simple.handle();
  }
   MethodHandle method=instanceMethod(handle.newInstance(),"createNamedBase",String.class,String.class);
  NamedBase bean=(NamedBase)method.invoke("hello","world");
  assertEquals("hello",bean.getFoo());
  assertEquals("world",bean.getBar());
}
