{
  InputStream source=testClass.getResourceAsStream(resource);
  if (source == null) {
    throw new FileNotFoundException("Could not find resource '" + resource + "' to unzip");
  }
  try {
    ZipInputStream zipStream=new ZipInputStream(source);
    ZipEntry entry=null;
    byte[] scratch=new byte[8096];
    while ((entry=zipStream.getNextEntry()) != null) {
      if (entry.isDirectory()) {
        new File(targetDirectory,entry.getName()).mkdirs();
      }
 else {
        OutputStream file=new BufferedOutputStream(new FileOutputStream(new File(targetDirectory,entry.getName())));
        try {
          long toCopy=entry.getSize();
          while (toCopy > 0) {
            int read=zipStream.read(scratch);
            file.write(scratch,0,read);
            toCopy-=read;
          }
        }
  finally {
          file.close();
        }
      }
      zipStream.closeEntry();
    }
  }
  finally {
    source.close();
  }
  return targetDirectory;
}
