{
  if (rel.getFirstPrevRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getFirstPrevRel());
    lockManager.getWriteLock(lockableRel);
    RelationshipRecord prevRel=getRelationshipRecord(rel.getFirstPrevRel());
    if (prevRel == null) {
      prevRel=getRelationshipStore().getRecord(rel.getFirstPrevRel(),readFromBuffer);
      addRelationshipRecord(prevRel);
    }
    if (prevRel.getFirstNode() == rel.getFirstNode()) {
      prevRel.setFirstNextRel(rel.getFirstNextRel());
    }
 else     if (prevRel.getSecondNode() == rel.getFirstNode()) {
      prevRel.setSecondNextRel(rel.getFirstNextRel());
    }
 else {
      throw new RuntimeException(prevRel + " don't match " + rel);
    }
    addRelationshipLockToTransaction(lockableRel);
  }
  if (rel.getFirstNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getFirstNextRel());
    lockManager.getWriteLock(lockableRel);
    RelationshipRecord nextRel=getRelationshipRecord(rel.getFirstNextRel());
    if (nextRel == null) {
      nextRel=getRelationshipStore().getRecord(rel.getFirstNextRel(),readFromBuffer);
      addRelationshipRecord(nextRel);
    }
    if (nextRel.getFirstNode() == rel.getFirstNode()) {
      nextRel.setFirstPrevRel(rel.getFirstPrevRel());
    }
 else     if (nextRel.getSecondNode() == rel.getFirstNode()) {
      nextRel.setSecondPrevRel(rel.getFirstPrevRel());
    }
 else {
      throw new RuntimeException(nextRel + " don't match " + rel);
    }
    addRelationshipLockToTransaction(lockableRel);
  }
  if (rel.getSecondPrevRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getSecondPrevRel());
    lockManager.getWriteLock(lockableRel);
    RelationshipRecord prevRel=getRelationshipRecord(rel.getSecondPrevRel());
    if (prevRel == null) {
      prevRel=getRelationshipStore().getRecord(rel.getSecondPrevRel(),readFromBuffer);
      addRelationshipRecord(prevRel);
    }
    if (prevRel.getFirstNode() == rel.getSecondNode()) {
      prevRel.setFirstNextRel(rel.getSecondNextRel());
    }
 else     if (prevRel.getSecondNode() == rel.getSecondNode()) {
      prevRel.setSecondNextRel(rel.getSecondNextRel());
    }
 else {
      throw new RuntimeException(prevRel + " don't match " + rel);
    }
    addRelationshipLockToTransaction(lockableRel);
  }
  if (rel.getSecondNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getSecondNextRel());
    lockManager.getWriteLock(lockableRel);
    RelationshipRecord nextRel=getRelationshipRecord(rel.getSecondNextRel());
    if (nextRel == null) {
      nextRel=getRelationshipStore().getRecord(rel.getSecondNextRel(),readFromBuffer);
      addRelationshipRecord(nextRel);
    }
    if (nextRel.getFirstNode() == rel.getSecondNode()) {
      nextRel.setFirstPrevRel(rel.getSecondPrevRel());
    }
 else     if (nextRel.getSecondNode() == rel.getSecondNode()) {
      nextRel.setSecondPrevRel(rel.getSecondPrevRel());
    }
 else {
      throw new RuntimeException(nextRel + " don't match " + rel);
    }
    addRelationshipLockToTransaction(lockableRel);
  }
}
