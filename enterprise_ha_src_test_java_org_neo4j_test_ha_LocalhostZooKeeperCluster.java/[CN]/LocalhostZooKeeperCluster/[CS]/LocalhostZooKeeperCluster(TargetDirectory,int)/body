{
  keeper=new ZooKeeper[ports.length];
  boolean success=false;
  try {
    ZooKeeperProcess subprocess=new ZooKeeperProcess(null);
    StringBuilder connection=new StringBuilder();
    for (int i=0; i < keeper.length; i++) {
      keeper[i]=subprocess.start(new String[]{config(target,i + 1,ports[i])});
      if (connection.length() > 0)       connection.append(",");
      connection.append("localhost:" + ports[i]);
    }
    this.connection=connection.toString();
    await(keeper,15,TimeUnit.SECONDS);
    success=true;
  }
 catch (  Throwable ex) {
    ex.printStackTrace();
  }
 finally {
    if (!success)     shutdown();
  }
}
