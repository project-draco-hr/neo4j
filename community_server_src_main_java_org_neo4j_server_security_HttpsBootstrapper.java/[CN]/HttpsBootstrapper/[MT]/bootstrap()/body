{
  Security.addProvider(new BouncyCastleProvider());
  File keyStoreFile=new File(getKeyStorePath());
  File certFile=new File(getCertPath());
  File privateKeyFile=new File(getPrivateKeyPath());
  char[] keyStorePassword=getRandomChars(50);
  char[] keyPassword=getRandomChars(50);
  if (!certFile.exists()) {
    log.info("No SSL certificate found, generating a self-signed certificate..");
    try {
      createSelfSignedCertificate(certFile,privateKeyFile,keyPassword);
    }
 catch (    Exception e) {
      throw new RuntimeException("Unable to create self signed certificate, see nested exception.",e);
    }
    log.info("Certificate generation done, saved certificate in [%s] and private key in [%s].",certFile.getAbsolutePath(),privateKeyFile.getAbsolutePath());
  }
  try {
    setUpKeyStore(keyStoreFile,keyStorePassword,keyPassword,certFile,privateKeyFile);
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to setup keystore, see nested exception.",e);
  }
  return new HttpsConfiguration(keyStoreFile.getAbsolutePath(),keyStorePassword,keyPassword);
}
