{
  File relStore=new File(storeName);
  if (!relStore.exists()) {
    throw new IOException("Couldn't find relationship store " + storeName);
  }
  File idGenerator=new File(storeName + ".id");
  if (idGenerator.exists()) {
    boolean success=idGenerator.delete();
    assert success;
  }
  int recordSize=33;
  System.out.print(storeName);
  ByteBuffer buffer=ByteBuffer.allocate(recordSize);
  FileChannel fileChannel=new RandomAccessFile(relStore,"r").getChannel();
  long fileSize=fileChannel.size();
  fileChannel.position(0);
  long dot=fileSize / recordSize / 20;
  int i=0;
  int inUseCount=0;
  for (i=0; (long)(i + 1) * recordSize <= fileSize; i++) {
    buffer.clear();
    fileChannel.position((long)i * recordSize);
    if (fileChannel.read(buffer) == 0) {
      break;
    }
    buffer.flip();
    byte inUse=buffer.get();
    if (inUse == RECORD_IN_USE + NOT_DIRECTED || inUse == RECORD_IN_USE + DIRECTED) {
      inUseCount++;
      int firstNode=buffer.getInt();
      int secondNode=buffer.getInt();
      int type=buffer.getInt();
      int firstPrev=buffer.getInt();
      int firstNext=buffer.getInt();
      int secondPrev=buffer.getInt();
      int secondNext=buffer.getInt();
      int prop=buffer.getInt();
      if (firstPrev == NO_PREVIOUS_RELATIONSHIP && !nodeSet.remove(firstNode)) {
        throw new IOException("Bad start node[" + firstNode + "](node don't exist or don't have relationships) "+ "at record "+ i);
      }
      if (secondPrev == NO_PREVIOUS_RELATIONSHIP && !nodeSet.remove(secondNode)) {
        throw new IOException("Bad start node[" + secondNode + "](node don't exist or don't have relationships) "+ "at record "+ i);
      }
      checkRelationshipList(i,firstNode,firstPrev,firstNext,fileChannel,buffer);
      checkRelationshipList(i,secondNode,secondPrev,secondNext,fileChannel,buffer);
      if (prop != NO_NEXT_PROPERTY && !propertySet.remove(prop)) {
        throw new IOException("Bad property start block[" + prop + "] on record "+ i);
      }
      if (!relTypeSet.contains(type)) {
        throw new IOException("Bad rel type[" + type + "] on record "+ i);
      }
    }
 else     if (inUse != RECORD_NOT_IN_USE) {
      System.out.println("Unknown record at: " + i);
      System.out.println("In use flag was: " + inUse);
    }
    if (dot != 0 && i % dot == 0) {
      System.out.print(".");
    }
  }
  System.out.print(" high id:" + i + " count:"+ inUseCount);
  fileChannel.close();
  System.out.println(".ok");
}
