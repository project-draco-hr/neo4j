{
  HelperThread t1=new HelperThread("T1");
  HelperThread t2=new HelperThread("T2");
  HelperThread t3=new HelperThread("T3");
  HelperThread t4=new HelperThread("T4");
  ResourceObject r1=new ResourceObject("R1");
  try {
    t1.start();
    t2.start();
    t3.start();
    t4.start();
    t1.getReadLock(r1);
    t1.waitForCompletionOfTask();
    t2.getReadLock(r1);
    t2.waitForCompletionOfTask();
    t3.getReadLock(r1);
    t3.waitForCompletionOfTask();
    t4.getWriteLock(r1);
    t3.releaseReadLock(r1);
    t3.waitForCompletionOfTask();
    t2.releaseReadLock(r1);
    t2.waitForCompletionOfTask();
    assertTrue(!t4.isTaskCompleted());
    t1.releaseReadLock(r1);
    t1.waitForCompletionOfTask();
    t4.waitForCompletionOfTask();
    t4.getReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.getReadLock(r1);
    t4.waitForCompletionOfTask();
    t1.getReadLock(r1);
    t4.getReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.releaseReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.getWriteLock(r1);
    t4.waitForCompletionOfTask();
    t4.releaseWriteLock(r1);
    t4.waitForCompletionOfTask();
    assertTrue(!t1.isTaskCompleted());
    t4.releaseWriteLock(r1);
    t4.waitForCompletionOfTask();
    t1.waitForCompletionOfTask();
    t4.releaseReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.getWriteLock(r1);
    t1.releaseReadLock(r1);
    t1.waitForCompletionOfTask();
    t4.waitForCompletionOfTask();
    t4.releaseReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.releaseWriteLock(r1);
    t4.waitForCompletionOfTask();
    t4.getWriteLock(r1);
    t4.waitForCompletionOfTask();
    t1.getReadLock(r1);
    t2.getReadLock(r1);
    t3.getReadLock(r1);
    t4.getReadLock(r1);
    t4.waitForCompletionOfTask();
    t4.releaseWriteLock(r1);
    t4.waitForCompletionOfTask();
    t1.waitForCompletionOfTask();
    t2.waitForCompletionOfTask();
    t3.waitForCompletionOfTask();
    t1.getWriteLock(r1);
    t2.releaseReadLock(r1);
    t2.waitForCompletionOfTask();
    t4.releaseReadLock(r1);
    t4.waitForCompletionOfTask();
    t3.releaseReadLock(r1);
    t3.waitForCompletionOfTask();
    t1.waitForCompletionOfTask();
    t1.releaseWriteLock(r1);
    t1.waitForCompletionOfTask();
    t2.getReadLock(r1);
    t2.waitForCompletionOfTask();
    t1.releaseReadLock(r1);
    t1.waitForCompletionOfTask();
    t2.getWriteLock(r1);
    t2.waitForCompletionOfTask();
    t2.releaseWriteLock(r1);
    t2.waitForCompletionOfTask();
    t2.releaseReadLock(r1);
    t2.waitForCompletionOfTask();
  }
 catch (  Exception e) {
    lm.dumpLocksOnResource(r1);
    e.printStackTrace();
    fail("Multiple thread rw lock test failed, " + e);
  }
 finally {
    t1.quit();
    t2.quit();
    t3.quit();
    t4.quit();
  }
}
