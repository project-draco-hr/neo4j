{
  boolean firstLock=false;
  if (lockElements == null) {
    lockElements=new ArrayList<LockElement>();
    firstLock=true;
  }
  LockElement element=new LockElement(resource,type);
  lockElements.add(element);
  if (firstLock) {
    try {
      transactionManager.getTransaction().registerSynchronization(new ReadOnlyTxReleaser());
    }
 catch (    Exception e) {
      throw new TransactionFailureException("Failed to register lock release synchronization hook",e);
    }
  }
  return element;
}
