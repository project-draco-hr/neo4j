{
  boolean firstLock=false;
  if (lockElements == null) {
    lockElements=new ArrayList<LockElement>();
    firstLock=true;
  }
  lockElements.add(lock);
  if (firstLock) {
    try {
      tx.registerSynchronization(new ReadOnlyTxReleaser());
    }
 catch (    Exception e) {
      throw new TransactionFailureException("Failed to register lock release synchronization hook",e);
    }
  }
}
