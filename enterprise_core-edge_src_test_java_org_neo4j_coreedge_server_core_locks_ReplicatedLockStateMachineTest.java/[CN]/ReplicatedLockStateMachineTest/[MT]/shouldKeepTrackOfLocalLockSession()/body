{
  StubReplicator replicator=new StubReplicator();
  RaftTestMember me=member(0);
  CurrentReplicatedLockState stateMachine=new ReplicatedLockStateMachine<>(me,replicator);
  replicator.replicate(new ReplicatedLockRequest<>(member(1),0));
  replicator.replicate(new ReplicatedLockRequest<>(member(2),1));
  assertFalse(stateMachine.currentLockSession().isMine());
  replicator.replicate(new ReplicatedLockRequest<>(me,0));
  assertFalse(stateMachine.currentLockSession().isMine());
  replicator.replicate(new ReplicatedLockRequest<>(me,2));
  assertTrue(stateMachine.currentLockSession().isMine());
  assertEquals(2,stateMachine.currentLockSession().id());
  replicator.replicate(new ReplicatedLockRequest<>(member(1),2));
  assertTrue(stateMachine.currentLockSession().isMine());
  assertEquals(2,stateMachine.currentLockSession().id());
  replicator.replicate(new ReplicatedLockRequest<>(member(1),3));
  assertFalse(stateMachine.currentLockSession().isMine());
  assertEquals(3,stateMachine.currentLockSession().id());
}
