{
  Pair<Map<String,String>,Boolean> result=findIndexConfig(entityType.entityClass(),indexName,suppliedConfig,config.getParams());
  boolean createdNow=false;
  if (result.other()) {
synchronized (this) {
      Map<String,String> existing=indexStore.get(entityType.entityClass(),indexName);
      if (existing != null) {
        assertConfigMatches(indexProviders.lookup(existing.get(PROVIDER)),indexName,existing,result.first());
        return Pair.of(result.first(),false);
      }
      try (KernelTransaction transaction=kernel.instance().newTransaction();Statement statement=transaction.acquireStatement()){
switch (entityType) {
case Node:
          statement.dataWriteOperations().nodeLegacyIndexCreate(indexName,result.first());
        break;
case Relationship:
      statement.dataWriteOperations().relationshipLegacyIndexCreate(indexName,result.first());
    break;
}
transaction.success();
createdNow=true;
}
 catch (Exception ex) {
throw new TransactionFailureException("Index creation failed for " + indexName + ", "+ result.first(),ex);
}
}
}
return Pair.of(result.first(),createdNow);
}
