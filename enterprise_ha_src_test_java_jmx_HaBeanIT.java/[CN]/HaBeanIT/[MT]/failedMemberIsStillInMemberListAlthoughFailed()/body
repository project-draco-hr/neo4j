{
  ManagedCluster cluster=clusterRule.startCluster();
  assertEquals(3,ha(cluster.getAnySlave()).getInstancesInCluster().length);
  HighlyAvailableGraphDatabase failedDb=cluster.getAnySlave();
  RepairKit dbFailure=cluster.fail(failedDb);
  try {
    await(ha(cluster.getMaster()),dbAlive(false));
    await(ha(cluster.getAnySlave(failedDb)),dbAlive(false));
  }
  finally {
    dbFailure.repair();
  }
  for (  HighlyAvailableGraphDatabase db : cluster.getAllMembers()) {
    await(ha(db),dbAvailability(true));
    await(ha(db),dbAlive(true));
  }
}
