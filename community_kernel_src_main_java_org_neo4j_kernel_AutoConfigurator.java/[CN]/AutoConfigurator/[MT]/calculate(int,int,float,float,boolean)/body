{
  int size;
  if (storeSize > (memLeft * use)) {
    size=(int)(memLeft * use);
  }
 else   if (canExpand) {
    if (storeSize * expand * NUMBER_OF_STORES_FOR_MEMORY_MAPPING < memLeft * use) {
      size=(int)(memLeft * use / NUMBER_OF_STORES_FOR_MEMORY_MAPPING);
    }
 else {
      size=(int)(memLeft * use);
    }
  }
 else {
    size=storeSize;
  }
  return size;
}
