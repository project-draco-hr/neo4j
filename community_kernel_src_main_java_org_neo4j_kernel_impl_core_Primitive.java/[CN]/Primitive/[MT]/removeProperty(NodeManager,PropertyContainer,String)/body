{
  if (key == null) {
    throw new IllegalArgumentException("Null parameter.");
  }
  boolean success=false;
  TransactionState tx=nodeManager.getTransactionState();
  tx.acquireWriteLock(proxy);
  try {
    ensureFullProperties(nodeManager);
    PropertyData property=null;
    ArrayMap<Integer,PropertyData> addMap=tx.getCowPropertyAddMap(this);
    ArrayMap<Integer,PropertyData> removeMap=tx.getCowPropertyRemoveMap(this);
    for (    PropertyKeyToken cachedIndex : nodeManager.getPropertyKeyTokens(key)) {
      if (addMap != null) {
        property=addMap.remove(cachedIndex.getKeyId());
        if (property != null) {
          removeMap=removeMap != null ? removeMap : tx.getOrCreateCowPropertyRemoveMap(this);
          removeMap.put(cachedIndex.getKeyId(),property);
          break;
        }
      }
      if (removeMap != null && removeMap.get(cachedIndex.getKeyId()) != null) {
        success=true;
        return null;
      }
      property=getPropertyForIndex(cachedIndex.getKeyId());
      if (property != null) {
        removeMap=removeMap != null ? removeMap : tx.getOrCreateCowPropertyRemoveMap(this);
        removeMap.put(cachedIndex.getKeyId(),property);
        break;
      }
    }
    if (property == null) {
      success=true;
      return null;
    }
    removeProperty(nodeManager,property,tx);
    success=true;
    return getPropertyValue(nodeManager,property);
  }
  finally {
    if (!success) {
      nodeManager.setRollbackOnly();
    }
  }
}
