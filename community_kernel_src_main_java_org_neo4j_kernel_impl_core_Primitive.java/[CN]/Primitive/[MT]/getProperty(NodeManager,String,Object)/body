{
  if (key == null) {
    throw new IllegalArgumentException("null key");
  }
  TransactionState tx=nodeManager.getTransactionState();
  ArrayMap<Integer,PropertyData> skipMap=null, addMap=null;
  if (tx.hasChanges()) {
    skipMap=tx.getCowPropertyRemoveMap(this);
    addMap=tx.getCowPropertyAddMap(this);
  }
  ensureFullProperties(nodeManager);
  Token index=nodeManager.getPropertyKeyTokenOrNull(key);
  if (index != null) {
    if (skipMap != null && skipMap.get(index.id()) != null) {
      return defaultValue;
    }
    if (addMap != null) {
      PropertyData property=addMap.get(index.id());
      if (property != null) {
        return getPropertyValue(nodeManager,property);
      }
    }
    PropertyData property=getPropertyForIndex(index.id());
    if (property != null) {
      return getPropertyValue(nodeManager,property);
    }
  }
  return defaultValue;
}
