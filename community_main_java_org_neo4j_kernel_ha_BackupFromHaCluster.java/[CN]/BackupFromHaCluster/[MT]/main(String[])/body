{
  Args arguments=new Args(args);
  String storeDir=arguments.get("path",!arguments.orphans().isEmpty() ? arguments.orphans().get(0) : null);
  ClusterManager cluster=new ClusterManager(arguments.get(HighlyAvailableGraphDatabase.CONFIG_KEY_HA_ZOO_KEEPER_SERVERS,null));
  cluster.waitForSyncConnected();
  final Machine master=cluster.getCachedMaster().other();
  System.out.println("Master:" + master);
  Map<String,String> config=MapUtil.stringMap(HighlyAvailableGraphDatabase.CONFIG_KEY_HA_MACHINE_ID,String.valueOf(master.getMachineId()));
  DelegatingResponseReceiver receiver=new DelegatingResponseReceiver();
  HighlyAvailableGraphDatabase db=new HighlyAvailableGraphDatabase(storeDir,config,AbstractBroker.wrapSingleBroker(new BackupBroker(new MasterClient(master.getServer().first(),master.getServer().other(),storeDir,receiver),storeDir)));
  receiver.setTarget(db);
  System.out.println("Leaching backup from master " + master);
  try {
    db.pullUpdates();
    System.out.println("Backup completed successfully");
  }
  finally {
    db.shutdown();
    cluster.shutdown();
  }
}
