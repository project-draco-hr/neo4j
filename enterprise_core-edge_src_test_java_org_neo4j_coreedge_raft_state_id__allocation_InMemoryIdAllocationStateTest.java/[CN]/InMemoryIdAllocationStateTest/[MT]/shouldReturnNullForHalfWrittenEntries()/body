{
  final InMemoryIdAllocationState state=new InMemoryIdAllocationState();
  for (int i=1; i <= 3; i++) {
    state.firstUnallocated(IdType.NODE,1024 * i);
    state.logIndex(i);
  }
  final InMemoryIdAllocationState.InMemoryIdAllocationStateChannelMarshal marshal=new InMemoryIdAllocationState.InMemoryIdAllocationStateChannelMarshal();
  InMemoryVersionableReadableClosablePositionAwareChannel channel=new InMemoryVersionableReadableClosablePositionAwareChannel();
  marshal.marshal(state,channel);
  channel.putInt(1).putInt(2).putInt(3).putLong(4L);
  marshal.unmarshal(channel);
  InMemoryIdAllocationState unmarshalled=marshal.unmarshal(channel);
  assertEquals(null,unmarshalled);
}
