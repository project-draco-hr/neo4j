{
  if (!ids.hasNext()) {
    return null;
  }
  RECORD[] batch=(RECORD[])Array.newInstance(klass,batchSize);
  int i=0;
  while (i < batchSize && ids.hasNext()) {
    if (cursor.next(ids.next()) && !IdValidator.isReservedId(record.getId())) {
      RECORD newRecord=(RECORD)record.clone();
      batch[i]=newRecord;
      i++;
    }
  }
  count+=i;
  batch=i == batchSize ? batch : Arrays.copyOf(batch,i);
  return batch.length > 0 ? batch : null;
}
