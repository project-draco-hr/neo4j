{
  GraphDatabaseShellServer server=getServer(kernel);
  if (server != null) {
    throw new IllegalStateException("Shell already enabled");
  }
  if (config == null)   config=Collections.<String,Serializable>emptyMap();
  try {
    server=new GraphDatabaseShellServer(kernel.graphDatabase());
    int port=(Integer)getConfig(config,"port","DEFAULT_PORT");
    String name=(String)getConfig(config,"name","DEFAULT_NAME");
    server.makeRemotelyAvailable(port,name);
  }
 catch (  Exception ex) {
    if (server != null)     server.shutdown();
    throw new IllegalStateException("Can't start remote Neo4j shell",ex);
  }
  setServer(kernel,server);
}
