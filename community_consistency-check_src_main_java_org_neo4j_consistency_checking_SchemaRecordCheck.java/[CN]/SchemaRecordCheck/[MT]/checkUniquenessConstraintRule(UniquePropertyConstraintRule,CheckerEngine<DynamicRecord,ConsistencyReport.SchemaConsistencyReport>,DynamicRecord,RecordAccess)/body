{
  if (phase == Phase.CHECK_RULES) {
    engine.comparativeCheck(records.label(rule.getLabel()),VALID_LABEL);
    engine.comparativeCheck(records.propertyKey(rule.getPropertyKey()),VALID_PROPERTY_KEY);
    checkForDuplicates(rule,record,engine);
    DynamicRecord previousObligation=indexObligations.put(rule.getOwnedIndex(),record);
    if (null != previousObligation) {
      engine.report().duplicateObligation(previousObligation);
    }
  }
 else   if (phase == Phase.CHECK_OBLIGATIONS) {
    DynamicRecord obligation=constraintObligations.get(rule.getId());
    if (null == obligation) {
      engine.report().missingObligation(SchemaRule.Kind.CONSTRAINT_INDEX_RULE);
    }
 else {
      if (obligation.getId() != rule.getOwnedIndex()) {
        engine.report().uniquenessConstraintNotReferencingBack(obligation);
      }
    }
  }
}
