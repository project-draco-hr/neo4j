{
  if (phase == Phase.CHECK_RULES) {
    engine.comparativeCheck(records.propertyKey(rule.getPropertyKey()),VALID_PROPERTY_KEY);
    if (rule.isConstraintIndex() && rule.getOwningConstraint() != null) {
      DynamicRecord previousObligation=constraintObligations.put(rule.getOwningConstraint(),record);
      if (null != previousObligation) {
        engine.report().duplicateObligation(previousObligation);
      }
    }
  }
 else   if (phase == Phase.CHECK_OBLIGATIONS) {
    if (rule.isConstraintIndex()) {
      DynamicRecord obligation=indexObligations.get(rule.getId());
      if (null == obligation) {
        if (rule.getOwningConstraint() != null) {
          engine.report().missingObligation(SchemaRule.Kind.UNIQUENESS_CONSTRAINT);
        }
      }
 else {
        if (obligation.getId() != rule.getOwningConstraint()) {
          engine.report().constraintIndexRuleNotReferencingBack(obligation);
        }
      }
    }
  }
}
