{
  long leaderWaitEndTime=leaderWaitTimeout + clock.currentTimeMillis();
  while (state.leader() == null && (clock.currentTimeMillis() < leaderWaitEndTime)) {
    LockSupport.parkNanos(MILLISECONDS.toNanos(electionTimeout) / 2);
  }
  if (state.leader() == null) {
    throw new NoLeaderTimeoutException();
  }
  return state.leader();
}
