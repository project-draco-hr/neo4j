{
  long sleep=Math.max(unit.toMillis(timeout) / 100,1);
  long deadline=System.currentTimeMillis() + unit.toMillis(timeout);
  do {
    if (predicate.accept(supplier.get())) {
      return;
    }
    Thread.sleep(sleep);
  }
 while (System.currentTimeMillis() < deadline);
  throw new TimeoutException("Waited for " + timeout + " "+ unit+ ", but "+ predicate+ " was not accepted.");
}
