{
  when(master.commit(requestContext,tx)).thenThrow(new IOException());
  try {
    commitProcess.commit(tx,new LockGroup(),CommitEvent.NULL,TransactionApplicationMode.INTERNAL);
    fail("commit should have thrown");
  }
 catch (  TransactionFailureException e) {
    assertThat(e.status(),is((Status)Status.Transaction.CouldNotCommit));
  }
}
