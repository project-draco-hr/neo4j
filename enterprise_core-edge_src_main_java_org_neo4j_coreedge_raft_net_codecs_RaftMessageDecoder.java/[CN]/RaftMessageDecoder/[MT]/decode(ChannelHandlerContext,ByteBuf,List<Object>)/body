{
  int messageTypeWire=buffer.readInt();
  RaftMessages.Type[] values=RaftMessages.Type.values();
  RaftMessages.Type messageType=values[messageTypeWire];
  CoreMember from=retrieveMember(buffer);
  if (messageType.equals(VOTE_REQUEST)) {
    CoreMember candidate=retrieveMember(buffer);
    long term=buffer.readLong();
    long lastLogIndex=buffer.readLong();
    long lastLogTerm=buffer.readLong();
    RaftMessages.Vote.Request<CoreMember> request=new RaftMessages.Vote.Request<>(from,term,candidate,lastLogIndex,lastLogTerm);
    list.add(request);
  }
 else   if (messageType.equals(VOTE_RESPONSE)) {
    long term=buffer.readLong();
    boolean voteGranted=buffer.readBoolean();
    RaftMessages.Vote.Response<CoreMember> response=new RaftMessages.Vote.Response<>(from,term,voteGranted);
    list.add(response);
  }
 else   if (messageType.equals(APPEND_ENTRIES_REQUEST)) {
    long term=buffer.readLong();
    long prevLogIndex=buffer.readLong();
    long prevLogTerm=buffer.readLong();
    long leaderCommit=buffer.readLong();
    long count=buffer.readLong();
    RaftLogEntry[] entries=new RaftLogEntry[(int)count];
    for (int i=0; i < count; i++) {
      long entryTerm=buffer.readLong();
      final ReplicatedContent content=marshal.deserialize(buffer);
      entries[i]=new RaftLogEntry(entryTerm,content);
    }
    list.add(new RaftMessages.AppendEntries.Request<>(from,term,prevLogIndex,prevLogTerm,entries,leaderCommit));
  }
 else   if (messageType.equals(APPEND_ENTRIES_RESPONSE)) {
    long term=buffer.readLong();
    boolean success=buffer.readBoolean();
    long matchIndex=buffer.readLong();
    long appendIndex=buffer.readLong();
    list.add(new RaftMessages.AppendEntries.Response<>(from,term,success,matchIndex,appendIndex));
  }
 else   if (messageType.equals(NEW_ENTRY_REQUEST)) {
    ReplicatedContent content=marshal.deserialize(buffer);
    list.add(new RaftMessages.NewEntry.Request<>(from,content));
  }
 else   if (messageType.equals(HEARTBEAT)) {
    long leaderTerm=buffer.readLong();
    long commitIndexTerm=buffer.readLong();
    long commitIndex=buffer.readLong();
    list.add(new RaftMessages.Heartbeat<>(from,leaderTerm,commitIndex,commitIndexTerm));
  }
 else {
    throw new IllegalArgumentException("Unknown message type");
  }
}
