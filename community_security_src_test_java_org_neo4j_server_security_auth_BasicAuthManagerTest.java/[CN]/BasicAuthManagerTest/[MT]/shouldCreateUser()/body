{
  final InMemoryUserRepository users=new InMemoryUserRepository();
  final BasicAuthManager manager=new BasicAuthManager(users,mock(PasswordPolicy.class),mock(AuthenticationStrategy.class));
  manager.start();
  manager.newUser("foo","bar",true);
  User user=users.getUserByName("foo");
  assertNotNull(user);
  assertTrue(user.passwordChangeRequired());
  assertTrue(user.credentials().matchesPassword("bar"));
}
