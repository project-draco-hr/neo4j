{
  final InMemoryUserRepository users=new InMemoryUserRepository();
  final User user=new User.Builder("jake",Credential.forPassword("abc123")).withRequiredPasswordChange(true).build();
  users.create(user);
  final AuthenticationStrategy authStrategy=mock(AuthenticationStrategy.class);
  final BasicAuthManager manager=new BasicAuthManager(users,mock(PasswordPolicy.class),authStrategy);
  manager.start();
  when(authStrategy.authenticate(user,"abc123")).thenReturn(AuthenticationResult.TOO_MANY_ATTEMPTS);
  AuthSubject authSubject=manager.login(authToken("jake","abc123"));
  AuthenticationResult result=authSubject.getAuthenticationResult();
  assertThat(result,equalTo(AuthenticationResult.TOO_MANY_ATTEMPTS));
}
