{
  final CommandState state=new CommandState(index,graphDb);
  threadState.set(STARTING);
  while (state.alive) {
    try {
      latch=new CountDownLatch(1);
      log("WORKER: Waiting for latch");
      latch.await();
      threadState.set(RUNNING);
      Command command=commands.poll();
      log("WORKER: I have a command! " + command.getClass().getSimpleName());
      command.doWork(state);
      threadState.set(DONE);
    }
 catch (    InterruptedException e) {
      throw new RuntimeException(e);
    }
catch (    Exception exception) {
      this.exception=exception;
      threadState.set(DONE);
    }
  }
}
