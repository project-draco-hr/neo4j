{
  GraphDatabaseFactory factory=new GraphDatabaseFactory(){
    @Override protected GraphDatabaseService newDatabase(    String path,    Map<String,String> config,    InternalAbstractGraphDatabase.Dependencies dependencies){
      return new EmbeddedGraphDatabase(path,config,dependencies){
        @Override protected LifecycledPageCache createPageCache(){
          return new ExternallyManagedLifecycledPageCache(StoreCopyClient.this.pageCache);
        }
      }
;
    }
  }
;
  return factory.setLogging(logging).setKernelExtensions(kernelExtensions).newEmbeddedDatabaseBuilder(tempStore.getAbsolutePath()).setConfig(GraphDatabaseSettings.keep_logical_logs,Settings.TRUE).setConfig(GraphDatabaseSettings.allow_store_upgrade,config.get(GraphDatabaseSettings.allow_store_upgrade).toString()).setConfig(InternalAbstractGraphDatabase.Configuration.log_configuration_file,logConfigFileName()).newGraphDatabase();
}
