{
  final CommandHandler applier=newApplier(true);
  final RelationshipTypeTokenRecord record=new RelationshipTypeTokenRecord(42);
  final Command.RelationshipTypeTokenCommand command=(RelationshipTypeTokenCommand)new Command.RelationshipTypeTokenCommand().init(record);
  final RelationshipTypeToken token=new RelationshipTypeToken("token",21);
  when(relationshipTypeTokenStore.getToken((int)command.getKey())).thenReturn(token);
  applier.begin(transactionToApply);
  final boolean result=applier.visitRelationshipTypeTokenCommand(command);
  applier.end();
  applyAndClose(applier);
  assertFalse(result);
  verify(relationshipTypeTokenStore,times(1)).setHighestPossibleIdInUse(record.getId());
  verify(relationshipTypeTokenStore,times(1)).updateRecord(record);
  verify(cacheAccess,times(1)).addRelationshipTypeToken(token);
}
