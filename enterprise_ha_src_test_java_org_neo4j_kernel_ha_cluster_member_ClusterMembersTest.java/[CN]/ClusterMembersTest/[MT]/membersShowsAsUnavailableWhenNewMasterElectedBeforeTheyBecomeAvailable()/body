{
  Cluster cluster=mock(Cluster.class);
  BindingNotifier binding=mock(BindingNotifier.class);
  Heartbeat heartbeat=mock(Heartbeat.class);
  ClusterMemberEvents clusterMemberEvents=mock(ClusterMemberEvents.class);
  ClusterMembers members=new ClusterMembers(cluster,binding,heartbeat,clusterMemberEvents);
  ArgumentCaptor<ClusterListener> listener=ArgumentCaptor.forClass(ClusterListener.class);
  verify(cluster).addClusterListener(listener.capture());
  listener.getValue().enteredCluster(clusterConfiguration(clusterUri1,clusterUri2,clusterUri3));
  ArgumentCaptor<ClusterMemberListener> clusterMemberListener=ArgumentCaptor.forClass(ClusterMemberListener.class);
  verify(clusterMemberEvents).addClusterMemberListener(clusterMemberListener.capture());
  clusterMemberListener.getValue().memberIsAvailable(SLAVE,clusterUri1,haUri1);
  clusterMemberListener.getValue().masterIsElected(clusterUri2);
  assertThat(members.getMembers(),CoreMatchers.<ClusterMember>hasItem(sameMemberAs(new ClusterMember(clusterUri1))));
}
