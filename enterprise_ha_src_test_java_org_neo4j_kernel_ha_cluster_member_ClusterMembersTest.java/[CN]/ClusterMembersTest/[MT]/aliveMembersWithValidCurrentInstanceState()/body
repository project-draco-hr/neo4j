{
  ClusterMember currentInstance=createClusterMember(1,HighAvailabilityModeSwitcher.UNKNOWN);
  ClusterMember otherInstance=createClusterMember(2,HighAvailabilityModeSwitcher.SLAVE);
  List<ClusterMember> members=Arrays.asList(currentInstance,otherInstance);
  when(observedClusterMembers.getAliveMembers()).thenReturn(members);
  when(observedClusterMembers.getCurrentMember()).thenReturn(currentInstance);
  when(stateMachine.getCurrentState()).thenReturn(HighAvailabilityMemberState.MASTER);
  Iterable<ClusterMember> currentMembers=clusterMembers.getAliveMembers();
  assertEquals("Only active members should be available",2,Iterables.count(currentMembers));
  assertEquals(1,countInstancesWithRole(currentMembers,HighAvailabilityModeSwitcher.MASTER));
  assertEquals(1,countInstancesWithRole(currentMembers,HighAvailabilityModeSwitcher.SLAVE));
}
