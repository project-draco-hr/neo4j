{
  FileSystemAbstraction fs=new EphemeralFileSystemAbstraction();
  StoreChannel channel=fs.open(new File("id.file"),"rw");
  int threshold=10;
  FreeIdKeeper keeper=new FreeIdKeeper(channel,threshold,true);
  Set<Long> freeIds=new HashSet<>();
  for (long i=0; i < threshold * 2; i++) {
    keeper.freeId(i);
    freeIds.add(i);
  }
  assertEquals(freeIds.size(),keeper.getCount());
  for (int i=threshold * 2 - 1; i >= 0; i--) {
    assertTrue(freeIds.remove(keeper.getId()));
  }
}
