{
  IdOrderingQueue queue=new SynchronizedArrayIdOrderingQueue(5);
  long offeredId=0, awaitedId=0;
  queue.offer(offeredId++);
  queue.offer(offeredId++);
  for (int i=0; i < 20; i++) {
    queue.waitFor(awaitedId);
    queue.removeChecked(awaitedId++);
    queue.offer(offeredId++);
    assertFalse(queue.isEmpty());
  }
  queue.removeChecked(awaitedId++);
  queue.removeChecked(awaitedId++);
  assertTrue(queue.isEmpty());
}
