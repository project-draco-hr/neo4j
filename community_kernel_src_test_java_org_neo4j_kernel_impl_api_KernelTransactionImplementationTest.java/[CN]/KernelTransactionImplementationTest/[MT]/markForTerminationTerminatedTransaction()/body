{
  Locks locks=mock(Locks.class);
  Locks.Client client=mock(Locks.Client.class);
  when(locks.newClient()).thenReturn(client);
  KernelTransactionImplementation transaction=newInitializedTransaction(true,locks);
  transaction.markForTermination(Status.Transaction.Terminated);
  transaction.markForTermination(Status.Transaction.Outdated);
  transaction.markForTermination(Status.Transaction.LockClientStopped);
  assertEquals(Status.Transaction.Terminated,transaction.getReasonIfTerminated());
  verify(client).stop();
  verify(transactionMonitor).transactionTerminated();
}
