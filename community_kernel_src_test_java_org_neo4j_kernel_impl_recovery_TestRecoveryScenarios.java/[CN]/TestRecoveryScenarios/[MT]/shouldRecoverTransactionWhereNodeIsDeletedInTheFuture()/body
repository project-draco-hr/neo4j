{
  Node node;
  try (Transaction tx=db.beginTx()){
    node=db.createNode(label);
    node.setProperty("key","value");
    tx.success();
  }
   rotateLog();
  try (Transaction tx=db.beginTx()){
    node.setProperty("other-key",1);
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    node.delete();
    tx.success();
  }
   flushAll();
  FileSystemAbstraction uncleanFs=fsRule.snapshot(shutdownDb(db));
  db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().setFileSystem(uncleanFs).newImpermanentDatabase();
  try (Transaction tx=db.beginTx()){
    node=db.getNodeById(node.getId());
    fail("Should not exist");
  }
 catch (  NotFoundException e) {
    assertEquals("Node " + node.getId() + " not found",e.getMessage());
  }
}
