{
synchronized (logFile) {
    logRotation.rotateLogIfNeeded(LogAppendEvent.NULL);
    if (!kernelHealth.isHealthy()) {
      Throwable causeOfPanic=kernelHealth.getCauseOfPanic();
      log.error(msg + " Original kernel panic cause was:\n" + causeOfPanic.getMessage());
      throw new IOException(msg,causeOfPanic);
    }
    try {
      if (transactionQueue.accept(batchCommitter) > 0) {
        appender.force();
        try {
          transactionQueue.accept(batchApplier);
          storeApplier.closeBatch();
        }
  finally {
          transactionQueue.accept(batchCloser);
        }
      }
    }
  finally {
      transactionQueue.clear();
    }
  }
}
