{
  response.accept(new Visitor<CommittedTransactionRepresentation,IOException>(){
    @Override public boolean visit(    CommittedTransactionRepresentation transaction) throws IOException {
synchronized (appender) {
        if (appender.append(transaction)) {
          final boolean isMyTx=serverId != NO_SERVER_ID && serverId == transaction.getTransactionRepresentation().getAuthorId();
          final long transactionId=transaction.getCommitEntry().getTxId();
          if (!isMyTx) {
            transactionMonitor.transactionStarted();
          }
          boolean success=false;
          try {
            storeApplier.apply(transaction.getTransactionRepresentation(),transactionId,true);
            handler.accept(transaction);
            success=true;
          }
  finally {
            transactionIdStore.transactionClosed(transactionId);
            if (!isMyTx) {
              transactionMonitor.transactionFinished(success);
            }
          }
        }
      }
      return true;
    }
  }
);
  return response.response();
}
