{
  if (committed) {
    throw new TransactionFailureException("Cannot add command to committed transaction");
  }
  if (rolledback) {
    throw new TransactionFailureException("Cannot add command to rolled back transaction");
  }
  doAddCommand(command);
  try {
    log.writeCommand(command,getIdentifier());
  }
 catch (  IOException e) {
    throw new TransactionFailureException("Unable to write command to logical log.",e);
  }
}
