{
  this.fileSystem=fileSystem;
  this.monitors=monitors;
  this.writerFactory=writerFactory;
  this.logger=logging.getMessagesLog(getClass());
  this.neo4jConfig=configForStoreDir(new Config(stringMap(dense_node_threshold.name(),valueOf(config.denseNodeThreshold())),GraphDatabaseSettings.class),new File(storeDir));
  this.pageCacheFactory=new BatchingPageCache(fileSystem,config.fileChannelBufferSize(),writerFactory,writeMonitor,APPEND_ONLY);
  this.neoStore=newNeoStore(pageCacheFactory);
  flushNeoStoreAndAwaitEverythingWritten();
  neoStore.setLastCommittedAndClosedTransactionId(highTokenIds.lastCommittedTransactionId());
  this.propertyKeyRepository=new BatchingPropertyKeyTokenRepository(neoStore.getPropertyKeyTokenStore(),highTokenIds.highPropertyKeyTokenId());
  this.labelRepository=new BatchingLabelTokenRepository(neoStore.getLabelTokenStore(),highTokenIds.highLabelTokenId());
  this.relationshipTypeRepository=new BatchingRelationshipTypeTokenRepository(neoStore.getRelationshipTypeTokenStore(),highTokenIds.highRelationshipTypeTokenId());
}
