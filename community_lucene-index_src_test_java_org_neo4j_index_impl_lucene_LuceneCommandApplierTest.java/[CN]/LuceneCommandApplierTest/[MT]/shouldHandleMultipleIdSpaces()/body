{
  fs.get().mkdirs(dir);
  String indexName="name", key="key";
  IndexConfigStore configStore=new IndexConfigStore(dir,fs.get());
  configStore.set(Node.class,indexName,EXACT_CONFIG);
  LuceneDataSource dataSource=life.add(spy(new LuceneDataSource(new Config(stringMap(LuceneDataSource.Configuration.store_dir.name(),dir.getAbsolutePath(),LuceneDataSource.Configuration.ephemeral.name(),Settings.TRUE)),configStore,fs.get())));
  try (LuceneCommandApplier applier=new LuceneCommandApplier(dataSource,false)){
    IndexDefineCommand definitions=definitions(MapUtil.<String,Integer>genericMap(indexName,0),MapUtil.<String,Integer>genericMap(key,0));
    applier.visitIndexDefineCommand(definitions);
    applier.visitIndexAddNodeCommand(addNodeToIndex(definitions,indexName,0L));
    definitions=definitions(MapUtil.<String,Integer>genericMap(indexName,1),MapUtil.<String,Integer>genericMap(key,0));
    applier.visitIndexDefineCommand(definitions);
    applier.visitIndexAddNodeCommand(addNodeToIndex(definitions,indexName,1L));
    applier.apply();
  }
   verify(dataSource,times(1)).getIndexSearcher(any(IndexIdentifier.class));
}
