{
  DatabaseReference ref=db;
  if (ref == null) {
    System.out.println("Shutdown attempted before completion of startup");
    throw new IllegalStateException("database has not been started");
  }
  System.out.println("Shutdown started");
  try {
    ref.shutdown();
  }
  finally {
    db((HighlyAvailableGraphDatabase)null);
  }
  System.out.println("Shutdown completed");
  super.shutdown(normal);
}
