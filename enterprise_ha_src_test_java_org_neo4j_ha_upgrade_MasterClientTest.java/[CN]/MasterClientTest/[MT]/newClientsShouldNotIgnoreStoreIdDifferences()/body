{
  MasterImpl.SPI masterImplSPI=mock(MasterImpl.SPI.class);
  when(masterImplSPI.storeId()).thenReturn(new StoreId(1,2,3,4));
  when(masterImplSPI.getMasterIdForCommittedTx(anyLong())).thenReturn(Pair.of(1,5L));
  MasterServer masterServer=cleanupRule.add(newMasterServer(masterImplSPI));
  masterServer.init();
  masterServer.start();
  StoreId storeId=new StoreId(5,6,7,8);
  MasterClient214 masterClient214=cleanupRule.add(newMasterClient214(storeId));
  masterClient214.init();
  masterClient214.start();
  masterClient214.handshake(1,storeId);
}
