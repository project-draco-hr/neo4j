{
  long[] current=new long[10];
  int cursor=0;
  ResourceType currentType=null;
  boolean currentExclusive=false;
  for (  Resource resource : locks) {
    if (currentType == null || (currentType.typeId() != resource.resourceType.typeId() || currentExclusive != resource.exclusive)) {
      if (!flushLocks(current,cursor,currentType,currentExclusive)) {
        break;
      }
      cursor=0;
      currentType=resource.resourceType;
      currentExclusive=resource.exclusive;
    }
    if (cursor == current.length) {
      current=Arrays.copyOf(current,cursor * 2);
    }
    current[cursor++]=resource.resourceId;
  }
  flushLocks(current,cursor,currentType,currentExclusive);
}
