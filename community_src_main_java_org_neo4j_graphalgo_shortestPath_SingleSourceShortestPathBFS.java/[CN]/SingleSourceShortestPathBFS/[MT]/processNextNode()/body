{
  if (currentLayer.isEmpty()) {
    if (nextLayer.isEmpty()) {
      return false;
    }
    currentLayer=nextLayer;
    nextLayer=new LinkedList<Node>();
    ++depth;
  }
  Node node=currentLayer.poll();
  if (distances.containsKey(node)) {
    return true;
  }
  distances.put(node,(int)depth);
  for (  RelationshipType relationshipType : relationShipTypes) {
    for (    Relationship relationship : node.getRelationships(relationshipType,relationShipDirection)) {
      Node targetNode=relationship.getOtherNode(node);
      if (!distances.containsKey(targetNode)) {
        nextLayer.add(targetNode);
        List<Relationship> targetPreds=predecessors.get(targetNode);
        if (targetPreds == null) {
          targetPreds=new LinkedList<Relationship>();
          predecessors.put(targetNode,targetPreds);
        }
        targetPreds.add(relationship);
      }
    }
  }
  return true;
}
