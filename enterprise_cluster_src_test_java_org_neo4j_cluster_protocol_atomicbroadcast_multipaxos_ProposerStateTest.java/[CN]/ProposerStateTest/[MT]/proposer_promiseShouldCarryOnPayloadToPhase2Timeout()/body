{
  String instanceId="1";
  Serializable payload="myPayload";
  PaxosInstance instance=new PaxosInstance(mock(PaxosInstanceStore.class),new org.neo4j.cluster.protocol.atomicbroadcast.multipaxos.InstanceId(instanceId));
  instance.propose(1,asList(create("http://some-guy")));
  instance.value_2=payload;
  ProposerContext context=mock(ProposerContext.class);
  when(context.getPaxosInstance(any(org.neo4j.cluster.protocol.atomicbroadcast.multipaxos.InstanceId.class))).thenReturn(instance);
  when(context.getMinimumQuorumSize(anyList())).thenReturn(1);
  TrackingMessageHolder outgoing=new TrackingMessageHolder();
  Message<ProposerMessage> message=to(promise,create("http://something"),new ProposerMessage.PromiseState(1,payload)).setHeader(INSTANCE,instanceId);
  ProposerState.proposer.handle(context,message,outgoing);
  verify(context).setTimeout(eq(new org.neo4j.cluster.protocol.atomicbroadcast.multipaxos.InstanceId(instanceId)),argThat(new MessageArgumentMatcher<>().withPayload(payload)));
}
