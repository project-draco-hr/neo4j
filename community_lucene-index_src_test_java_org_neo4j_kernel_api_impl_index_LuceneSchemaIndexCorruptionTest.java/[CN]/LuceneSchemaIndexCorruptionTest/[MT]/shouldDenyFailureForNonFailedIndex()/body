{
  DirectoryFactory dirFactory=mock(DirectoryFactory.class);
  EOFException toThrow=new EOFException("/some/path/somewhere");
  when(dirFactory.open(any(File.class))).thenThrow(toThrow);
  LuceneSchemaIndexProvider p=getLuceneSchemaIndexProvider(dirFactory);
  InternalIndexState initialState=p.getInitialState(1l);
  assertThat(initialState,equalTo(InternalIndexState.FAILED));
  boolean exceptionOnOtherIndexThrown=false;
  try {
    p.getPopulationFailure(2l);
  }
 catch (  IllegalStateException e) {
    exceptionOnOtherIndexThrown=true;
  }
  assertTrue(exceptionOnOtherIndexThrown);
}
