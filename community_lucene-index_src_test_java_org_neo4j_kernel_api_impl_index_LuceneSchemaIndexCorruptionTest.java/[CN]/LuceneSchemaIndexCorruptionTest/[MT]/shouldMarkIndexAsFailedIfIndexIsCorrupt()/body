{
  DirectoryFactory dirFactory=mock(DirectoryFactory.class);
  when(dirFactory.open(any(File.class))).thenThrow(new CorruptIndexException("It's borken."));
  LuceneSchemaIndexProvider p=new LuceneSchemaIndexProvider(dirFactory,new Config(stringMap("store_dir",forTest(getClass()).graphDbDir(true).getAbsolutePath())));
  InternalIndexState initialState=p.getInitialState(1l);
  assertThat(initialState,equalTo(InternalIndexState.FAILED));
}
