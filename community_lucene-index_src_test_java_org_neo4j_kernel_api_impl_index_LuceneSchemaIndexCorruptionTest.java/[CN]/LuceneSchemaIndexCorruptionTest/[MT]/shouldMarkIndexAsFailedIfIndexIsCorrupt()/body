{
  DirectoryFactory dirFactory=mock(DirectoryFactory.class);
  when(dirFactory.open(any(File.class))).thenThrow(new CorruptIndexException("It's borken."));
  LuceneSchemaIndexProvider p=getLuceneSchemaIndexProvider(dirFactory);
  InternalIndexState initialState=p.getInitialState(1l);
  assertThat(initialState,equalTo(InternalIndexState.FAILED));
}
