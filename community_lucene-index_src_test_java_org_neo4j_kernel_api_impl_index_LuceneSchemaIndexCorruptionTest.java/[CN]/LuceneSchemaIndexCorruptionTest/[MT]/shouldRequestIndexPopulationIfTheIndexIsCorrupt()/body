{
  DirectoryFactory dirFactory=mock(DirectoryFactory.class);
  CorruptIndexException toThrow=new CorruptIndexException("It's borken.");
  when(dirFactory.open(any(File.class))).thenThrow(toThrow);
  LuceneSchemaIndexProvider p=getLuceneSchemaIndexProvider(dirFactory);
  InternalIndexState initialState=p.getInitialState(1l);
  assertThat(initialState,equalTo(InternalIndexState.POPULATING));
  logProvider.assertAtLeastOnce(loggedException(toThrow));
}
