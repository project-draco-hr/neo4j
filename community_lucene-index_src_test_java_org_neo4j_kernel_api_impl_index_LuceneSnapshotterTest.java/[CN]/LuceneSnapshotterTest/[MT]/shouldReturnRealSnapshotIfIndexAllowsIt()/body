{
  LuceneSnapshotter snapshotter=new LuceneSnapshotter();
  when(luceneSnapshot.getFileNames()).thenReturn(asList("a","b"));
  ResourceIterator<File> snapshot=snapshotter.snapshot(indexDir,writer);
  assertEquals(new File(indexDir,"a"),snapshot.next());
  assertEquals(new File(indexDir,"b"),snapshot.next());
  assertFalse(snapshot.hasNext());
  snapshot.close();
  verify(snapshotPolicy).release(any(IndexCommit.class));
}
