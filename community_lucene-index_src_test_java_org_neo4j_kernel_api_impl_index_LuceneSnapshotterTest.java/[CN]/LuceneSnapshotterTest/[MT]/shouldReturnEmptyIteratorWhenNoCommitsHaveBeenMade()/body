{
  LuceneSnapshotter snapshotter=new LuceneSnapshotter();
  when(luceneSnapshot.getFileNames()).thenThrow(new IllegalStateException("No index commit to snapshot"));
  ResourceIterator<File> snapshot=snapshotter.snapshot(indexDir,writer);
  assertFalse(snapshot.hasNext());
  snapshot.close();
  verify(snapshotPolicy).snapshot();
  verifyNoMoreInteractions(snapshotPolicy);
}
