{
  LogFile logFile=mock(LogFile.class);
  InMemoryLogChannel channel=new InMemoryLogChannel();
  when(logFile.getWriter()).thenReturn(channel);
  TxIdGenerator txIdGenerator=mock(TxIdGenerator.class);
  TransactionMetadataCache positionCache=new TransactionMetadataCache(10,100);
  TransactionIdStore transactionIdStore=mock(TransactionIdStore.class);
  TransactionAppender appender=new PhysicalTransactionAppender(logFile,txIdGenerator,positionCache,transactionIdStore);
  PhysicalTransactionRepresentation transaction=new PhysicalTransactionRepresentation(singleCreateNodeCommand());
  final byte[] additionalHeader=new byte[]{1,2,5};
  final int masterId=2, authorId=1;
  final long timeWritten=12345, latestCommittedTxWhenStarted=4545;
  transaction.setHeader(additionalHeader,masterId,authorId,timeWritten,latestCommittedTxWhenStarted);
  appender.append(transaction);
  try (PhysicalTransactionCursor reader=new PhysicalTransactionCursor(channel,new VersionAwareLogEntryReader(CommandReaderFactory.DEFAULT))){
    reader.next();
    TransactionRepresentation tx=reader.get().getTransactionRepresentation();
    assertArrayEquals(additionalHeader,tx.additionalHeader());
    assertEquals(masterId,tx.getMasterId());
    assertEquals(authorId,tx.getAuthorId());
    assertEquals(timeWritten,tx.getTimeWritten());
    assertEquals(latestCommittedTxWhenStarted,tx.getLatestCommittedTxWhenStarted());
  }
 }
