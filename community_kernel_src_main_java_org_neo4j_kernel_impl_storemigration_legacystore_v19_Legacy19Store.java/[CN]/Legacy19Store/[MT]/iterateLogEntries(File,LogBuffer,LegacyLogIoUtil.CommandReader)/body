{
  final StoreChannel channel=fs.open(legacyLogFile,"r");
  final ByteBuffer buffer=ByteBuffer.allocate(100000);
  final LegacyLogIoUtil logIoUtil=new LegacyLogIoUtil(commandReader);
  long[] header=LegacyLogIoUtil.readLogHeader(buffer,channel,false);
  if (header != null) {
    ByteBuffer headerBuf=ByteBuffer.allocate(16);
    writeLogHeader(headerBuf,header[0],header[1]);
    logBuffer.put(headerBuf.array());
  }
  Resource resource=new Resource(){
    @Override public void close(){
      try {
        channel.close();
      }
 catch (      IOException e) {
        throw new RuntimeException("Failed to close legacy log channel",e);
      }
    }
  }
;
  return newResourceIterator(resource,new PrefetchingIterator<LogEntry>(){
    @Override protected LogEntry fetchNextOrNull(){
      try {
        return logIoUtil.readEntry(buffer,channel);
      }
 catch (      IOException e) {
        throw new RuntimeException("Failed to read legacy log entry",e);
      }
    }
  }
);
}
