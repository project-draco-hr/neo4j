{
  Monitor monitor=mock(Monitor.class);
  Encoder encoder=mock(Encoder.class);
  when(encoder.encode(any())).thenReturn(12345L);
  IdMapper mapper=mapper(encoder,Radix.STRING,monitor);
  InputIterable<Object> ids=wrap("source",Arrays.<Object>asList("10","9"));
  try (ResourceIterator<Object> iterator=ids.iterator()){
    for (int i=0; iterator.hasNext(); i++) {
      mapper.put(iterator.next(),i,GLOBAL);
    }
  }
   ProgressListener progress=mock(ProgressListener.class);
  Collector collector=mock(Collector.class);
  mapper.prepare(ids,collector,progress);
  verifyNoMoreInteractions(collector);
  verify(monitor).numberOfCollisions(2);
  assertEquals(0L,mapper.get("10",GLOBAL));
  assertEquals(1L,mapper.get("9",GLOBAL));
  verify(progress,times(7)).started(anyString());
  verify(progress,times(7)).done();
}
