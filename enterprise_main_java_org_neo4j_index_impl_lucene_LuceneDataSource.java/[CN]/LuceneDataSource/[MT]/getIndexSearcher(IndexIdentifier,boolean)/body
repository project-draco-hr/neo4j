{
  try {
    IndexSearcherRef searcher=indexSearchers.get(identifier);
    if (searcher == null) {
      IndexWriter writer=getIndexWriter(identifier);
      IndexReader reader=writer.getReader();
      IndexSearcher indexSearcher=new IndexSearcher(reader);
      searcher=new IndexSearcherRef(identifier,indexSearcher);
      indexSearchers.put(identifier,searcher);
    }
 else {
      Triplet<IndexWriter,AtomicBoolean,SnapshotDeletionPolicy> writer=indexWriters.get(identifier);
      if (writer != null && writer.second().compareAndSet(true,false)) {
        searcher=refreshSearcher(searcher);
        if (searcher != null) {
          indexSearchers.put(identifier,searcher);
        }
      }
    }
    if (incRef) {
      searcher.incRef();
    }
    return searcher;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
