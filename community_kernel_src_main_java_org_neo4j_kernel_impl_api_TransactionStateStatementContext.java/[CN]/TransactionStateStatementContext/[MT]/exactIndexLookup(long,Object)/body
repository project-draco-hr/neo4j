{
  IndexDescriptor idx=delegate.getIndexDescriptor(indexId);
  DiffSets<Long> diff=state.getNodesWithChangedProperty(idx.getPropertyKeyId(),value);
  diff=diff.filterAdded(new HasLabelFilter(idx.getLabelId()));
  HasPropertyFilter hasPropertyFilter=new HasPropertyFilter(idx.getPropertyKeyId(),value);
  Iterator<Long> addedNodesWithLabel=state.getNodesWithLabelAdded(idx.getLabelId()).iterator();
  diff.addAll(Iterables.filter(hasPropertyFilter,addedNodesWithLabel));
  Set<Long> removedNodesWithLabel=state.getNodesWithLabelChanged(idx.getLabelId()).getRemoved();
  diff.removeAll(Iterables.filter(hasPropertyFilter,removedNodesWithLabel.iterator()));
  return state.getDeletedNodes().apply(diff.apply(delegate.exactIndexLookup(indexId,value)));
}
