{
  int id=idGenerator.nextId(Node.class);
  NodeImpl node=new NodeImpl(id,true,this);
  acquireLock(node,LockType.WRITE);
  try {
    EventData eventData=new EventData(new NodeOpData(node,id));
    if (!generateProActiveEvent(Event.NODE_CREATE,eventData)) {
      setRollbackOnly();
      throw new CreateException("Unable to create node, " + "pro-active event failed.");
    }
    addNodeToCache(node);
    generateReActiveEvent(Event.NODE_CREATE,eventData);
    return new NodeProxy(id,this);
  }
  finally {
    releaseLock(node,LockType.WRITE);
  }
}
