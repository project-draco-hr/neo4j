{
  final int hash=hash(key.hashCode());
  final int bucket=hash & bitwiseModByBuckets;
  for (Record<K,V> record=buckets[bucket]; record != null; record=record.next) {
    if (record.hashCode == hash && ((record.key == key) || record.key.equals(key))) {
      V old=record.value;
      record.value=value;
      return old;
    }
  }
  Record<K,V> record=new Record<>(hash,key,value,buckets[bucket],version);
  buckets[bucket]=record;
  if (size++ > resizeThreshold) {
    resize(buckets.length << 1);
  }
  return null;
}
