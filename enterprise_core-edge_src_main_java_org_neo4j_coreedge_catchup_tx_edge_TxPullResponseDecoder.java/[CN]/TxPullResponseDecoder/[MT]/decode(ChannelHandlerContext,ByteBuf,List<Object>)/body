{
  if (protocol.isExpecting(NextMessage.TX_PULL_RESPONSE)) {
    StoreId storeId=new StoreIdDecoder().decode(msg);
    NetworkReadableClosableByteBuf logChannel=new NetworkReadableClosableByteBuf(msg);
    LogEntryReader<NetworkReadableClosableByteBuf> reader=new VersionAwareLogEntryReader<>(new RecordStorageCommandReaderFactory());
    PhysicalTransactionCursor<NetworkReadableClosableByteBuf> transactionCursor=new PhysicalTransactionCursor<>(logChannel,reader);
    transactionCursor.next();
    CommittedTransactionRepresentation tx=transactionCursor.get();
    if (tx != null) {
      out.add(new TxPullResponse(storeId,tx));
    }
  }
 else {
    out.add(Unpooled.copiedBuffer(msg));
  }
}
