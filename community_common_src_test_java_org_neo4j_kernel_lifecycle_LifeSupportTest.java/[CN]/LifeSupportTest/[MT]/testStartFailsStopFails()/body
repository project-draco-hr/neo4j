{
  LifeSupport lifeSupport=newLifeSupport();
  Lifecycle lifecycle1=mock(Lifecycle.class);
  Lifecycle lifecycle2=mock(Lifecycle.class);
  RuntimeException startRuntimeException=new RuntimeException();
  RuntimeException stopRuntimeException=new RuntimeException();
  doThrow(startRuntimeException).when(lifecycle2).start();
  doThrow(stopRuntimeException).when(lifecycle1).stop();
  lifeSupport.add(lifecycle1);
  lifeSupport.add(lifecycle2);
  try {
    lifeSupport.start();
    fail("Expected exception");
  }
 catch (  LifecycleException e) {
    assertEquals(startRuntimeException,e.getCause());
    assertEquals(1,e.getSuppressed().length);
    assertEquals(stopRuntimeException,e.getSuppressed()[0].getCause());
    assertThat(e.getSuppressed()[0],instanceOf(LifecycleException.class));
  }
}
