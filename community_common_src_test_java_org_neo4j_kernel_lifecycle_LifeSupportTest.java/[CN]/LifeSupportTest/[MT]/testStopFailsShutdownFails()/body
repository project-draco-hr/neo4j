{
  LifeSupport lifeSupport=newLifeSupport();
  Lifecycle lifecycle1=mock(Lifecycle.class);
  Lifecycle lifecycle2=mock(Lifecycle.class);
  RuntimeException stopRuntimeException=new RuntimeException();
  RuntimeException shutdownRuntimeException=new RuntimeException();
  doThrow(stopRuntimeException).when(lifecycle2).stop();
  doThrow(shutdownRuntimeException).when(lifecycle1).shutdown();
  lifeSupport.add(lifecycle1);
  lifeSupport.add(lifecycle2);
  lifeSupport.start();
  try {
    lifeSupport.shutdown();
    fail("Expected exception");
  }
 catch (  LifecycleException e) {
    assertEquals(stopRuntimeException,e.getCause());
    assertEquals(1,e.getSuppressed().length);
    assertEquals(shutdownRuntimeException,e.getSuppressed()[0].getCause());
    assertThat(e.getSuppressed()[0],instanceOf(LifecycleException.class));
  }
}
