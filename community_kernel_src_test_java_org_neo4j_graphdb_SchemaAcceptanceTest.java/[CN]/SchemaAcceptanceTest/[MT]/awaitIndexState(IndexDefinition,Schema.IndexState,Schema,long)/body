{
  while (schema.getIndexState(index) != state) {
    Thread.yield();
    if (System.currentTimeMillis() > timeout) {
      fail("Expected index to come online within a reasonable time.");
    }
  }
}
