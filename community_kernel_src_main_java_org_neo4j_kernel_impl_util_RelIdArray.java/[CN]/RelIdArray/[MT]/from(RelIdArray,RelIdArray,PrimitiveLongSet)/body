{
  if (remove == null) {
    if (src == null) {
      return add.downgradeIfPossible();
    }
    if (add != null) {
      src=src.addAll(add);
      return src.downgradeIfPossible();
    }
    return src;
  }
  if (src == null && add == null) {
    return null;
  }
  RelIdArray newArray=null;
  if (src != null) {
    newArray=src.newSimilarInstance();
    newArray.addAll(src);
    evictExcluded(newArray,remove);
  }
 else {
    newArray=add.newSimilarInstance();
  }
  if (add != null) {
    newArray=newArray.upgradeIfNeeded(add);
    for (RelIdIteratorImpl fromIterator=(RelIdIteratorImpl)add.iterator(DirectionWrapper.BOTH); fromIterator.hasNext(); ) {
      long value=fromIterator.next();
      if (!remove.contains(value)) {
        newArray.add(value,fromIterator.currentDirection);
      }
    }
  }
  return newArray;
}
