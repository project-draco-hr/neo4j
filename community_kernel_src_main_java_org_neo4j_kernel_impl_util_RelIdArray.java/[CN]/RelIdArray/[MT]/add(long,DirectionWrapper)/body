{
  IdBlock lastBlock=direction.getLastBlock(this);
  long highBits=id & 0xFFFFFFFF00000000L;
  if (lastBlock == null || lastBlock.getHighBits() != highBits) {
    IdBlock newLastBlock=null;
    if (highBits == 0 && lastBlock == null) {
      newLastBlock=new LowIdBlock();
    }
 else {
      newLastBlock=new HighIdBlock(highBits);
      if (lastBlock != null) {
        lastBlock=lastBlock.upgradeIfNeeded();
        newLastBlock.setPrev(lastBlock);
      }
    }
    direction.setLastBlock(this,newLastBlock);
    lastBlock=newLastBlock;
  }
  lastBlock.add((int)id);
}
