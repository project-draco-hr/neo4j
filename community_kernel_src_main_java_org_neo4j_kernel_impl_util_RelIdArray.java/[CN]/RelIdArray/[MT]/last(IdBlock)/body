{
  IdBlock previousInLoop=null;
  while (true) {
    block=block.upgradeIfNeeded();
    if (previousInLoop != null) {
      previousInLoop.setPrev(block);
    }
    IdBlock prev=block.getPrev();
    if (prev == null) {
      return block;
    }
    previousInLoop=block;
    block=prev;
  }
}
