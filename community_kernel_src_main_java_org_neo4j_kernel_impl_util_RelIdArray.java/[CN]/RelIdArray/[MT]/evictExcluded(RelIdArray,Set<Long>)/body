{
  for (RelIdIterator iterator=DirectionWrapper.BOTH.iterator(ids); iterator.hasNext(); ) {
    long value=iterator.next();
    if (excluded.contains(value)) {
      boolean swapSuccessful=false;
      IteratorState state=iterator.currentState;
      IdBlock block=state.block;
      for (int j=block.length() - 1; j >= state.relativePosition; j--) {
        long backValue=block.get(j);
        block.ids[0]=block.ids[0] - 1;
        if (!excluded.contains(backValue)) {
          block.set(backValue,state.relativePosition - 1);
          swapSuccessful=true;
          break;
        }
      }
      if (!swapSuccessful) {
        block.ids[0]=block.ids[0] - 1;
      }
    }
  }
}
