{
  for (RelIdIterator iterator=DirectionWrapper.BOTH.iterator(ids); iterator.hasNext(); ) {
    long value=iterator.next();
    if (excluded.contains(value)) {
      boolean swapSuccessful=false;
      IdBlock block=iterator.currentBlock;
      for (int j=block.length - 1; j >= iterator.relativePosition; j--) {
        long backValue=block.get(j);
        block.length--;
        if (!excluded.contains(backValue)) {
          block.set(backValue,iterator.relativePosition - 1);
          swapSuccessful=true;
          break;
        }
      }
      if (!swapSuccessful) {
        iterator.currentBlock.length--;
      }
    }
  }
}
