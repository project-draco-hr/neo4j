{
  IdBlock lastBlock=direction == Direction.OUTGOING ? lastOutBlock : lastInBlock;
  long highBits=id & 0xFFFFFFFF00000000L;
  if (lastBlock == null || lastBlock.getHighBits() != highBits) {
    IdBlock newLastBlock=highBits == 0 ? new LowIdBlock() : new HighIdBlock(highBits);
    newLastBlock.prev=lastBlock;
    if (direction == Direction.OUTGOING)     lastOutBlock=newLastBlock;
 else     lastInBlock=newLastBlock;
    lastBlock=newLastBlock;
  }
  lastBlock.add((int)id);
}
