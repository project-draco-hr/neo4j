{
  IdBlock fromBlock=direction.getBlock(source);
  if (fromBlock == null || !filter.accept(type,direction,direction.firstId(this))) {
    return;
  }
  IdBlock toBlock=direction.getBlock(this);
  if (toBlock == null) {
    direction.setBlock(this,fromBlock.copyAndShrink());
  }
 else   if (toBlock.accepts(fromBlock)) {
    toBlock.addAll(fromBlock);
  }
 else {
    toBlock=toBlock.upgradeToHighIdBlock();
    toBlock.addAll(fromBlock);
    direction.setBlock(this,toBlock);
  }
}
