{
  rel.setFirstNextRel(firstNode.getNextRel());
  rel.setSecondNextRel(secondNode.getNextRel());
  if (firstNode.getNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    RelationshipRecord nextRel=getRelationshipRecord(firstNode.getNextRel() & 0xFFFFFFFFL);
    if (nextRel.getFirstNode() == firstNode.getId()) {
      nextRel.setFirstPrevRel(rel.getId());
    }
 else     if (nextRel.getSecondNode() == firstNode.getId()) {
      nextRel.setSecondPrevRel(rel.getId());
    }
 else {
      throw new RuntimeException(firstNode + " dont match " + nextRel);
    }
  }
  if (secondNode.getNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    RelationshipRecord nextRel=getRelationshipRecord(secondNode.getNextRel() & 0xFFFFFFFFL);
    if (nextRel.getFirstNode() == secondNode.getId()) {
      nextRel.setFirstPrevRel(rel.getId());
    }
 else     if (nextRel.getSecondNode() == secondNode.getId()) {
      nextRel.setSecondPrevRel(rel.getId());
    }
 else {
      throw new RuntimeException(firstNode + " dont match " + nextRel);
    }
  }
  firstNode.setNextRel(rel.getId());
  secondNode.setNextRel(rel.getId());
}
