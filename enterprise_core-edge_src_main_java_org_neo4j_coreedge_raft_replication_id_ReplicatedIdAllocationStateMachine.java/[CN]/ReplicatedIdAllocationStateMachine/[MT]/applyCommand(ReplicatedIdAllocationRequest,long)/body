{
  if (commandIndex <= idAllocationState.logIndex()) {
    return Optional.empty();
  }
  idAllocationState.logIndex(commandIndex);
  IdType idType=request.idType();
  if (request.idRangeStart() == firstUnallocated(idType)) {
    idAllocationState.firstUnallocated(idType,request.idRangeStart() + request.idRangeLength());
    return Optional.of(Result.of(true));
  }
 else {
    return Optional.of(Result.of(false));
  }
}
