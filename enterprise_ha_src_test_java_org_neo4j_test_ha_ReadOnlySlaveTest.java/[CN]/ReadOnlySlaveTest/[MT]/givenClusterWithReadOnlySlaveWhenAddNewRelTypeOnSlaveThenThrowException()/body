{
  Map<String,String> config=stringMap(tx_push_factor.name(),"2");
  ClusterManager clusterManager=new ClusterManager.Builder(folder.getRoot()).withCommonConfig(config).withInstanceConfig(2,stringMap(GraphDatabaseSettings.read_only.name(),Settings.TRUE)).build();
  try {
    clusterManager.start();
    ClusterManager.ManagedCluster cluster=clusterManager.getDefaultCluster();
    cluster.await(ClusterManager.allSeesAllAsAvailable());
    Node node;
    Node node2;
    HighlyAvailableGraphDatabase master=cluster.getMaster();
    try (Transaction tx=master.beginTx()){
      node=master.createNode();
      node2=master.createNode();
      tx.success();
    }
     HighlyAvailableGraphDatabase readOnlySlave=cluster.getMemberByServerId(new InstanceId(2));
    try (Transaction tx=readOnlySlave.beginTx()){
      Node slaveNode=readOnlySlave.getNodeById(node.getId());
      Node slaveNode2=readOnlySlave.getNodeById(node2.getId());
      slaveNode.createRelationshipTo(slaveNode2,DynamicRelationshipType.withName("KNOWS"));
      tx.success();
    }
 catch (    TransactionFailureException ex) {
      assertThat(ex.getCause(),instanceOf(ReadOnlyDbException.class));
    }
  }
  finally {
    clusterManager.shutdown();
  }
}
