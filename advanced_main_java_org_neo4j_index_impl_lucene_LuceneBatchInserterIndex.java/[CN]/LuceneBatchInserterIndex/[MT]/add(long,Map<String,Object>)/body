{
  try {
    Document document=identifier.entityType.newDocument(entityId);
    for (    Map.Entry<String,Object> entry : properties.entrySet()) {
      String key=entry.getKey();
      for (      Object value : PrimitiveUtils.asArray(entry.getValue())) {
        type.addToDocument(document,key,value);
      }
    }
    writer().addDocument(document);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
