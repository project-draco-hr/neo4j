{
  HazelcastConnector connector=mock(HazelcastConnector.class);
  HazelcastClient client=new HazelcastClient(connector,NullLogProvider.getInstance(),address);
  HazelcastInstance hazelcastInstance1=mock(HazelcastInstance.class);
  HazelcastInstance hazelcastInstance2=mock(HazelcastInstance.class);
  when(connector.connectToHazelcast()).thenReturn(hazelcastInstance1).thenReturn(hazelcastInstance2);
  com.hazelcast.core.Cluster cluster=mock(Cluster.class);
  when(hazelcastInstance1.getCluster()).thenReturn(cluster).thenThrow(new HazelcastInstanceNotActiveException());
  when(hazelcastInstance2.getCluster()).thenReturn(cluster);
  when(hazelcastInstance1.getSet(anyString())).thenReturn(new HazelcastSet());
  when(hazelcastInstance2.getSet(anyString())).thenReturn(new HazelcastSet());
  when(hazelcastInstance1.getExecutorService(anyString())).thenReturn(new StubExecutorService());
  when(hazelcastInstance2.getExecutorService(anyString())).thenReturn(new StubExecutorService());
  Set<Member> members=asSet(makeMember(1),makeMember(2));
  when(cluster.getMembers()).thenReturn(members);
  ClusterTopology topology1=client.currentTopology();
  assertEquals(members.size(),topology1.coreMembers().size());
  ClusterTopology topology2=client.currentTopology();
  assertEquals(members.size(),topology2.coreMembers().size());
  verify(connector,times(2)).connectToHazelcast();
}
