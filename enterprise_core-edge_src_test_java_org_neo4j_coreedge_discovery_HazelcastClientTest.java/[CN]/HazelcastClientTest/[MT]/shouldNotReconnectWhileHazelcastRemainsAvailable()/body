{
  HazelcastConnector connector=mock(HazelcastConnector.class);
  HazelcastClient client=new HazelcastClient(connector,NullLogProvider.getInstance(),address);
  HazelcastInstance hazelcastInstance=mock(HazelcastInstance.class);
  when(connector.connectToHazelcast()).thenReturn(hazelcastInstance);
  when(hazelcastInstance.getSet(anyString())).thenReturn(new HazelcastSet());
  com.hazelcast.core.Cluster cluster=mock(Cluster.class);
  when(hazelcastInstance.getCluster()).thenReturn(cluster);
  Set<Member> members=asSet(makeMember(1),makeMember(2));
  when(cluster.getMembers()).thenReturn(members);
  ClusterTopology topology;
  for (int i=0; i < 5; i++) {
    topology=client.currentTopology();
    assertEquals(members.size(),topology.coreMembers().size());
  }
  verify(connector,times(1)).connectToHazelcast();
}
