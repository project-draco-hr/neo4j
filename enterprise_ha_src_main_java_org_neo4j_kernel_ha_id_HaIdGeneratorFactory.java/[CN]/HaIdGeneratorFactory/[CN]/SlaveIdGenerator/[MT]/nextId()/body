{
  long nextId=nextLocalId();
  if (nextId == VALUE_REPRESENTING_NULL) {
    Response<IdAllocation> response=master.allocateIds(requestContextFactory.newRequestContext(),idType);
    try {
      IdAllocation allocation=response.response();
      logger.info("Received id allocation " + allocation + " from master "+ master+ " for "+ idType);
      nextId=storeLocally(allocation);
    }
  finally {
      response.close();
    }
  }
  return nextId;
}
