{
  PlatformModule platform=createPlatform(storeDir,params,dependencies,graphDatabaseFacade);
  EditionModule edition=editionFactory.apply(platform);
  final DataSourceModule dataSource=createDataSource(dependencies,platform,edition);
  Logger msgLog=platform.logging.getInternalLog(getClass()).infoLogger();
  CoreAPIAvailabilityGuard coreAPIAvailabilityGuard=edition.coreAPIAvailabilityGuard;
  graphDatabaseFacade.init(new ClassicCoreSPI(platform,dataSource,msgLog,coreAPIAvailabilityGuard),platform.config);
  Throwable error=null;
  try {
    enableAvailabilityLogging(platform.availabilityGuard,msgLog);
    platform.life.start();
  }
 catch (  final Throwable throwable) {
    error=new RuntimeException("Error starting " + getClass().getName() + ", "+ platform.storeDir,throwable);
  }
 finally {
    if (error != null) {
      try {
        graphDatabaseFacade.shutdown();
      }
 catch (      Throwable shutdownError) {
        error=Exceptions.withSuppressed(shutdownError,error);
      }
    }
  }
  if (error != null) {
    msgLog.log("Failed to start database",error);
    throw Exceptions.launderedException(error);
  }
  return graphDatabaseFacade;
}
