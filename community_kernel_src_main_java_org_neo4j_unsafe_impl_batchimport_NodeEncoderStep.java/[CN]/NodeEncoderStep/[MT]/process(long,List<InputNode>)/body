{
  List<BatchEntity<NodeRecord,InputNode>> entities=new ArrayList<>(batch.size());
  for (  InputNode batchNode : batch) {
    long nodeId=idGenerator.generate(batchNode.id());
    if (batchNode.id() != null) {
      idMapper.put(batchNode.id(),nodeId,batchNode.group());
    }
    NodeRecord nodeRecord=new NodeRecord(nodeId,false,NO_NEXT_RELATIONSHIP.intValue(),NO_NEXT_PROPERTY.intValue());
    nodeRecord.setInUse(true);
    entities.add(new BatchEntity<>(nodeRecord,batchNode));
    if (batchNode.hasLabelField()) {
      nodeRecord.setLabelField(batchNode.labelField(),Collections.<DynamicRecord>emptyList());
    }
 else {
      long[] labels=labelHolder.getOrCreateIds(batchNode.labels());
      InlineNodeLabels.putSorted(nodeRecord,labels,null,nodeStore.getDynamicLabelStore());
    }
  }
  return entities;
}
