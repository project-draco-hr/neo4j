{
  List<NodeRecord> nodeRecords=new ArrayList<>(batch.size());
  for (  InputNode batchNode : batch) {
    long nodeId=idGenerator.generate(batchNode.id());
    idMapper.put(batchNode.id(),nodeId);
    NodeRecord nodeRecord=new NodeRecord(nodeId,false,NO_NEXT_RELATIONSHIP.intValue(),NO_NEXT_PROPERTY.intValue());
    nodeRecord.setInUse(true);
    nodeRecords.add(nodeRecord);
    if (batchNode.hasLabelField()) {
      nodeRecord.setLabelField(batchNode.labelField(),Collections.<DynamicRecord>emptyList());
    }
 else {
      long[] labels=labelHolder.getOrCreateIds(batchNode.labels());
      InlineNodeLabels.put(nodeRecord,labels,null,nodeStore.getDynamicLabelStore());
    }
  }
  return new RecordBatch<>(nodeRecords,batch);
}
