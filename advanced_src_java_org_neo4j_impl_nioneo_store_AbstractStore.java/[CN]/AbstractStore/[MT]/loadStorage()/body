{
  long fileSize=getFileChannel().size();
  String expectedVersion=getTypeAndVersionDescriptor();
  byte version[]=new byte[expectedVersion.getBytes().length];
  ByteBuffer buffer=ByteBuffer.wrap(version);
  if (fileSize >= version.length) {
    getFileChannel().position(fileSize - version.length);
  }
 else {
    setStoreNotOk();
  }
  getFileChannel().read(buffer);
  if (!expectedVersion.equals(new String(version))) {
    versionFound(new String(version));
    setStoreNotOk();
  }
  if (getRecordSize() != 0 && (fileSize - version.length) % getRecordSize() != 0) {
    setStoreNotOk();
  }
  if (getStoreOk()) {
    getFileChannel().truncate(fileSize - version.length);
  }
  try {
    openIdGenerator();
  }
 catch (  IOException e) {
    setStoreNotOk();
  }
  setWindowPool(new PersistenceWindowPool(getStorageFileName(),getRecordSize(),getFileChannel(),getMappedMem()));
}
