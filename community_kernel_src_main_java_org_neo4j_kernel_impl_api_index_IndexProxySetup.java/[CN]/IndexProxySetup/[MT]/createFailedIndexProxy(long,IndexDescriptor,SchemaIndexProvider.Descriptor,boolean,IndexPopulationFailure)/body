{
  IndexConfiguration config=new IndexConfiguration(unique);
  ValueSampler sampler=unique ? new UniqueIndexSampler() : new NonUniqueIndexSampler(samplingConfig.bufferSize());
  IndexPopulator indexPopulator=populatorFromProvider(providerDescriptor,ruleId,descriptor,config,sampler);
  String indexUserDescription=indexUserDescription(descriptor,providerDescriptor);
  IndexProxy proxy;
  proxy=new FailedIndexProxy(descriptor,config,providerDescriptor,indexUserDescription,indexPopulator,populationFailure,IndexCountsRemover.Factory.create(storeView,descriptor));
  proxy=new ContractCheckingIndexProxy(proxy,true);
  return proxy;
}
