{
  newTransaction();
  db.createNode(label("Foo")).setProperty("name","foo");
  long foo=statement.labelGetForName(getState(),"Foo");
  long name=statement.propertyKeyGetForName(getState(),"name");
  commit();
  newTransaction();
  statement.uniquenessConstraintCreate(getState(),foo,name);
  commit();
  newTransaction();
  Node node=db.createNode();
  node.setProperty("name","foo");
  try {
    node.addLabel(label("Foo"));
    fail("should have thrown exception");
  }
 catch (  ConstraintViolationException ex) {
    assertThat(ex.getMessage(),containsString("\"name\"=[foo]"));
  }
}
