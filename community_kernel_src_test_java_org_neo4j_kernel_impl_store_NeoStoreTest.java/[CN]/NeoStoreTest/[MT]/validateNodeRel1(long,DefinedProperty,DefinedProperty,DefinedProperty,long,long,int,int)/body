{
  assertTrue(nodeExists(node));
  ArrayMap<Integer,Pair<DefinedProperty,Long>> props=new ArrayMap<>();
  PropertyReceiver receiver=newPropertyReceiver(props);
  propertyLoader.nodeLoadProperties(node,receiver);
  int count=0;
  for (  int keyId : props.keySet()) {
    long id=props.get(keyId).other();
    PropertyRecord record=pStore.getRecord(id);
    PropertyBlock block=record.getPropertyBlock(props.get(keyId).first().propertyKeyId());
    DefinedProperty data=block.newPropertyData(pStore);
    if (data.propertyKeyId() == prop1.propertyKeyId()) {
      assertEquals("prop1",MyPropertyKeyToken.getIndexFor(keyId).name());
      assertEquals("string1",data.value());
      transaction.nodeChangeProperty(node,prop1.propertyKeyId(),"-string1");
    }
 else     if (data.propertyKeyId() == prop2.propertyKeyId()) {
      assertEquals("prop2",MyPropertyKeyToken.getIndexFor(keyId).name());
      assertEquals(1,data.value());
      transaction.nodeChangeProperty(node,prop2.propertyKeyId(),new Integer(-1));
    }
 else     if (data.propertyKeyId() == prop3.propertyKeyId()) {
      assertEquals("prop3",MyPropertyKeyToken.getIndexFor(keyId).name());
      assertEquals(true,data.value());
      transaction.nodeChangeProperty(node,prop3.propertyKeyId(),false);
    }
 else {
      throw new IOException();
    }
    count++;
  }
  assertEquals(3,count);
  count=0;
  try (Cursor<NodeItem> nodeCursor=((KernelStatement)tx.acquireStatement()).getStoreStatement().acquireSingleNodeCursor(node)){
    nodeCursor.next();
    try (Cursor<RelationshipItem> relationships=nodeCursor.get().relationships(Direction.BOTH)){
      while (relationships.next()) {
        long rel=relationships.get().id();
        if (rel == rel1) {
          assertEquals(node,relationships.get().startNode());
          assertEquals(relType1,relationships.get().type());
        }
 else         if (rel == rel2) {
          assertEquals(node,relationships.get().endNode());
          assertEquals(relType2,relationships.get().type());
        }
 else {
          throw new IOException();
        }
        count++;
      }
    }
   }
   assertEquals(2,count);
}
