{
  OutputFormatProvider provider=new OutputFormatProvider(new RepresentationFormatRepository(mock(AbstractNeoServer.class)));
  HttpRequestContext httpRequestContext=mock(HttpRequestContext.class);
  HttpContext httpContext=mock(HttpContext.class);
  when(httpContext.getRequest()).thenReturn(httpRequestContext);
  when(httpRequestContext.getBaseUri()).thenReturn(new URI("http://localhost:37465"));
  when(httpRequestContext.getHeaderValue("X-Forwarded-Host")).thenReturn("foobar.com:9999");
  when(httpRequestContext.getHeaderValue("X-Forwarded-Proto")).thenReturn("https");
  Representation representation=mock(Representation.class);
  OutputFormat outputFormat=provider.getValue(httpContext);
  outputFormat.assemble(representation);
  verify(representation).serialize(any(RepresentationFormat.class),eq(new URI("https://foobar.com:9999")),any(ExtensionInjector.class));
}
