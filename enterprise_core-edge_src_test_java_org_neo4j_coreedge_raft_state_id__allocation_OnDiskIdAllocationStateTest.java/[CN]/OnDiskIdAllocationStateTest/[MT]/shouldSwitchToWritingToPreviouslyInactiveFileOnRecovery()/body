{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  OnDiskIdAllocationState store=new OnDiskIdAllocationState(fsa,testDir.directory(),10,mock(Supplier.class));
  for (int i=1; i <= 3; i++) {
    store.firstUnallocated(someType,1024 * i);
    store.logIndex(i);
  }
  store=new OnDiskIdAllocationState(fsa,testDir.directory(),10,mock(Supplier.class));
  store.firstUnallocated(someType,1024 * 4);
  store.logIndex(4);
  assertEquals(3 * NUMBER_OF_BYTES_PER_WRITE,fsa.getFileSize(new File(testDir.directory(),"id.allocation.A")));
  assertEquals(NUMBER_OF_BYTES_PER_WRITE,fsa.getFileSize(new File(testDir.directory(),"id.allocation.B")));
}
