{
  Monitor monitor=mock(RecoveryVisitor.Monitor.class);
  final RecoveryVisitor visitor=new RecoveryVisitor(store,storeApplier,recoveredCount,monitor);
  final TransactionRepresentation representation=new PhysicalTransactionRepresentation(Collections.<Command>emptySet());
  final CommittedTransactionRepresentation transaction=new CommittedTransactionRepresentation(startEntry,representation,commitEntry);
  final boolean result=visitor.visit(transaction);
  assertTrue(result);
  verify(storeApplier,times(1)).apply(same(representation),any(LockGroup.class),eq(commitEntry.getTxId()),eq(true));
  assertEquals(1l,recoveredCount.get());
  verify(monitor).transactionRecovered(commitEntry.getTxId());
  visitor.close();
  verify(store,times(1)).setLastCommittedAndClosedTransactionId(commitEntry.getTxId());
}
