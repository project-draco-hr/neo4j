{
  Map<String,String> config=defaultBackupPortHostParams();
  config.put(GraphDatabaseSettings.keep_logical_logs.name(),"false");
  GraphDatabaseAPI db=createDb(storeDir,config);
  BackupService backupService=new BackupService(fileSystem);
  createAndIndexNode(db,1);
  backupService.doFullBackup(BACKUP_HOST,backupPort,backupDir.getAbsolutePath(),false,defaultConfig(),BackupClient.BIG_READ_TIMEOUT);
  createAndIndexNode(db,2);
  rotate(db);
  createAndIndexNode(db,3);
  rotate(db);
  createAndIndexNode(db,4);
  rotate(db);
  backupService.doIncrementalBackupOrFallbackToFull(BACKUP_HOST,backupPort,backupDir.getAbsolutePath(),false,defaultConfig(),BackupClient.BIG_READ_TIMEOUT);
  db.shutdown();
  assertEquals(DbRepresentation.of(storeDir),DbRepresentation.of(backupDir));
}
