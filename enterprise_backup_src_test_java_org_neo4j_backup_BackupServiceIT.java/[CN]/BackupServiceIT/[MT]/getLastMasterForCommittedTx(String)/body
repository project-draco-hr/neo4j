{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabase(backupDir.getAbsolutePath());
  try {
    XaDataSourceManager xaDataSourceManager=db.getDependencyResolver().resolveDependency(XaDataSourceManager.class);
    XaDataSource dataSource=xaDataSourceManager.getXaDataSource(dataSourceName);
    long lastCommittedTxId=dataSource.getLastCommittedTxId();
    return dataSource.getMasterForCommittedTx(lastCommittedTxId);
  }
  finally {
    db.shutdown();
  }
}
