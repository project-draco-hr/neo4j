{
  Map<String,String> config=defaultBackupPortHostParams();
  config.put(GraphDatabaseSettings.keep_logical_logs.name(),"false");
  config.put(GraphDatabaseSettings.logical_log_rotation_threshold.name(),"20");
  GraphDatabaseAPI db=createDb(storeDir,config);
  BackupService backupService=new BackupService(fileSystem);
  createAndIndexNode(db,1);
  backupService.doFullBackup(BACKUP_HOST,backupPort,backupDir.getAbsolutePath(),false,defaultConfig());
  createAndIndexNode(db,2);
  createAndIndexNode(db,3);
  createAndIndexNode(db,4);
  createAndIndexNode(db,5);
  try {
    backupService.doIncrementalBackup(BACKUP_HOST,backupPort,backupDir.getAbsolutePath(),false);
    fail("Should have thrown exception.");
  }
 catch (  IncrementalBackupNotPossibleException e) {
    assertThat(e.getMessage(),equalTo(BackupService.TOO_OLD_BACKUP));
  }
}
