{
  GraphDatabaseService db=createDb(storeDir,defaultBackupPortHostParams());
  BackupService backupService=new BackupService(fileSystem);
  backupService.doFullBackup(BACKUP_HOST,backupPort,backupDir.getAbsolutePath(),false,new Config(defaultBackupPortHostParams()));
  db.shutdown();
  assertEquals(DbRepresentation.of(storeDir),DbRepresentation.of(backupDir));
  XaDataSourceManager xaDataSourceManager=xaDataSourceManager(backupDir);
  XaDataSource neoStoreXaDataSource=xaDataSourceManager.getXaDataSource(DEFAULT_DATA_SOURCE_NAME);
  long lastCommittedTxId=neoStoreXaDataSource.getLastCommittedTxId();
  assertNotNull(neoStoreXaDataSource.getMasterForCommittedTx(lastCommittedTxId));
  XaDataSource luceneDataSource=xaDataSourceManager.getXaDataSource(DEFAULT_NAME);
  long lastCommittedLuceneTxId=luceneDataSource.getLastCommittedTxId();
  assertNotNull(luceneDataSource.getMasterForCommittedTx(lastCommittedLuceneTxId));
}
