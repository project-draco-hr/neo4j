{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabase(backupDir.getAbsolutePath());
  ReadableByteChannel logicalLog=null;
  try {
    XaDataSourceManager xaDataSourceManager=db.getDependencyResolver().resolveDependency(XaDataSourceManager.class);
    XaDataSource dataSource=xaDataSourceManager.getXaDataSource(dataSourceName);
    logicalLog=dataSource.getLogicalLog(1);
    ByteBuffer buffer=ByteBuffer.allocate(64);
    long[] headerData=VersionAwareLogEntryReader.readLogHeader(buffer,logicalLog,true);
    long previousCommittedTxIdFromFirstLog=headerData[1];
    assertEquals(previousCommittedTxIdFromFirstLog,dataSource.getLastCommittedTxId() - 1);
  }
  finally {
    db.shutdown();
    if (logicalLog != null) {
      logicalLog.close();
    }
  }
}
