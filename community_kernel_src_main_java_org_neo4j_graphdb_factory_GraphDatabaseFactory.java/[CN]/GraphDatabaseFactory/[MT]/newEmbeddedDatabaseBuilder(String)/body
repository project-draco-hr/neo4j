{
  return new GraphDatabaseBuilder(new GraphDatabaseBuilder.DatabaseCreator(){
    @Override public GraphDatabaseService newDatabase(    Map<String,String> config){
      config.put("ephemeral","false");
      if (TRUE.equalsIgnoreCase(config.get(read_only.name()))) {
        return new EmbeddedReadOnlyGraphDatabase(path,config,indexProviders,kernelExtensions,cacheProviders,txInterceptorProviders,indexPopulatorMappers);
      }
 else {
        return new EmbeddedGraphDatabase(path,config,indexProviders,kernelExtensions,cacheProviders,txInterceptorProviders,indexPopulatorMappers);
      }
    }
  }
);
}
