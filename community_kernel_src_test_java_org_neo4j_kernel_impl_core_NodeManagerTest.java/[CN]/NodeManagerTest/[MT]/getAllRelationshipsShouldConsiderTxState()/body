{
  Transaction tx=db.beginTx();
  Relationship firstCommittedRelationship=createRelationshipAssumingTxWith("committed",1);
  Relationship secondCommittedRelationship=createRelationshipAssumingTxWith("committed",2);
  Relationship thirdCommittedRelationship=createRelationshipAssumingTxWith("committed",3);
  tx.success();
  tx.finish();
  tx=db.beginTx();
  secondCommittedRelationship.delete();
  tx.success();
  tx.finish();
  tx=db.beginTx();
  Relationship firstAdditionalRelationship=createRelationshipAssumingTxWith("additional",1);
  Relationship secondAdditionalRelationship=createRelationshipAssumingTxWith("additional",2);
  thirdCommittedRelationship.delete();
  List<Relationship> allRelationships=addToCollection(getNodeManager().getAllRelationships(),new ArrayList<Relationship>());
  Set<Relationship> allRelationshipsSet=new HashSet<Relationship>(allRelationships);
  tx.finish();
  assertEquals(allRelationships.size(),allRelationshipsSet.size());
  assertEquals(asSet(firstCommittedRelationship,firstAdditionalRelationship,secondAdditionalRelationship),allRelationshipsSet);
}
