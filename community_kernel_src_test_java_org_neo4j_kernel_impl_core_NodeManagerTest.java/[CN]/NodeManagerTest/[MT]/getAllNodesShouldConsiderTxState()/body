{
  Transaction tx=db.beginTx();
  Node referenceNode=db.getReferenceNode();
  Node firstCommittedNode=db.createNode();
  Node secondCommittedNode=db.createNode();
  Node thirdCommittedNode=db.createNode();
  tx.success();
  tx.finish();
  tx=db.beginTx();
  secondCommittedNode.delete();
  tx.success();
  tx.finish();
  tx=db.beginTx();
  Node firstAdditionalNode=db.createNode();
  Node secondAdditionalNode=db.createNode();
  thirdCommittedNode.delete();
  List<Node> allNodes=addToCollection(getNodeManager().getAllNodes(),new ArrayList<Node>());
  Set<Node> allNodesSet=new HashSet<>(allNodes);
  tx.finish();
  assertEquals(allNodes.size(),allNodesSet.size());
  assertEquals(asSet(referenceNode,firstCommittedNode,firstAdditionalNode,secondAdditionalNode),allNodesSet);
}
