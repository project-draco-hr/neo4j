{
{
    Transaction tx=db.beginTx();
    db.createNode();
    db.createNode();
    tx.success();
    tx.finish();
  }
  Transaction transaction=db.beginTx();
  Iterator<Node> allNodes=GlobalGraphOperations.at(db).getAllNodes().iterator();
  allNodes.next();
  Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      Transaction newTx=db.beginTx();
      assertThat(newTx,not(instanceOf(PlaceboTransaction.class)));
      db.createNode();
      newTx.success();
      newTx.finish();
    }
  }
);
  thread.start();
  thread.join();
  assertThat(addToCollection(allNodes,new ArrayList<Node>()).size(),is(3));
  transaction.finish();
}
