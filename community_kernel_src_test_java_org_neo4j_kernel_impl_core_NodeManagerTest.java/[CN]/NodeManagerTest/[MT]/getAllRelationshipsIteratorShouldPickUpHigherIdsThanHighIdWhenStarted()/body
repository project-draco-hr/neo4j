{
  Transaction tx=db.beginTx();
  createRelationshipAssumingTxWith("key",1);
  createRelationshipAssumingTxWith("key",2);
  tx.success();
  tx.close();
  tx=db.beginTx();
  Iterator<Relationship> allRelationships=GlobalGraphOperations.at(db).getAllRelationships().iterator();
  Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      Transaction newTx=db.beginTx();
      assertThat(newTx,not(instanceOf(PlaceboTransaction.class)));
      createRelationshipAssumingTxWith("key",3);
      newTx.success();
      newTx.close();
    }
  }
);
  thread.start();
  thread.join();
  assertThat(addToCollection(allRelationships,new ArrayList<Relationship>()).size(),is(3));
  tx.success();
  tx.close();
}
