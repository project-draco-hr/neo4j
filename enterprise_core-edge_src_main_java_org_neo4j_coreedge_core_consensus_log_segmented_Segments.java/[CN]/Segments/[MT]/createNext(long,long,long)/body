{
  currentVersion++;
  SegmentHeader header=new SegmentHeader(prevFileLastIndex,currentVersion,prevIndex,prevTerm);
  File file=fileNames.getForVersion(currentVersion);
  SegmentFile segment=SegmentFile.create(fileSystem,file,readerPool,currentVersion,contentMarshal,logProvider,header);
  segment.flush();
  allSegments.add(segment);
  rangeMap.replaceFrom(prevIndex + 1,segment);
  return segment;
}
