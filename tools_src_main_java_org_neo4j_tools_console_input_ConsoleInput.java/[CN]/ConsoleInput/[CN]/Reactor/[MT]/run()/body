{
  while (!halted) {
    try {
      prompt.receive(out);
      String commandLine=inputReader.readLine();
      if (commandLine == null) {
        halted=true;
        break;
      }
      String[] args=tokenizeStringWithQuotes(commandLine);
      if (args.length == 0) {
        continue;
      }
      String commandName=args[0];
      Command action=commands.get(commandName);
      if (action != null) {
        action.run(copyOfRange(args,1,args.length),out);
      }
 else {
switch (commandName) {
case "help":
case "?":
case "man":
          printUsage();
        break;
case "exit":
      halt();
    break;
default :
  System.err.println("Unrecognized command '" + commandName + "'");
break;
}
}
}
 catch (Exception e) {
e.printStackTrace();
}
}
}
