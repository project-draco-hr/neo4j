{
  GraphDatabaseService beansAPI=dbRule.getGraphDatabaseService();
  Node myNode;
  Transaction tx=beansAPI.beginTx();
  IndexDefinition indexDef;
  try {
    myNode=beansAPI.createNode();
    myNode.addLabel(Labels.MY_LABEL);
    myNode.setProperty("name","Hawking");
    indexDef=beansAPI.schema().indexCreator(Labels.MY_LABEL).on("name").create();
    tx.success();
  }
  finally {
    tx.finish();
  }
  while (beansAPI.schema().getIndexState(indexDef) == Schema.IndexState.POPULATING) {
    Thread.sleep(10);
  }
  assertThat(beansAPI.schema().getIndexState(indexDef),is(Schema.IndexState.ONLINE));
  Node result=single(beansAPI.findNodesByLabelAndProperty(Labels.MY_LABEL,"name","Hawking"));
  assertThat(result,is(myNode));
}
