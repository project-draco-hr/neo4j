{
  GraphDatabaseService beansAPI=dbRule.getGraphDatabaseAPI();
  long id;
{
    try (Transaction tx=beansAPI.beginTx()){
      Node myNode=beansAPI.createNode();
      id=myNode.getId();
      myNode.setProperty("key0",true);
      myNode.setProperty("key1",true);
      tx.success();
    }
   }
{
    IndexDefinition indexDefinition;
    try (Transaction tx=beansAPI.beginTx()){
      indexDefinition=beansAPI.schema().indexFor(LABEL1).on("key2").create();
      tx.success();
    }
     waitForIndex(beansAPI,indexDefinition);
  }
  Node myNode;
{
    try (Transaction tx=beansAPI.beginTx()){
      myNode=beansAPI.getNodeById(id);
      myNode.addLabel(LABEL1);
      myNode.setProperty("key2",LONG_STRING);
      myNode.setProperty("key3",LONG_STRING);
      tx.success();
    }
   }
  assertThat(myNode,inTx(beansAPI,hasProperty("key2").withValue(LONG_STRING)));
  assertThat(myNode,inTx(beansAPI,hasProperty("key3").withValue(LONG_STRING)));
  assertThat(findNodesByLabelAndProperty(LABEL1,"key2",LONG_STRING,beansAPI),containsOnly(myNode));
}
