{
  GraphDatabaseService beansAPI=dbRule.getGraphDatabaseAPI();
  long id;
{
    Transaction tx=beansAPI.beginTx();
    IndexDefinition indexDefinition;
    try {
      Node myNode=beansAPI.createNode();
      id=myNode.getId();
      myNode.setProperty("key0",true);
      myNode.setProperty("key1",true);
      indexDefinition=beansAPI.schema().indexCreator(Labels.MY_LABEL).on("key2").create();
      tx.success();
    }
  finally {
      tx.finish();
    }
    beansAPI.schema().awaitIndexOnline(indexDefinition,10,SECONDS);
  }
{
    Transaction tx=beansAPI.beginTx();
    try {
      Node myNode=beansAPI.getNodeById(id);
      myNode.addLabel(Labels.MY_LABEL);
      myNode.setProperty("key2",LONG_STRING);
      myNode.setProperty("key3",LONG_STRING);
      tx.success();
    }
  finally {
      tx.finish();
    }
  }
  Node foundNode=single(beansAPI.findNodesByLabelAndProperty(Labels.MY_LABEL,"key2",LONG_STRING));
  assertEquals(id,foundNode.getId());
}
