{
  getTransaction().finish();
  tm=getGraphDbAPI().getDependencyResolver().resolveDependency(TransactionManager.class);
  xaDsMgr=getGraphDbAPI().getDependencyResolver().resolveDependency(XaDataSourceManager.class);
  java.util.Map<String,String> map1=new java.util.HashMap<>();
  map1.put("store_dir","target/var");
  java.util.Map<String,String> map2=new java.util.HashMap<>();
  map2.put("store_dir","target/var");
  try {
    xaDsMgr.registerDataSource(new DummyXaDataSource("fakeRes1",UTF8.encode("0xDDDDDE"),new FakeXAResource("XAResource1")));
    xaDsMgr.registerDataSource(new DummyXaDataSource("fakeRes2",UTF8.encode("0xDDDDDF"),new FakeXAResource("XAResource2")));
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  try {
    tm.commit();
  }
 catch (  Exception e) {
  }
  Transaction tx=null;
  try {
    tx=tm.getTransaction();
  }
 catch (  Exception e) {
    throw new RuntimeException("Unknown state of TM");
  }
  if (tx != null) {
    throw new RuntimeException("We're still in transaction");
  }
}
