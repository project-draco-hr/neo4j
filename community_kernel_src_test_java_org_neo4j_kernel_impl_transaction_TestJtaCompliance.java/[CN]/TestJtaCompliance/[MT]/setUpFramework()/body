{
  getTransaction().finish();
  TxModule txModule=getEmbeddedGraphDb().getConfig().getTxModule();
  tm=txModule.getTxManager();
  xaDsMgr=txModule.getXaDataSourceManager();
  java.util.Map<String,Object> map1=new java.util.HashMap<String,Object>();
  map1.put("xa_resource",new FakeXAResource("XAResource1"));
  map1.put("store_dir","target/var");
  java.util.Map<String,Object> map2=new java.util.HashMap<String,Object>();
  map2.put("xa_resource",new FakeXAResource("XAResource2"));
  map2.put("store_dir","target/var");
  try {
    xaDsMgr.registerDataSource("fakeRes1",new DummyXaDataSource(map1),UTF8.encode("0xDDDDDE"));
    xaDsMgr.registerDataSource("fakeRes2",new DummyXaDataSource(map2),UTF8.encode("0xDDDDDF"));
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  try {
    tm.commit();
  }
 catch (  Exception e) {
  }
  Transaction tx=null;
  try {
    tx=tm.getTransaction();
  }
 catch (  Exception e) {
    throw new RuntimeException("Unknown state of TM");
  }
  if (tx != null) {
    throw new RuntimeException("We're still in transaction");
  }
}
