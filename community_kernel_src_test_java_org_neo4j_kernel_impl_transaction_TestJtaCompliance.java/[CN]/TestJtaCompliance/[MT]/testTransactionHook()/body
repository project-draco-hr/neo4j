{
  tm.begin();
  Transaction tx=tm.getTransaction();
  TxHook txHook=new TxHook();
  tx.registerSynchronization(txHook);
  assertEquals(false,txHook.gotBefore);
  assertEquals(false,txHook.gotAfter);
  tm.commit();
  assertEquals(true,txHook.gotBefore);
  assertEquals(true,txHook.gotAfter);
  assertTrue(tx == txHook.txBefore);
  assertTrue(tx == txHook.txAfter);
  assertEquals(Status.STATUS_ACTIVE,txHook.statusBefore);
  assertEquals(Status.STATUS_COMMITTED,txHook.statusAfter);
  tm.begin();
  tx=tm.getTransaction();
  txHook=new TxHook();
  tx.registerSynchronization(txHook);
  assertEquals(false,txHook.gotBefore);
  assertEquals(false,txHook.gotAfter);
  tm.rollback();
  assertEquals(true,txHook.gotBefore);
  assertEquals(true,txHook.gotAfter);
  assertTrue(tx == txHook.txBefore);
  assertTrue(tx == txHook.txAfter);
  assertEquals(Status.STATUS_MARKED_ROLLBACK,txHook.statusBefore);
  assertEquals(Status.STATUS_ROLLEDBACK,txHook.statusAfter);
}
