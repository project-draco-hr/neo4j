{
  SimpleTxHook hook=new SimpleTxHook();
  OtherThreadExecutor<Void> t1=new OtherThreadExecutor<Void>("T1",null);
  t1.execute(beginTransaction(hook));
  tm.begin();
  FakeXAResource resource=new FailingFakeXAResource("XAResource1",true);
  tm.getTransaction().enlistResource(resource);
  try {
    tm.commit();
    fail("Should have failed commit");
  }
 catch (  Exception e) {
  }
  try {
    t1.execute(finish);
    fail("Should've failed");
  }
 catch (  Exception e) {
  }
  kernelHealth.healed();
  assertTrue(hook.gotAfter);
}
