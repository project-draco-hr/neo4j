{
  long nodeId;
  Transaction tx=database.getGraph().beginTx();
  try {
    Node node=database.getGraph().createNode();
    node.setProperty("remove me","trash");
    nodeId=node.getId();
    tx.success();
  }
  finally {
    tx.finish();
  }
  Map<String,Object> properties=new HashMap<String,Object>();
  properties.put("foo","bar");
  properties.put("baz",17);
  actions.setAllNodeProperties(nodeId,properties);
  tx=database.getGraph().beginTx();
  try {
    Node node=database.getGraph().getNodeById(nodeId);
    assertHasProperties(node,properties);
    assertNull(node.getProperty("remove me",null));
  }
  finally {
    tx.finish();
  }
}
