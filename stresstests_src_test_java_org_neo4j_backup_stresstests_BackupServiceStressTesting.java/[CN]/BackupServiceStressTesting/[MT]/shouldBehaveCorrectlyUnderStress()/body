{
  long durationInMinutes=parseLong(fromEnv("BACKUP_SERVICE_STRESS_DURATION",DEFAULT_DURATION_IN_MINUTES));
  String directory=fromEnv("BACKUP_SERVICE_STRESS_WORKING_DIRECTORY",DEFAULT_WORKING_DIR);
  String backupHostname=fromEnv("BACKUP_SERVICE_STRESS_BACKUP_HOSTNAME",DEFAULT_HOSTNAME);
  int backupPort=parseInt(fromEnv("BACKUP_SERVICE_STRESS_BACKUP_PORT",DEFAULT_PORT));
  File storeDirectory=new File(directory,"store");
  File workDirectory=new File(directory,"work");
  Callable<Integer> callable=new BackupServiceStressTestingBuilder().until(untilTimeExpired(durationInMinutes,MINUTES)).withStore(ensureExists(storeDirectory)).withBackupDirectory(ensureExists(workDirectory)).withBackupAddress(backupHostname,backupPort).build();
  int brokenStores=callable.call();
  assertEquals(0,brokenStores);
  FileUtils.deleteRecursively(storeDirectory);
  FileUtils.deleteRecursively(workDirectory);
}
