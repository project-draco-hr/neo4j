{
synchronized (connectedSlaveChannels) {
    Collection<Channel> channelsToRemove=new ArrayList<Channel>();
    for (    Map.Entry<Channel,SlaveContext> entry : connectedSlaveChannels.entrySet()) {
      if (!channelIsOpen(entry.getKey())) {
        System.out.println("Found dead channel " + entry.getKey() + ", "+ entry.getValue());
        realMaster.finishTransaction(entry.getValue());
        System.out.println("Removed " + entry.getKey() + ", "+ entry.getValue());
      }
      channelsToRemove.add(entry.getKey());
    }
    for (    Channel channel : channelsToRemove) {
      connectedSlaveChannels.remove(channel);
      channelBuffers.remove(channel);
      partialRequests.remove(channel);
    }
  }
}
