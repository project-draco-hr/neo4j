{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabase();
  try {
    TransactionMonitor monitor=db.getDependencyResolver().resolveDependency(TransactionMonitor.class);
    int startedBefore=monitor.getNumberOfStartedTransactions();
    long committedBefore=monitor.getNumberOfCommittedTransactions();
    long rolledBackBefore=monitor.getNumberOfRolledbackTransactions();
    try (Transaction tx=db.beginTx()){
      db.createNode();
      tx.failure();
    }
     assertEquals(startedBefore + 1,monitor.getNumberOfStartedTransactions());
    assertEquals(committedBefore,monitor.getNumberOfCommittedTransactions());
    assertEquals(rolledBackBefore + 1,monitor.getNumberOfRolledbackTransactions());
  }
  finally {
    db.shutdown();
  }
}
