{
  @SuppressWarnings("unchecked") Inbound.MessageHandler<RaftMessages.RaftMessage<Object>> innerHandler=mock(Inbound.MessageHandler.class);
  BatchingMessageHandler<Object> batchHandler=new BatchingMessageHandler<>(innerHandler,NullLogProvider.getInstance(),QUEUE_SIZE,MAX_BATCH,localDatabase);
  ReplicatedString contentA=new ReplicatedString("A");
  ReplicatedString contentC=new ReplicatedString("C");
  RaftMessages.NewEntry.Request<Object> messageA=new RaftMessages.NewEntry.Request<>(null,contentA,localDatabase.storeId());
  RaftMessages.Heartbeat<Object> messageB=new RaftMessages.Heartbeat<>(null,0,0,0,localDatabase.storeId());
  RaftMessages.NewEntry.Request<Object> messageC=new RaftMessages.NewEntry.Request<>(null,contentC,localDatabase.storeId());
  RaftMessages.Heartbeat<Object> messageD=new RaftMessages.Heartbeat<>(null,1,1,1,localDatabase.storeId());
  batchHandler.handle(messageA);
  batchHandler.handle(messageB);
  batchHandler.handle(messageC);
  batchHandler.handle(messageD);
  verifyZeroInteractions(innerHandler);
  batchHandler.run();
  RaftMessages.NewEntry.Batch<Object> batch=new RaftMessages.NewEntry.Batch<>(2,localDatabase.storeId());
  batch.add(contentA);
  batch.add(contentC);
  verify(innerHandler).handle(batch);
  verify(innerHandler).handle(messageB);
  verify(innerHandler).handle(messageD);
}
