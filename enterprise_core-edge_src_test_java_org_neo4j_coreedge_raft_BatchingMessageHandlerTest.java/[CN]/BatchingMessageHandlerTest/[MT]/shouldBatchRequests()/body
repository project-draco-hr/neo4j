{
  @SuppressWarnings("unchecked") Inbound.MessageHandler<RaftMessages.RaftMessage> innerHandler=mock(Inbound.MessageHandler.class);
  BatchingMessageHandler batchHandler=new BatchingMessageHandler(innerHandler,NullLogProvider.getInstance(),QUEUE_SIZE,MAX_BATCH,localDatabase,raftStateMachine);
  ReplicatedString contentA=new ReplicatedString("A");
  ReplicatedString contentB=new ReplicatedString("B");
  RaftMessages.NewEntry.Request messageA=new RaftMessages.NewEntry.Request(null,contentA);
  RaftMessages.NewEntry.Request messageB=new RaftMessages.NewEntry.Request(null,contentB);
  batchHandler.handle(new RaftMessages.StoreIdAwareMessage(new StoreId(1,2,3,4),messageA));
  batchHandler.handle(new RaftMessages.StoreIdAwareMessage(new StoreId(1,2,3,4),messageB));
  verifyZeroInteractions(innerHandler);
  batchHandler.run();
  RaftMessages.NewEntry.Batch batch=new RaftMessages.NewEntry.Batch(2);
  batch.add(contentA);
  batch.add(contentB);
  verify(innerHandler).handle(batch);
}
