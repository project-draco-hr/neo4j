{
  File dir=AbstractNeo4jTestCase.unzip(testDir.graphDbDir(),getClass(),"0.A.3-to-be-recovered.zip");
  new File(dir,"messages.log").delete();
  GraphDatabaseFactory factory=new TestGraphDatabaseFactory();
  GraphDatabaseBuilder builder=factory.newEmbeddedDatabaseBuilder(dir);
  builder.setConfig(GraphDatabaseSettings.allow_store_upgrade,"true");
  builder.setConfig(GraphDatabaseSettings.pagecache_memory,"8m");
  try {
    GraphDatabaseService db=builder.newGraphDatabase();
    db.shutdown();
    fail("It should have failed.");
  }
 catch (  RuntimeException ex) {
    final UpgradingStoreVersionNotFoundException expected=new UpgradingStoreVersionNotFoundException("neostore.nodestore.db");
    final Throwable cause=ex.getCause().getCause().getCause();
    assertEquals(expected.getClass(),cause.getClass());
    assertEquals(expected.getMessage(),cause.getMessage());
  }
}
