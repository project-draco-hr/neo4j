{
  File dir=store.prepareDirectory(testDir.graphDbDir());
  File configFile=new File(dir,"neo4j.properties");
  Properties props=new Properties();
  props.putAll(ServerTestUtils.getDefaultRelativeProperties());
  props.setProperty(Configurator.DATABASE_LOCATION_PROPERTY_KEY,dir.getAbsolutePath());
  props.setProperty(Configurator.DB_TUNING_PROPERTY_FILE_KEY,configFile.getAbsolutePath());
  props.setProperty(GraphDatabaseSettings.allow_store_upgrade.name(),"true");
  props.setProperty(GraphDatabaseSettings.pagecache_memory.name(),"8m");
  props.store(new FileWriter(configFile),"");
  try {
    Bootstrapper bootstrapper=new CommunityBootstrapper();
    bootstrapper.start(configFile);
    try {
      NeoServer server=bootstrapper.getServer();
      Database database=server.getDatabase();
      assertTrue(database.isRunning());
      checkInstance(store,database.getGraph());
    }
  finally {
      bootstrapper.stop();
    }
  }
  finally {
    System.clearProperty(Configurator.NEO_SERVER_CONFIG_FILE_KEY);
  }
  assertConsistentStore(dir);
}
