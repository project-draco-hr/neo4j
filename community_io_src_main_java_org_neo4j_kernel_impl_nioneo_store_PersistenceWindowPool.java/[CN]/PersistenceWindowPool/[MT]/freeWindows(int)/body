{
  if (brickSize <= 0) {
    return;
  }
  ArrayList<BrickElement> mappedBricks=new ArrayList<>();
  for (int i=0; i < brickCount; i++) {
    BrickElement be=brickArray[i];
    if (be.getWindow() != null) {
      be.snapshotHitCount();
      mappedBricks.add(be);
    }
  }
  Collections.sort(mappedBricks,BRICK_SORTER);
  for (int i=0; i < nr && i < mappedBricks.size(); i++) {
    BrickElement mappedBrick=mappedBricks.get(i);
    LockableWindow window=mappedBrick.getWindow();
    if (window.writeOutAndCloseIfFree(readOnly)) {
      mappedBrick.setWindow(null);
      memUsed-=brickSize;
    }
  }
}
