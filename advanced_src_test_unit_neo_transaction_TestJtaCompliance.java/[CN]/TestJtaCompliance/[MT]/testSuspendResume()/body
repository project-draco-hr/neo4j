{
  tm.begin();
  Transaction tx=tm.getTransaction();
  FakeXAResource res=new FakeXAResource("XAResource1");
  tx.enlistResource((XAResource)res);
  assertTrue(tm.suspend() == tx);
  tx.delistResource((XAResource)res,XAResource.TMSUSPEND);
  MethodCall calls[]=res.getAndRemoveMethodCalls();
  assertEquals(2,calls.length);
  assertEquals("start",calls[0].getMethodName());
  Object args[]=calls[0].getArgs();
  assertEquals(XAResource.TMNOFLAGS,((Integer)args[1]).intValue());
  assertEquals("end",calls[1].getMethodName());
  args=calls[1].getArgs();
  assertEquals(XAResource.TMSUSPEND,((Integer)args[1]).intValue());
  tm.resume(tx);
  tx.enlistResource((XAResource)res);
  calls=res.getAndRemoveMethodCalls();
  assertEquals(1,calls.length);
  assertEquals("start",calls[0].getMethodName());
  args=calls[0].getArgs();
  assertEquals(XAResource.TMRESUME,((Integer)args[1]).intValue());
  assertTrue(tm.getTransaction() == tx);
  tx.delistResource((XAResource)res,XAResource.TMSUCCESS);
  tm.commit();
  tm.resume(tx);
  assertTrue(tm.getStatus() == Status.STATUS_NO_TRANSACTION);
  assertTrue(tm.getTransaction() == null);
}
