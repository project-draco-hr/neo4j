{
  final long timestamp=3;
  Transaction tx=beginTx();
  getNodeWithName("2").setProperty("timestamp",1L);
  getNodeWithName("3").setProperty("timestamp",2L);
  tx.success();
  tx.finish();
  final RelationshipType type=DynamicRelationshipType.withName("TO");
  Traverser t=node("1").traverse(Order.DEPTH_FIRST,new StopEvaluator(){
    public boolean isStopNode(    TraversalPosition position){
      Relationship last=position.lastRelationshipTraversed();
      if (last != null && last.isType(type)) {
        Node node=position.currentNode();
        long currentTime=(Long)node.getProperty("timestamp");
        return currentTime >= timestamp;
      }
      return false;
    }
  }
,new ReturnableEvaluator(){
    public boolean isReturnableNode(    TraversalPosition position){
      Relationship last=position.lastRelationshipTraversed();
      if (last != null && last.isType(type)) {
        return true;
      }
      return false;
    }
  }
,type,Direction.OUTGOING);
  Iterator<Node> nodes=t.iterator();
  assertEquals("2",nodes.next().getProperty("name"));
  assertEquals("3",nodes.next().getProperty("name"));
  assertFalse(nodes.hasNext());
}
