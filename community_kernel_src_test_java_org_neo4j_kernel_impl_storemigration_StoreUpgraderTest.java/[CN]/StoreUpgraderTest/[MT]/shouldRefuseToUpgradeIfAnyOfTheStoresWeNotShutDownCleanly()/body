{
  File workingDirectory=new File("target/" + StoreUpgraderTest.class.getSimpleName());
  File comparisonDirectory=new File("target/" + StoreUpgraderTest.class.getSimpleName() + "-comparison");
  MigrationTestUtils.prepareSampleLegacyDatabase(workingDirectory);
  truncateFile(new File(workingDirectory,"neostore.propertystore.db.index.keys"),"StringPropertyStore v0.9.9");
  deleteRecursively(comparisonDirectory);
  copyRecursively(workingDirectory,comparisonDirectory);
  try {
    new StoreUpgrader(defaultConfig(),alwaysAllowed(),new UpgradableDatabase(),new StoreMigrator(new SilentMigrationProgressMonitor()),new DatabaseFiles()).attemptUpgrade(new File(workingDirectory,NeoStore.DEFAULT_NAME).getPath());
    fail("Should throw exception");
  }
 catch (  StoreUpgrader.UnableToUpgradeException e) {
  }
  verifyFilesHaveSameContent(comparisonDirectory,workingDirectory);
}
