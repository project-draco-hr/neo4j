{
  String key="foo";
  String value="bar";
  HighlyAvailableGraphDatabase master=null;
  HighlyAvailableGraphDatabase slave=null;
  try {
    master=start(dir.cleanDirectory("master").getAbsolutePath(),0,stringMap(keep_logical_logs.name(),"1 files",ClusterSettings.initial_hosts.name(),"127.0.0.1:5001"));
    createNode(master,"something","unimportant");
    slave=start(dir.cleanDirectory("slave").getAbsolutePath(),1,stringMap(ClusterSettings.initial_hosts.name(),"127.0.0.1:5001,127.0.0.1:5002"));
    slave.shutdown();
    long nodeId=createNode(master,key,value);
    createNode(master,"something","unimportant");
    master.getDependencyResolver().resolveDependency(NeoStoreDataSource.class).getDependencyResolver().resolveDependency(PhysicalLogFile.class).forceRotate();
    master.shutdown();
    master=start(dir.existingDirectory("master").getAbsolutePath(),0,stringMap(keep_logical_logs.name(),"1 files",ClusterSettings.initial_hosts.name(),"127.0.0.1:5001"));
    createNode(master,key,value);
    slave=start(dir.existingDirectory("slave").getAbsolutePath(),1,stringMap(ClusterSettings.initial_hosts.name(),"127.0.0.1:5001,127.0.0.1:5002"));
    slave.getDependencyResolver().resolveDependency(UpdatePuller.class).pullUpdates();
    try (Transaction ignore=slave.beginTx()){
      assertEquals("store contents differ",value,slave.getNodeById(nodeId).getProperty(key));
    }
   }
  finally {
    if (slave != null) {
      slave.shutdown();
    }
    if (master != null) {
      master.shutdown();
    }
  }
}
