{
  String key="foo";
  String value="bar";
  HighlyAvailableGraphDatabase master=null;
  HighlyAvailableGraphDatabase slave=null;
  try {
    master=start(dir.directory("master",true).getAbsolutePath(),0,stringMap(keep_logical_logs.name(),"1 files",ClusterSettings.initial_hosts.name(),"127.0.0.1:5001"));
    createNode(master,"something","unimportant");
    slave=start(dir.directory("slave",true).getAbsolutePath(),1,stringMap(ClusterSettings.initial_hosts.name(),"127.0.0.1:5001,127.0.0.1:5002"));
    slave.shutdown();
    long nodeId=createNode(master,key,value);
    createNode(master,"something","unimportant");
    rotateLogs(master.getXaDataSourceManager(),master.getKernelPanicGenerator(),master.getDependencyResolver().resolveDependency(StringLogger.class));
    master.shutdown();
    master=start(dir.directory("master",false).getAbsolutePath(),0,stringMap(keep_logical_logs.name(),"1 files",ClusterSettings.initial_hosts.name(),"127.0.0.1:5001"));
    slave=start(dir.directory("slave",false).getAbsolutePath(),1,stringMap(ClusterSettings.initial_hosts.name(),"127.0.0.1:5001,127.0.0.1:5002"));
    slave.getDependencyResolver().resolveDependency(UpdatePuller.class).pullUpdates();
    Transaction transaction=slave.beginTx();
    try {
      assertEquals("store contents differ",value,slave.getNodeById(nodeId).getProperty(key));
    }
  finally {
      transaction.finish();
    }
  }
  finally {
    if (slave != null) {
      slave.shutdown();
    }
    if (master != null) {
      master.shutdown();
    }
  }
}
