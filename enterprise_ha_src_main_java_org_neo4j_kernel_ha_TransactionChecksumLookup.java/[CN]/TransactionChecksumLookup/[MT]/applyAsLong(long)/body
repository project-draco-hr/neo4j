{
  long[] lastCommittedTransaction=transactionIdStore.getLastCommittedTransaction();
  if (lastCommittedTransaction[0] == txId) {
    return lastCommittedTransaction[1];
  }
  try {
    return logicalTransactionStore.getMetadataFor(txId).getChecksum();
  }
 catch (  NoSuchTransactionException e) {
    long[] lastUpgradeTransaction=transactionIdStore.getUpgradeTransaction();
    if (lastUpgradeTransaction[0] == txId) {
      return lastUpgradeTransaction[1];
    }
    throw withMessage(e,e.getMessage() + " | transaction id store says last transaction is " + Arrays.toString(lastCommittedTransaction)+ " and last upgrade transaction is "+ Arrays.toString(lastUpgradeTransaction));
  }
}
