{
  Class<?> taskType=task.getClass();
  while (taskType != Object.class) {
    for (    Type type : taskType.getGenericInterfaces()) {
      if (type instanceof ParameterizedType) {
        ParameterizedType paramType=(ParameterizedType)type;
        if (paramType.getRawType() == Task.class) {
          Type param=paramType.getActualTypeArguments()[0];
          if (param.getClass() == Class.class)           return (Class<T>)param;
        }
      }
    }
    taskType=taskType.getSuperclass();
  }
  return null;
}
