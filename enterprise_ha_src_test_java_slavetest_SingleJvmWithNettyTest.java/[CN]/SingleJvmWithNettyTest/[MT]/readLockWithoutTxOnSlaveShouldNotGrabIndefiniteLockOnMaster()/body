{
  final long lockTimeout=1;
  initializeDbs(1,stringMap(CONFIG_KEY_LOCK_READ_TIMEOUT,String.valueOf(lockTimeout)));
  final long id=executeJob(new CommonJobs.CreateNodeJob(true),0);
  final Fetcher<DoubleLatch> latchFetcher=getDoubleLatch();
  Thread lockHolder=new Thread(new Runnable(){
    @Override public void run(){
      DoubleLatch latch=latchFetcher.fetch();
      try {
        final GraphDatabaseService slaveDb=getSlave(0);
        Node node=slaveDb.getNodeById(id);
        final Config config=((AbstractGraphDatabase)slaveDb).getConfig();
        config.getLockManager().getReadLock(node);
        config.getLockReleaser().addLockToTransaction(node,LockType.READ);
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
 finally {
        try {
          latch.countDownFirst();
          latch.awaitSecond();
        }
 catch (        RemoteException e) {
          e.printStackTrace();
        }
      }
    }
  }
,"slaveLockHolder");
  lockHolder.start();
  final DoubleLatch latch=latchFetcher.fetch();
  latch.awaitFirst();
  final HighlyAvailableGraphDatabase masterDb=getMasterHaDb();
  final Transaction tx=masterDb.beginTx();
  try {
    long startTime=System.currentTimeMillis();
    masterDb.getNodeById(id).setProperty("name","David");
    long duration=System.currentTimeMillis() - startTime;
    latch.countDownSecond();
    assertTrue("Read lock was acquired but not released.",duration < lockTimeout * 1000);
  }
  finally {
    tx.finish();
  }
}
