{
  initializeDbs(1,MapUtil.stringMap(GraphDatabaseSettings.cache_type.name(),GraphDatabaseSettings.CacheTypeSetting.strong));
  HighlyAvailableGraphDatabase sDb=(HighlyAvailableGraphDatabase)getSlave(0);
  HighlyAvailableGraphDatabase mDb=getMasterHaDb();
  long relId;
  Node node;
  Transaction tx=mDb.beginTx();
  try {
    node=mDb.createNode();
    node.createRelationshipTo(mDb.createNode(),REL_TYPE);
    relId=node.createRelationshipTo(mDb.createNode(),REL_TYPE).getId();
    node.createRelationshipTo(mDb.createNode(),REL_TYPE);
    tx.success();
  }
  finally {
    tx.finish();
  }
  sDb.pullUpdates();
  tx=sDb.beginTx();
  try {
    sDb.getRelationshipById(relId).delete();
    tx.success();
  }
  finally {
    tx.finish();
  }
  int relCount=0;
  for (  Relationship rel : node.getRelationships()) {
    rel.getOtherNode(node);
    relCount++;
  }
  assertEquals("wrong number of relationships",2,relCount);
}
