{
  initializeDbs(2);
  long node=executeJobOnMaster(new CommonJobs.CreateNodeJob(true));
  pullUpdates();
  Worker t1=new Worker(getSlave(0));
  Worker t2=new Worker(getSlave(1));
  t1.beginTx();
  t2.beginTx();
  String index="index";
  String key="key";
  String value="Mattias";
  assertNull(t2.putIfAbsent(index,node,key,value).get());
  Future<Node> futurePut=t1.putIfAbsent(index,node,key,value);
  t1.waitUntilWaiting();
  t2.finishTx(true);
  assertNotNull(futurePut.get());
  t1.finishTx(true);
  assertEquals(node,getSlave(0).index().forNodes(index).get(key,value).getSingle().getId());
  assertEquals(node,getSlave(1).index().forNodes(index).get(key,value).getSingle().getId());
  t1.shutdown();
  t2.shutdown();
}
