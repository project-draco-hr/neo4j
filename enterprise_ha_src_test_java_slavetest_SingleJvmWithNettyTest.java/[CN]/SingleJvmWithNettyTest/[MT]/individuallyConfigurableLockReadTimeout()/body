{
  long lockTimeout=1;
  initializeDbs(1,stringMap(CONFIG_KEY_LOCK_READ_TIMEOUT,String.valueOf(lockTimeout)));
  final Long nodeId=executeJobOnMaster(new CommonJobs.CreateNodeJob(true));
  final Fetcher<DoubleLatch> latchFetcher=getDoubleLatch();
  pullUpdates();
  Thread lockHolder=new Thread(new Runnable(){
    @Override public void run(){
      try {
        executeJobOnMaster(new CommonJobs.HoldLongLock(nodeId,latchFetcher));
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  lockHolder.start();
  DoubleLatch latch=latchFetcher.fetch();
  latch.awaitFirst();
  long waitStart=System.currentTimeMillis();
  assertFalse(executeJob(new CommonJobs.SetNodePropertyJob(nodeId,"key","value"),0));
  long waitTime=System.currentTimeMillis() - waitStart;
  assertTrue("" + waitTime,Math.abs(waitTime - lockTimeout * 1000) < (lockTimeout * 1000) / 2);
  latch.countDownSecond();
}
