{
  try {
    Node node=resource instanceof Node ? (Node)resource : null;
    Relationship relationship=resource instanceof Relationship ? (Relationship)resource : null;
    if (node == null && relationship == null) {
      super.getWriteLock(resource);
      return;
    }
    LockResult result=null;
    do {
      result=node != null ? receiver.receive(broker.getMaster().acquireNodeWriteLock(receiver.getSlaveContext(),getLocalTxId(),node.getId())) : receiver.receive(broker.getMaster().acquireRelationshipWriteLock(receiver.getSlaveContext(),getLocalTxId(),relationship.getId()));
switch (result.getStatus()) {
case OK_LOCKED:
        super.getWriteLock(resource);
      return;
case DEAD_LOCKED:
    throw new DeadlockDetectedException(result.getDeadlockMessage());
}
}
 while (result.getStatus() == LockStatus.NOT_LOCKED);
}
 catch (ZooKeeperException e) {
receiver.somethingIsWrong(e);
throw e;
}
catch (HaCommunicationException e) {
receiver.somethingIsWrong(e);
throw e;
}
}
