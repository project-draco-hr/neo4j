{
  int logIndex=1;
  StubTransactionCommitProcess commitProcess=new StubTransactionCommitProcess(null,null);
  when(dependencies.resolveDependency(TransactionRepresentationCommitProcess.class)).thenReturn(commitProcess);
  ReplicatedTokenStateMachine<Token> stateMachine=new ReplicatedTokenStateMachine<>(new TokenRegistry<>("Token"),dependencies,new Token.Factory(),LABEL,NullLogProvider.getInstance(),mock(RecoverTransactionLogState.class));
  ReplicatedTokenRequest tokenRequest=new ReplicatedTokenRequest(LABEL,"Person",commandBytes(tokenCommands(EXPECTED_TOKEN_ID)));
  stateMachine.applyCommand(tokenRequest,logIndex);
  List<TransactionRepresentation> transactions=commitProcess.transactionsToApply;
  assertEquals(1,transactions.size());
  assertEquals(logIndex,decodeLogIndexFromTxHeader(transactions.get(0).additionalHeader()));
}
