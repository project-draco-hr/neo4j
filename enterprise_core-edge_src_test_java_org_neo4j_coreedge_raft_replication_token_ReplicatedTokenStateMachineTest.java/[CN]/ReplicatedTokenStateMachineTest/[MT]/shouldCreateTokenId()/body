{
  when(dependencies.resolveDependency(TransactionRepresentationCommitProcess.class)).thenReturn(mock(TransactionRepresentationCommitProcess.class));
  TokenRegistry<Token> registry=new TokenRegistry<>("Label");
  ReplicatedTokenStateMachine<Token> stateMachine=new ReplicatedTokenStateMachine<>(registry,dependencies,new Token.Factory(),NullLogProvider.getInstance(),mock(RecoverTransactionLogState.class));
  stateMachine.applyCommand(new ReplicatedTokenRequest(LABEL,"Person",commandBytes(tokenCommands(EXPECTED_TOKEN_ID))),1);
  assertEquals(EXPECTED_TOKEN_ID,(int)registry.getId("Person"));
}
