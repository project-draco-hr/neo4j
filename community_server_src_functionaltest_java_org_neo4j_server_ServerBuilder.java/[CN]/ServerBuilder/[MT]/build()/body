{
  if (dbDir == null) {
    throw new IllegalStateException("database directory must be configured.");
  }
  File configFile=createPropertiesFiles();
  return new NeoServerWithEmbeddedWebServer(new NeoServerBootstrapper(),addressResolver,startupHealthCheck,new PropertyFileConfigurator(new Validator(new DatabaseLocationMustBeSpecifiedRule()),configFile),new Jetty6WebServer(),serverModules);
}
