{
  HighlyAvailableGraphDatabase master=cluster.getMaster();
  OtherThreadExecutor<HighlyAvailableGraphDatabase> masterWorker=new OtherThreadExecutor<>("master worker",master);
  final Node node=createNode(master);
  cluster.sync();
  HighlyAvailableGraphDatabase slave=cluster.getAnySlave();
  try (Transaction slaveTx=slave.beginTx()){
    Lock lock=slaveTx.acquireWriteLock(slave.getNodeById(node.getId()));
    lock.release();
    Transaction masterTx=masterWorker.execute(new BeginTx());
    masterWorker.execute(new AcquireWriteLock(masterTx,new Callable<Node>(){
      @Override public Node call() throws Exception {
        return node;
      }
    }
),1,SECONDS);
  }
  finally {
    masterWorker.close();
  }
}
