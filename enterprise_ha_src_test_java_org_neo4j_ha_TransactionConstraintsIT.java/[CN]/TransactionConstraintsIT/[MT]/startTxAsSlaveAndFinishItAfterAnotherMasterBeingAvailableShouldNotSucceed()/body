{
  HighlyAvailableGraphDatabase db=getSlaveOnlySlave();
  HighlyAvailableGraphDatabase oldMaster;
  Transaction tx=db.beginTx();
  try {
    db.createNode().setProperty("name","slave");
    tx.success();
  }
  finally {
    oldMaster=cluster.getMaster();
    cluster.shutdown(oldMaster);
    cluster.await(masterAvailable(oldMaster));
    assertFinishGetsTransactionFailure(tx);
  }
  assertFalse(db.isMaster());
  assertFalse(oldMaster.isMaster());
  awaitFullyOperational(db);
}
