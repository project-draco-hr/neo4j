{
  HighlyAvailableGraphDatabase db=getSlaveOnlySlave();
  HighlyAvailableGraphDatabase oldMaster=cluster.getMaster();
  Transaction tx=db.beginTx();
  try {
    db.createNode().setProperty("name","slave");
    tx.success();
  }
  finally {
    cluster.shutdown(oldMaster);
    assertFinishGetsTransactionFailure(tx);
  }
  try {
    cluster.await(ClusterManager.masterAvailable());
  }
 catch (  Exception e) {
    throw e;
  }
  assertFalse(db.isMaster());
  assertFalse(oldMaster.isMaster());
  awaitFullyOperational(db);
}
