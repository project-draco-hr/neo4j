{
  HighlyAvailableGraphDatabase db=cluster.getAnySlave();
  HighlyAvailableGraphDatabase theOtherSlave;
  Transaction tx=db.beginTx();
  try {
    db.createNode().setProperty("name","slave");
    tx.success();
  }
  finally {
    theOtherSlave=cluster.getAnySlave(db);
    takeTheLeadInAnEventualMasterSwitch(theOtherSlave);
    cluster.shutdown(cluster.getMaster());
    assertFinishGetsTransactionFailure(tx);
  }
  cluster.await(ClusterManager.masterAvailable());
  assertFalse(db.isMaster());
  assertTrue(theOtherSlave.isMaster());
  awaitFullyOperational(db);
}
