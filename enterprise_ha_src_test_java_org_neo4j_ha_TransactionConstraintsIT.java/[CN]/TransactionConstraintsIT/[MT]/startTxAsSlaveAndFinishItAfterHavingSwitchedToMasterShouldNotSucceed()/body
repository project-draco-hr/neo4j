{
  GraphDatabaseService db=cluster.getAnySlave();
  takeTheLeadInAnEventualMasterSwitch(db);
  Transaction tx=db.beginTx();
  try {
    db.createNode().setProperty("name","slave");
    tx.success();
  }
  finally {
    cluster.shutdown(cluster.getMaster());
    assertFinishGetsTransactionFailure(tx);
  }
  cluster.await(masterAvailable());
  assertEquals(db,cluster.getMaster());
  awaitFullyOperational(db);
}
