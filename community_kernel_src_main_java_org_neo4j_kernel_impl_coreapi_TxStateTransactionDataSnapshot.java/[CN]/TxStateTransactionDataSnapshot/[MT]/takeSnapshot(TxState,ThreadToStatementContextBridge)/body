{
  try (Statement stmt=bridge.instance()){
    ReadOperations ops=stmt.readOperations();
    for (    Long nodeId : state.addedAndRemovedNodes().getRemoved()) {
      Iterator<DefinedProperty> props=ops.nodeGetAllCommittedProperties(nodeId);
      while (props.hasNext()) {
        DefinedProperty prop=props.next();
        removedNodeProperties.add(new NodePropertyEntryView(nodeId,ops.propertyKeyGetName(prop.propertyKeyId()),null,prop.value()));
      }
      PrimitiveIntIterator labels=ops.nodeGetCommittedLabels(nodeId);
      while (labels.hasNext()) {
        removedLabels.add(new LabelEntryView(nodeId,ops.labelGetName(labels.next())));
      }
    }
    for (    Long relId : state.addedAndRemovedRels().getRemoved()) {
      Iterator<DefinedProperty> props=ops.relationshipGetAllCommittedProperties(relId);
      while (props.hasNext()) {
        DefinedProperty prop=props.next();
        removedRelationshipProperties.add(new RelationshipPropertyEntryView(relId,ops.propertyKeyGetName(prop.propertyKeyId()),null,prop.value()));
      }
    }
    for (    NodeState nodeState : state.modifiedNodes()) {
      Iterator<DefinedProperty> added=nodeState.addedAndChangedProperties();
      while (added.hasNext()) {
        DefinedProperty property=added.next();
        assignedNodeProperties.add(new NodePropertyEntryView(nodeState.getId(),ops.propertyKeyGetName(property.propertyKeyId()),property.value(),committedValue(ops,nodeState,property.propertyKeyId())));
      }
      Iterator<Integer> removed=nodeState.removedProperties();
      while (removed.hasNext()) {
        Integer property=removed.next();
        removedNodeProperties.add(new NodePropertyEntryView(nodeState.getId(),ops.propertyKeyGetName(property),null,committedValue(ops,nodeState,property)));
      }
      DiffSets<Integer> labels=nodeState.labelDiffSets();
      for (      Integer label : labels.getAdded()) {
        assignedLabels.add(new LabelEntryView(nodeState.getId(),ops.labelGetName(label)));
      }
      for (      Integer label : labels.getRemoved()) {
        removedLabels.add(new LabelEntryView(nodeState.getId(),ops.labelGetName(label)));
      }
    }
    for (    RelationshipState relState : state.modifiedRelationships()) {
      Iterator<DefinedProperty> added=relState.addedAndChangedProperties();
      while (added.hasNext()) {
        DefinedProperty property=added.next();
        assignedRelationshipProperties.add(new RelationshipPropertyEntryView(relState.getId(),ops.propertyKeyGetName(property.propertyKeyId()),property.value(),committedValue(ops,relState,property.propertyKeyId())));
      }
      Iterator<Integer> removed=relState.removedProperties();
      while (removed.hasNext()) {
        Integer property=removed.next();
        removedRelationshipProperties.add(new RelationshipPropertyEntryView(relState.getId(),ops.propertyKeyGetName(property),null,committedValue(ops,relState,property)));
      }
    }
  }
 catch (  EntityNotFoundException|PropertyKeyIdNotFoundKernelException|LabelNotFoundKernelException e) {
    throw new ThisShouldNotHappenError("Jake","An entity that does not exist was modified.",e);
  }
}
