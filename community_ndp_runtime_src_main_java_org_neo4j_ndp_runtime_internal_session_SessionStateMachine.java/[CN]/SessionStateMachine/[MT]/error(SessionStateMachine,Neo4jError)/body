{
  if (ctx.hasTransaction()) {
    try {
      ctx.currentTransaction.failure();
      ctx.currentTransaction.close();
    }
 catch (    Throwable t) {
      ctx.log.error("While handling '" + err.status() + "', a second failure occurred when rolling "+ "back transaction: "+ t.getMessage(),t);
    }
 finally {
      ctx.currentTransaction=null;
    }
  }
  ctx.error(err);
  return ERROR;
}
