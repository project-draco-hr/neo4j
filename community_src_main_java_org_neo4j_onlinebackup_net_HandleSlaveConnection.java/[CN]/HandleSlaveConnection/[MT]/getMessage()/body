{
  if (logVersionToSend > -1 && logLength > -1 && logToSend != null) {
    setStatus(Status.SETUP_OFFER_LOG);
    return true;
  }
  if (!acquireReadBuffer()) {
    return false;
  }
  try {
    buffer.limit(9);
    int read=connection.read();
    if (read == 9) {
      buffer.flip();
      byte request=buffer.get();
      if (request != HeaderConstants.REQUEST_LOG) {
        log("Unkown request: " + request);
        close();
        return true;
      }
      logVersionToSend=buffer.getLong();
      if (logVersionToSend > master.getVersion()) {
        log("Got wrong version [" + logVersionToSend + "]");
        return true;
      }
      log("Slave request: " + logVersionToSend);
      if (master.hasLog(logVersionToSend)) {
        try {
          logToSend=master.getLog(logVersionToSend);
          logLength=master.getLogLength(logVersionToSend);
        }
 catch (        IOException e) {
          close();
          throw new SocketException("Unable to get logical log[" + logVersionToSend + "]",e);
        }
        setStatus(Status.SETUP_OFFER_LOG);
      }
 else {
        log("No such log version[" + logVersionToSend + "]");
        return true;
      }
      retries=0;
      return true;
    }
 else {
      if (read > 0) {
        connection.pushBackAllReadData();
      }
      return false;
    }
  }
  finally {
    releaseReadBuffer();
  }
}
