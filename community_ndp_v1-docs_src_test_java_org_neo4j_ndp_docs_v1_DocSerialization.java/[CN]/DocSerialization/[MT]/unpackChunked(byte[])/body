{
  ChunkedInput input=new ChunkedInput();
  PackStreamMessageFormatV1.Reader reader=new PackStreamMessageFormatV1.Reader(input);
  RecordingMessageHandler messages=new RecordingMessageHandler();
  ByteBuf buf=Unpooled.wrappedBuffer(data);
  while (buf.readableBytes() > 0) {
    int chunkSize=buf.readUnsignedShort();
    if (chunkSize > 0) {
      input.addChunk(buf.readSlice(chunkSize));
    }
 else {
      reader.read(messages);
      input.clear();
    }
  }
  return messages.asList();
}
