{
  if (commitIndex == appendIndex) {
    return;
  }
  long actualNewCommitIndex=newCommitIndex;
  if (newCommitIndex > appendIndex) {
    actualNewCommitIndex=appendIndex;
  }
  try {
    storeCommitIndex(actualNewCommitIndex);
  }
 catch (  IOException e) {
    throw new RaftStorageException("Failed to commit",e);
  }
  commitIndex=actualNewCommitIndex;
}
