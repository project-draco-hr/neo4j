{
  this.serializer=serializer;
  this.appendIndexMonitor=monitors.newMonitor(RaftLogAppendIndexMonitor.class,getClass(),RaftLog.APPEND_INDEX_TAG);
  this.commitIndexMonitor=monitors.newMonitor(RaftLogCommitIndexMonitor.class,getClass(),RaftLog.COMMIT_INDEX_TAG);
  directory.mkdirs();
  try {
    entriesChannel=fileSystem.open(new File(directory,"entries.log"),"rw");
    contentChannel=fileSystem.open(new File(directory,"content.log"),"rw");
    commitChannel=fileSystem.open(new File(directory,"commit.log"),"rw");
    appendIndex=entriesChannel.size() / ENTRY_RECORD_LENGTH - 1;
    contentOffset=contentChannel.size();
    commitIndex=readCommitIndex();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
