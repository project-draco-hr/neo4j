{
  fs.create(file).close();
  getPageCache(fs,maxPages,pageCachePageSize,PageCacheMonitor.NULL);
  PagedFile pagedFile=pageCache.map(file,filePageSize);
  PageCursor cursor=pagedFile.io(0,PF_EXCLUSIVE_LOCK);
  assertTrue(cursor.next());
  Thread unmapper=fork($unmap(pageCache,file));
  awaitTheadState(unmapper,1000,Thread.State.BLOCKED,Thread.State.WAITING,Thread.State.TIMED_WAITING);
  assertFalse(cursor.retry());
  cursor.close();
  unmapper.join();
}
