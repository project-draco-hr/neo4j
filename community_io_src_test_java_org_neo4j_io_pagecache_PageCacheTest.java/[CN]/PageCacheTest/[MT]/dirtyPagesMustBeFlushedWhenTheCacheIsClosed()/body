{
  ByteBuffer buf=ByteBuffer.allocate(recordSize);
  PageCache cache=getPageCache(fs,maxPages,pageCachePageSize,PageCacheMonitor.NULL);
  PagedFile pagedFile=cache.map(file,filePageSize);
  RecordPageIO pageIO=new RecordPageIO(recordSize,recordsPerFilePage);
  long startPageId=0;
  long endPageId=recordCount / recordsPerFilePage;
  try (PageCursor cursor=pagedFile.io(startPageId,PF_EXCLUSIVE_LOCK,pageIO,0,RecordPageIO.IO_FLAGS_WRITE_RECORDS)){
    while (pageIO.pageId < endPageId && cursor.next())     ;
  }
   cache.close();
  StoreChannel channel=fs.open(file,"r");
  ByteBuffer observation=ByteBuffer.allocate(recordSize);
  for (int i=0; i < recordCount; i++) {
    generateRecordForId(i,buf);
    observation.position(0);
    channel.read(observation);
    assertThat("Record id: " + i,observation.array(),byteArray(buf.array()));
  }
  channel.close();
}
