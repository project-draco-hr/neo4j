{
  long pagesToGenerate=142;
  DefaultPageCacheMonitor monitor=new DefaultPageCacheMonitor();
  fs.create(file).close();
  getPageCache(fs,maxPages,pageCachePageSize,monitor);
  try (PagedFile pagedFile=pageCache.map(file,filePageSize);PageCursor cursor=pagedFile.io(0,PF_EXCLUSIVE_LOCK)){
    for (long i=0; i < pagesToGenerate; i++) {
      assertTrue(cursor.next());
      assertThat(cursor.getCurrentPageId(),is(i));
      assertTrue(cursor.next(i));
      assertThat(cursor.getCurrentPageId(),is(i));
      writeRecords(cursor);
    }
  }
   assertThat("wrong count of pins",monitor.countPins(),is(pagesToGenerate * 2));
  assertThat("wrong count of unpins",monitor.countUnpins(),is(pagesToGenerate * 2));
  long faults=monitor.countFaults();
  assertThat("wrong count of faults",faults,greaterThanOrEqualTo(pagesToGenerate));
  assertThat("wrong count of evictions",monitor.countEvictions(),both(greaterThanOrEqualTo(pagesToGenerate - maxPages)).and(lessThanOrEqualTo(pagesToGenerate + faults)));
  assertThat(monitor.countFlushes(),greaterThanOrEqualTo(pagesToGenerate));
}
