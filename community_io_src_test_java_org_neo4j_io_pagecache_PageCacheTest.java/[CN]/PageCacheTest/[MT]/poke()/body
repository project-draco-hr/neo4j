{
  generateFileWithRecords(file,recordsPerFilePage * 2,recordSize);
  getPageCache(fs,maxPages,pageCachePageSize,PageCacheMonitor.NULL);
  PagedFile pagedFile=pageCache.map(file,filePageSize);
  PageCursor cursor=pagedFile.io(0,PF_SHARED_LOCK);
  assertTrue(cursor.next());
  assertTrue(cursor.next());
  assertTrue(cursor.next(0));
  fork($unmap(pageCache,file)).join();
  pageCache.close();
  pageCache=null;
  cursor.getByte();
  assertFalse(cursor.retry());
  try {
    cursor.next();
    fail("Advancing the cursor should have thrown");
  }
 catch (  IllegalStateException e) {
  }
}
