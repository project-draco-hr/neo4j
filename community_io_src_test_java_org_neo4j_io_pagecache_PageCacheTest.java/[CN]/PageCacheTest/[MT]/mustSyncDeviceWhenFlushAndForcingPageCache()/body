{
  AtomicInteger syncDeviceCounter=new AtomicInteger();
  AtomicInteger expectedCountInForce=new AtomicInteger();
  Queue<Integer> expectedCountsInForce=queue(0,0,1,2);
  PageSwapperFactory factory=factoryCountingSyncDevice(syncDeviceCounter,expectedCountsInForce);
  try (PageCache cache=createPageCache(factory,maxPages,pageCachePageSize,PageCacheTracer.NULL);PagedFile p1=cache.map(existingFile("a"),filePageSize);PagedFile p2=cache.map(existingFile("b"),filePageSize)){
    try (PageCursor cursor=p1.io(0,PF_SHARED_WRITE_LOCK)){
      assertTrue(cursor.next());
    }
     try (PageCursor cursor=p2.io(0,PF_SHARED_WRITE_LOCK)){
      assertTrue(cursor.next());
    }
     cache.flushAndForce();
    expectedCountInForce.set(1);
    assertThat(syncDeviceCounter.get(),is(1));
  }
 }
