{
  final CountDownLatch startLatch=new CountDownLatch(1);
  final CountDownLatch unpinLatch=new CountDownLatch(1);
  final AtomicReference<Exception> exceptionRef=new AtomicReference<>();
  generateFileWithRecords(file,recordsPerFilePage,recordSize);
  final PageCache cache=getPageCache(fs,maxPages,pageCachePageSize,PageCacheMonitor.NULL);
  final PagedFile pagedFile=cache.map(file,filePageSize);
  Runnable runnable=new Runnable(){
    @Override public void run(){
      try (PageCursor cursorA=pagedFile.io(0,PF_EXCLUSIVE_LOCK | PF_NO_GROW)){
        assertTrue(cursorA.next());
        assertFalse(cursorA.next());
        startLatch.countDown();
        unpinLatch.await();
        cursorA.close();
      }
 catch (      Exception e) {
        exceptionRef.set(e);
      }
    }
  }
;
  executor.submit(runnable);
  startLatch.await();
  try (PageCursor cursorB=pagedFile.io(1,PF_EXCLUSIVE_LOCK)){
    assertTrue(cursorB.next());
    unpinLatch.countDown();
  }
  finally {
    pageCache.unmap(file);
  }
  Exception e=exceptionRef.get();
  if (e != null) {
    throw new Exception("Child thread got exception",e);
  }
}
