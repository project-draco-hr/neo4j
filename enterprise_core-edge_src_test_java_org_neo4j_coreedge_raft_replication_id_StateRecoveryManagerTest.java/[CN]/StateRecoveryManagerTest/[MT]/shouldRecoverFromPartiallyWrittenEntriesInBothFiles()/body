{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  StateRecoveryManager<Long> manager=new StateRecoveryManager<>(fsa,new LongMarshal());
  writeSomeLongsIn(fsa,fileA(),3,4);
  writeSomeLongsIn(fsa,fileB(),5,6);
  writeSomeGarbage(fsa,fileA());
  writeSomeGarbage(fsa,fileB());
  final StateRecoveryManager.RecoveryStatus recovered=manager.recover(fileA(),fileB());
  assertEquals(fileA(),recovered.activeFile());
  assertEquals(6L,recovered.recoveredState());
}
