{
  upgrader(new StoreMigrator(monitor,fs)).migrateIfNeeded(find20FormatStoreDirectory(storeDir));
  assertEquals(100,monitor.events.size());
  assertTrue(monitor.started);
  assertTrue(monitor.finished);
  GraphDatabaseService database=cleanup.add(new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.getAbsolutePath()));
  try {
    DatabaseContentVerifier verifier=new DatabaseContentVerifier(database);
    verifier.verifyNodes();
    verifier.verifyRelationships();
    verifier.verifyNodeIdsReused();
    verifier.verifyRelationshipIdsReused();
    verifier.verifyLegacyIndex();
  }
  finally {
    database.shutdown();
  }
  NeoStore neoStore=cleanup.add(storeFactory.newNeoStore(storeFileName));
  verifyNeoStore(neoStore);
  neoStore.close();
}
