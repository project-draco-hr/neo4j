{
  File legacyStoreDir=MigrationTestUtils.findOldFormatStoreDirectory();
  LegacyStore legacyStore=new LegacyStore(fs,new File(legacyStoreDir,NeoStore.DEFAULT_NAME));
  NeoStore neoStore=storeFactory.createNeoStore(storeFileName);
  new StoreMigrator(monitor).migrate(legacyStore,neoStore);
  legacyStore.close();
  neoStore=storeFactory.newNeoStore(storeFileName);
  verifyNeoStore(neoStore);
  neoStore.close();
  assertEquals(100,monitor.events.size());
  assertTrue(monitor.started);
  assertTrue(monitor.finished);
  GraphDatabaseService db=new GraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  try {
    DatabaseContentVerifier verifier=new DatabaseContentVerifier(db);
    verifier.verifyNodes();
    verifier.verifyRelationships();
    verifier.verifyNodeIdsReused();
    verifier.verifyRelationshipIdsReused();
    verifier.verifyLegacyIndex();
  }
  finally {
    db.shutdown();
  }
}
