{
  LegacyStore legacyStore=new LegacyStore(fs,new File(getClass().getResource("legacystore/exampledb/neostore").getFile()));
  NeoStore neoStore=storeFactory.createNeoStore(storeFileName);
  new StoreMigrator(monitor).migrate(legacyStore,neoStore);
  legacyStore.close();
  neoStore=storeFactory.newNeoStore(storeFileName);
  verifyNeoStore(neoStore);
  neoStore.close();
  assertEquals(100,monitor.events.size());
  assertTrue(monitor.started);
  assertTrue(monitor.finished);
  GraphDatabaseService database=new GraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  DatabaseContentVerifier verifier=new DatabaseContentVerifier(database);
  verifier.verifyNodes();
  verifier.verifyRelationships();
  verifier.verifyNodeIdsReused();
  verifier.verifyRelationshipIdsReused();
  verifier.verifyLegacyIndex();
  database.shutdown();
}
