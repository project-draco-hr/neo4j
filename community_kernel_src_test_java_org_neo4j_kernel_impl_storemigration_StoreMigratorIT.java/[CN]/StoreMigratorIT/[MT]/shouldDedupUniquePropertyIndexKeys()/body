{
  Unzip.unzip(LegacyStore.class,"propkeydupdb.zip",storeDir);
  upgrader(new StoreMigrator(monitor,fs,idGeneratorFactory)).migrateIfNeeded(storeDir);
  GraphDatabaseService db=cleanup.add(new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.getAbsolutePath()));
  Node nodeA=getNodeWithName(db,"A");
  assertThat(nodeA,inTx(db,hasProperty("name").withValue("A")));
  Node nodeB=getNodeWithName(db,"B");
  assertThat(nodeB,inTx(db,hasProperty("name").withValue("B")));
  Node nodeC=getNodeWithName(db,"C");
  assertThat(nodeC,inTx(db,hasProperty("name").withValue("C")));
  assertThat(nodeC,inTx(db,hasProperty("other").withValue("a value")));
  assertThat(nodeC,inTx(db,hasProperty("third").withValue("something")));
  db.shutdown();
  PropertyKeyTokenStore tokenStore=cleanup.add(storeFactory.newPropertyKeyTokenStore(new File(storeFileName + PROPERTY_KEY_TOKEN_STORE_NAME)));
  Token[] tokens=tokenStore.getTokens(MAX_VALUE);
  tokenStore.close();
  assertNuDuplicates(tokens);
}
