{
  if (!ranges.isEmpty() && ranges.peekLast().version >= version) {
    throw new IllegalArgumentException(format("Cannot accept range for version %d while having " + "already accepted %d",version,ranges.peek().version));
  }
  while (!ranges.isEmpty()) {
    VersionIndexRange range=ranges.peekLast();
    if (range.prevIndex >= prevIndex) {
      ranges.removeLast();
    }
 else {
      range.endAt(prevIndex);
      break;
    }
  }
  ranges.add(new VersionIndexRange(version,prevIndex));
}
