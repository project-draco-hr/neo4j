{
  OngoingStubbing<Response<Void>> updatePullStubbing=when(master.pullUpdates(any(RequestContext.class)));
  updatePullStubbing.thenThrow(new InvalidEpochException(2,1));
  for (int i=0; i < SlaveUpdatePuller.LOG_CAP + 20; i++) {
    updatePuller.pullUpdates();
  }
  assertThat(logging.countWarningsByType(InvalidEpochException.class),is(SlaveUpdatePuller.LOG_CAP));
  updatePullStubbing.thenReturn(Response.EMPTY).thenThrow(new InvalidEpochException(2,1));
  updatePuller.pullUpdates();
  updatePuller.pullUpdates();
  assertThat(logging.countWarningsByType(InvalidEpochException.class),is(SlaveUpdatePuller.LOG_CAP + 1));
}
