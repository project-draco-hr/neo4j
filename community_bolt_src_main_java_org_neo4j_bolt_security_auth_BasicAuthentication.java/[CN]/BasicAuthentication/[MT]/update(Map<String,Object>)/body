{
  try {
    AuthSubject authSubject=authManager.login(authToken);
switch (authSubject.getAuthenticationResult()) {
case SUCCESS:
case PASSWORD_CHANGE_REQUIRED:
      String username=AuthToken.safeCast(PRINCIPAL,authToken);
    String newPassword=AuthToken.safeCast(NEW_CREDENTIALS,authToken);
  authSubject.setPassword(newPassword);
authSubject=authManager.login(newBasicAuthToken(username,newPassword));
break;
default :
throw new AuthenticationException(Status.Security.Unauthorized,identifier.get());
}
return new BasicAuthenticationResult(authSubject,false);
}
 catch (AuthorizationViolationException e) {
throw new AuthenticationException(e.status(),identifier.get(),e.getMessage(),e);
}
catch (IOException e) {
throw new AuthenticationException(Status.Security.Unauthorized,identifier.get(),e.getMessage(),e);
}
catch (IllegalCredentialsException e) {
throw new AuthenticationException(e.status(),identifier.get(),e.getMessage(),e);
}
catch (InvalidAuthTokenException e) {
throw new AuthenticationException(e.status(),identifier.get(),e.getMessage());
}
}
