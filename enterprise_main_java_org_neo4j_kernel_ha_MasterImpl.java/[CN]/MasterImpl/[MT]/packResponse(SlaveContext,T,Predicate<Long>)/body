{
  try {
    TransactionStreams streams=new TransactionStreams();
    for (    Pair<String,Long> txEntry : context.lastAppliedTransactions()) {
      String resourceName=txEntry.first();
      XaDataSource dataSource=graphDbConfig.getTxModule().getXaDataSourceManager().getXaDataSource(resourceName);
      if (dataSource == null) {
        throw new RuntimeException("No data source '" + resourceName + "' found");
      }
      long masterLastTx=dataSource.getLastCommittedTxId();
      Collection<Pair<Long,ReadableByteChannel>> channels=new ArrayList<Pair<Long,ReadableByteChannel>>();
      for (long txId=txEntry.other() + 1; txId <= masterLastTx; txId++) {
        if (filter.accept(txId)) {
          channels.add(new Pair<Long,ReadableByteChannel>(txId,dataSource.getCommittedTransaction(txId)));
        }
      }
      streams.add(resourceName,new TransactionStream(channels));
    }
    return new Response<T>(response,streams);
  }
 catch (  IOException e) {
    e.printStackTrace();
    return new FailedResponse<T>();
  }
}
