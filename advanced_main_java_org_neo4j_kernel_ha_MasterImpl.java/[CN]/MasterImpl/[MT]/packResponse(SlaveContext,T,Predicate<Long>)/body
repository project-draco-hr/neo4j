{
  List<Triplet<String,Long,TxExtractor>> stream=new ArrayList<Triplet<String,Long,TxExtractor>>();
  Set<String> resourceNames=new HashSet<String>();
  for (  Pair<String,Long> txEntry : context.lastAppliedTransactions()) {
    String resourceName=txEntry.first();
    final XaDataSource dataSource=graphDbConfig.getTxModule().getXaDataSourceManager().getXaDataSource(resourceName);
    if (dataSource == null) {
      throw new RuntimeException("No data source '" + resourceName + "' found");
    }
    resourceNames.add(resourceName);
    long masterLastTx=dataSource.getLastCommittedTxId();
    for (long txId=txEntry.other() + 1; txId <= masterLastTx; txId++) {
      if (filter.accept(txId)) {
        final long tx=txId;
        TxExtractor extractor=new TxExtractor(){
          public ReadableByteChannel extract(){
            try {
              return dataSource.getCommittedTransaction(tx);
            }
 catch (            IOException e) {
              throw new RuntimeException(e);
            }
          }
          public void extract(          LogBuffer buffer){
            try {
              dataSource.getCommittedTransaction(tx,buffer);
            }
 catch (            IOException e) {
              throw new RuntimeException(e);
            }
          }
        }
;
        stream.add(Triplet.of(resourceName,txId,extractor));
      }
    }
  }
  return new Response<T>(response,TransactionStream.create(resourceNames,stream));
}
