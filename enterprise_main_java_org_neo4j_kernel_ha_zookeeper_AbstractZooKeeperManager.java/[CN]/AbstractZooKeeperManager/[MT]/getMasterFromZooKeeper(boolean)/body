{
  Machine master=getMasterBasedOn(getAllMachines(wait).values());
  invalidateMaster();
  MasterClient masterClient=null;
  if (master != Machine.NO_MACHINE && master.getMachineId() != getMyMachineId()) {
    masterClient=new MasterClient(master,storeDir);
  }
  cachedMaster=new Pair<Master,Machine>(masterClient,master);
  return cachedMaster;
}
