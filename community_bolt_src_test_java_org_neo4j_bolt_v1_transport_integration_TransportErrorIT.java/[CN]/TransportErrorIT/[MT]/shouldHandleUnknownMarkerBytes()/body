{
  final RecordingByteChannel rawData=new RecordingByteChannel();
  final BufferedChannelOutput out=new BufferedChannelOutput(rawData);
  final PackStream.Packer packer=new PackStream.Packer(out);
  packer.packStructHeader(2,PackStreamMessageFormatV1.MessageTypes.MSG_RUN);
  out.writeByte(PackStream.RESERVED_C4);
  out.flush();
  byte[] invalidMessage=rawData.getBytes();
  client.connect(address).send(TransportTestUtil.acceptedVersions(1,0,0,0)).send(TransportTestUtil.chunk(32,invalidMessage));
  MatcherAssert.assertThat(client,TransportTestUtil.eventuallyRecieves(new byte[]{0,0,0,1}));
  MatcherAssert.assertThat(client,TransportTestUtil.eventuallyRecieves(msgFailure(Status.Request.InvalidFormat,"Unable to read MSG_RUN message. Error was: Wrong type received. Expected TEXT, received: " + "RESERVED (0xff).")));
}
