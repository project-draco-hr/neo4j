{
  if (dbDir == null && persistent) {
    throw new IllegalStateException("Must specify path");
  }
  final File configFile=buildBefore();
  Log log=logProvider.getLog(getClass());
  ConfigurationBuilder configurator=new PropertyFileConfigurator(configFile,log);
  Monitors monitors=new Monitors();
  return build(configFile,configurator,GraphDatabaseDependencies.newDependencies().userLogProvider(logProvider).monitors(monitors));
}
