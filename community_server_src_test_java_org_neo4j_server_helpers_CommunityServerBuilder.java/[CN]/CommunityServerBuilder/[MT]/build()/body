{
  if (dataDir == null && persistent) {
    throw new IllegalStateException("Must specify path");
  }
  final File configFile=buildBefore();
  Log log=logProvider.getLog(getClass());
  BaseServerConfigLoader configLoader=new BaseServerConfigLoader();
  Config config=configLoader.loadConfig(null,configFile,log);
  return build(configFile,config,GraphDatabaseDependencies.newDependencies().userLogProvider(logProvider).monitors(new Monitors()));
}
