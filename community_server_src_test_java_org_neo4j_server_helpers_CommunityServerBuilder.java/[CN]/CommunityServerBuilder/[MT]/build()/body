{
  if (dataDir == null && persistent) {
    throw new IllegalStateException("Must specify path");
  }
  final Optional<File> configFile=buildBefore();
  Log log=logProvider.getLog(getClass());
  Config config=new ConfigLoader(CommunityBootstrapper.settingsClasses).loadConfig(configFile);
  config.setLogger(log);
  return build(configFile,config,GraphDatabaseDependencies.newDependencies().userLogProvider(logProvider).monitors(new Monitors()));
}
