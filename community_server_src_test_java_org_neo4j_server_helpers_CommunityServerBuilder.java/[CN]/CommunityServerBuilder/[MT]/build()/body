{
  if (dbDir == null && persistent) {
    throw new IllegalStateException("Must specify path");
  }
  final File configFile=createPropertiesFiles();
  if (preflightTasks == null) {
    preflightTasks=new PreFlightTasks(){
      @Override public boolean run(){
        return true;
      }
    }
;
  }
  return new TestCommunityNeoServer(new PropertyFileConfigurator(new Validator(new DatabaseLocationMustBeSpecifiedRule()),configFile),configFile);
}
