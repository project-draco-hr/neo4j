{
  ByteBuf buffer=ctx.alloc().buffer();
  WritableChannel channel=new NetworkFlushableByteBuf(buffer);
  channel.putInt(message.type().ordinal());
  writeMember(message.from(),channel);
  StoreIdMarshal.marshal(message.storeId(),channel);
  if (message instanceof RaftMessages.Vote.Request) {
    RaftMessages.Vote.Request<CoreMember> voteRequest=(RaftMessages.Vote.Request<CoreMember>)message;
    writeMember(voteRequest.candidate(),channel);
    channel.putLong(voteRequest.term());
    channel.putLong(voteRequest.lastLogIndex());
    channel.putLong(voteRequest.lastLogTerm());
  }
 else   if (message instanceof RaftMessages.Vote.Response) {
    RaftMessages.Vote.Response<CoreMember> voteResponse=(RaftMessages.Vote.Response<CoreMember>)message;
    channel.putLong(voteResponse.term());
    channel.put((byte)(voteResponse.voteGranted() ? 1 : 0));
  }
 else   if (message instanceof RaftMessages.AppendEntries.Request) {
    RaftMessages.AppendEntries.Request<CoreMember> appendRequest=(RaftMessages.AppendEntries.Request<CoreMember>)message;
    channel.putLong(appendRequest.leaderTerm());
    channel.putLong(appendRequest.prevLogIndex());
    channel.putLong(appendRequest.prevLogTerm());
    channel.putLong(appendRequest.leaderCommit());
    channel.putLong(appendRequest.entries().length);
    for (    RaftLogEntry raftLogEntry : appendRequest.entries()) {
      channel.putLong(raftLogEntry.term());
      marshal.marshal(raftLogEntry.content(),channel);
    }
  }
 else   if (message instanceof RaftMessages.AppendEntries.Response) {
    RaftMessages.AppendEntries.Response<CoreMember> appendResponse=(RaftMessages.AppendEntries.Response<CoreMember>)message;
    channel.putLong(appendResponse.term());
    channel.put((byte)(appendResponse.success() ? 1 : 0));
    channel.putLong(appendResponse.matchIndex());
    channel.putLong(appendResponse.appendIndex());
  }
 else   if (message instanceof RaftMessages.NewEntry.Request) {
    RaftMessages.NewEntry.Request<CoreMember> newEntryRequest=(RaftMessages.NewEntry.Request<CoreMember>)message;
    marshal.marshal(newEntryRequest.content(),channel);
  }
 else   if (message instanceof RaftMessages.Heartbeat) {
    RaftMessages.Heartbeat<CoreMember> heartbeat=(RaftMessages.Heartbeat<CoreMember>)message;
    channel.putLong(heartbeat.leaderTerm());
    channel.putLong(heartbeat.commitIndexTerm());
    channel.putLong(heartbeat.commitIndex());
  }
 else   if (message instanceof RaftMessages.LogCompactionInfo) {
    RaftMessages.LogCompactionInfo<CoreMember> logCompactionInfo=(RaftMessages.LogCompactionInfo<CoreMember>)message;
    channel.putLong(logCompactionInfo.leaderTerm());
    channel.putLong(logCompactionInfo.prevIndex());
  }
 else {
    throw new IllegalArgumentException("Unknown message type");
  }
  list.add(buffer);
}
