{
  File tmpFile=new File(this.file.getParentFile(),this.file.getName() + ".tmp");
  write(tmpFile);
  this.oldFile.delete();
  if (this.file.exists() && !this.file.renameTo(this.oldFile)) {
    throw new RuntimeException("Couldn't rename " + file + " -> "+ oldFile);
  }
  if (!tmpFile.renameTo(this.file)) {
    throw new RuntimeException("Couldn't rename " + tmpFile + " -> "+ file);
  }
  this.oldFile.delete();
}
