{
  int id=IdGenerator.getGenerator().nextId(PropertyIndex.class);
  PropertyIndex index=new PropertyIndex(key,id);
  EventManager em=EventManager.getManager();
  EventData eventData=new EventData(new PropIndexOpData(index));
  if (!em.generateProActiveEvent(Event.PROPERTY_INDEX_CREATE,eventData)) {
    setRollbackOnly();
    throw new CreateException("Unable to create property index, " + "pro-active event failed.");
  }
  Transaction tx=null;
  try {
    tx=transactionManager.getTransaction();
    if (tx == null) {
      throw new NotInTransactionException("Unable to create property index for " + index.getKey());
    }
    tx.registerSynchronization(new TxCommitHook(index));
  }
 catch (  javax.transaction.SystemException e) {
    throw new NotInTransactionException(e);
  }
catch (  Exception e) {
    throw new NotInTransactionException(e);
  }
  em.generateReActiveEvent(Event.PROPERTY_INDEX_CREATE,eventData);
  return index;
}
