{
  TransactionMarker marker=registry.get(id);
  if (null == marker) {
    throw new InvalidTransactionIdError("The transaction you asked for cannot be found. " + "This could also be because the transaction has timed out and has been rolled back.");
  }
  if (!marker.isSuspended()) {
    throw new ConcurrentTransactionAccessError("Please ensure that you are not concurrently using the same transaction elsewhere. ");
  }
  SuspendedTransaction transaction=marker.getTransaction();
  if (registry.replace(id,marker,ActiveTransaction.INSTANCE)) {
    transaction.context.resumeSinceTransactionsAreStillThreadBound();
    return transaction.context;
  }
 else {
    throw new ConcurrentTransactionAccessError("Please ensure that you are not concurrently using the same transaction elsewhere. ");
  }
}
