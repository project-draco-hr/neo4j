{
  while (true) {
    TraversalBranch next=current.next(expander,metadata);
    if (next != null) {
      if (!visitedNodes.contains(next.endNode().getId())) {
        P newPriority=addPriority(next,currentAggregatedValue,calculateValue(next));
        queue.put(next,newPriority);
      }
    }
 else {
      break;
    }
  }
  Entry<TraversalBranch,P> entry=queue.pop();
  if (entry != null) {
    current=entry.getEntity();
    currentAggregatedValue=entry.getPriority();
    visitedNodes.add(current.endNode().getId());
    return current;
  }
  return null;
}
