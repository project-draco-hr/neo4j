{
  Response response=mock(Response.class);
  final AtomicReference<StreamingOutput> ref=new AtomicReference<>();
  final Response.ResponseBuilder responseBuilder=mockResponsBuilder(response,ref);
  OutputFormat format=repository.outputFormat(asList(MediaType.APPLICATION_JSON_TYPE),null,streamingHeader());
  assertNotNull(format);
  Response returnedResponse=format.response(responseBuilder,new MapRepresentation(map("a","test")));
  assertSame(response,returnedResponse);
  StreamingOutput streamingOutput=ref.get();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  streamingOutput.write(baos);
  assertEquals("{\"a\":\"test\"}",baos.toString());
}
