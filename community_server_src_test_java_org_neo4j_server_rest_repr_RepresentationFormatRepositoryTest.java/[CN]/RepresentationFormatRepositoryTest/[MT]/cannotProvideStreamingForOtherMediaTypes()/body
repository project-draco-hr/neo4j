{
  final Response.ResponseBuilder responseBuilder=mock(Response.ResponseBuilder.class);
  when(responseBuilder.entity(anyString())).thenReturn(responseBuilder);
  Mockito.verify(responseBuilder,never()).entity(isA(StreamingOutput.class));
  when(responseBuilder.type(Mockito.<MediaType>any())).thenReturn(responseBuilder);
  when(responseBuilder.header(HttpHeaders.CONTENT_ENCODING,"UTF-8")).thenReturn(responseBuilder);
  when(responseBuilder.build()).thenReturn(null);
  OutputFormat format=repository.outputFormat(asList(MediaType.TEXT_HTML_TYPE),new URI("http://some.host"),streamingHeader());
  assertNotNull(format);
  format.response(responseBuilder,new ExceptionRepresentation(new RuntimeException()));
}
