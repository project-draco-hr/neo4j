{
  if (protocol.isExpecting(NextMessage.CORE_SNAPSHOT)) {
    out.add(new CoreSnapshot.Marshal().unmarshal(msg));
  }
 else {
    out.add(Unpooled.copiedBuffer(msg));
  }
}
