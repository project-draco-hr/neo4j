{
  if (directoryContainsDb(targetDirectory)) {
    throw new RuntimeException(targetDirectory + " already contains a database");
  }
  BackupClient client=new BackupClient(hostNameOrIp,port,StringLogger.DEV_NULL,Client.NO_STORE_ID_GETTER);
  long timestamp=System.currentTimeMillis();
  try {
    Response<Void> response=client.fullBackup(decorateWithProgressIndicator(new ToFileStoreWriter(targetDirectory)));
    GraphDatabaseSPI targetDb=startTemporaryDb(targetDirectory,VerificationLevel.NONE);
    try {
      unpackResponse(response,targetDb,MasterUtil.txHandlerForFullCopy());
    }
  finally {
      targetDb.shutdown();
    }
    bumpLogFile(targetDirectory,timestamp);
    if (verification) {
      StoreFactory factory=new StoreFactory(stringMap(),defaultIdGeneratorFactory(),defaultFileSystemAbstraction(),defaultLastCommittedTxIdSetter(),SYSTEM,defaultTxHook());
      NeoStore neoStore=factory.newNeoStore(new File(targetDirectory,NeoStore.DEFAULT_NAME).getAbsolutePath());
      try {
        StoreAccess store=new StoreAccess(neoStore);
        ConsistencyCheck.run(store,false);
      }
  finally {
        neoStore.close();
      }
    }
  }
  finally {
    client.shutdown();
  }
  return this;
}
