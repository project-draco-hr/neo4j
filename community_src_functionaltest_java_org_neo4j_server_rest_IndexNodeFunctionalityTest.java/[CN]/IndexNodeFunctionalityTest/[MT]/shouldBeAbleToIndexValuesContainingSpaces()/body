{
  long nodeId=helper.createNode();
  String key="key";
  String value="value with   spaces  in it";
  value=URIHelper.encode(value);
  ClientResponse response=Client.create().resource(FunctionalTestUtil.indexUri("node",key,value)).entity(JsonHelper.createJsonFrom(FunctionalTestUtil.nodeUri(nodeId)),MediaType.APPLICATION_JSON).post(ClientResponse.class);
  assertEquals(Status.CREATED.getStatusCode(),response.getStatus());
  URI location=response.getLocation();
  response=Client.create().resource(FunctionalTestUtil.indexUri("node",key,value)).accept(MediaType.APPLICATION_JSON_TYPE).get(ClientResponse.class);
  assertEquals(Status.OK.getStatusCode(),response.getStatus());
  Collection<?> hits=(Collection<?>)JsonHelper.jsonToSingleValue(response.getEntity(String.class));
  assertEquals(1,hits.size());
  Client.create().resource(location).delete();
  response=Client.create().resource(FunctionalTestUtil.indexUri("node",key,value)).accept(MediaType.APPLICATION_JSON_TYPE).get(ClientResponse.class);
  hits=(Collection<?>)JsonHelper.jsonToSingleValue(response.getEntity(String.class));
  assertEquals(0,hits.size());
}
