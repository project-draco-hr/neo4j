{
  final int capacity=roundedToNearestRecordSize(windowTargetSize);
  this.maxRecordsInBuffer=capacity / recordSize;
  bufferRing=new Ring<>(2,new Factory<ByteBuffer>(){
    @Override public ByteBuffer newInstance(){
      return allocateDirect(capacity);
    }
  }
);
  this.currentBuffer=new Buffer(this,bufferRing.next());
}
