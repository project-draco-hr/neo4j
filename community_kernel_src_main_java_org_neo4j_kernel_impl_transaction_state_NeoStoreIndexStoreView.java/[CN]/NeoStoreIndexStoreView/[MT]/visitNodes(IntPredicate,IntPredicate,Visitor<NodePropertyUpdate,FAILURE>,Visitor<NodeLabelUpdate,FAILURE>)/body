{
  final long allNodes=nodeStore.getHighId();
  return new NodeStoreScan<FAILURE>(nodeStore,locks,allNodes){
    @Override protected void process(    NodeRecord node) throws FAILURE {
      long[] labels=parseLabelsField(node).get(this.nodeStore);
      if (labels.length == 0) {
        return;
      }
      if (labelUpdateVisitor != null) {
        labelUpdateVisitor.visit(labelChanges(node.getId(),EMPTY_LONG_ARRAY,labels));
      }
      if (propertyUpdateVisitor != null && containsAnyLabel(labelIdFilter,labels)) {
        properties:         for (        PropertyBlock property : properties(node)) {
          int propertyKeyId=property.getKeyIndexId();
          if (propertyKeyIdFilter.test(propertyKeyId)) {
            NodePropertyUpdate update=add(node.getId(),propertyKeyId,valueOf(property),labels);
            propertyUpdateVisitor.visit(update);
            continue properties;
          }
        }
      }
    }
  }
;
}
