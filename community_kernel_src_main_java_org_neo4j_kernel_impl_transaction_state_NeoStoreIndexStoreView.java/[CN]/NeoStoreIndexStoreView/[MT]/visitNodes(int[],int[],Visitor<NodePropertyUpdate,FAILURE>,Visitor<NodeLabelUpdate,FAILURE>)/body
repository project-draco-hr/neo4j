{
  final long allNodes=counts.nodeCount(ANY_LABEL,Registers.newDoubleLongRegister()).readSecond();
  return new NodeStoreScan<FAILURE>(nodeStore,locks,allNodes){
    @Override protected void process(    NodeRecord node) throws FAILURE {
      long[] labels=parseLabelsField(node).get(this.nodeStore);
      if (labels.length == 0) {
        return;
      }
      if (labelUpdateVisitor != null) {
        labelUpdateVisitor.visit(labelChanges(node.getId(),EMPTY_LONG_ARRAY,labels));
      }
      if (!containsAnyLabel(labelIds,labels)) {
        return;
      }
      properties:       for (      PropertyBlock property : properties(node)) {
        int propertyKeyId=property.getKeyIndexId();
        for (        int sought : propertyKeyIds) {
          if (propertyKeyId == sought) {
            NodePropertyUpdate update=add(node.getId(),propertyKeyId,valueOf(property),labels);
            propertyUpdateVisitor.visit(update);
            continue properties;
          }
        }
      }
    }
  }
;
}
