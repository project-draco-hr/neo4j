{
  final int soughtLabelId=descriptor.getLabelId();
  final int soughtPropertyKeyId=descriptor.getPropertyKeyId();
  final long labelledNodes=counts.nodeCount(soughtLabelId,Registers.newDoubleLongRegister()).readSecond();
  return new NodeStoreScan<NodePropertyUpdate,FAILURE>(nodeStore,locks,labelledNodes){
    @Override protected NodePropertyUpdate read(    NodeRecord node){
      long[] labels=parseLabelsField(node).get(this.nodeStore);
      if (!containsLabel(soughtLabelId,labels)) {
        return null;
      }
      for (      PropertyBlock property : properties(node)) {
        int propertyKeyId=property.getKeyIndexId();
        if (soughtPropertyKeyId == propertyKeyId) {
          return NodePropertyUpdate.add(node.getId(),propertyKeyId,valueOf(property),labels);
        }
      }
      return null;
    }
    @Override protected void process(    NodePropertyUpdate update) throws FAILURE {
      visitor.visit(update);
    }
  }
;
}
