{
  Transaction tx=graphDb.beginTx();
  try {
    System.out.println("All members:");
    Node referenceNode=graphDb.getReferenceNode();
    Traverser traverser=referenceNode.traverse(Traverser.Order.BREADTH_FIRST,StopEvaluator.END_OF_GRAPH,new ReturnableEvaluator(){
      @Override public boolean isReturnableNode(      TraversalPosition currentPos){
        if (currentPos.isStartNode()) {
          return false;
        }
        Relationship rel=currentPos.lastRelationshipTraversed();
        return rel.isType(RoleRels.MEMBER_OF);
      }
    }
,RoleRels.ROOT,Direction.INCOMING,RoleRels.PART_OF,Direction.INCOMING,RoleRels.MEMBER_OF,Direction.INCOMING);
    for (    Node group : traverser) {
      System.out.println(group.getProperty(NAME));
    }
    tx.success();
  }
  finally {
    tx.finish();
  }
}
