{
  int term=1;
  int followerAppendIndex=9;
  RaftState<RaftTestMember> state=raftState().myself(myself).term(term).build();
  Follower follower=new Follower();
  appendSomeEntriesToLog(state,follower,followerAppendIndex,term);
  RaftMessages.Heartbeat<RaftTestMember> heartbeat=heartbeat().from(member1).commitIndex(followerAppendIndex - 1).commitIndexTerm(term).leaderTerm(term + 2).build();
  Outcome<RaftTestMember> outcome=follower.handle(heartbeat,state,log());
  Iterator<LogCommand> iterator=outcome.logCommands.iterator();
  assertTrue(iterator.hasNext());
  LogCommand logCommand=iterator.next();
  assertFalse(iterator.hasNext());
  assertThat(logCommand,instanceOf(CommitCommand.class));
  CommitCommand commit=(CommitCommand)logCommand;
  CapturingRaftLog capture=new CapturingRaftLog();
  commit.applyTo(capture);
  assertEquals(followerAppendIndex - 1,capture.commitIndex());
}
