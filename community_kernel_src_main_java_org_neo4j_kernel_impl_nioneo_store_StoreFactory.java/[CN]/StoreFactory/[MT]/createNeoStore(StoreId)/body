{
  boolean readOnly=config.get(GraphDatabaseSettings.read_only);
  if (readOnly) {
    throw new UnderlyingStorageException("Was told to create a neo store, but I'm in read-only mode");
  }
  stringLogger.info("Creating new db @ " + neoStoreFileName);
  try {
    fileSystemAbstraction.mkdirs(neoStoreFileName.getParentFile());
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Unable to create directory " + neoStoreFileName.getParentFile() + " for creating a neo store in",e);
  }
  createEmptyStore(neoStoreFileName,buildTypeDescriptorAndVersion(NeoStore.TYPE_DESCRIPTOR));
  createNodeStore();
  createRelationshipStore();
  createPropertyStore();
  createRelationshipTypeStore();
  createLabelTokenStore();
  createSchemaStore();
  createRelationshipGroupStore(config.get(Configuration.dense_node_threshold));
  NeoStore neoStore=newNeoStore(false);
  for (int i=0; i < 6; i++) {
    neoStore.nextId();
  }
  neoStore.setCreationTime(storeId.getCreationTime());
  neoStore.setRandomNumber(storeId.getRandomId());
  neoStore.setCurrentLogVersion(0);
  neoStore.setLastCommittingAndClosedTransactionId(BASE_TX_ID);
  neoStore.setStoreVersion(NeoStore.versionStringToLong(CommonAbstractStore.ALL_STORES_VERSION));
  neoStore.setGraphNextProp(-1);
  try {
    pageCache.flush();
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException(e);
  }
  return neoStore;
}
