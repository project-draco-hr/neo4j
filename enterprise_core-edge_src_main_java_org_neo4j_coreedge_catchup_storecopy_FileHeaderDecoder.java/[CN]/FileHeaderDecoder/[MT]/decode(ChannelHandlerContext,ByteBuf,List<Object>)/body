{
  if (protocol.isExpecting(NextMessage.FILE_HEADER)) {
    int nameLength=msg.readInt();
    byte[] name=new byte[nameLength];
    msg.readBytes(name);
    long fileLength=msg.readLong();
    out.add(new FileHeader(new String(name),fileLength));
  }
 else {
    out.add(Unpooled.copiedBuffer(msg));
  }
}
