{
  final long logVersionToPrune=findLogVersionToPrune(safeIndex);
  if (logVersionToPrune != -1) {
    logPruning.pruneLogs(logVersionToPrune);
    restorePrevIndexAndTerm();
    metadataCache.removeUpTo(prevIndex - 1);
  }
  return prevIndex;
}
