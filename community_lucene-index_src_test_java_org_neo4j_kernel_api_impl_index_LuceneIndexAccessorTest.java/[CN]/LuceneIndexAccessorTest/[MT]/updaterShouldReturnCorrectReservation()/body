{
  ReservingLuceneIndexWriter indexWriter=mock(ReservingLuceneIndexWriter.class);
  IndexUpdater updater=newIndexUpdater(indexWriter);
  Reservation reservation=updater.validate(asList(add(1,"foo"),change(2,"bar","baz"),remove(3,"qux")));
  reservation.release();
  InOrder inOrder=inOrder(indexWriter);
  inOrder.verify(indexWriter).reserveInsertions(2);
  inOrder.verify(indexWriter).removeReservedInsertions(2);
}
