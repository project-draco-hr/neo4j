{
  IndexWriterFactory<ReservingLuceneIndexWriter> indexWriterFactory=mock(IndexWriterFactory.class);
  when(indexWriterFactory.create(any(Directory.class))).thenReturn(indexWriter);
  LuceneIndexAccessor indexAccessor=new NonUniqueLuceneIndexAccessor(documentLogic,indexWriterFactory,writerLogic,dirFactory,dir);
  return indexAccessor.newUpdater(IndexUpdateMode.ONLINE);
}
