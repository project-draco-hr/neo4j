{
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicInteger initCalls=new AtomicInteger();
  LazySingleReference<Integer> ref=new LazySingleReference<Integer>(){
    @Override protected Integer create(){
      awaitLatch(latch);
      return initCalls.incrementAndGet();
    }
  }
;
  Future<Integer> t1Evaluate=t1.executeDontWait(evaluate(ref));
  t1.waitUntilWaiting();
  Future<Void> t2Invalidate=t2.executeDontWait(invalidate(ref));
  t2.waitUntilBlocked();
  latch.countDown();
  int e=t1Evaluate.get();
  t2Invalidate.get();
  assertEquals("Evaluation",1,e);
}
