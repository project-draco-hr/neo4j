{
  long endPosition=writeBuffer.getFileChannelPosition();
  if (xidIdentMap.size() > 0) {
    log.info("Active transactions: " + xidIdentMap.size());
    log.info("Closing dirty log: " + fileName + "."+ currentLog);
    if (writeBuffer != null) {
      writeBuffer.force();
    }
    writeBuffer=null;
    fileChannel.close();
    return;
  }
  if (!keepLogs || backupSlave) {
    deleteCurrentLogFile(fileName + "." + currentLog);
  }
 else {
    renameCurrentLogFileAndIncrementVersion(fileName + "." + currentLog,endPosition);
  }
  setActiveLog(CLEAN);
}
