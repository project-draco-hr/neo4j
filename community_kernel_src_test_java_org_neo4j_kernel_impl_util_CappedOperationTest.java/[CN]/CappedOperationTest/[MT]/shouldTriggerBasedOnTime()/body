{
  AtomicInteger triggerCount=new AtomicInteger();
  FakeClock clock=new FakeClock();
  CappedOperation<String> operation=countingCappedOperations(triggerCount,CappedOperation.time(clock,1500,TimeUnit.MILLISECONDS));
  operation.event("event");
  assertEquals(0,triggerCount.get());
  clock.forward(1499,TimeUnit.MILLISECONDS);
  operation.event("event");
  assertEquals(0,triggerCount.get());
  clock.forward(2,TimeUnit.MILLISECONDS);
  operation.event("event");
  assertEquals(1,triggerCount.get());
  clock.forward(1600,TimeUnit.MILLISECONDS);
  operation.event("event");
  assertEquals(2,triggerCount.get());
}
