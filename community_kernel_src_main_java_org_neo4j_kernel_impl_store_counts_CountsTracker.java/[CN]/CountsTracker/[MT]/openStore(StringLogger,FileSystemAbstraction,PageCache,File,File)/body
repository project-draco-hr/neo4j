{
  try {
    CountsStore alphaStore=openVerifiedCountsStore(fs,pageCache,alpha);
    CountsStore betaStore=openVerifiedCountsStore(fs,pageCache,beta);
    boolean isAlphaCorrupted=alphaStore == null;
    boolean isBetaCorrupted=betaStore == null;
    if (isAlphaCorrupted && isBetaCorrupted) {
      throw new UnderlyingStorageException("Both counts store files are corrupted. Please shut down the database and delete them " + "to have the database recreate the counts store on next startup");
    }
    if (isAlphaCorrupted) {
      logger.debug("CountsStore picked beta since alpha store file is corrupted " + "(txId=" + betaStore.lastTxId() + ", minorVersion="+ betaStore.minorVersion()+ ")");
      return betaStore;
    }
    if (isBetaCorrupted) {
      logger.debug("CountsStore picked alpha store file since beta is corrupted " + "(txId=" + alphaStore.lastTxId() + ", minorVersion="+ alphaStore.minorVersion()+ ")");
      return alphaStore;
    }
    if (isAlphaStoreMoreRecent(alphaStore,betaStore)) {
      logger.debug("CountsStore picked alpha store file (txId=" + alphaStore.lastTxId() + ", minorVersion="+ alphaStore.minorVersion()+ "), against beta (txId="+ betaStore.lastTxId()+ ", minorVersion="+ betaStore.minorVersion()+ ")");
      betaStore.close();
      return alphaStore;
    }
 else {
      logger.debug("CountsStore picked beta store file (txId=" + betaStore.lastTxId() + ", minorVersion="+ betaStore.minorVersion()+ "), against alpha (txId="+ alphaStore.lastTxId()+ ", minorVersion="+ alphaStore.minorVersion()+ ")");
      alphaStore.close();
      return betaStore;
    }
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException(e);
  }
}
