{
  try {
    long endTime=System.currentTimeMillis() + maxSeconds * 1000;
    ProcessStreamHandler streamHandler=new ProcessStreamHandler(process,false);
    streamHandler.launch();
    try {
      while (System.currentTimeMillis() < endTime) {
        try {
          return process.exitValue();
        }
 catch (        IllegalThreadStateException e) {
          Thread.sleep(100);
        }
      }
      tempHackToGetThreadDump(process);
      throw new RuntimeException("Process didn't exit on its own.");
    }
  finally {
      streamHandler.cancel();
    }
  }
  finally {
    process.destroy();
  }
}
