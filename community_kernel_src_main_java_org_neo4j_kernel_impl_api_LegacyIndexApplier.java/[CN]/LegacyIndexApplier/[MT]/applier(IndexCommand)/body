{
  byte nameId=command.getIndexNameId();
  String indexName=defineCommand.getIndexName(nameId);
  NeoCommandHandler applier=providerAppliers.get(indexName);
  if (applier == null) {
    IndexEntityType entityType=IndexEntityType.byId(command.getEntityType());
    Map<String,String> config=indexConfigStore.get(entityType.entityClass(),indexName);
    if (config == null) {
      throw new IllegalStateException("Unknown " + entityType.nameToLowerCase() + " index '"+ indexName+ "'");
    }
    String providerName=config.get(PROVIDER);
    applier=providerLookup.lookup(providerName).newApplier(mode.needsIdempotencyChecks());
    applier.visitIndexDefineCommand(defineCommand);
    providerAppliers.put(indexName,applier);
  }
  return applier;
}
