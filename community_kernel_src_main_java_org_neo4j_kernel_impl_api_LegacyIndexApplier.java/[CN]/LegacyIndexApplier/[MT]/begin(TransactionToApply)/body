{
  if (transaction.commitment().hasLegacyIndexChanges()) {
    activeTransactionId=transaction.transactionId();
    try {
      transactionOrdering.waitFor(activeTransactionId);
      if (transaction.next() == null) {
        isLastTransactionInBatch=true;
      }
    }
 catch (    InterruptedException e) {
      throw new IOException("Interrupted while waiting for applying tx:" + activeTransactionId + " legacy index updates",e);
    }
  }
}
