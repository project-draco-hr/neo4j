{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabase(dir);
  Transaction tx=db.beginTx();
  db.createNode().createRelationshipTo(db.createNode(),MyRelTypes.TEST);
  tx.success();
  tx.close();
  NeoStoreXaDataSource dataSource=db.getDependencyResolver().resolveDependency(NeoStoreXaDataSource.class);
  DependencyResolver dependencyResolver=dataSource.getDependencyResolver();
  PhysicalLogFile physicalLogFile=dependencyResolver.resolveDependency(PhysicalLogFile.class);
  physicalLogFile.forceRotate();
  tx=db.beginTx();
  db.index().forNodes("index").add(db.createNode(),dir,db.createNode());
  tx.success();
  tx.close();
  exit(0);
}
