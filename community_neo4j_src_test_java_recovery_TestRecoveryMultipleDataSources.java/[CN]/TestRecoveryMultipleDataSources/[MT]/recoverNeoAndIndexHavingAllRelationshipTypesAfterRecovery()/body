{
  deleteRecursively(new File(dir));
  assertEquals(0,getRuntime().exec(new String[]{"java","-cp",getProperty("java.class.path"),getClass().getName()}).waitFor());
  GraphDatabaseService db=new GraphDatabaseFactory().newEmbeddedDatabase(dir);
  Transaction transaction=db.beginTx();
  try {
    assertEquals(MyRelTypes.TEST.name(),GlobalGraphOperations.at(db).getAllRelationshipTypes().iterator().next().name());
  }
  finally {
    transaction.finish();
    db.shutdown();
  }
}
