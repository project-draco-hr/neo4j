{
  PhysicalLogFiles logFiles=new PhysicalLogFiles(storeDir,fileSystem);
  File logFileForVersion=logFiles.getLogFileForVersion(logVersion);
  if (!fileSystem.fileExists(logFileForVersion)) {
    try (StoreChannel channel=fileSystem.create(logFileForVersion)){
      writeLogHeader(channel,logVersion,lastCommittedTx);
    }
   }
  try (LogVersionedStoreChannel storeChannel=PhysicalLogFile.openForVersion(logFiles,fileSystem,logVersion,true)){
    long offset=storeChannel.size();
    storeChannel.position(offset);
    try (PositionAwarePhysicalFlushableChannel channel=new PositionAwarePhysicalFlushableChannel(storeChannel)){
      TransactionLogWriter writer=new TransactionLogWriter(new LogEntryWriter(channel));
      writer.checkPoint(new LogPosition(logVersion,offset));
    }
   }
 }
