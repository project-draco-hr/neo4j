{
  NeoStores neoStores=neoStoresRule.open();
  TransactionRecordState recordState=new TransactionRecordState(neoStores,integrityValidator,newContext(neoStores));
  int nodeId=1;
  recordState.nodeCreate(nodeId);
  int propertyKey=1;
  Object value=5;
  recordState.nodeAddProperty(nodeId,propertyKey,value);
  Collection<Command> commands=new ArrayList<>();
  recordState.extractCommands(commands);
  PropertyCommand propertyCommand=singlePropertyCommand(commands);
  PropertyRecord before=propertyCommand.getBefore();
  assertFalse(before.inUse());
  assertFalse(before.iterator().hasNext());
  PropertyRecord after=propertyCommand.getAfter();
  assertTrue(after.inUse());
  assertEquals(1,count(after));
}
