{
  int nodeId=0;
  NeoStores neoStores=neoStoresRule.open();
  TransactionRecordState recordState=new TransactionRecordState(neoStores,integrityValidator,newContext(neoStores));
  int propertyKey1=1, propertyKey2=2;
  Object value1="first", value2=4;
  recordState.nodeCreate(nodeId);
  DefinedProperty property1=recordState.nodeAddProperty(nodeId,propertyKey1,value1);
  DefinedProperty property2=recordState.nodeAddProperty(nodeId,propertyKey2,value2);
  apply(neoStores,transactionRepresentationOf(recordState));
  Object newValue1="new", newValue2="new 2";
  recordState=new TransactionRecordState(neoStores,integrityValidator,newContext(neoStores));
  recordState.nodeChangeProperty(nodeId,property1.propertyKeyId(),newValue1);
  recordState.nodeChangeProperty(nodeId,property2.propertyKeyId(),newValue2);
  Iterable<NodePropertyUpdate> indexUpdates=indexUpdatesOf(neoStores,recordState);
  assertEquals(asSet(change(nodeId,propertyKey1,value1,EMPTY_LONG_ARRAY,newValue1,EMPTY_LONG_ARRAY),change(nodeId,propertyKey2,value2,EMPTY_LONG_ARRAY,newValue2,EMPTY_LONG_ARRAY)),asSet(indexUpdates));
}
