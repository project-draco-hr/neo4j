{
  Map<Node,Integer> counts=new HashMap<Node,Integer>();
  for (  Node message : new VisibleMessagesByFollowedUsers(user)) {
    Integer seen=counts.get(message);
    counts.put(message,seen == null ? 1 : (seen + 1));
    count++;
  }
  StringBuilder duplicates=null;
  for (  Map.Entry<Node,Integer> seen : counts.entrySet()) {
    if (seen.getValue() > 1) {
      if (duplicates == null) {
        duplicates=new StringBuilder("These nodes occured multiple times (expected once): ");
      }
 else {
        duplicates.append(", ");
      }
      duplicates.append(seen.getKey());
      duplicates.append(" (");
      duplicates.append(seen.getValue());
      duplicates.append(" times)");
    }
  }
  if (duplicates != null) {
    fail(duplicates.toString());
  }
  tx.success();
}
