{
  long myCurrentSize=currentSize.get();
  if (myCurrentSize <= closeToMaxSize) {
    return;
  }
  if (purging.compareAndSet(false,true)) {
    try {
      doPurge(pos);
    }
  finally {
      purging.set(false);
    }
  }
 else {
    if (myCurrentSize < purgeHandoffSize) {
      avertedPurgeWaits.incrementAndGet();
    }
 else {
      forcedPurgeWaits.incrementAndGet();
      waitForCurrentPurgeToComplete();
    }
  }
}
