{
  db.getDependencyResolver().resolveDependency(NodeManager.class).clearCache();
  ExecutorService executor=newCachedThreadPool();
  final CountDownLatch startSignal=new CountDownLatch(1);
  int threads=getRuntime().availableProcessors();
  final List<Throwable> errors=Collections.synchronizedList(new ArrayList<Throwable>());
  for (int i=0; i < threads; i++) {
    executor.submit(new Runnable(){
      @Override public void run(){
        awaitStartSignalAndRandomTimeLonger(startSignal);
        Transaction transaction=db.beginTx();
        try {
          assertEquals(relCount,count(node.getRelationships()));
        }
 catch (        Throwable e) {
          errors.add(e);
        }
 finally {
          transaction.finish();
        }
      }
    }
);
  }
  startSignal.countDown();
  executor.shutdown();
  executor.awaitTermination(10,SECONDS);
  if (!errors.isEmpty()) {
    throw new MultipleCauseException(format("Exception(s) after %s iterations with %s threads",iterations,threads),errors);
  }
}
