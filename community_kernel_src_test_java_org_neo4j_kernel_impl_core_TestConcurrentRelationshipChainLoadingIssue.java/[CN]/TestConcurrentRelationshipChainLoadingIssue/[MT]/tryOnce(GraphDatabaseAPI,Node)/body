{
  db.getNodeManager().clearCache();
  ExecutorService executor=newCachedThreadPool();
  final CountDownLatch startSignal=new CountDownLatch(1);
  int threads=getRuntime().availableProcessors();
  final AtomicReference<Throwable> error=new AtomicReference<Throwable>();
  for (int i=0; i < threads; i++) {
    executor.submit(new Runnable(){
      @Override public void run(){
        awaitStartSignalAndRandomTimeLonger(startSignal);
        Transaction transaction=db.beginTx();
        try {
          assertEquals(relCount,count(node.getRelationships()));
        }
 catch (        Throwable e) {
          error.set(e);
        }
 finally {
          transaction.finish();
        }
      }
    }
);
  }
  startSignal.countDown();
  executor.shutdown();
  executor.awaitTermination(10,SECONDS);
  if (error.get() != null)   throw error.get();
}
