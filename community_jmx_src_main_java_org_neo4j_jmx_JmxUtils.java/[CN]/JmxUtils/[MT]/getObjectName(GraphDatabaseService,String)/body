{
  if (!(db instanceof GraphDatabaseAPI)) {
    throw new IllegalArgumentException("Can only resolve object names for embedded Neo4j database " + "instances, eg. instances created by GraphDatabaseFactory or HighlyAvailableGraphDatabaseFactory.");
  }
  ObjectName neoQuery=((GraphDatabaseAPI)db).getDependencyResolver().resolveDependency(JmxKernelExtension.class).getSingleManagementBean(Kernel.class).getMBeanQuery();
  String instance=neoQuery.getKeyProperty("instance");
  String domain=neoQuery.getDomain();
  try {
    return new ObjectName(format("%s:instance=%s,name=%s",domain,instance,name));
  }
 catch (  MalformedObjectNameException e) {
    throw new RuntimeException(e);
  }
}
