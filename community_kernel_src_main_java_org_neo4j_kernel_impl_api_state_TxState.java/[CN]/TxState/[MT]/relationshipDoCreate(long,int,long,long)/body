{
  relationships().add(id);
  if (startNodeId == endNodeId) {
    getOrCreateNodeState(startNodeId).addRelationship(id,relationshipTypeId,Direction.BOTH);
  }
 else {
    getOrCreateNodeState(startNodeId).addRelationship(id,relationshipTypeId,Direction.OUTGOING);
    getOrCreateNodeState(endNodeId).addRelationship(id,relationshipTypeId,Direction.INCOMING);
  }
  getOrCreateRelationshipState(id).setMetaData(startNodeId,endNodeId,relationshipTypeId);
  hasChanges=true;
}
