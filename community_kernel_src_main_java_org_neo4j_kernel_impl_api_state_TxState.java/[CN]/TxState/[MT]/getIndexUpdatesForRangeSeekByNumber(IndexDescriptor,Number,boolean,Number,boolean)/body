{
  TreeMap<DefinedProperty,DiffSets<Long>> sortedUpdates=getSortedIndexUpdates(descriptor);
  if (sortedUpdates == null) {
    return null;
  }
  DefinedProperty selectedLower;
  boolean selectedIncludeLower;
  DefinedProperty selectedUpper;
  boolean selectedIncludeUpper;
  int propertyKeyId=descriptor.getPropertyKeyId();
  if (lower == null) {
    selectedLower=DefinedProperty.numberProperty(propertyKeyId,NUMBER.lowLimit.castValue(Number.class));
    selectedIncludeLower=NUMBER.lowLimit.isInclusive;
  }
 else {
    selectedLower=numberProperty(propertyKeyId,lower);
    selectedIncludeLower=includeLower;
  }
  if (upper == null) {
    selectedUpper=DefinedProperty.numberProperty(propertyKeyId,NUMBER.highLimit.castValue(Number.class));
    selectedIncludeUpper=NUMBER.highLimit.isInclusive;
  }
 else {
    selectedUpper=numberProperty(propertyKeyId,upper);
    selectedIncludeUpper=includeUpper;
  }
  DiffSets<Long> diffs=new DiffSets<>();
  for (  Map.Entry<DefinedProperty,DiffSets<Long>> entry : sortedUpdates.subMap(selectedLower,selectedIncludeLower,selectedUpper,selectedIncludeUpper).entrySet()) {
    DiffSets<Long> diffSets=entry.getValue();
    diffs.addAll(diffSets.getAdded().iterator());
    diffs.removeAll(diffSets.getRemoved().iterator());
  }
  return diffs;
}
