{
  File fileName=me.getStoreFileName(StoreFactory.COUNTS_STORE);
  boolean readOnly=me.config.get(GraphDatabaseSettings.read_only);
  CountsTracker counts=readOnly ? me.createReadOnlyCountsTracker(fileName) : me.createWritableCountsTracker(fileName);
  counts.setInitializer(new DataInitializer<CountsAccessor.Updater>(){
    private final Log log=me.logProvider.getLog(MetaDataStore.class);
    @Override public void initialize(    CountsAccessor.Updater updater){
      log.warn("Missing counts store, rebuilding it.");
      new CountsComputer(me).initialize(updater);
    }
    @Override public long initialVersion(){
      return ((MetaDataStore)me.getOrCreateStore(META_DATA)).getLastCommittedTransactionId();
    }
  }
);
  try {
    counts.init();
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Failed to initialize counts store",e);
  }
  return counts;
}
