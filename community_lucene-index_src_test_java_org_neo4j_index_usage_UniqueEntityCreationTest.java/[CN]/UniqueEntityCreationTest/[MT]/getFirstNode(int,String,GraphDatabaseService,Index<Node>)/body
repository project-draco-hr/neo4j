{
  final IndexHits<Node> hits=index.get("name",key);
  Node firstNode=null;
  Set<Node> duplicates=new HashSet<Node>();
  try {
    for (    Node node : hits) {
      if (firstNode == null) {
        firstNode=node;
      }
 else {
        duplicates.add(node);
      }
    }
  }
  finally {
    hits.close();
  }
  if (!duplicates.isEmpty()) {
    ArrayList<Node> duplicatesList=new ArrayList(duplicates);
    for (int i=0; i < duplicatesList.size(); i++) {
      Node node=duplicatesList.get(i);
      String message=String.format("Thread %d: For %s, found node %d, deleting node %d (duplicate %d)",threadNumber,key,firstNode.getId(),node.getId(),i);
      Transaction tx=graphDb.beginTx();
      try {
        index.remove(node,"name",key);
        node.delete();
        tx.success();
      }
 catch (      Exception e) {
        message+=" threw " + e.getClass().getSimpleName();
      }
 finally {
        tx.finish();
      }
      System.out.println(message);
    }
  }
  return firstNode;
}
