{
  if (enabled.get()) {
    System.out.println("flushing");
    beginBarrier.release();
  }
  delegate.flush();
  if (enabled.get()) {
    System.out.println("flushed");
    commitBarrier.awaitUninterruptibly();
    commitBarrier.release();
  }
}
