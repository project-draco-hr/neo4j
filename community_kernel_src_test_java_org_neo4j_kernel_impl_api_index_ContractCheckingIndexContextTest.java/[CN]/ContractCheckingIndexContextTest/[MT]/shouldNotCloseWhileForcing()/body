{
  final DoubleLatch latch=new DoubleLatch();
  final IndexContext inner=new IndexContext.Adapter(){
    @Override public void force(){
      latch.startAndAwaitFinish();
    }
  }
;
  final IndexContext outer=new ContractCheckingIndexContext(inner);
  outer.create();
  new Thread(new Runnable(){
    @Override public void run(){
      outer.force();
    }
  }
).start();
  try {
    latch.awaitStart();
    outer.close();
  }
  finally {
    latch.finish();
  }
}
