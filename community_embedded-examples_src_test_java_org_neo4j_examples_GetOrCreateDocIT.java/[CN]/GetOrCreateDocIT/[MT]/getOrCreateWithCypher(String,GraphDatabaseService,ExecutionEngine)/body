{
  Node result=null;
  ResourceIterator<Node> resultIterator=null;
  try (Transaction tx=graphDb.beginTx()){
    String queryString="MERGE (n:User {name: {name}}) RETURN n";
    Map<String,Object> parameters=new HashMap<>();
    parameters.put("name",username);
    resultIterator=engine.execute(queryString,parameters).columnAs("n");
    result=resultIterator.next();
    tx.success();
    return result;
  }
  finally {
    if (resultIterator != null) {
      if (resultIterator.hasNext()) {
        Node other=resultIterator.next();
        throw new IllegalStateException("Merge returned more than one node: " + result + " and "+ other);
      }
    }
  }
}
