{
  Transaction transaction=graphDb.beginTx();
  try {
    UniqueFactory<Node> factory=new UniqueFactory.UniqueNodeFactory(graphDb,"users"){
      @Override protected void initialize(      Node created,      Map<String,Object> properties){
        created.setProperty("name",properties.get("name"));
      }
    }
;
    Node node=factory.getOrCreate("name",username);
    transaction.success();
    return node;
  }
  finally {
    transaction.finish();
  }
}
