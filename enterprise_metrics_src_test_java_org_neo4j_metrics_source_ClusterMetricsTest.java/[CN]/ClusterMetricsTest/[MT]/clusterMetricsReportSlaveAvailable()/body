{
  MetricRegistry metricRegistry=new MetricRegistry();
  Config config=new Config(stringMap(MetricsSettings.neoClusterEnabled.name(),Settings.TRUE));
  ClusterMembers clusterMembers=getClusterMembers(HighAvailabilityModeSwitcher.SLAVE,HighAvailabilityMemberState.SLAVE);
  DependencyResolver dependencyResolver=mock(DependencyResolver.class);
  when(dependencyResolver.resolveDependency(ClusterMembers.class)).thenReturn(clusterMembers);
  LogService logService=mock(LogService.class);
  Monitors monitors=new Monitors();
  LifeSupport life=new LifeSupport();
  life.add(new ClusterMetrics(config,monitors,metricRegistry,dependencyResolver,logService));
  life.start();
  TestReporter reporter=new TestReporter(metricRegistry);
  reporter.start(10,TimeUnit.MILLISECONDS);
  reporter.report();
  assertEquals(0,reporter.isMasterValue);
  assertEquals(1,reporter.isAvailableValue);
}
