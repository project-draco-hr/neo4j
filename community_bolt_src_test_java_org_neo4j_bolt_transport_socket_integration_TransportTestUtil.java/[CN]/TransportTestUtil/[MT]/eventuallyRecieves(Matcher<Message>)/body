{
  return new TypeSafeMatcher<Connection>(){
    @Override protected boolean matchesSafely(    Connection conn){
      try {
        int messageNo=0;
        ByteArrayOutputStream baos=new ByteArrayOutputStream();
        while (messageNo < messages.length) {
          int size=recvChunkHeader(conn);
          if (size > 0) {
            baos.write(conn.recv(size));
          }
 else {
            Message message=message(baos.toByteArray());
            assertThat(message,messages[messageNo]);
            baos=new ByteArrayOutputStream();
            messageNo++;
          }
        }
        return true;
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
    @Override public void describeTo(    Description description){
      description.appendValueList("Messages[",",","]",messages);
    }
  }
;
}
