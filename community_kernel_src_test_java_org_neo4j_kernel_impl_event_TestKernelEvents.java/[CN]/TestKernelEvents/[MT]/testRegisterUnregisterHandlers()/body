{
  GraphDatabaseService graphDb=new EmbeddedGraphDatabase(PATH);
  KernelEventHandler handler1=new DummyKernelEventHandler(RESOURCE1){
    public ExecutionOrder orderComparedTo(    KernelEventHandler other){
      return ExecutionOrder.DOESNT_MATTER;
    }
  }
;
  KernelEventHandler handler2=new DummyKernelEventHandler(RESOURCE2){
    public ExecutionOrder orderComparedTo(    KernelEventHandler other){
      return ExecutionOrder.DOESNT_MATTER;
    }
  }
;
  try {
    graphDb.unregisterKernelEventHandler(handler1);
    fail("Shouldn't be able to do unregister on a " + "unregistered handler");
  }
 catch (  IllegalStateException e) {
  }
  assertTrue(handler1 == graphDb.registerKernelEventHandler(handler1));
  assertTrue(handler1 == graphDb.registerKernelEventHandler(handler1));
  assertTrue(handler1 == graphDb.unregisterKernelEventHandler(handler1));
  try {
    graphDb.unregisterKernelEventHandler(handler1);
    fail("Shouldn't be able to do unregister on a " + "unregistered handler");
  }
 catch (  IllegalStateException e) {
  }
  assertTrue(handler1 == graphDb.registerKernelEventHandler(handler1));
  assertTrue(handler2 == graphDb.registerKernelEventHandler(handler2));
  assertTrue(handler1 == graphDb.unregisterKernelEventHandler(handler1));
  assertTrue(handler2 == graphDb.unregisterKernelEventHandler(handler2));
  graphDb.shutdown();
}
