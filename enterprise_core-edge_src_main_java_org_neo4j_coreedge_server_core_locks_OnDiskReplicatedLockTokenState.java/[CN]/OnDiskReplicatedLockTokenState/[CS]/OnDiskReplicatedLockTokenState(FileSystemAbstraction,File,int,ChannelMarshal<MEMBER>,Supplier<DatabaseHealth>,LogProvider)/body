{
  File fileA=new File(stateDir,FILENAME + "a");
  File fileB=new File(stateDir,FILENAME + "b");
  InMemoryReplicatedLockStateChannelMarshal<MEMBER> marshal=new InMemoryReplicatedLockStateChannelMarshal<>(channelMarshal);
  ReplicatedLockTokenStateRecoveryManager<MEMBER> recoveryManager=new ReplicatedLockTokenStateRecoveryManager<>(fileSystemAbstraction,marshal);
  StateRecoveryManager.RecoveryStatus recoveryStatus=recoveryManager.recover(fileA,fileB);
  this.inMemoryReplicatedLockTokenState=recoveryManager.readLastEntryFrom(fileSystemAbstraction,recoveryStatus.previouslyActive());
  this.statePersister=new StatePersister<>(fileA,fileB,fileSystemAbstraction,numberOfEntriesBeforeRotation,marshal,recoveryStatus.previouslyInactive(),databaseHealthSupplier);
  logProvider.getLog(getClass()).info("State restored, last index is %d",inMemoryReplicatedLockTokenState.logIndex());
}
