{
  Response<Void> response=Response.EMPTY;
  StoreId storeId=response.getStoreId();
  String host="localhost";
  int port=BackupServer.DEFAULT_PORT;
  LifeSupport life=new LifeSupport();
  LogEntryReader<ReadableClosablePositionAwareChannel> reader=new VersionAwareLogEntryReader<>(new RecordStorageCommandReaderFactory());
  BackupClient client=life.add(new BackupClient(host,port,null,NullLogProvider.getInstance(),storeId,1000,mock(ResponseUnpacker.class),mock(ByteCounterMonitor.class),mock(RequestMonitor.class),reader));
  ControlledBackupInterface backup=new ControlledBackupInterface();
  life.add(new BackupServer(backup,new HostnamePort(host,port),NullLogProvider.getInstance(),mock(ByteCounterMonitor.class),mock(RequestMonitor.class)));
  life.start();
  try {
    StoreWriter writer=mock(StoreWriter.class);
    client.fullBackup(writer,forensics);
    assertEquals(forensics,backup.receivedForensics.booleanValue());
  }
  finally {
    life.shutdown();
  }
}
