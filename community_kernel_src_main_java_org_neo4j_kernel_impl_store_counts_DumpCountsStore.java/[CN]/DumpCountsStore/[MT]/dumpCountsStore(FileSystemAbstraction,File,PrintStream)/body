{
  try (PageCache pages=createPageCache(fs);Lifespan life=new Lifespan()){
    if (fs.isDirectory(path)) {
      StoreFactory factory=new StoreFactory(fs,path,pages,NullLogProvider.getInstance());
      life.add(factory.newCountsStore()).accept(new DumpCountsStore(out,factory));
    }
 else {
      CountsTracker tracker=new CountsTracker(NullLogProvider.getInstance(),fs,pages,new Config(),path);
      if (fs.fileExists(path)) {
        tracker.visitFile(path,new DumpCountsStore(out));
      }
 else {
        life.add(tracker).accept(new DumpCountsStore(out));
      }
    }
  }
 }
