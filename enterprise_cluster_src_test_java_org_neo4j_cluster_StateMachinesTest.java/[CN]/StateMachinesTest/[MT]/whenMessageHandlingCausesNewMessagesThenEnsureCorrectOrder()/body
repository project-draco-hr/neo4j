{
  StateMachines stateMachines=new StateMachines(Mockito.mock(MessageSource.class),Mockito.mock(MessageSender.class),Mockito.mock(Timeouts.class),Mockito.mock(DelayedDirectExecutor.class),new Executor(){
    @Override public void execute(    Runnable command){
      command.run();
    }
  }
);
  ArrayList<TestMessage> handleOrder=new ArrayList<>();
  StateMachine stateMachine=new StateMachine(handleOrder,TestMessage.class,TestState.test,Mockito.mock(Logging.class));
  stateMachines.addStateMachine(stateMachine);
  stateMachines.process(internal(TestMessage.message1));
  assertThat(handleOrder.toString(),equalTo("[message1, message2, message4, message5, message3]"));
}
