{
  StateMachines stateMachines=new StateMachines(mock(MessageSource.class),mock(MessageSender.class),mock(TimeoutStrategy.class),mock(DelayedDirectExecutor.class),new Executor(){
    @Override public void execute(    Runnable command){
      command.run();
    }
  }
,mock(InstanceId.class));
  ArrayList<TestMessage> handleOrder=new ArrayList<TestMessage>();
  StateMachine stateMachine=new StateMachine(handleOrder,TestMessage.class,TestState.test,mock(Logging.class));
  stateMachines.addStateMachine(stateMachine);
  stateMachines.process(internal(TestMessage.message1));
  assertThat(handleOrder.toString(),equalTo("[message1, message2, message4, message5, message3]"));
}
