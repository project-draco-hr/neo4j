{
  FileSystemAbstraction fileSystemAbstraction=new DelegatingFileSystemAbstraction(new DefaultFileSystemAbstraction()){
    @Override public boolean fileExists(    File fileName){
      return false;
    }
    @Override public FileLock tryLock(    File fileName,    StoreChannel channel) throws IOException {
      throw new IOException("Unable to create lock file " + fileName);
    }
  }
;
  StoreLocker storeLocker=new StoreLocker(fileSystemAbstraction);
  try {
    storeLocker.checkLock(target.directory("unused"));
    fail();
  }
 catch (  StoreLockException e) {
    assertThat(e.getMessage(),containsString("Unable to obtain lock on store lock file"));
  }
 finally {
    storeLocker.release();
  }
}
