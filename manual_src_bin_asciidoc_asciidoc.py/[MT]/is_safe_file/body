def is_safe_file(fname, directory=None):
    if (directory is None):
        if (document.infile == '<stdin>'):
            return (not safe())
        directory = os.path.dirname(document.infile)
    elif (directory == ''):
        directory = '.'
    return ((not safe()) or file_in(fname, directory) or file_in(fname, APP_DIR) or file_in(fname, CONF_DIR))
