def extract_zip(zip_file, destdir):
    '\n    Unzip Zip file to destination directory.\n    Throws exception if error occurs.\n    '
    zipo = zipfile.ZipFile(zip_file, 'r')
    try:
        for zi in zipo.infolist():
            outfile = zi.filename
            if (not outfile.endswith('/')):
                (d, outfile) = os.path.split(outfile)
                directory = os.path.normpath(os.path.join(destdir, d))
                if (not os.path.isdir(directory)):
                    os.makedirs(directory)
                outfile = os.path.join(directory, outfile)
                perms = ((zi.external_attr >> 16) & 511)
                message.verbose(('extracting: %s' % outfile))
                flags = (os.O_CREAT | os.O_WRONLY)
                if (sys.platform == 'win32'):
                    flags |= os.O_BINARY
                if (perms == 0):
                    fh = os.open(outfile, flags)
                else:
                    fh = os.open(outfile, flags, perms)
                try:
                    os.write(fh, zipo.read(zi.filename))
                finally:
                    os.close(fh)
    finally:
        zipo.close()
