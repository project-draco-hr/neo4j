def subs(self, text, prefix='', callouts=False):
    result = text
    for m in self.macros:
        if (m.prefix == prefix):
            if (callouts ^ (m.name != 'callout')):
                result = m.subs(result)
    return result
