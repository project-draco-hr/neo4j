{
  assertValidArguments(resource,tx);
synchronized (resourceLockMap) {
    RWLock lock=resourceLockMap.get(resource);
    if (lock == null) {
      throw new LockNotFoundException("Lock not found for: " + resource + " tx:"+ tx);
    }
    if (!lock.isMarked() && lock.getReadCount() == readCountPrerequisite && lock.getWriteCount() == writeCountPrerequisite && lock.getWaitingThreadsCount() == 0) {
      resourceLockMap.remove(resource);
    }
    return lock;
  }
}
