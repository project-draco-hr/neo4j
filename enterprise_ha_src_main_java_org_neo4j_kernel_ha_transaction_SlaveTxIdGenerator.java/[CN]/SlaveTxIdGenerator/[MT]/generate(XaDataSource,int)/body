{
  try {
    TransactionState txState=txManager.getTransactionState();
    txState.getTxHook().remotelyInitializeTransaction(txManager.getEventIdentifier(),txState);
    Response<Long> response=master.commitSingleResourceTransaction(requestContextFactory.newRequestContext(dataSource),dataSource.getName(),myPreparedTransactionToCommit(dataSource,identifier));
    xaDsm.applyTransactions(response);
    return response.response().longValue();
  }
 catch (  ComException e) {
    throw Exceptions.withCause(new XAException(XAException.XA_HEURCOM),e);
  }
catch (  RuntimeException e) {
    Throwable currentException=e.getCause();
    while (currentException != null) {
      if (currentException instanceof XAException) {
        throw Exceptions.withCause(new XAException(((XAException)currentException).errorCode),e);
      }
      currentException=currentException.getCause();
    }
    throw e;
  }
}
