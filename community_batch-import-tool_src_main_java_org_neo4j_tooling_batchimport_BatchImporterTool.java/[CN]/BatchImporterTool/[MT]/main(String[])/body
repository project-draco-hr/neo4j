{
  Args args=new Args(incomingArguments);
  FileSystemAbstraction fs=new DefaultFileSystemAbstraction();
  File storeDir, nodesFile, relationshipsFile, nodeHeaderFile, relationshipHeaderFile;
  storeDir=parseArgument(args,STORE_DIR,Converters.<File>mandatory(),Converters.toFile(),DIRECTORY_IS_WRITABLE,CONTAINS_NO_EXISTING_DATABASE);
  nodesFile=parseArgument(args,NODE_DATA,Converters.<File>mandatory(),Converters.toFile(),FILE_EXISTS);
  relationshipsFile=parseArgument(args,RELATIONSHIP_DATA,Converters.<File>mandatory(),Converters.toFile(),FILE_EXISTS);
  nodeHeaderFile=parseArgument(args,NODE_HEADER,Converters.<File>optional(),Converters.toFile(),FILE_EXISTS);
  relationshipHeaderFile=parseArgument(args,RELATIONSHIP_HEADER,Converters.<File>optional(),Converters.toFile(),FILE_EXISTS);
  if (nodeHeaderFile != null && nodeHeaderFile.equals(nodesFile)) {
    nodeHeaderFile=null;
  }
  if (relationshipHeaderFile != null && relationshipHeaderFile.equals(relationshipsFile)) {
    relationshipHeaderFile=null;
  }
  BatchImporter importer=new ParallelBatchImporter(storeDir.getPath(),DEFAULT,new SystemOutLogging(),ExecutionMonitors.defaultVisible());
  Input input=new CsvInput(DataFactories.file(nodesFile),nodeHeaderFile != null ? defaultFormatNodeFileHeader(nodeHeaderFile) : defaultFormatNodeFileHeader(),DataFactories.file(relationshipsFile),relationshipHeaderFile != null ? defaultFormatRelationshipFileHeader(relationshipHeaderFile) : defaultFormatRelationshipFileHeader(),parseArgument(args,ID_TYPE,withDefault(IdType.STRING),toIdType()),csvConfiguration(args,nodesFile));
  boolean success=false;
  try {
    importer.doImport(input);
    success=true;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
 finally {
    if (!success) {
      try {
        StoreFile.fileOperation(FileOperation.DELETE,fs,storeDir,null,Iterables.<StoreFile,StoreFile>iterable(StoreFile.values()),false,false,StoreFileType.values());
      }
 catch (      IOException e) {
        System.err.println("Unable to delete store files after an aborted import " + e);
      }
    }
  }
}
