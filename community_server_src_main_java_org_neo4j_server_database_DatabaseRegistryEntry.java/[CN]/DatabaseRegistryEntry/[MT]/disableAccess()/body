{
  while (!referenceCount.compareAndSet(0,-1)) {
    Thread.sleep(1);
    if (referenceCount.get() == -1) {
      throw new RuntimeException("Another caller has already blocked access to this database");
    }
  }
}
