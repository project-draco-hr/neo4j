{
  String value1="Mattias", value2="Jacob", value3="Stefan";
  long node1=createNode(map(name,value1),FIRST);
  long node2=createNode(map(name,value2),FIRST);
  long node3=createNode(map(name,value3),FIRST);
  int propertyKeyId=getPropertyKeyForName(name);
  NodeDeletingWriter populator=new NodeDeletingWriter(node2,propertyKeyId,value2,labelId);
  IndexPopulationJob job=newIndexPopulationJob(FIRST,name,populator,new FlippableIndexProxy());
  populator.setJob(job);
  job.run();
  Map<Long,Object> expectedAdded=genericMap(node1,value1,node2,value2,node3,value3);
  assertEquals(expectedAdded,populator.added);
  Map<Long,Object> expectedRemoved=genericMap(node2,value2);
  assertEquals(expectedRemoved,populator.removed);
  assertEquals(2,indexCount(FIRST,name));
}
