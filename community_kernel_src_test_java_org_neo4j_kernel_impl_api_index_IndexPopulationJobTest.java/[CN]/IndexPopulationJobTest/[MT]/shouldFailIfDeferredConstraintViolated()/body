{
  createNode(map(name,"irrelephant"),FIRST);
  TestLogger logger=new TestLogger();
  FlippableIndexProxy index=new FlippableIndexProxy(mock(IndexProxy.class));
  IndexPopulationJob job=newIndexPopulationJob(FIRST,name,populator,index,indexStoreView,logger);
  IndexEntryConflictException failure=new PreexistingIndexEntryConflictException("duplicate value",0,1);
  doThrow(failure).when(populator).verifyDeferredConstraints(indexStoreView);
  job.run();
  verify(populator).markAsFailed(Matchers.contains("duplicate value"));
  assertEquals(0,indexCount(FIRST,name));
  assertDoubleLongEquals(0,0,indexSample(FIRST,name));
}
