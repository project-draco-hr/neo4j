{
  IndexPopulator failingPopulator=mock(IndexPopulator.class);
  doThrow(new RuntimeException("BORK BORK")).when(failingPopulator).add(anyLong(),any());
  FlippableIndexProxy index=new FlippableIndexProxy();
  createNode(map(name,"Taylor"),FIRST);
  IndexPopulationJob job=newIndexPopulationJob(FIRST,name,failingPopulator,index);
  job.run();
  assertThat(index.getState(),equalTo(InternalIndexState.FAILED));
  assertEquals(0,indexCount(FIRST,name));
  assertDoubleLongEquals(0,0,indexSample(FIRST,name));
}
