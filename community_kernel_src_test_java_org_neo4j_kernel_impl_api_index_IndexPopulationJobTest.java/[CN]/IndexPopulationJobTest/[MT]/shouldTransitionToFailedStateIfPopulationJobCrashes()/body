{
  IndexPopulator failingPopulator=mock(IndexPopulator.class);
  doThrow(new RuntimeException("BORK BORK")).when(failingPopulator).add(anyLong(),any());
  FlippableIndexProxy index=new FlippableIndexProxy();
  createNode(map(name,"Taylor"),FIRST);
  IndexPopulationJob job=newIndexPopulationJob(FIRST,name,failingPopulator,index,false);
  job.run();
  assertThat(index.getState(),equalTo(InternalIndexState.FAILED));
}
