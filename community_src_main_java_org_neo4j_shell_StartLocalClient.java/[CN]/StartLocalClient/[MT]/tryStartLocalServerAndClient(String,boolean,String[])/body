{
  final GraphDatabaseService graph=readOnly ? new EmbeddedReadOnlyGraphDatabase(dbPath) : new EmbeddedGraphDatabase(dbPath);
  final GraphDatabaseShellServer server=new GraphDatabaseShellServer(graph);
  Runtime.getRuntime().addShutdownHook(new Thread(){
    @Override public void run(){
      shutdownIfNecessary(server,graph);
    }
  }
);
  System.out.println("NOTE: Local Neo4j graph database service at '" + dbPath + "'");
  ShellClient client=new SameJvmClient(server);
  setSessionVariablesFromArgs(client,args);
  client.grabPrompt();
  shutdownIfNecessary(server,graph);
}
