{
  HandshakeOutcome outcome=protocolChooser.handleVersionHandshakeChunk(buffer,ctx.channel());
switch (outcome) {
case PROTOCOL_CHOSEN:
    protocol=protocolChooser.chosenProtocol();
  ctx.writeAndFlush(ctx.alloc().buffer(4).writeInt(protocol.version()));
if (buffer.readableBytes() > 0) {
  channelRead(ctx,buffer);
}
 else {
  buffer.release();
}
return;
case NO_APPLICABLE_PROTOCOL:
buffer.release();
ctx.writeAndFlush(wrappedBuffer(new byte[]{0,0,0,0})).sync().channel().close();
return;
case INSECURE_HANDSHAKE:
case INVALID_HANDSHAKE:
buffer.release();
ctx.close();
return;
case PARTIAL_HANDSHAKE:
return;
default :
throw new IllegalStateException("Unknown handshake outcome: " + outcome);
}
}
