{
  assertHealthy();
  while (!hasReadAhead) {
    parkAWhile();
    assertHealthy();
  }
  int available=readAheadBuffer.limit();
  int bytesToCopy;
  try {
    bytesToCopy=min(available,target.remaining());
    readAheadBuffer.limit(bytesToCopy);
    target.put(readAheadBuffer);
  }
  finally {
    readAheadBuffer.limit(available);
  }
  hasReadAhead=false;
  LockSupport.unpark(this);
  return bytesToCopy;
}
