{
  CopyOnWriteAfterIteratorHashSet<String> set=newCOWSet();
  set.add("hullo");
  Snapshot<String> snapshot1=snapshot(set);
  set.add("wurld");
  Snapshot<String> snapshot2=snapshot(set);
  set.add("!");
  set.remove("wurld");
  Snapshot<String> snapshot3=snapshot(set);
  set.clear();
  assertEquals(asSet("hullo"),snapshot1.toSet());
  assertEquals(asSet("hullo","wurld"),snapshot2.toSet());
  assertEquals(asSet("hullo","!"),snapshot3.toSet());
  assertEquals(IteratorUtil.<String>asSet(),snapshot(set).toSet());
}
