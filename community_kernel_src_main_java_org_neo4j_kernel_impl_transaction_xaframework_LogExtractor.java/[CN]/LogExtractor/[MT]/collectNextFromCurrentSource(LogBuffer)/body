{
  LogEntry entry=null;
  while (collector.hasInFutureQueue() || (entry=LogIoUtils.readEntry(localBuffer,source,commandFactory)) != null) {
    LogEntry foundEntry=collector.collect(entry,target);
    if (foundEntry != null) {
      previousCommitEntry=lastCommitEntry;
      LogIoUtils.writeLogEntry(new LogEntry.Done(collector.getIdentifier()),target);
      lastCommitEntry=(LogEntry.Commit)foundEntry;
      return lastCommitEntry.getTxId();
    }
  }
  return -1;
}
