{
  if (value instanceof String[]) {
    int size=0;
    for (    String string : (String[])value) {
      size+=withReference(sizeOf(string));
    }
    return withArrayOverhead(size);
  }
 else {
    int base;
    if (value instanceof byte[] || value instanceof boolean[]) {
      base=1;
    }
 else     if (value instanceof short[] || value instanceof char[]) {
      base=2;
    }
 else     if (value instanceof int[] || value instanceof float[]) {
      base=4;
    }
 else     if (value instanceof long[] || value instanceof double[]) {
      base=8;
    }
 else     if (value instanceof Byte[] || value instanceof Boolean[] || value instanceof Short[]|| value instanceof Character[]|| value instanceof Integer[]|| value instanceof Float[]|| value instanceof Long[]|| value instanceof Double[]) {
      base=withObjectOverhead(REFERENCE_SIZE + 8);
    }
 else {
      throw new IllegalStateException("Unkown type: " + value.getClass() + " ["+ value+ "]");
    }
    return withArrayOverhead(base * Array.getLength(value));
  }
}
