{
  Session session=mock(Session.class);
  SessionWorker worker=new SessionWorker(session,NullLogService.getInstance());
  worker.handle(new Consumer<Session>(){
    @Override public void accept(    Session session){
      session.run("Hello, world!",null,null,null);
    }
  }
);
  worker.handle(SessionWorker.SHUTDOWN);
  worker.run();
  verify(session).run("Hello, world!",null,null,null);
  verify(session).close();
  verifyNoMoreInteractions(session);
}
