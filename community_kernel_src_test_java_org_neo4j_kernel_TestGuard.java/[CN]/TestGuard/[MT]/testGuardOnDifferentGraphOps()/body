{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabaseBuilder().setConfig(GraphDatabaseSettings.execution_guard_enabled,Settings.TRUE).newGraphDatabase();
  try (Transaction ignored=db.beginTx()){
    getGuard(db).startOperationsCount(MAX_VALUE);
    db.createNode();
    db.createNode();
    db.createNode();
    Guard.OperationsCount ops1=getGuard(db).stop();
    assertEquals(3,ops1.getOpsCount());
    getGuard(db).startOperationsCount(MAX_VALUE);
    Node n0=db.getNodeById(0);
    Node n1=db.getNodeById(1);
    db.getNodeById(2);
    Guard.OperationsCount ops2=getGuard(db).stop();
    assertEquals(3,ops2.getOpsCount());
    getGuard(db).startOperationsCount(MAX_VALUE);
    n0.createRelationshipTo(n1,withName("REL"));
    Guard.OperationsCount ops3=getGuard(db).stop();
    assertEquals(2,ops3.getOpsCount());
    getGuard(db).startOperationsCount(MAX_VALUE);
    for (    Path position : Traversal.description().breadthFirst().relationships(withName("REL")).traverse(n0)) {
      ignore(position);
    }
    Guard.OperationsCount ops4=getGuard(db).stop();
    assertEquals(1,ops4.getOpsCount());
  }
   db.shutdown();
}
