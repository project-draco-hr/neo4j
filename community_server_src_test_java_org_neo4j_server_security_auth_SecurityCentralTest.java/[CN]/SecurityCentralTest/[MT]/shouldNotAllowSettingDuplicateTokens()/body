{
  SecurityCentral security=new SecurityCentral(new FakeClock(),new InMemoryUserRepository());
  security.newUser("neo4j","neo4j",true,Privileges.ADMIN);
  security.newUser("other","other",true,Privileges.ADMIN);
  security.regenerateToken("neo4j");
  String neo4jUserToken=security.userForName("neo4j").token();
  try {
    security.setToken("other",neo4jUserToken);
    fail("Should not have been allowed.");
  }
 catch (  IllegalTokenException e) {
    assertThat(e.getMessage(),equalTo("Unable to set token, because the chosen token is already in use."));
  }
}
