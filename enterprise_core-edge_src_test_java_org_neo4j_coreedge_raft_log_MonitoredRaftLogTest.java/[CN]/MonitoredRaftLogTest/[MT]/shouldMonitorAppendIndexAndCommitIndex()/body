{
  FileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  File directory=new File(".");
  fsa.create(directory);
  Monitors monitors=new Monitors();
  StubRaftLogAppendIndexMonitor appendMonitor=new StubRaftLogAppendIndexMonitor();
  monitors.addMonitorListener(appendMonitor);
  StubRaftLogCommitIndexMonitor commitMonitor=new StubRaftLogCommitIndexMonitor();
  monitors.addMonitorListener(commitMonitor);
  MonitoredRaftLog log=new MonitoredRaftLog(new NaiveDurableRaftLog(fsa,directory,new DummyRaftableContentSerializer()),monitors);
  log.append(new RaftLogEntry(0,ReplicatedInteger.valueOf(1)));
  log.append(new RaftLogEntry(0,ReplicatedInteger.valueOf(1)));
  log.commit(0);
  assertEquals(1,appendMonitor.appendIndex());
  assertEquals(0,commitMonitor.commitIndex());
  log.truncate(1);
  assertEquals(0,appendMonitor.appendIndex());
}
