{
  if (true)   throw new Error("implementation not done!");
  if (response == null)   return null;
  ChannelBuffer buffer=ChannelBuffers.buffer(CHUNK_SIZE);
  while (tx == null || !tx.hasNext()) {
    if (stream == null || !stream.hasNext()) {
      response.write(buffer);
      response=null;
      return buffer;
    }
 else {
      Pair<String,TransactionStream> next=stream.next();
      resource=next.first();
      tx=next.other().getChannels().iterator();
    }
  }
  Pair<Long,ReadableByteChannel> next=tx.next();
  CommunicationUtils.writeString(resource,buffer,false);
  current=next.other();
  return buffer;
}
