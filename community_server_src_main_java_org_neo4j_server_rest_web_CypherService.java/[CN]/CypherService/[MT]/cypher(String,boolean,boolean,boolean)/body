{
  Map<String,Object> command=input.readMap(body);
  if (!command.containsKey(QUERY_KEY)) {
    return output.badRequest(new BadInputException("You have to provide the 'query' parameter."));
  }
  String query=(String)command.get(QUERY_KEY);
  Map<String,Object> params=(Map<String,Object>)(command.containsKey(PARAMS_KEY) ? command.get(PARAMS_KEY) : new HashMap<String,Object>());
  try {
    if (profile) {
      ExecutionResult result=cypherExecutor.getExecutionEngine().profile(query,params);
      return output.ok(new CypherResultRepresentation(result,includeStats,true));
    }
 else {
      ExecutionResult result=cypherExecutor.getExecutionEngine().execute(query,params);
      return output.ok(new CypherResultRepresentation(result,includeStats,includePlan));
    }
  }
 catch (  Throwable e) {
    if (e.getCause() instanceof CypherException) {
      return output.badRequest(e.getCause());
    }
 else {
      return output.badRequest(e);
    }
  }
}
