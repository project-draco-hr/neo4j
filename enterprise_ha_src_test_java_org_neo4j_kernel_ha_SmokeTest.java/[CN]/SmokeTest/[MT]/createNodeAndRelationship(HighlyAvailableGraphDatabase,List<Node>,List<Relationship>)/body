{
  while (true) {
    Transaction tx=db.beginTx();
    try {
      Node node=db.createNode();
      nodes.add(node);
      Node from=db.getNodeById(nodes.get(nodes.size() - 1).getId());
      Relationship rel=from.createRelationshipTo(node,MyRelTypes.TEST);
      rels.add(rel);
      Relationship rad=db.getReferenceNode().createRelationshipTo(node,MyRelTypes.TEST);
      rels.add(rad);
      tx.success();
      return;
    }
 catch (    Exception e) {
      try {
        Thread.sleep(500);
      }
 catch (      InterruptedException e1) {
        throw new RuntimeException(e1);
      }
      e.printStackTrace();
      continue;
    }
 finally {
      try {
        tx.finish();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
}
