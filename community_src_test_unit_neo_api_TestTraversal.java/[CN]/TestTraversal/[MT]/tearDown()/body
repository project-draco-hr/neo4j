{
  UserTransaction ut=TransactionFactory.getUserTransaction();
  try {
    if (ut.getStatus() == Status.STATUS_ACTIVE) {
      ut.commit();
    }
 else     if (ut.getStatus() == Status.STATUS_MARKED_ROLLBACK) {
      ut.rollback();
    }
 else     if (ut.getStatus() == Status.STATUS_NO_TRANSACTION) {
    }
 else {
      System.out.println("ARGH.");
      fail("Unkown transaction status[" + ut.getStatus() + "].");
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Failed to end transaciton, " + e);
  }
}
