{
  if (newMessage.getRole().equals(MASTER)) {
    List<MemberIsAvailable> result=new LinkedList<>();
    for (    MemberIsAvailable existing : previousSnapshot) {
      if ((isSlave(existing) && sameIds(newMessage,existing)) || isMaster(existing)) {
        continue;
      }
      result.add(existing);
    }
    result.add(newMessage);
    return result;
  }
 else   if (newMessage.getRole().equals(SLAVE)) {
    List<MemberIsAvailable> result=new LinkedList<>();
    for (    MemberIsAvailable existing : previousSnapshot) {
      if (sameIds(newMessage,existing)) {
        continue;
      }
      result.add(existing);
    }
    result.add(newMessage);
    return result;
  }
 else   if (newMessage.getRole().equals(OnlineBackupKernelExtension.BACKUP)) {
    List<MemberIsAvailable> result=new LinkedList<>();
    for (    MemberIsAvailable existing : previousSnapshot) {
      if (existing.getRole().equals(OnlineBackupKernelExtension.BACKUP)) {
        continue;
      }
      result.add(existing);
    }
    result.add(newMessage);
    return result;
  }
  return Iterables.append(newMessage,previousSnapshot);
}
