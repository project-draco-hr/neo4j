{
  if (newMessage.getRole().equals(HighAvailabilityModeSwitcher.MASTER)) {
    List<MemberIsAvailable> result=new LinkedList<MemberIsAvailable>();
    for (    MemberIsAvailable existing : previousSnapshot) {
      if ((existing.getInstanceId().equals(newMessage.getInstanceId()) && existing.getRole().equals(HighAvailabilityModeSwitcher.SLAVE)) || existing.getRole().equals(HighAvailabilityModeSwitcher.MASTER)) {
        continue;
      }
      result.add(existing);
    }
    result.add(newMessage);
    return result;
  }
 else   if (newMessage.getRole().equals(HighAvailabilityModeSwitcher.SLAVE)) {
    List<MemberIsAvailable> result=new LinkedList<MemberIsAvailable>();
    for (    MemberIsAvailable existing : previousSnapshot) {
      if (existing.getInstanceId().equals(newMessage.getInstanceId())) {
        continue;
      }
      result.add(existing);
    }
    result.add(newMessage);
    return result;
  }
  return Iterables.append(newMessage,previousSnapshot);
}
