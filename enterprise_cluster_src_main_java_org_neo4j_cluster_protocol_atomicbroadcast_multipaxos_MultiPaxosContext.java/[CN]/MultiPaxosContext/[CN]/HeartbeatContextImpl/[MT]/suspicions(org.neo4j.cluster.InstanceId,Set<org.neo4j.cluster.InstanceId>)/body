{
  Set<org.neo4j.cluster.InstanceId> serverSuspicions=getSuspicionsFor(from);
  Iterator<org.neo4j.cluster.InstanceId> suspicionsIterator=serverSuspicions.iterator();
  while (suspicionsIterator.hasNext()) {
    org.neo4j.cluster.InstanceId currentSuspicion=suspicionsIterator.next();
    if (!suspicions.contains(currentSuspicion)) {
      getLogger(HeartbeatContext.class).info(from + " is no longer suspecting " + currentSuspicion);
      suspicionsIterator.remove();
    }
  }
  for (  org.neo4j.cluster.InstanceId suspicion : suspicions) {
    if (!serverSuspicions.contains(suspicion)) {
      getLogger(HeartbeatContext.class).info(from + " is now suspecting " + suspicion);
      serverSuspicions.add(suspicion);
    }
  }
  for (  final org.neo4j.cluster.InstanceId node : suspicions) {
    if (isFailed(node) && !failed.contains(node)) {
      failed.add(node);
      Listeners.notifyListeners(heartBeatListeners,executor,new Listeners.Notification<HeartbeatListener>(){
        @Override public void notify(        HeartbeatListener listener){
          listener.failed(node);
        }
      }
);
    }
  }
}
