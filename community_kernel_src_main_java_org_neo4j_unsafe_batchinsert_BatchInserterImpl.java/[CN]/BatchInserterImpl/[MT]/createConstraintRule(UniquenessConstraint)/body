{
  SchemaStore schemaStore=getSchemaStore();
  long indexRuleId=schemaStore.nextId();
  long constraintRuleId=schemaStore.nextId();
  IndexRule indexRule=IndexRule.constraintIndexRule(indexRuleId,constraint.label(),constraint.propertyKeyId(),this.schemaIndexProviders.getDefaultProvider().getProviderDescriptor(),constraintRuleId);
  UniquenessConstraintRule constraintRule=UniquenessConstraintRule.uniquenessConstraintRule(schemaStore.nextId(),constraint.label(),constraint.propertyKeyId(),indexRuleId);
  for (  DynamicRecord record : schemaStore.allocateFrom(constraintRule)) {
    schemaStore.updateRecord(record);
  }
  schemaCache.addSchemaRule(constraintRule);
  for (  DynamicRecord record : schemaStore.allocateFrom(indexRule)) {
    schemaStore.updateRecord(record);
  }
  schemaCache.addSchemaRule(indexRule);
  labelsTouched=true;
  recordAccess.commit();
}
