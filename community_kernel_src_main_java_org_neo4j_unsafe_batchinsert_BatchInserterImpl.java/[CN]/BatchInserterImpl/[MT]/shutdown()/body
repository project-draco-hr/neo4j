{
  if (isShutdown) {
    throw new IllegalStateException("Batch inserter already has shutdown");
  }
  isShutdown=true;
  flushStrategy.forceFlush();
  try {
    repopulateAllIndexes();
  }
 catch (  IOException|IndexCapacityExceededException|IndexEntryConflictException e) {
    throw new RuntimeException(e);
  }
  rebuildCounts();
  neoStore.close();
  try {
    storeLocker.release();
  }
 catch (  IOException e) {
    throw new UnderlyingStorageException("Could not release store lock",e);
  }
  msgLog.info(Thread.currentThread() + " Clean shutdown on BatchInserter(" + this+ ")",true);
  life.shutdown();
}
