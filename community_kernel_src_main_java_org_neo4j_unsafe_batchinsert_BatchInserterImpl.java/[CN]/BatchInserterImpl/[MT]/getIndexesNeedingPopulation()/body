{
  List<IndexRule> indexesNeedingPopulation=new ArrayList<IndexRule>();
  for (  SchemaRule rule : schemaCache.getSchemaRules()) {
    if (rule.getKind() == Kind.INDEX_RULE) {
      IndexRule indexRule=(IndexRule)rule;
      SchemaIndexProvider provider=schemaIndexProviders.apply(indexRule.getProviderDescriptor());
      if (provider.getInitialState(indexRule.getId()) != InternalIndexState.FAILED) {
        indexesNeedingPopulation.add(indexRule);
      }
    }
  }
  return indexesNeedingPopulation.toArray(new IndexRule[indexesNeedingPopulation.size()]);
}
