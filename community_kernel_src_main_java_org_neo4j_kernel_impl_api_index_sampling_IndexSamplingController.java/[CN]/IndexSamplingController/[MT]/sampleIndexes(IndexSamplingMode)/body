{
  IndexMap indexMap=indexMapSnapshotProvider.indexMapSnapshot();
  fillQueue(mode,indexMap);
  if (mode.blockUntilAllScheduled) {
    emptyQueue(indexMap);
  }
 else {
    tryEmptyQueue(indexMap);
  }
}
