{
  IndexMap indexMap=indexMapSnapshotProvider.indexMapSnapshot();
switch (mode) {
case REBUILD_ALL:
    fillQueue(false,indexMap);
  break;
case REBUILD_UPDATED:
case TRY_REBUILD_UPDATED:
fillQueue(true,indexMap);
break;
default :
throw new IllegalArgumentException("Unsupported sampling mode: " + mode.name());
}
if (mode.scheduleBlocking()) {
emptyQueue(indexMap);
}
 else {
tryEmptyQueue(indexMap);
}
}
