{
  samplingLock.lock();
  try {
    IndexMap indexMap=indexMapSnapshotProvider.indexMapSnapshot();
    Iterator<IndexDescriptor> descriptors=indexMap.descriptors();
    while (descriptors.hasNext()) {
      IndexDescriptor descriptor=descriptors.next();
      if (indexRecoveryCondition.test(descriptor)) {
        sampleIndexOnCurrentThread(indexMap,descriptor);
      }
    }
  }
  finally {
    samplingLock.unlock();
  }
}
