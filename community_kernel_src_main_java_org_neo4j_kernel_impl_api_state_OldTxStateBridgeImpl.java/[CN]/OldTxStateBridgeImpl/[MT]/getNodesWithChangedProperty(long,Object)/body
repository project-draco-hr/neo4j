{
  DiffSets<Long> diff=new DiffSets<Long>();
  for (  WritableTransactionState.CowNodeElement changedNode : state.getChangedNodes()) {
    PropertyData removed=propertyChange(changedNode.getPropertyRemoveMap(false),propertyKey);
    if (removed != null && removed.getValue().equals(value)) {
      diff.remove(changedNode.getId());
    }
    if (!changedNode.isDeleted()) {
      PropertyData added=propertyChange(changedNode.getPropertyAddMap(false),propertyKey);
      if (added != null) {
        if (added.getValue().equals(value)) {
          diff.add(changedNode.getId());
        }
 else {
          diff.remove(changedNode.getId());
        }
      }
    }
  }
  return diff;
}
