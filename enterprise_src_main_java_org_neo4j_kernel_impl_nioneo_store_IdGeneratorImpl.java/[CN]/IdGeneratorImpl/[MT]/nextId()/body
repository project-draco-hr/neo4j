{
  if (fileChannel == null) {
    throw new IllegalStateException("Closed id generator " + fileName);
  }
  if (defragedIdList.size() > 0) {
    long id=defragedIdList.removeFirst();
    if (haveMore && defragedIdList.size() == 0) {
      readIdBatch();
    }
    defraggedIdCount--;
    return id;
  }
  if (nextFreeId.get() >= OVERFLOW_ID || nextFreeId.get() < 0) {
    throw new UnderlyingStorageException("Id capacity exceeded");
  }
  return nextFreeId.getAndIncrement();
}
