{
  if (current == null) {
    if (leftInChunk != 0) {
      current=new byte[leftInChunk];
    }
 else     if (moreChunks) {
      if (buffer.readableBytes() >= DATASIZE_SIZE) {
        int chunkSize=buffer.readShort();
        if (chunkSize < 0) {
          moreChunks=true;
          chunkSize=-chunkSize;
        }
 else {
          moreChunks=false;
        }
        leftInChunk=chunkSize;
        if (chunkSize == 0) {
          return done();
        }
        current=new byte[leftInChunk];
        data.add(current);
      }
 else {
        return null;
      }
    }
 else {
      return done();
    }
  }
  int toRead=Math.min(buffer.readableBytes(),leftInChunk);
  buffer.readBytes(current,current.length - leftInChunk,toRead);
  if (leftInChunk == 0) {
    current=null;
    if (!moreChunks) {
      return done();
    }
  }
  return null;
}
