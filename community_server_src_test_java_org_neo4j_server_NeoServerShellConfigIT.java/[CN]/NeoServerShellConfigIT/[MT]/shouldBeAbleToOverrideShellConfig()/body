{
  final int customPort=findFreeShellPortToUse(8881);
  CommunityNeoServer server=new CommunityNeoServer(new Configurator.Adapter(){
    @Override public Configuration configuration(){
      return new MapConfiguration(stringMap(Configurator.DATABASE_LOCATION_PROPERTY_KEY,testDir.absolutePath()));
    }
    @Override public Map<String,String> getDatabaseTuningProperties(){
      return stringMap(ShellSettings.remote_shell_enabled.name(),Settings.TRUE,ShellSettings.remote_shell_port.name(),"" + customPort);
    }
  }
,GraphDatabaseDependencies.newDependencies().logging(DevNullLoggingService.DEV_NULL));
  server.start();
  ShellLobby.newClient(customPort).shutdown();
  server.stop();
}
