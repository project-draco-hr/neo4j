{
  long denseNode=0;
  NodeRelationshipCache link=new NodeRelationshipCache(NumberArrayFactory.AUTO,1,base);
  link.incrementCount(denseNode);
  link.getAndPutRelationship(denseNode,0,Direction.OUTGOING,0,true);
  link.getAndPutRelationship(denseNode,2,Direction.OUTGOING,1,true);
  link.getAndPutRelationship(denseNode,1,Direction.INCOMING,2,true);
  link.getAndPutRelationship(denseNode,0,Direction.INCOMING,3,true);
  link.getAndPutRelationship(denseNode,1,Direction.OUTGOING,4,true);
  link.getAndPutRelationship(denseNode,2,Direction.INCOMING,5,true);
  link.getAndPutRelationship(denseNode,1,Direction.BOTH,6,true);
  GroupVisitor visitor=mock(GroupVisitor.class);
  assertEquals(0L,link.getFirstRel(denseNode,visitor));
  verify(visitor).visit(denseNode,0,base + 2L,0L,3L,-1L);
  verify(visitor).visit(denseNode,1,base + 1L,4L,2L,6L);
  verify(visitor).visit(denseNode,2,-1L,1L,5L,-1L);
  verifyNoMoreInteractions(visitor);
}
