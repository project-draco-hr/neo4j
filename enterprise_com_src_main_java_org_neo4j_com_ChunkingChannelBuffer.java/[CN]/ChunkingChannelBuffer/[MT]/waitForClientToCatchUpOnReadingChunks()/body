{
  boolean waited=false;
  while (channel.isConnected() && writeAheadCounter.get() >= MAX_WRITE_AHEAD_CHUNKS) {
    waited=true;
    try {
      Thread.sleep(200);
    }
 catch (    InterruptedException e) {
      Thread.interrupted();
    }
  }
  if (waited && (!channel.isConnected() || !channel.isOpen())) {
    throw new ComException("Channel has been closed");
  }
}
