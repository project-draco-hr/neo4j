{
  User user=userRepository.findByName(username);
  if (user == null) {
    throw new IllegalArgumentException("User " + username + " does not exist.");
  }
  if (!user.hasFlag(IS_SUSPENDED)) {
    User suspendedUser=user.augment().withFlag(IS_SUSPENDED).build();
    try {
      userRepository.update(user,suspendedUser);
    }
 catch (    ConcurrentModificationException e) {
      suspendUser(username);
    }
  }
  clearCacheForUser(username);
}
