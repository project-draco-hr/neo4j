{
  if (isShutdown) {
    throw new IllegalStateException("Batch inserter already has shutdown");
  }
  isShutdown=true;
  flushStrategy.forceFlush();
  rebuildCounts();
  try {
    repopulateAllIndexes();
  }
 catch (  IOException|IndexEntryConflictException e) {
    throw new RuntimeException(e);
  }
 finally {
    cursors.close();
    neoStores.close();
    try {
      storeLocker.release();
    }
 catch (    IOException e) {
      throw new UnderlyingStorageException("Could not release store lock",e);
    }
    msgLog.info(Thread.currentThread() + " Clean shutdown on BatchInserter(" + this+ ")",true);
    life.shutdown();
  }
}
