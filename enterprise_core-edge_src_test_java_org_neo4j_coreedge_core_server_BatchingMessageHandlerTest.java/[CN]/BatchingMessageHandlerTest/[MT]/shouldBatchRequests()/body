{
  BatchingMessageHandler batchHandler=new BatchingMessageHandler(raftStateMachine,QUEUE_SIZE,MAX_BATCH,NullLogProvider.getInstance());
  ReplicatedString contentA=new ReplicatedString("A");
  ReplicatedString contentB=new ReplicatedString("B");
  RaftMessages.NewEntry.Request messageA=new RaftMessages.NewEntry.Request(CURRENT_VERSION,null,contentA);
  RaftMessages.NewEntry.Request messageB=new RaftMessages.NewEntry.Request(CURRENT_VERSION,null,contentB);
  batchHandler.handle(new RaftMessages.StoreIdAwareMessage(localStoreId,messageA));
  batchHandler.handle(new RaftMessages.StoreIdAwareMessage(localStoreId,messageB));
  verifyZeroInteractions(raftStateMachine);
  batchHandler.run();
  RaftMessages.NewEntry.BatchRequest batchRequest=new RaftMessages.NewEntry.BatchRequest(CURRENT_VERSION,2);
  batchRequest.add(contentA);
  batchRequest.add(contentB);
  verify(raftStateMachine).handle(new RaftMessages.StoreIdAwareMessage(localStoreId,batchRequest));
}
