{
  int entryCount=100;
  RaftLogMetadataCache metadataCache=new RaftLogMetadataCache(entryCount * 2);
  PhysicalRaftLog log=createRaftLog(100,mock(PhysicalRaftLogFile.Monitor.class),metadataCache);
  for (long i=0; i < entryCount; i++) {
    log.append(new RaftLogEntry(i,ReplicatedInteger.valueOf((int)i)));
  }
  long truncateIndex=50L;
  log.truncate(truncateIndex);
  for (long i=0; i < truncateIndex; i++) {
    assertNotNull(metadataCache.getMetadata(i));
  }
  for (long i=truncateIndex; i < entryCount; i++) {
    assertNull(metadataCache.getMetadata(i));
  }
}
