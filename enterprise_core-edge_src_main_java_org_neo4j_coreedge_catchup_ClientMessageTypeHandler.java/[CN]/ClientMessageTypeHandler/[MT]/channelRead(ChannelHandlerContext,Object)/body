{
  if (protocol.isExpecting(NextMessage.MESSAGE_TYPE)) {
    ResponseMessageType responseMessageType=from(((ByteBuf)msg).readByte());
switch (responseMessageType) {
case STORE_ID:
      protocol.expect(NextMessage.STORE_ID);
    break;
case TX:
  protocol.expect(NextMessage.TX_PULL_RESPONSE);
break;
case FILE:
protocol.expect(NextMessage.FILE_HEADER);
break;
case STORY_COPY_FINISHED:
protocol.expect(NextMessage.STORE_COPY_FINISHED);
break;
case TX_STREAM_FINISHED:
protocol.expect(NextMessage.TX_STREAM_FINISHED);
break;
case LOCK:
protocol.expect(NextMessage.LOCK_RESPONSE);
break;
default :
log.warn("No handler found for message type %s",responseMessageType);
}
ReferenceCountUtil.release(msg);
}
 else {
ctx.fireChannelRead(msg);
}
}
