{
  long id=nextGroupId != -1 ? nextGroupId : relGroupStore.nextId();
  nextGroupId=-1;
  RelationshipGroupRecord groupRecord=new RelationshipGroupRecord(id);
  groupRecord.setType(type);
  groupRecord.setInUse(true);
  groupRecord.setFirstOut(out);
  groupRecord.setFirstIn(in);
  groupRecord.setFirstLoop(loop);
  groupRecord.setOwningNode(nodeId);
  if (next != -1) {
    groupRecord.setNext(nextGroupId=relGroupStore.nextId());
  }
  relGroupStore.prepareForCommit(groupRecord);
  relGroupStore.updateRecord(groupRecord);
  return id;
}
