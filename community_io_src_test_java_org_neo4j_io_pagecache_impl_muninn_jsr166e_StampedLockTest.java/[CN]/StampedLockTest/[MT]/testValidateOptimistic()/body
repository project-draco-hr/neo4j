{
  try {
    StampedLock lock=new StampedLock();
    long s, p;
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
    assertTrue(lock.validate(p));
    assertTrue((s=lock.writeLock()) != 0L);
    assertFalse((p=lock.tryOptimisticRead()) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockWrite(s);
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
    assertTrue(lock.validate(p));
    assertTrue((s=lock.readLock()) != 0L);
    assertTrue(lock.validate(s));
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
    assertTrue(lock.validate(p));
    lock.unlockRead(s);
    assertTrue((s=lock.tryWriteLock()) != 0L);
    assertTrue(lock.validate(s));
    assertFalse((p=lock.tryOptimisticRead()) != 0L);
    lock.unlockWrite(s);
    assertTrue((s=lock.tryReadLock()) != 0L);
    assertTrue(lock.validate(s));
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
    lock.unlockRead(s);
    assertTrue(lock.validate(p));
    assertTrue((s=lock.tryWriteLock(100L,MILLISECONDS)) != 0L);
    assertFalse((p=lock.tryOptimisticRead()) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockWrite(s);
    assertTrue((s=lock.tryReadLock(100L,MILLISECONDS)) != 0L);
    assertTrue(lock.validate(s));
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
    lock.unlockRead(s);
    assertTrue((p=lock.tryOptimisticRead()) != 0L);
  }
 catch (  InterruptedException ie) {
    threadUnexpectedException(ie);
  }
}
