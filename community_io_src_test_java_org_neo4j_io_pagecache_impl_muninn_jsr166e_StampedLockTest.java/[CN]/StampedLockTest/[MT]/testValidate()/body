{
  try {
    StampedLock lock=new StampedLock();
    long s=lock.writeLock();
    assertTrue(lock.validate(s));
    lock.unlockWrite(s);
    s=lock.readLock();
    assertTrue(lock.validate(s));
    lock.unlockRead(s);
    assertTrue((s=lock.tryWriteLock()) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockWrite(s);
    assertTrue((s=lock.tryReadLock()) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockRead(s);
    assertTrue((s=lock.tryWriteLock(100L,MILLISECONDS)) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockWrite(s);
    assertTrue((s=lock.tryReadLock(100L,MILLISECONDS)) != 0L);
    assertTrue(lock.validate(s));
    lock.unlockRead(s);
    assertTrue((s=lock.tryOptimisticRead()) != 0L);
  }
 catch (  InterruptedException ie) {
    threadUnexpectedException(ie);
  }
}
