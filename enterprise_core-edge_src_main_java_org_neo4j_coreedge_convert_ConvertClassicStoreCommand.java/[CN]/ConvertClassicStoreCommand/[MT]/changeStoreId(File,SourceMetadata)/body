{
  FileSystemAbstraction fs=new DefaultFileSystemAbstraction();
  File metadataStore=new File(storeDir,MetaDataStore.DEFAULT_NAME);
  try (PageCache pageCache=StandalonePageCacheFactory.createPageCache(fs)){
    StoreId before=readStoreId(metadataStore,pageCache);
    long lastTxId=MetaDataStore.getRecord(pageCache,metadataStore,LAST_TRANSACTION_ID);
    Long upgradeTime=conversionId == null ? System.currentTimeMillis() : conversionId.after().getUpgradeTime();
    MetaDataStore.setRecord(pageCache,metadataStore,UPGRADE_TIME,upgradeTime);
    StoreId after=readStoreId(metadataStore,pageCache);
    return new SourceMetadata(before,after,lastTxId);
  }
 }
