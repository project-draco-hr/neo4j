{
  if (map == null || map.isEmpty()) {
    return false;
  }
  boolean modified=false;
  Iterator<E> it=map.keySet().iterator();
  HashMap<E,Object> target=readOnly ? null : map;
  while (it.hasNext()) {
    E item=it.next();
    if (c.contains(item) == remove) {
      if (readOnly) {
        if (target == null) {
          target=new HashMap<>(map);
        }
        target.remove(item);
      }
 else {
        it.remove();
      }
      modified=true;
    }
  }
  if (target != null && target != map) {
    map=target;
    readOnly=false;
  }
  return modified;
}
