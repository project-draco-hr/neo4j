{
  this.config=config;
  this.kernel=kernel;
  idGeneratorFactory=kernel.graphDatabase().getDependencyResolver().resolveDependency(IdGeneratorFactory.class);
  final StartupStatistics startupStatistics=kernel.graphDatabase().getDependencyResolver().resolveDependency(StartupStatistics.class);
  if (xadsm != null) {
    xadsm.addListener(new DataSourceManager.Listener(){
      @Override public void registered(      NeoStoreXaDataSource ds){
        crashPing=startupStatistics.numberOfRecoveredTransactions() > 0;
        storeId=Long.toHexString(ds.getRandomIdentifier());
      }
      @Override public void unregistered(      NeoStoreXaDataSource ds){
        crashPing=false;
        storeId=null;
      }
    }
);
  }
}
