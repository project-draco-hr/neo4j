{
  coreStateMachines.installSnapshots(coreSnapshot);
  long snapshotPrevIndex=coreSnapshot.prevIndex();
  try {
    raftLog.skip(snapshotPrevIndex,coreSnapshot.prevTerm());
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  lastApplied=lastFlushed=snapshotPrevIndex;
  log.info(format("Skipping lastApplied index forward to %d",snapshotPrevIndex));
  raft.installCoreState(coreSnapshot.get(CoreStateType.RAFT_CORE_STATE));
  sessionTracker.installSnapshot(coreSnapshot.get(CoreStateType.SESSION_TRACKER));
  flush();
}
