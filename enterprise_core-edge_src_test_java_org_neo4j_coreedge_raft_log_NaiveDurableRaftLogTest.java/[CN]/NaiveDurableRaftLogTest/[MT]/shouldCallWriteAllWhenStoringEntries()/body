{
  FileSystemAbstraction fsa=mock(FileSystemAbstraction.class);
  StoreFileChannel entriesChannel=mock(StoreFileChannel.class);
  StoreFileChannel contentChannel=mock(StoreFileChannel.class);
  StoreFileChannel commitChannel=mock(StoreFileChannel.class);
  File directory=new File(".");
  File entriesFile=new File(directory,"entries.log");
  File contentFile=new File(directory,"content.log");
  File commitFile=new File(directory,"commit.log");
  when(fsa.open(Matchers.eq(entriesFile),anyString())).thenReturn(entriesChannel);
  when(fsa.open(Matchers.eq(contentFile),anyString())).thenReturn(contentChannel);
  when(fsa.open(Matchers.eq(commitFile),anyString())).thenReturn(commitChannel);
  NaiveDurableRaftLog log=new NaiveDurableRaftLog(fsa,directory,new DummyRaftableContentSerializer(),new Monitors());
  log.append(new RaftLogEntry(0,ReplicatedInteger.valueOf(1)));
  verify(entriesChannel).writeAll(any(ByteBuffer.class),anyInt());
  verify(entriesChannel).force(anyBoolean());
  verify(contentChannel,times(2)).writeAll(any(ByteBuffer.class),anyInt());
  verify(contentChannel).force(anyBoolean());
  log.commit(2);
  verify(commitChannel).writeAll(any(ByteBuffer.class),anyInt());
  verify(commitChannel).force(anyBoolean());
}
