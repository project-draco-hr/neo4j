{
  EphemeralFileSystemAbstraction fs=fsRule.get();
  File path=new File("/store.db");
  PageCache cache=new MuninnPageCache(fsRule.get(),1024,1024,PageCacheMonitor.NULL);
  Store<TestRecord,TestCursor> store=newStore(fs,path,cache);
  store.write(new TestRecord(1001,1));
  store.write(new TestRecord(2001,1));
  cache.flush();
  StoreIdGenerator idGenerator=mock(StoreIdGenerator.class);
  StoreToolkit toolkit=mock(StoreToolkit.class);
  when(toolkit.fileSize()).thenReturn(2001 * 8l);
  when(toolkit.recordSize()).thenReturn(8);
  IdGeneratorRebuilder.FindHighestInUseRebuilderFactory rebuilder=new IdGeneratorRebuilder.FindHighestInUseRebuilderFactory();
  rebuilder.newIdGeneratorRebuilder(store,toolkit,idGenerator).rebuildIdGenerator();
  verify(idGenerator).rebuild(2001);
}
