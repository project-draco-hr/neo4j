{
  EphemeralFileSystemAbstraction fs=fsRule.get();
  File path=new File("/store.db");
  PageCache cache=pageCacheRule.getPageCache(fsRule.get());
  Store<TestRecord,TestCursor> store=newStore(fs,path,cache);
  store.write(new TestRecord(1001,1));
  store.write(new TestRecord(2001,1));
  cache.flushAndForce();
  StoreIdGenerator idGenerator=mock(StoreIdGenerator.class);
  StoreToolkit toolkit=mock(StoreToolkit.class);
  when(toolkit.fileSize()).thenReturn(2001 * 8l);
  when(toolkit.recordSize()).thenReturn(8);
  IdGeneratorRebuilder.FindHighestInUseRebuilderFactory rebuilder=new IdGeneratorRebuilder.FindHighestInUseRebuilderFactory();
  rebuilder.newIdGeneratorRebuilder(store,toolkit,idGenerator).rebuildIdGenerator();
  store.stop();
  store.shutdown();
  verify(idGenerator).rebuild(2001);
}
