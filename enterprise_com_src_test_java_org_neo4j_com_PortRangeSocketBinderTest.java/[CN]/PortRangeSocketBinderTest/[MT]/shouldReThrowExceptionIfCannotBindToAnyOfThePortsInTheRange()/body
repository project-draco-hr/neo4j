{
  HostnamePort localhost=new HostnamePort("localhost",9000,9002);
  ServerBootstrap bootstrap=mock(ServerBootstrap.class);
  when(bootstrap.bind(new InetSocketAddress("localhost",9000))).thenThrow(new ChannelException("Failed to bind to: 9000"));
  when(bootstrap.bind(new InetSocketAddress("localhost",9001))).thenThrow(new ChannelException("Failed to bind to: 9001"));
  when(bootstrap.bind(new InetSocketAddress("localhost",9002))).thenThrow(new ChannelException("Failed to bind to: 9002"));
  try {
    new PortRangeSocketBinder(bootstrap).bindToFirstAvailablePortInRange(localhost);
    fail("should have thrown ChannelException");
  }
 catch (  ChannelException ex) {
    assertEquals(2,suppressedExceptions(ex));
  }
}
