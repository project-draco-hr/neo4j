{
  final RecoveryVisitor visitor=new RecoveryVisitor(store,storeApplier,recoveredCount);
  final TransactionRepresentation representation=new PhysicalTransactionRepresentation(Collections.<Command>emptySet());
  final CommittedTransactionRepresentation transaction=new CommittedTransactionRepresentation(startEntry,representation,commitEntry);
  final boolean result=visitor.visit(transaction);
  assertTrue(result);
  verify(storeApplier,times(1)).apply(representation,commitEntry.getTxId(),true);
  assertEquals(1l,recoveredCount.get());
  visitor.close();
  verify(store,times(1)).setLastCommittingAndClosedTransactionId(commitEntry.getTxId());
}
