{
  terminationReleaseLock.lock();
  try {
    if (canBeTerminated()) {
      failure=true;
      terminationReason=reason;
      if (txTerminationAwareLocks && locks != null) {
        locks.stop();
      }
      transactionMonitor.transactionTerminated(hasTxStateWithChanges());
    }
  }
  finally {
    terminationReleaseLock.unlock();
  }
}
