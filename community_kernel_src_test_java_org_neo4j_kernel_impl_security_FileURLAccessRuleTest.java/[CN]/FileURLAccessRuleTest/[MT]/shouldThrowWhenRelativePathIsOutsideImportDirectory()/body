{
  File importDir=new File("/tmp/neo4jtest").getAbsoluteFile();
  final Config config=new Config(MapUtil.stringMap(GraphDatabaseSettings.load_csv_file_url_root.name(),importDir.toString()));
  final GraphDatabaseAPI gdb=mock(GraphDatabaseAPI.class);
  final DependencyResolver mockResolver=mock(DependencyResolver.class);
  when(gdb.getDependencyResolver()).thenReturn(mockResolver);
  when(mockResolver.resolveDependency(eq(Config.class))).thenReturn(config);
  try {
    URLAccessRules.fileAccess().validate(gdb,new URL("file:///../baz.csv"));
    fail("expected exception not thrown ");
  }
 catch (  URLAccessValidationError error) {
    assertThat(error.getMessage(),equalTo("file URL points outside configured import directory"));
  }
}
