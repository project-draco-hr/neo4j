{
  final NeoTransactionStoreApplier applier=new NeoTransactionStoreApplier(neoStore,indexingService,cacheAccess,lockService,transactionId,true);
  final DynamicRecord record=DynamicRecord.dynamicRecord(21,true);
  final Collection<DynamicRecord> recordsAfter=Arrays.asList(record);
  final UniquenessConstraintRule rule=UniquenessConstraintRule.uniquenessConstraintRule(0l,1,2,3l);
  final Command.SchemaRuleCommand command=new Command.SchemaRuleCommand().init(Collections.<DynamicRecord>emptyList(),recordsAfter,rule);
  final boolean result=applier.visitSchemaRuleCommand(command);
  assertTrue(result);
  verify(schemaStore,times(1)).setHighId(record.getId());
  verify(schemaStore,times(1)).updateRecord(record);
  verify(neoStore,times(1)).setLatestConstraintIntroducingTx(transactionId);
  verify(cacheAccess,times(1)).addSchemaRule(rule);
}
