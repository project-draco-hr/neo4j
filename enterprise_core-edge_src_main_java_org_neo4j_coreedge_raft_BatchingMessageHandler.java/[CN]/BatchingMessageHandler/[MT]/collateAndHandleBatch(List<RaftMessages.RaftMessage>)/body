{
  RaftMessages.NewEntry.Batch batchRequest=null;
  for (  RaftMessages.RaftMessage message : batch) {
    if (message instanceof RaftMessages.NewEntry.Request) {
      RaftMessages.NewEntry.Request newEntryRequest=(RaftMessages.NewEntry.Request)message;
      if (batchRequest == null) {
        batchRequest=new RaftMessages.NewEntry.Batch(batch.size());
      }
      batchRequest.add(newEntryRequest.content());
    }
 else {
      innerHandler.handle(message);
    }
  }
  if (batchRequest != null) {
    innerHandler.handle(batchRequest);
  }
}
