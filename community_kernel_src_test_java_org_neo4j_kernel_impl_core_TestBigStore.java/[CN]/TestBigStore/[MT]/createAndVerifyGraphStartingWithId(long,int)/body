{
  assumeTrue(machineIsOkToRunThisTest(testName.getMethodName(),requiredHeapMb));
  setHighIds(startId - 1000);
  byte[] bytes=new byte[45];
  bytes[2]=5;
  bytes[10]=42;
  Map<String,Object> properties=map("number",11,"short string","test","long string","This is a long value, long enough","array",bytes);
  Transaction tx=db.beginTx();
  int count=10000;
  for (int i=0; i < count; i++) {
    Node node=db.createNode();
    setProperties(node,properties);
    Relationship rel=db.getReferenceNode().createRelationshipTo(node,this);
    setProperties(rel,properties);
    Node highNode=db.createNode();
    node.createRelationshipTo(highNode,OTHER_TYPE);
    setProperties(highNode,properties);
    if (i % 100 == 0 && i > 0) {
      tx.success();
      tx.finish();
      tx=db.beginTx();
    }
    System.out.println("rel " + rel + " added to refnode");
  }
  tx.success();
  tx.finish();
  db.shutdown();
  db=new EmbeddedGraphDatabase(PATH);
  System.out.println("sdsd");
  int verified=0;
  for (  Relationship rel : db.getReferenceNode().getRelationships(Direction.OUTGOING)) {
    Node node=rel.getEndNode();
    assertProperties(properties,node);
    assertProperties(properties,rel);
    Node highNode=node.getSingleRelationship(OTHER_TYPE,Direction.OUTGOING).getEndNode();
    assertProperties(properties,highNode);
    verified++;
  }
  assertEquals(count,verified);
}
