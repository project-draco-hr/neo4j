{
  sendExecutor=Executors.newSingleThreadExecutor(new NamedThreadFactory("Cluster Sender"));
  channels=new DefaultChannelGroup();
  nioChannelFactory=new NioServerSocketChannelFactory(Executors.newCachedThreadPool(new NamedThreadFactory("Cluster boss")),Executors.newFixedThreadPool(2,new NamedThreadFactory("Cluster worker")),2);
  serverBootstrap=new ServerBootstrap(nioChannelFactory);
  serverBootstrap.setOption("child.tcpNoDelay",true);
  serverBootstrap.setPipelineFactory(new NetworkNodePipelineFactory());
  int[] ports=config.clusterServer().getPorts();
  int minPort=ports[0];
  int maxPort=ports.length == 2 ? ports[1] : minPort;
  clientBootstrap=new ClientBootstrap(new NioClientSocketChannelFactory(Executors.newSingleThreadExecutor(new NamedThreadFactory("Cluster client boss")),Executors.newFixedThreadPool(2,new NamedThreadFactory("Cluster client worker")),2));
  clientBootstrap.setOption("tcpNoDelay",true);
  clientBootstrap.setPipelineFactory(new NetworkNodePipelineFactory());
  clientBootstrap.setOption("tcpNoDelay",true);
  listen(minPort,maxPort);
}
