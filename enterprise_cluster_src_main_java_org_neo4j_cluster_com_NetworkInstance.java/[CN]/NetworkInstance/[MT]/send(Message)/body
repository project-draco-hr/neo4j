{
  URI to=null;
  try {
    to=new URI(message.getHeader(Message.TO));
  }
 catch (  URISyntaxException e) {
    msgLog.error("Not valid URI:" + message.getHeader(Message.TO));
    return;
  }
  Channel channel=getChannel(to);
  try {
    if (channel == null) {
      channel=openChannel(to);
      openedChannel(to,channel);
    }
  }
 catch (  Exception e) {
    msgLog.error("Could not connect to:" + to,e);
    return;
  }
  try {
    if (msgLog.isDebugEnabled()) {
      msgLog.debug("Sending to " + to + ": "+ message);
    }
    ChannelFuture future=channel.write(message);
    future.addListener(new ChannelFutureListener(){
      @Override public void operationComplete(      ChannelFuture future) throws Exception {
        if (!future.isSuccess())         msgLog.error("Unable to write " + message + " to "+ future.getChannel(),future.getCause());
      }
    }
);
  }
 catch (  Exception e) {
    e.printStackTrace();
    channel.close();
    closedChannel(to);
  }
}
