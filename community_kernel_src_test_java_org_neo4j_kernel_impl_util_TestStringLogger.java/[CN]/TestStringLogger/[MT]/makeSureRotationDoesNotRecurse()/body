{
  final String baseMessage="base message";
  File target=TargetDirectory.forTest(TestStringLogger.class).directory("recursionTest",true);
  final StringLogger logger=StringLogger.logger(target.getAbsolutePath(),baseMessage.length());
  Runnable trigger=new Runnable(){
    @Override public void run(){
      logger.logMessage(baseMessage + " from trigger",true);
    }
  }
;
  logger.addRotationListener(trigger);
  logger.logMessage(baseMessage + " from main",true);
  File rotated=new File(target,"messages.log.1");
  assertTrue("rotated file not present, should have been created",rotated.exists());
  Pair<String,Integer> rotatedInfo=lastLineOfFile(rotated);
  assertTrue("rotated file should have only stuff from main",rotatedInfo.first().endsWith(" from main") && rotatedInfo.other() == 1);
  File current=new File(target,"messages.log");
  assertTrue("should have created a new messages.log file",current.exists());
  Pair<String,Integer> currentInfo=lastLineOfFile(current);
  assertTrue("current file should have only stuff from trigger",currentInfo.first().endsWith(" from trigger") && currentInfo.other() == 1);
}
