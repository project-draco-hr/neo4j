{
  startDb();
  DoubleLatch populationCompletionLatch=provider.installPopulationJobCompletionLatch();
  IndexDefinition index=createIndex();
  populationCompletionLatch.awaitStart();
  dropIndex(index,populationCompletionLatch);
  assertEquals(emptySetOf(IndexDefinition.class),asSet(db.schema().getIndexes(myLabel)));
  try {
    db.schema().getIndexState(index);
    fail("This index should have been deleted");
  }
 catch (  NotFoundException e) {
    assertThat(e.getMessage(),CoreMatchers.containsString(myLabel.name()));
  }
}
