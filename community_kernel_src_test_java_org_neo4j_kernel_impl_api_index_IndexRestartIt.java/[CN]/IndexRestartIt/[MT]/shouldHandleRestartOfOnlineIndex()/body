{
  startDb();
  createIndex();
  provider.awaitFullyPopulated();
  stopDb();
  provider.setInitialIndexState(ONLINE);
  startDb();
  IndexDefinition index=getSingleIndex();
  assertThat(db.schema().getIndexState(index),equalTo(Schema.IndexState.ONLINE));
  assertEquals(1,provider.populatorCallCount.get());
  assertEquals(2,provider.writerCallCount.get());
}
