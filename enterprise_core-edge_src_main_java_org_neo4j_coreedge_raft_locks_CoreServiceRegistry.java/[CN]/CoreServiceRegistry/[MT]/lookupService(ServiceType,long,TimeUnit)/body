{
  CoreServiceAssignment assignment;
  long endTime=clock.currentTimeMillis() + unit.toMillis(time);
  while ((assignment=serviceMap.get(serviceType)) == null) {
    if (clock.currentTimeMillis() >= endTime) {
      throw new TimeoutException();
    }
    try {
      wait(1000);
    }
 catch (    InterruptedException e) {
      throw new TimeoutException(e.getMessage());
    }
  }
  return assignment;
}
