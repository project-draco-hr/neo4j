{
  TargetDirectory dir=TargetDirectory.forTest(getClass());
  zoo=LocalhostZooKeeperCluster.singleton().clearDataAndVerifyConnection();
  master=new WrappingDatabase((AbstractGraphDatabase)new EnterpriseGraphDatabaseFactory().newHighlyAvailableDatabaseBuilder(dir.directory("1",true).getAbsolutePath()).setConfig(ShellSettings.remote_shell_enabled,GraphDatabaseSetting.TRUE).setConfig(ShellSettings.remote_shell_port,"1337").setConfig(HaSettings.coordinators,zoo.getConnectionString()).setConfig(HaSettings.server_id,"1").setConfig(HaSettings.server,"localhost:6361").newGraphDatabase());
  createData(master.getGraph());
  slave=new WrappingDatabase((AbstractGraphDatabase)new EnterpriseGraphDatabaseFactory().newHighlyAvailableDatabaseBuilder(dir.directory("2",true).getAbsolutePath()).setConfig(ShellSettings.remote_shell_enabled,GraphDatabaseSetting.TRUE).setConfig(ShellSettings.remote_shell_port,"1338").setConfig(HaSettings.coordinators,zoo.getConnectionString()).setConfig(HaSettings.server_id,"2").setConfig(HaSettings.server,"localhost:6362").newGraphDatabase());
  this.consoleService=new ConsoleService(this,slave,new OutputFormat(new JsonFormat(),uri,null));
  this.session=new ShellSession(slave.getGraph());
}
