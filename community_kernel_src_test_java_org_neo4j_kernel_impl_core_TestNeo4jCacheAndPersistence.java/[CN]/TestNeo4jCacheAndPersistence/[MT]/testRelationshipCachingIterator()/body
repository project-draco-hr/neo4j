{
  Node node1=getGraphDb().createNode();
  Node node2=getGraphDb().createNode();
  Relationship rels[]=new Relationship[100];
  for (int i=0; i < rels.length; i++) {
    if (i < 50) {
      rels[i]=node1.createRelationshipTo(node2,MyRelTypes.TEST);
    }
 else {
      rels[i]=node2.createRelationshipTo(node1,MyRelTypes.TEST);
    }
  }
  newTransaction();
  clearCache();
  Iterable<Relationship> relIterable=toList(node1.getRelationships());
  Set<Relationship> relSet=new HashSet<>();
  for (  Relationship rel : rels) {
    rel.delete();
    relSet.add(rel);
  }
  newTransaction();
  assertEquals(relSet,new HashSet<>(IteratorUtil.asCollection(relIterable)));
  node1.delete();
  node2.delete();
}
