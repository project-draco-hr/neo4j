{
  if (backupService.directoryContainsDb(to)) {
    try {
      doBackupIncremental(from,to,checkConsistency,tuningConfiguration);
      systemOut.println("Done");
    }
 catch (    MismatchingStoreIdException e) {
      systemOut.println("Backup failed.");
      throw new ToolFailureException(String.format(MISMATCHED_STORE_ID,e.getExpected(),e.getEncountered()));
    }
  }
 else {
    doBackupFull(from,to,checkConsistency,tuningConfiguration);
    systemOut.println("Done");
  }
}
