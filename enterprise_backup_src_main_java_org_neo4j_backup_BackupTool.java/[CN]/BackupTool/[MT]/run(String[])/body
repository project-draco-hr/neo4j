{
  Args arguments=new Args(args);
  checkArguments(arguments);
  String from=arguments.get(FROM,null);
  String to=arguments.get(TO,null);
  boolean verify=arguments.getBoolean(VERIFY,true,true);
  Config tuningConfiguration=readTuningConfiguration(TO,arguments);
  URI backupURI=resolveBackupUri(from.trim(),arguments,tuningConfiguration);
  if (backupURI == null || backupURI.getHost() == null) {
    throw new ToolFailureException(WRONG_FROM_ADDRESS_SYNTAX);
  }
  try {
    String str=backupURI.toASCIIString();
    if (str.contains("://")) {
      str=str.split("://")[1];
    }
    systemOut.println("Performing backup from '" + str + "'");
    doBackup(backupURI,to,verify,tuningConfiguration);
  }
 catch (  TransactionFailureException e) {
    if (e.getCause() instanceof UpgradeNotAllowedByConfigurationException) {
      try {
        systemOut.println("The database present in the target directory is of an older version. " + "Backing that up in target and performing a full backup from source");
        moveExistingDatabase(fs,to);
      }
 catch (      IOException e1) {
        throw new ToolFailureException("There was a problem moving the old database out of the way" + " - cannot continue, aborting.",e);
      }
      doBackup(backupURI,to,verify,tuningConfiguration);
    }
 else {
      throw new ToolFailureException("TransactionFailureException " + "from existing backup at '" + from + "'.",e);
    }
  }
}
