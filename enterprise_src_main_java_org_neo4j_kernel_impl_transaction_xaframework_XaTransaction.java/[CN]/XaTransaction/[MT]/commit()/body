{
  if (!prepared && !isRecovered()) {
    throw new XAException("Cannot commit unprepared transaction");
  }
  log.registerTxIdentifier(getIdentifier());
  try {
    committed=true;
    doCommit();
  }
  finally {
    log.unregisterTxIdentifier();
  }
}
