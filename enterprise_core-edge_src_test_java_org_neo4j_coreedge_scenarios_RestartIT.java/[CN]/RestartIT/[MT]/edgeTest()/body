{
  File dbDir=dir.directory();
  cluster=Cluster.start(dbDir,2,1,new TestOnlyDiscoveryServiceFactory());
  final GraphDatabaseService coreDB=cluster.awaitLeader(5000);
  try (Transaction tx=coreDB.beginTx()){
    Node node=coreDB.createNode(label("boo"));
    node.setProperty("foobar","baz_bat");
    tx.success();
  }
   cluster.addCoreServerWithServerId(2,3);
  cluster.shutdown();
  for (  CoreGraphDatabase core : cluster.coreServers()) {
    ConsistencyCheckService.Result result=new ConsistencyCheckService().runFullConsistencyCheck(new File(core.getStoreDir()),Config.defaults(),ProgressMonitorFactory.NONE,FormattedLogProvider.toOutputStream(System.out),new DefaultFileSystemAbstraction(),false);
    assertTrue("Inconsistent: " + core,result.isSuccessful());
  }
  for (  EdgeGraphDatabase edge : cluster.edgeServers()) {
    ConsistencyCheckService.Result result=new ConsistencyCheckService().runFullConsistencyCheck(new File(edge.getStoreDir()),Config.defaults(),ProgressMonitorFactory.NONE,FormattedLogProvider.toOutputStream(System.out),new DefaultFileSystemAbstraction(),false);
    assertTrue("Inconsistent: " + edge,result.isSuccessful());
  }
}
