{
  File dbDir=dir.directory();
  cluster=Cluster.start(dbDir,3,0);
  final GraphDatabaseService coreDB=cluster.getCoreServerById(0);
  ExecutorService executor=Executors.newCachedThreadPool();
  final AtomicBoolean done=new AtomicBoolean(false);
  executor.execute(new Runnable(){
    @Override public void run(){
      while (!done.get()) {
        try (Transaction tx=coreDB.beginTx()){
          Node node=coreDB.createNode(label("boo"));
          node.setProperty("foobar","baz_bat");
          tx.success();
        }
       }
    }
  }
);
  Thread.sleep(500);
  cluster.removeCoreServerWithServerId(1);
  cluster.addCoreServerWithServerId(1,3);
  Thread.sleep(500);
  done.set(true);
  executor.shutdown();
  cluster.shutdown();
}
