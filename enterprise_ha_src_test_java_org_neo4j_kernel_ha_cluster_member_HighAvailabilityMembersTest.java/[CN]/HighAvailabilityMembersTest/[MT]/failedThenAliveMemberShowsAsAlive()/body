{
  MockedClusterMonitor clusterMonitor=new MockedClusterMonitor();
  MockedHighAvailability highAvailability=new MockedHighAvailability();
  HighAvailabilityMembers members=new HighAvailabilityMembers(clusterMonitor,highAvailability);
  clusterMonitor.listeningAt(clusterUri1);
  clusterMonitor.enteredCluster(clusterConfiguration(clusterUri1,clusterUri2));
  highAvailability.masterIsElectedAndAvailable(clusterUri1,haUri1);
  highAvailability.slaveIsAvailable(clusterUri2,haUri2);
  clusterMonitor.failed(clusterUri2);
  clusterMonitor.alive(clusterUri2);
  assertThat(members.getMembers(),containsMembers(member(clusterUri1).available(true).alive(true).haRole("MASTER"),member(clusterUri2).available(true).alive(true).haRole("SLAVE")));
}
