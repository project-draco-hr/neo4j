{
  File neoStore=new File(storeDir,MetaDataStore.DEFAULT_NAME);
  long lastTxId=MetaDataStore.getRecord(pageCache,neoStore,Position.LAST_TRANSACTION_ID);
  long lastTxChecksum=extractTransactionChecksum(neoStore,storeDir,lastTxId);
  LogPosition lastTxLogPosition=extractTransactionLogPosition(neoStore,storeDir,lastTxId);
  writeLastTxChecksum(migrationDir,lastTxChecksum);
  writeLastTxLogPosition(migrationDir,lastTxLogPosition);
switch (versionToMigrateFrom) {
case Legacy23Store.LEGACY_VERSION:
case Legacy22Store.LEGACY_VERSION:
    break;
case Legacy21Store.LEGACY_VERSION:
  removeDuplicateEntityProperties(storeDir,migrationDir,pageCache,schemaIndexProvider,Legacy21Store.LEGACY_VERSION);
break;
case Legacy20Store.LEGACY_VERSION:
case Legacy19Store.LEGACY_VERSION:
migrateWithBatchImporter(storeDir,migrationDir,lastTxId,lastTxChecksum,lastTxLogPosition.getLogVersion(),lastTxLogPosition.getByteOffset(),pageCache,progressMonitor,versionToMigrateFrom);
break;
default :
throw new IllegalStateException("Unknown version to upgrade from: " + versionToMigrateFrom);
}
}
