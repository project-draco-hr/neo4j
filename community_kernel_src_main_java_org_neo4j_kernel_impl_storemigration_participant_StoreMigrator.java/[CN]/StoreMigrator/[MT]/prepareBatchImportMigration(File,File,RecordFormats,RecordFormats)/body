{
  BatchingNeoStores.createStore(fileSystem,migrationDir.getPath(),config);
  if (newFormat.dynamic().equals(oldFormat.dynamic())) {
    Iterable<StoreFile> storeFiles=iterable(StoreFile.NODE_LABEL_STORE);
    StoreFile.fileOperation(COPY,fileSystem,storeDir,migrationDir,storeFiles,true,ExistingTargetStrategy.FAIL,StoreFileType.values());
  }
 else {
    DirectRecordStoreMigrator migrator=new DirectRecordStoreMigrator(pageCache,fileSystem,config);
    migrator.migrate(storeDir,oldFormat,migrationDir,newFormat,new StoreType[]{StoreType.LABEL_TOKEN,StoreType.LABEL_TOKEN_NAME,StoreType.PROPERTY_KEY_TOKEN,StoreType.PROPERTY_KEY_TOKEN_NAME,StoreType.RELATIONSHIP_TYPE_TOKEN,StoreType.RELATIONSHIP_TYPE_TOKEN_NAME,StoreType.NODE_LABEL,StoreType.SCHEMA},new StoreType[]{StoreType.NODE});
  }
}
