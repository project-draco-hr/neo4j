{
  ArrayMap<String,ArrayIntSet> mapToCheck=null;
  if (cowRelationshipMap != null && cowTxId == nodeManager.getTransaction()) {
    mapToCheck=cowRelationshipMap;
  }
 else {
    ensureFullRelationships();
    mapToCheck=relationshipMap;
  }
  int size=0;
  for (  RelationshipType type : types) {
    ArrayIntSet relTypeSet=mapToCheck.get(type.name());
    if (relTypeSet != null) {
      size+=relTypeSet.size();
    }
  }
  int[] ids=new int[size];
  int position=0;
  for (  RelationshipType type : types) {
    ArrayIntSet relTypeSet=mapToCheck.get(type.name());
    if (relTypeSet != null) {
      for (      int relId : relTypeSet.values()) {
        ids[position++]=relId;
      }
    }
  }
  return new RelationshipIterator(ids,this,Direction.BOTH,nodeManager);
}
