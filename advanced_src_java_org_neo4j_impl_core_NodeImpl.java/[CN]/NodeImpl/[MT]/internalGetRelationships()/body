{
  ensureFullRelationships();
  Map<String,Integer> result=null;
  for (  String type : relationshipMap.keySet()) {
    ArrayIntSet source=relationshipMap.get(type);
    for (    int relId : source.values()) {
      ArrayIntSet skip=nodeManager.getCowRelationshipRemoveMap(this,type);
      if (skip != null && skip.contains(relId)) {
        continue;
      }
      result=result == null ? new HashMap<String,Integer>() : result;
      Integer count=result.get(type);
      count=count == null ? 0 : count;
      count++;
      result.put(type,count);
    }
  }
  ArrayMap<String,ArrayIntSet> cowRelationshipAddMap=nodeManager.getCowRelationshipAddMap(this);
  if (cowRelationshipAddMap != null) {
    for (    String type : cowRelationshipAddMap.keySet()) {
      ArrayIntSet source=cowRelationshipAddMap.get(type);
      if (source.size() > 0) {
        result=result == null ? new HashMap<String,Integer>() : result;
        Integer count=result.get(type);
        count=count == null ? 0 : count;
        count+=source.size();
        result.put(type,count);
      }
    }
  }
  return result;
}
