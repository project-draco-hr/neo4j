{
  ArrayMap<String,ArrayIntSet> mapToCheck=null;
  if (cowRelationshipMap != null && cowTxId == nodeManager.getTransactionId()) {
    mapToCheck=cowRelationshipMap;
  }
 else {
    ensureFullRelationships();
    mapToCheck=relationshipMap;
  }
  Iterator<ArrayIntSet> values=mapToCheck.values().iterator();
  int size=0;
  while (values.hasNext()) {
    ArrayIntSet relTypeSet=values.next();
    size+=relTypeSet.size();
  }
  values=mapToCheck.values().iterator();
  int[] ids=new int[size];
  int position=0;
  while (values.hasNext()) {
    ArrayIntSet relTypeSet=values.next();
    for (    int relId : relTypeSet.values()) {
      ids[position++]=relId;
    }
  }
  return new RelationshipIterator(ids,this,Direction.BOTH,nodeManager);
}
