{
  if (dir == Direction.BOTH) {
    return getRelationships(type);
  }
  acquireLock(this,LockType.READ);
  try {
    ensureFullRelationships();
    if (relationshipMap == null) {
      return Collections.emptyList();
    }
    Set<Integer> relationshipSet=relationshipMap.get(type);
    if (relationshipSet == null) {
      return Collections.emptyList();
    }
 else {
      List<Relationship> rels=new LinkedList<Relationship>();
      Iterator<Integer> values=relationshipSet.iterator();
      while (values.hasNext()) {
        Relationship rel=nodeManager.getRelationshipById(values.next());
        if (dir == Direction.OUTGOING && rel.getStartNode().equals(this)) {
          rels.add(rel);
        }
 else         if (dir == Direction.INCOMING && rel.getEndNode().equals(this)) {
          rels.add(rel);
        }
      }
      return rels;
    }
  }
  finally {
    releaseLock(this,LockType.READ);
  }
}
