{
  boolean checkCow=false;
  if (cowTxId != null && cowTxId == nodeManager.getTransaction()) {
    checkCow=true;
  }
  ensureFullRelationships();
  ArrayIntSet relIds=new ArrayIntSet();
  ArrayIntSet source=relationshipMap.get(type.name());
  if (source != null) {
    for (    int relId : source.values()) {
      if (checkCow) {
        ArrayIntSet skip=nodeManager.getCowRelationshipRemoveMap(this,type.name());
        if (skip != null && skip.contains(relId)) {
          continue;
        }
      }
      relIds.add(relId);
    }
  }
  if (checkCow) {
    source=nodeManager.getCowRelationshipAddMap(this,type.name());
    if (source != null) {
      for (      int relId : source.values()) {
        relIds.add(relId);
      }
    }
  }
  return new RelationshipArrayIntSetIterator(relIds,this,dir,nodeManager);
}
