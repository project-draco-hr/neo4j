{
  if (brickSize <= 0) {
    return;
  }
  ArrayList<BrickElement> mappedBricks=new ArrayList<BrickElement>();
  for (int i=0; i < brickCount; i++) {
    BrickElement be=brickArray[i];
    if (be.getWindow() != null) {
      mappedBricks.add(be);
    }
  }
  Collections.sort(mappedBricks,new BrickSorter());
  for (int i=0; i < nr && i < mappedBricks.size(); i++) {
    BrickElement mappedBrick=mappedBricks.get(i);
    LockableWindow window=mappedBrick.getWindow();
    if (window.getWaitingThreadsCount() == 0 && !window.isMarked()) {
      if (window instanceof MappedPersistenceWindow) {
        ((MappedPersistenceWindow)window).unmap();
      }
 else       if (window instanceof PlainPersistenceWindow) {
        ((PlainPersistenceWindow)window).writeOut();
      }
      mappedBrick.setWindow(null);
      memUsed-=brickSize;
    }
  }
}
