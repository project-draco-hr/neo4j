{
  try {
    LockableWindow window=null;
    if (useMemoryMapped) {
      window=new MappedPersistenceWindow(brickIndexToPosition(brick.index()),blockSize,brickSize,fileChannel,mapMode);
    }
 else {
      PlainPersistenceWindow dpw=new PlainPersistenceWindow(brickIndexToPosition(brick.index()),blockSize,brickSize,fileChannel);
      dpw.readFullWindow();
      window=dpw;
    }
    while (true) {
synchronized (brick) {
        if (brick.lockCount.get() == 0) {
          brick.setWindow(window);
          break;
        }
 else {
          try {
            Thread.sleep(20);
          }
 catch (          InterruptedException e) {
            Thread.interrupted();
            continue;
          }
        }
      }
    }
    memUsed+=brickSize;
    return true;
  }
 catch (  MappedMemException e) {
    ooe++;
    logWarn("Unable to memory map",e);
  }
catch (  OutOfMemoryError e) {
    ooe++;
    logWarn("Unable to allocate direct buffer",e);
  }
  return false;
}
