{
  try {
    int maxWindowMappingAttempts=5;
    for (int attempt=0; attempt < maxWindowMappingAttempts; attempt++) {
synchronized (brick) {
        if (brick.lockCount.get() == 0) {
          if (useMemoryMapped) {
            LockableWindow window=new MappedPersistenceWindow(brickIndexToPosition(brick.index()),blockSize,brickSize,fileChannel,mapMode);
            brick.setWindow(window);
          }
 else {
            PlainPersistenceWindow window=new PlainPersistenceWindow(brickIndexToPosition(brick.index()),blockSize,brickSize,fileChannel);
            window.readFullWindow();
            brick.setWindow(window);
          }
          memUsed+=brickSize;
          return true;
        }
      }
      Thread.yield();
    }
    return false;
  }
 catch (  MappedMemException e) {
    ooe++;
    logWarn("Unable to memory map",e);
  }
catch (  OutOfMemoryError e) {
    ooe++;
    logWarn("Unable to allocate direct buffer",e);
  }
  return false;
}
