{
  List<CountsRecordState.Difference> differences=state.verify(new CountsVisitor.Visitable(){
    @Override public void accept(    final CountsVisitor verifier){
      tracker.accept(new CountsVisitor(){
        @Override public void visitNodeCount(        int labelId,        long count){
          assertEquals("Should be able to read visited state.",tracker.nodeCount(labelId),count);
          verifier.visitNodeCount(labelId,count);
        }
        @Override public void visitRelationshipCount(        int startLabelId,        int typeId,        int endLabelId,        long count){
          assertEquals("Should be able to read visited state.",tracker.relationshipCount(startLabelId,typeId,endLabelId),count);
          verifier.visitRelationshipCount(startLabelId,typeId,endLabelId,count);
        }
        @Override public void visitIndexSize(        int labelId,        int propertyKeyId,        long count){
          assertEquals("Should be able to read visited state.",tracker.indexSize(labelId,propertyKeyId),count);
          verifier.visitIndexSize(labelId,propertyKeyId,count);
        }
        @Override public void visitIndexSample(        int labelId,        int propertyKeyId,        long unique,        long size){
          Register.DoubleLongRegister output=Registers.newDoubleLongRegister();
          tracker.indexSample(labelId,propertyKeyId,output);
          assertEquals("Should be able to read visited state.",output.readFirst(),unique);
          assertEquals("Should be able to read visited state.",output.readSecond(),size);
          verifier.visitIndexSample(labelId,propertyKeyId,unique,size);
        }
      }
);
    }
  }
);
  if (!differences.isEmpty()) {
    StringBuilder errors=new StringBuilder().append("Counts differ in ").append(differences.size()).append(" places...");
    for (    CountsRecordState.Difference difference : differences) {
      errors.append("\n\t").append(difference);
    }
    throw new AssertionError(errors.toString());
  }
}
