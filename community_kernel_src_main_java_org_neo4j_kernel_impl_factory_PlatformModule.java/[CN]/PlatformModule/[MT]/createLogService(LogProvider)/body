{
  if (userLogProvider == null) {
    userLogProvider=NullLogProvider.getInstance();
  }
  long internalLogRotationThreshold=config.get(GraphDatabaseSettings.store_internal_log_rotation_threshold);
  int internalLogRotationDelay=config.get(GraphDatabaseSettings.store_internal_log_rotation_delay);
  int internalLogMaxArchives=config.get(GraphDatabaseSettings.store_internal_log_max_archives);
  LogService logService;
  try {
    logService=new StoreLogService(userLogProvider,fileSystem,storeDir,config,internalLogRotationThreshold,internalLogRotationDelay,internalLogMaxArchives,jobScheduler,new Consumer<LogProvider>(){
      @Override public void accept(      LogProvider logProvider){
        diagnosticsManager.dumpAll(logProvider.getLog(DiagnosticsManager.class));
      }
    }
);
  }
 catch (  IOException ex) {
    throw new RuntimeException(ex);
  }
  return life.add(logService);
}
