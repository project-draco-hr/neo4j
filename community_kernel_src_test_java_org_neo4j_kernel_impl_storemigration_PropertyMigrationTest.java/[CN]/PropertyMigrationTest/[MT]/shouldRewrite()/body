{
  URL legacyNodeStoreFile=getClass().getResource("oldformatstore/neostore.nodestore.db");
  URL legacyPropertyStoreFile=getClass().getResource("oldformatstore/neostore.propertystore.db");
  URL legacyStringStoreFile=getClass().getResource("oldformatstore/neostore.propertystore.db.strings");
  URL legacyArrayStoreFile=getClass().getResource("oldformatstore/neostore.propertystore.db.arrays");
  LegacyPropertyStoreReader propertyStoreReader=new LegacyPropertyStoreReader(legacyPropertyStoreFile.getFile());
  LegacyDynamicRecordFetcher legacyDynamicRecordFetcher=new LegacyDynamicRecordFetcher(legacyStringStoreFile.getFile(),legacyArrayStoreFile.getFile());
  LegacyNodeStoreReader legacyNodeStoreReader=new LegacyNodeStoreReader(legacyNodeStoreFile.getFile());
  HashMap config=MigrationTestUtils.defaultConfig();
  File outputDir=new File("target/outputDatabase");
  FileUtils.deleteRecursively(outputDir);
  assertTrue(outputDir.mkdirs());
  File propertyStoreFile=new File(outputDir,"neostore.propertystore.db");
  PropertyStore.createStore(propertyStoreFile.getPath(),config);
  PropertyStore propertyStore=new PropertyStore(propertyStoreFile.getPath(),config);
  new PropertyMigration(legacyNodeStoreReader,propertyStoreReader,legacyDynamicRecordFetcher).migrateNodeProperties(new PropertyWriter(propertyStore));
  assertEquals(1000,propertyStore.getHighId());
  propertyStore.close();
}
