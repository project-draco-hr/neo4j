{
  if (!providers.containsKey(db.provider())) {
    throw new NoSuchDatabaseProviderException(db.provider());
  }
  DatabaseRegistryEntry entry=new DatabaseRegistryEntry(providers.get(db.provider()).newDatabase(db.config(),loggingProvider));
  DatabaseRegistryEntry prevEntry=databases.putIfAbsent(db.key(),entry);
  if (prevEntry == null) {
    life.add(entry);
  }
}
