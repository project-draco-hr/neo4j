{
  File tuningFile=createNeo4jProperties();
  NeoServer server=EnterpriseServerBuilder.server().usingDatabaseDir(folder.getRoot().getAbsolutePath()).withProperty(Configurator.DB_MODE_KEY,"HA").withProperty(Configurator.DB_TUNING_PROPERTY_FILE_KEY,tuningFile.getAbsolutePath()).persistent().build();
  try {
    server.start();
    server.getDatabase();
    assertThat(server.getDatabase(),is(EnterpriseDatabase.class));
    assertThat(server.getDatabase().getGraph(),is(HighlyAvailableGraphDatabase.class));
    Client client=Client.create();
    ClientResponse r=client.resource("http://localhost:" + DEFAULT_WEBSERVER_PORT + "/db/manage/server/ha").accept(APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(200,r.getStatus());
    assertThat(r.getEntity(String.class),containsString("master"));
  }
  finally {
    server.stop();
  }
}
