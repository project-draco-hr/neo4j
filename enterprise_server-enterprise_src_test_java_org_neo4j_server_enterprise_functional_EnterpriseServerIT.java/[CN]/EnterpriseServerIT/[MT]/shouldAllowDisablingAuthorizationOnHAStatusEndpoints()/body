{
  File tuningFile=createNeo4jProperties();
  NeoServer server=EnterpriseServerBuilder.server().withProperty(ServerSettings.auth_enabled.name(),"true").withProperty(HaSettings.ha_status_auth_enabled.name(),"false").usingDatabaseDir(folder.getRoot().getAbsolutePath()).withProperty(mode.name(),"HA").withProperty(Configurator.DB_TUNING_PROPERTY_FILE_KEY,tuningFile.getAbsolutePath()).persistent().build();
  try {
    server.start();
    server.getDatabase();
    assertThat(server.getDatabase().getGraph(),is(instanceOf(HighlyAvailableGraphDatabase.class)));
    Client client=Client.create();
    ClientResponse r=client.resource("http://localhost:" + DEFAULT_WEBSERVER_PORT + "/db/manage/server/ha").accept(APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(200,r.getStatus());
    assertThat(r.getEntity(String.class),containsString("master"));
  }
  finally {
    server.stop();
  }
}
