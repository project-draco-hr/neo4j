{
  for (int i=0; i < batch.length; i++) {
    T item=batch[i];
    if (item != null && item.inUse()) {
      if (!processor.process(item)) {
        batch[i]=null;
      }
    }
  }
  if (!endOfLine) {
    sender.send(batch);
  }
}
