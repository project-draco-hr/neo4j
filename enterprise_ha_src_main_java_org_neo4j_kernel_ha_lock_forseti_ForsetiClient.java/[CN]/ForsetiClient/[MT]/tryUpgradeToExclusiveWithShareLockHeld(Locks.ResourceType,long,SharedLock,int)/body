{
  if (sharedLock.tryAcquireUpdateLock(this)) {
    try {
      while (sharedLock.numberOfHolders() > 1) {
        if (stateHolder.isClosed()) {
          sharedLock.releaseUpdateLock(this);
          return false;
        }
        waitStrategies[resourceType.typeId()].apply(tries++);
        markAsWaitingFor(sharedLock,resourceType,resourceId);
      }
      return true;
    }
 catch (    DeadlockDetectedException e) {
      sharedLock.releaseUpdateLock(this);
      throw e;
    }
catch (    Throwable e) {
      sharedLock.releaseUpdateLock(this);
      clearWaitList();
      throw new RuntimeException(e);
    }
  }
  return false;
}
