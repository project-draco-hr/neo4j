{
  IdAllocation firstResult=new IdAllocation(new IdRange(new long[]{},42,123),123,0);
  Response<IdAllocation> response=response(firstResult);
  when(master.allocateIds(any(RequestContext.class),any(IdType.class))).thenReturn(response);
  IdGenerator gen=switchToSlave();
  for (long i=firstResult.getIdRange().getRangeStart(); i < firstResult.getIdRange().getRangeLength(); i++) {
    assertEquals(i,gen.nextId());
  }
  verify(master,times(1)).allocateIds(any(RequestContext.class),eq(IdType.NODE));
}
