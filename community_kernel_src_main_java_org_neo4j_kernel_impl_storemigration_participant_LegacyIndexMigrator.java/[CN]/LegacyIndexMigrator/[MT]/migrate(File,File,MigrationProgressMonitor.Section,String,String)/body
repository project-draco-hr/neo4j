{
  IndexImplementation indexImplementation=indexProviders.get(LUCENE_LEGACY_INDEX_PROVIDER_NAME);
  if (indexImplementation != null) {
    RecordFormats from=InternalRecordFormatSelector.fromVersion(versionToMigrateFrom);
    RecordFormats to=InternalRecordFormatSelector.fromVersion(versionToMigrateTo);
    if (!from.hasSameCapabilities(to,Capability.TYPE_INDEX)) {
      originalLegacyIndexesRoot=indexImplementation.getIndexImplementationDirectory(storeDir);
      migrationLegacyIndexesRoot=indexImplementation.getIndexImplementationDirectory(migrationDir);
      if (isNotEmptyDirectory(originalLegacyIndexesRoot)) {
        migrateLegacyIndexes(progressMonitor);
        legacyIndexMigrated=true;
      }
    }
  }
 else {
    log.debug("Lucene index provider not found, nothing to migrate.");
  }
}
