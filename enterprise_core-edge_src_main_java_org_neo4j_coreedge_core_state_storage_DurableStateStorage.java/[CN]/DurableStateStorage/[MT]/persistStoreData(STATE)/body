{
  if (numberOfEntriesWrittenInActiveFile >= numberOfEntriesBeforeRotation) {
    switchStoreFile();
    numberOfEntriesWrittenInActiveFile=0;
  }
  marshal.marshal(state,currentStoreChannel);
  currentStoreChannel.prepareForFlush().flush();
  numberOfEntriesWrittenInActiveFile++;
}
