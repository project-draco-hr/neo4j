{
  clearCache();
  for (  Direction dir : Direction.values()) {
    Set<Relationship> expected=new HashSet<Relationship>();
    for (int i=0; i < relationships.length; i++) {
      if (relationships[i] != null && (dir != Direction.INCOMING || loop[i])) {
        expected.add(relationships[i]);
      }
    }
    for (    Relationship rel : root.getRelationships(dir)) {
      assertTrue(message + ": unexpected relationship: " + rel,expected.remove(rel));
    }
    assertTrue(message + ": expected relationships not seen " + expected,expected.isEmpty());
  }
}
