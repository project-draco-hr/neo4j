{
  if (retries > 20) {
    close();
  }
  connection.write();
  log("Send log: " + logVersionToSend);
  if (!buffer.hasRemaining()) {
    buffer.clear();
    try {
      if (logToSend.read(buffer) <= 0) {
        releaseWriteBuffer();
        setStatus(Status.GET_MESSAGE);
        logLength=-1;
        logVersionToSend=-1;
        logToSend=null;
        if (logVersionToSend >= slaveVersion) {
          slaveVersion=logVersionToSend + 1;
        }
        return true;
      }
      buffer.flip();
    }
 catch (    IOException e) {
      log("Error reading log",e);
      close();
      return true;
    }
  }
  retries++;
  return false;
}
