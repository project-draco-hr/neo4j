{
  buffer.clear();
  buffer.limit(length);
  int bytesRead=0;
  int read;
  do {
    read=channel.read(buffer,offset + bytesRead);
  }
 while (read != -1 && (bytesRead+=read) < length);
  while (buffer.position() < buffer.limit()) {
    buffer.put((byte)0);
  }
  return bytesRead;
}
