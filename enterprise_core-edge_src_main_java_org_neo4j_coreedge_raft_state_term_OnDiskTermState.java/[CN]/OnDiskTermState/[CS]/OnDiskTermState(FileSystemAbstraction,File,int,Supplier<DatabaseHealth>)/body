{
  File fileA=new File(stateDir,FILENAME + "a");
  File fileB=new File(stateDir,FILENAME + "b");
  workingBuffer=ByteBuffer.allocate(InMemoryVoteState.InMemoryVoteStateMarshal.NUMBER_OF_BYTES_PER_VOTE);
  TermStateRecoveryManager recoveryManager=new TermStateRecoveryManager(fileSystemAbstraction,new InMemoryTermState.InMemoryTermStateMarshal());
  final StateRecoveryManager.RecoveryStatus recoveryStatus=recoveryManager.recover(fileA,fileB);
  this.inMemoryTermState=recoveryManager.readLastEntryFrom(fileSystemAbstraction,recoveryStatus.previouslyActive());
  this.statePersister=new StatePersister<>(fileA,fileB,fileSystemAbstraction,numberOfEntriesBeforeRotation,workingBuffer,new InMemoryTermState.InMemoryTermStateMarshal(),recoveryStatus.previouslyInactive(),databaseHealthSupplier);
}
