{
  this.monitors=monitors;
  this.fileSystem=life.add(new ChannelReusingFileSystemAbstraction(fileSystem));
  this.neoStoreFileName=new File(storeDir,NeoStore.DEFAULT_NAME);
  this.logger=logging.getMessagesLog(getClass());
  this.neo4jConfig=configForStoreDir(new Config(stringMap(dense_node_threshold.name(),valueOf(config.denseNodeThreshold()))),new File(storeDir));
  Neo4jJobScheduler jobScheduler=life.add(new Neo4jJobScheduler());
  pageCache=life.add(new LifecycledPageCache(fileSystem,jobScheduler,neo4jConfig));
  this.neoStore=newBatchWritingNeoStore(pageCache);
  this.propertyKeyRepository=new BatchingPropertyKeyTokenRepository(neoStore.getPropertyKeyTokenStore());
  this.labelRepository=new BatchingLabelTokenRepository(neoStore.getLabelTokenStore());
  this.relationshipTypeRepository=new BatchingRelationshipTypeTokenRepository(neoStore.getRelationshipTypeStore());
  life.start();
}
