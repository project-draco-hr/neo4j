{
  @SuppressWarnings("unchecked") ServiceFactory<T> factory=(ServiceFactory<T>)serviceFactories.get(iface);
  if (factory == null) {
    final HandlerFactory handlerFactory=new HandlerFactory(this,iface,builder);
    factory=new ServiceFactory<T>(){
      public T createServiceInstance(      int serviceId){
        return iface.cast(Proxy.newProxyInstance(iface.getClassLoader(),new Class[]{iface},handlerFactory.makeServiceHandler(serviceId)));
      }
    }
;
    serviceFactories.put(iface,factory);
  }
  return factory;
}
