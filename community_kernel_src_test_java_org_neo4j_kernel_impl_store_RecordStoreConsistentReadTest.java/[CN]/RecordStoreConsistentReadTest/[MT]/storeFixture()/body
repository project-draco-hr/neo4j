{
  PageCache pageCache=pageCacheRule.getPageCache(fs);
  pageCache=pageCacheRule.withInconsistentReads(pageCache,nextReadIsInconsistent);
  File storeDir=new File("stores");
  StoreFactory factory=new StoreFactory(fs,storeDir,pageCache,NullLogProvider.getInstance(),new Monitors());
  NeoStore neoStore=factory.newNeoStore(true);
  S store=initialiseStore(neoStore);
  CommonAbstractStore commonAbstractStore=(CommonAbstractStore)store;
  commonAbstractStore.rebuildIdGenerator();
  return neoStore;
}
