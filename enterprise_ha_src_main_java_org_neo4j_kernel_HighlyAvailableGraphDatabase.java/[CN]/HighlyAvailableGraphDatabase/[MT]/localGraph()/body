{
  AbstractGraphDatabase result=internalGraphDatabase;
  if (result != null)   return result;
  long endTime=System.currentTimeMillis() + SECONDS.toMillis(localGraphWait);
  while (result == null && System.currentTimeMillis() < endTime) {
    sleepWithoutInterruption(1,"Failed waiting for local graph to be available");
    result=internalGraphDatabase;
  }
  if (result != null)   return result;
  if (causeOfShutdown != null) {
    throw new RuntimeException("Graph database not started",causeOfShutdown);
  }
 else {
    throw new RuntimeException("Graph database not assigned and no cause of shutdown, " + "maybe not started yet or in the middle of master/slave swap?");
  }
}
