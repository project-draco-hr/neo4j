{
  try {
    return localGraph().beginTx();
  }
 catch (  TransactionFailureException e) {
    if (doingNewMaster) {
      throw e;
    }
    internalShutdown();
    newMaster(null,e);
    return localGraph().beginTx();
  }
}
