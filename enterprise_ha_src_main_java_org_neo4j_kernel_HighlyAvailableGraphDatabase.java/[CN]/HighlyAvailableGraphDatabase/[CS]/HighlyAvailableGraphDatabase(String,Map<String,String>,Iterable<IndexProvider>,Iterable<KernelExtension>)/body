{
  this.storeDir=storeDir;
  this.indexProviders=indexProviders;
  this.kernelExtensions=kernelExtensions;
  messageLog=StringLogger.logger(this.storeDir);
  fileSystemAbstraction=new DefaultFileSystemAbstraction();
  config=new EnterpriseConfigurationMigrator(messageLog).migrateConfiguration(config);
  slaveOperations=new LocalDatabaseOperations();
  this.nodeLookup=new HANodeLookup();
  this.relationshipLookups=new HARelationshipLookups();
  config.put(GraphDatabaseSettings.keep_logical_logs.name(),GraphDatabaseSetting.TRUE);
  configuration=new Config(messageLog,fileSystemAbstraction,config,Iterables.iterable(HaSettings.class,OnlineBackupSettings.class));
  this.startupTime=System.currentTimeMillis();
  kernelEventHandlers.add(new TxManagerCheckKernelEventHandler());
  this.slaveUpdateMode=configuration.getEnum(SlaveUpdateMode.class,HaSettings.slave_coordinator_update_mode);
  this.machineId=configuration.getInteger(HaSettings.server_id);
  this.branchedDataPolicy=configuration.getEnum(BranchedDataPolicy.class,HaSettings.branched_data_policy);
  this.localGraphWait=configuration.getInteger(HaSettings.read_timeout);
  storeIdGetter=new StoreIdGetter(){
    @Override public StoreId get(){
      if (storeId == null) {
        throw new IllegalStateException("No store ID");
      }
      return storeId;
    }
  }
;
  this.broker=createBroker();
  this.pullUpdates=false;
  this.clusterClient=createClusterClient();
  start();
}
