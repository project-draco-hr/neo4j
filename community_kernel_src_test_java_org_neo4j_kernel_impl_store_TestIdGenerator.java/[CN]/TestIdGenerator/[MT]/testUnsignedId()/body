{
  try {
    IdGeneratorImpl.createGenerator(fs,idGeneratorFile());
    IdGenerator idGenerator=new IdGeneratorImpl(fs,idGeneratorFile(),1,IdType.PROPERTY_KEY_TOKEN.getMaxValue(),false,0);
    idGenerator.setHighId(IdType.PROPERTY_KEY_TOKEN.getMaxValue() - 1);
    long id=idGenerator.nextId();
    assertEquals(IdType.PROPERTY_KEY_TOKEN.getMaxValue() - 1,id);
    idGenerator.freeId(id);
    try {
      idGenerator.nextId();
      fail("Shouldn't be able to get next ID");
    }
 catch (    StoreFailureException e) {
    }
    closeIdGenerator(idGenerator);
    idGenerator=new IdGeneratorImpl(fs,idGeneratorFile(),1,IdType.PROPERTY_KEY_TOKEN.getMaxValue(),false,0);
    assertEquals(IdType.PROPERTY_KEY_TOKEN.getMaxValue() + 1,idGenerator.getHighId());
    id=idGenerator.nextId();
    assertEquals(IdType.PROPERTY_KEY_TOKEN.getMaxValue() - 1,id);
    try {
      idGenerator.nextId();
    }
 catch (    StoreFailureException e) {
    }
    closeIdGenerator(idGenerator);
  }
  finally {
    File file=idGeneratorFile();
    if (file.exists()) {
      assertTrue(file.delete());
    }
  }
}
