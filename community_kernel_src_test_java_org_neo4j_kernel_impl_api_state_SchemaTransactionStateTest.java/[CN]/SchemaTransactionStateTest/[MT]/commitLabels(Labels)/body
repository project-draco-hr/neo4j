{
  Map<Long,Collection<Long>> allLabels=new HashMap<Long,Collection<Long>>();
  for (  Labels nodeLabels : labels) {
    when(store.getLabelsForNode(nodeLabels.nodeId)).then(asAnswer(Arrays.<Long>asList(nodeLabels.labelIds)));
    for (    long label : nodeLabels.labelIds) {
      when(store.isLabelSetOnNode(label,nodeLabels.nodeId)).thenReturn(true);
      when(store.removeLabelFromNode(label,nodeLabels.nodeId)).thenReturn(true);
      when(store.addLabelToNode(label,nodeLabels.nodeId)).thenReturn(false);
      Collection<Long> nodes=allLabels.get(label);
      if (nodes == null) {
        nodes=new ArrayList<Long>();
        allLabels.put(label,nodes);
      }
      nodes.add(nodeLabels.nodeId);
    }
  }
  for (  Map.Entry<Long,Collection<Long>> entry : allLabels.entrySet()) {
    when(store.getNodesWithLabel(entry.getKey())).then(asAnswer(entry.getValue()));
  }
}
