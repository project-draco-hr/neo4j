{
  if (Settings.osIsWindows()) {
    if (fileName.getName().equals(StoreLocker.STORE_LOCK_FILENAME)) {
      return getLockFileBasedFileLock(fileName.getParentFile());
    }
    return new PlaceboFileLock();
  }
 else   if (fileName.getName().equals(NeoStore.DEFAULT_NAME)) {
    FileLock regular=wrapOrNull(channel.tryLock());
    if (regular == null)     throw new IOException("Unable to lock " + channel);
    FileLock extra=getLockFileBasedFileLock(fileName.getParentFile());
    if (extra == null) {
      regular.release();
      throw new IOException("Unable to lock lock file for " + fileName.getParentFile());
    }
    return new DoubleFileLock(regular,extra);
  }
 else {
    return wrapOrNull(channel.tryLock());
  }
}
