{
  File lockFile=new File(storeDir,"lock");
  if (!lockFile.exists()) {
    if (!lockFile.createNewFile()) {
      throw new IOException("Couldn't create lock file " + lockFile.getAbsolutePath());
    }
  }
  FileChannel fileChannel=new RandomAccessFile(lockFile,"rw").getChannel();
  java.nio.channels.FileLock fileChannelLock=null;
  try {
    fileChannelLock=fileChannel.tryLock();
  }
 catch (  OverlappingFileLockException e) {
  }
  if (fileChannelLock == null) {
    fileChannel.close();
    throw new IOException("Couldn't lock lock file " + lockFile.getAbsolutePath() + " because another process already holds the lock.");
  }
  return new WindowsFileLock(lockFile,fileChannel,fileChannelLock);
}
