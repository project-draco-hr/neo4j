{
  List<HostnamePort> hosts=config.getInitialHosts();
  cluster.addClusterListener(new UnknownJoiningMemberWarning(hosts));
  if (hosts == null || hosts.size() == 0) {
    userLog.info("No cluster hosts specified. Creating cluster %s",config.getClusterName());
    cluster.create(config.getClusterName());
  }
 else {
    URI[] memberURIs=Iterables.toArray(URI.class,Iterables.map(new Function<HostnamePort,URI>(){
      @Override public URI apply(      HostnamePort member){
        return URI.create("cluster://" + resolvePortOnlyHost(member));
      }
    }
,hosts));
    while (true) {
      userLog.info("Attempting to join cluster of %s",hosts.toString());
      Future<ClusterConfiguration> clusterConfig=cluster.join(this.config.getClusterName(),memberURIs);
      if (config.getClusterJoinTimeout() > 0) {
        try {
          userLog.info("Joined cluster: %s",clusterConfig.get(config.getClusterJoinTimeout(),TimeUnit.MILLISECONDS));
          return;
        }
 catch (        InterruptedException e) {
          userLog.warn("Could not join cluster, interrupted. Retrying...");
        }
catch (        ExecutionException e) {
          messagesLog.debug("Could not join cluster " + this.config.getClusterName());
          if (e.getCause() instanceof IllegalStateException) {
            throw ((IllegalStateException)e.getCause());
          }
          if (config.isAllowedToCreateCluster()) {
            userLog.info("Could not join cluster of %s",hosts.toString());
            userLog.info("Creating new cluster with name [%s]...",config.getClusterName());
            cluster.create(config.getClusterName());
            break;
          }
          userLog.warn("Could not join cluster, timed out. Retrying...");
        }
      }
 else {
        try {
          userLog.info("Joined cluster: %s",clusterConfig.get());
          return;
        }
 catch (        InterruptedException e) {
          userLog.warn("Could not join cluster, interrupted. Retrying...");
        }
catch (        ExecutionException e) {
          messagesLog.debug("Could not join cluster " + this.config.getClusterName());
          if (e.getCause() instanceof IllegalStateException) {
            throw ((IllegalStateException)e.getCause());
          }
          if (config.isAllowedToCreateCluster()) {
            userLog.info("Could not join cluster of %s",hosts.toString());
            userLog.info("Creating new cluster with name [%s]...",config.getClusterName());
            cluster.create(config.getClusterName());
            break;
          }
          userLog.warn("Could not join cluster, timed out. Retrying...");
        }
      }
    }
  }
}
