{
  if (!hasMoreRelationshipsToLoad(direction,types)) {
    return Triplet.of(null,Collections.<RelationshipImpl>emptyList(),relChainPosition);
  }
  Triplet<ArrayMap<Integer,RelIdArray>,List<RelationshipImpl>,RelationshipLoadingPosition> rels=loadMoreRelationships(nodeManager,direction,types,loader);
  ArrayMap<Integer,RelIdArray> addMap=rels.first();
  if (addMap.size() == 0) {
    return rels;
  }
  for (  Integer type : addMap.keySet()) {
    RelIdArray addRels=addMap.get(type);
    RelIdArray srcRels=tmpRelMap.get(type);
    if (srcRels == null) {
      tmpRelMap.put(type,addRels);
    }
 else {
      RelIdArray newSrcRels=srcRels.addAll(addRels);
      if (newSrcRels != srcRels) {
        tmpRelMap.put(type,newSrcRels);
      }
    }
  }
  return rels;
}
