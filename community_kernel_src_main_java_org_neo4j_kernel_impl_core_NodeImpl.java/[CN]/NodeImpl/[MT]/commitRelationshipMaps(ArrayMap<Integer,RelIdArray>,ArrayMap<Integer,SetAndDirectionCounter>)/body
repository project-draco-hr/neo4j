{
  if (relationships == null) {
    return;
  }
synchronized (this) {
    if (cowRelationshipAddMap != null) {
      for (      int type : cowRelationshipAddMap.keySet()) {
        RelIdArray add=cowRelationshipAddMap.get(type);
        SetAndDirectionCounter remove=null;
        if (relationshipRemoveMap != null) {
          remove=relationshipRemoveMap.get(type);
        }
        RelIdArray src=getRelIdArray(type);
        putRelIdArray(RelIdArray.from(src,add,remove != null ? remove.set : null));
      }
    }
    if (relationshipRemoveMap != null) {
      for (      int type : relationshipRemoveMap.keySet()) {
        if (cowRelationshipAddMap != null && cowRelationshipAddMap.get(type) != null) {
          continue;
        }
        RelIdArray src=getRelIdArray(type);
        if (src != null) {
          SetAndDirectionCounter remove=relationshipRemoveMap.get(type);
          putRelIdArray(RelIdArray.from(src,null,remove != null ? remove.set : null));
        }
      }
    }
  }
}
