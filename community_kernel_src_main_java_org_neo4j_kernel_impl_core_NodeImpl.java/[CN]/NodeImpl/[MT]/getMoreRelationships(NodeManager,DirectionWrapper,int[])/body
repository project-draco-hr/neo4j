{
  Triplet<ArrayMap<Integer,RelIdArray>,List<RelationshipImpl>,RelationshipLoadingPosition> rels;
  if (!hasMoreRelationshipsToLoad(direction,types)) {
    return LoadStatus.NOTHING;
  }
  boolean more;
synchronized (this) {
    if (!hasMoreRelationshipsToLoad(direction,types)) {
      return LoadStatus.NOTHING;
    }
    rels=loadMoreRelationshipsFromNodeManager(nodeManager,direction,types);
    ArrayMap<Integer,RelIdArray> addMap=rels.first();
    if (addMap.size() == 0) {
      return LoadStatus.NOTHING;
    }
    for (    int type : addMap.keySet()) {
      RelIdArray addRels=addMap.get(type);
      RelIdArray srcRels=getRelIdArray(type);
      if (srcRels == null) {
        putRelIdArray(addRels);
      }
 else {
        RelIdArray newSrcRels=srcRels.addAll(addRels);
        if (newSrcRels != srcRels) {
          putRelIdArray(newSrcRels);
        }
      }
    }
    relChainPosition=rels.third();
    moreRelationshipsLoaded();
    more=hasMoreRelationshipsToLoad(direction,types);
    updateSize(nodeManager);
  }
  nodeManager.putAllInRelCache(rels.second());
  return more ? LoadStatus.LOADED_MORE : LoadStatus.LOADED_END;
}
