{
  ensureRelationshipMapNotNull(nodeManager);
  boolean hasMore=hasMoreRelationshipsToLoad();
  RelIdIterator[] result=new RelIdIterator[types.length];
  TransactionState tx=nodeManager.getTransactionState();
  ArrayMap<Integer,RelIdArray> addMap=null;
  ArrayMap<Integer,Collection<Long>> skipMap=null;
  if (tx.hasChanges()) {
    addMap=tx.getCowRelationshipAddMap(this);
    skipMap=tx.getCowRelationshipRemoveMap(this);
  }
  int actualLength=0;
  for (int i=0; i < types.length; i++) {
    int typeId;
    try {
      typeId=nodeManager.getRelationshipTypeIdFor(types[i]);
    }
 catch (    KeyNotFoundException e) {
      continue;
    }
    result[actualLength++]=getRelationshipsIterator(nodeManager,direction,addMap != null ? addMap.get(typeId) : null,skipMap != null ? skipMap.get(typeId) : null,typeId);
  }
  if (actualLength < result.length) {
    RelIdIterator[] compacted=new RelIdIterator[actualLength];
    arraycopy(result,0,compacted,0,actualLength);
    result=compacted;
  }
  if (result.length == 0) {
    return Collections.emptyList();
  }
  return new RelationshipIterator(result,this,direction,nodeManager,hasMore,false);
}
