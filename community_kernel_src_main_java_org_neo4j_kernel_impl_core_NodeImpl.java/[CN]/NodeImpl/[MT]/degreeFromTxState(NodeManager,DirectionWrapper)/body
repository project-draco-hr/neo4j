{
  int count=0;
  TransactionState transactionState=nm.getTransactionState();
  ArrayMap<Integer,RelIdArray> add=transactionState.getCowRelationshipAddMap(this);
  if (add != null) {
    for (    RelIdArray addedIds : add.values()) {
      count+=addedIds.length(direction);
    }
  }
  ArrayMap<Integer,SetAndDirectionCounter> remove=transactionState.getCowRelationshipRemoveMap(this);
  if (remove != null) {
    for (    SetAndDirectionCounter removedIds : remove.values()) {
      count-=removedIds.getCount(direction.direction());
    }
  }
  return count;
}
