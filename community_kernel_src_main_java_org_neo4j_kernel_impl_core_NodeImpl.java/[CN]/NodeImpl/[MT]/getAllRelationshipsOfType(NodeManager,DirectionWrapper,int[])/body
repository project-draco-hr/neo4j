{
  ensureRelationshipMapNotNull(nodeManager,direction,types);
  boolean hasMore=hasMoreRelationshipsToLoad(direction,types);
  RelIdIterator[] result=new RelIdIterator[types.length];
  int actualLength=0;
  for (  int typeId : types) {
    if (typeId == TokenHolder.NO_ID || typeIn(typeId,actualLength,result)) {
      continue;
    }
    result[actualLength++]=getRelationshipsIterator(direction,typeId);
  }
  if (actualLength < result.length) {
    RelIdIterator[] compacted=new RelIdIterator[actualLength];
    arraycopy(result,0,compacted,0,actualLength);
    result=compacted;
  }
  if (result.length == 0) {
    return emptyPrimitiveLongIterator();
  }
  return new RelationshipIterator(result,this,direction,types,nodeManager,hasMore,false);
}
