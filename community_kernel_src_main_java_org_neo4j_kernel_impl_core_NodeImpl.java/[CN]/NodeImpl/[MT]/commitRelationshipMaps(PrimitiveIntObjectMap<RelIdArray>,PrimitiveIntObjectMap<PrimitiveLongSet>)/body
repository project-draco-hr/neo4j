{
  if (relationships == null) {
    return;
  }
synchronized (this) {
    if (cowRelationshipAddMap != null) {
      PrimitiveIntIterator typeIterator=cowRelationshipAddMap.iterator();
      while (typeIterator.hasNext()) {
        int type=typeIterator.next();
        RelIdArray add=cowRelationshipAddMap.get(type);
        PrimitiveLongSet remove=null;
        if (removeMap != null) {
          remove=removeMap.get(type);
        }
        RelIdArray src=getRelIdArray(type);
        putRelIdArray(RelIdArray.from(src,add,remove));
      }
    }
    if (removeMap != null) {
      PrimitiveIntIterator typeIterator=removeMap.iterator();
      while (typeIterator.hasNext()) {
        int type=typeIterator.next();
        if (cowRelationshipAddMap != null && cowRelationshipAddMap.get(type) != null) {
          continue;
        }
        RelIdArray src=getRelIdArray(type);
        if (src != null) {
          PrimitiveLongSet remove=removeMap.get(type);
          putRelIdArray(RelIdArray.from(src,null,remove));
        }
      }
    }
  }
}
