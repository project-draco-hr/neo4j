{
  int count=0;
  TransactionState transactionState=nm.getTransactionState();
  ArrayMap<Integer,RelIdArray> add=transactionState.getCowRelationshipAddMap(this);
  if (add != null) {
    RelIdArray added=add.get(type);
    if (added != null) {
      count+=added.length(direction);
    }
  }
  ArrayMap<Integer,SetAndDirectionCounter> remove=transactionState.getCowRelationshipRemoveMap(this);
  if (remove != null) {
    SetAndDirectionCounter removed=remove.get(type);
    if (removed != null) {
      count-=removed.getCount(direction.direction());
    }
  }
  return count;
}
