{
  DirectionWrapper dir=DirectionedRelIdArray.wrap(direction);
  ensureRelationshipMapNotNull(nodeManager);
  List<RelTypeElementIterator> relTypeList=new LinkedList<RelTypeElementIterator>();
  boolean hasModifications=nodeManager.getLockReleaser().hasRelationshipModifications(this);
  ArrayMap<String,DirectionedRelIdArray> addMap=null;
  if (hasModifications) {
    addMap=nodeManager.getCowRelationshipAddMap(this);
  }
  for (  String type : relationshipMap.keySet()) {
    DirectionedRelIdArray src=relationshipMap.get(type);
    RelIdArray remove=null;
    DirectionedRelIdArray add=null;
    if (hasModifications) {
      remove=nodeManager.getCowRelationshipRemoveMap(this,type);
      if (addMap != null) {
        add=addMap.get(type);
      }
    }
    relTypeList.add(RelTypeElement.create(type,this,src != null ? dir.get(src) : null,add != null ? dir.get(add) : null,remove));
  }
  if (addMap != null) {
    for (    String type : addMap.keySet()) {
      if (relationshipMap.get(type) == null) {
        RelIdArray remove=nodeManager.getCowRelationshipRemoveMap(this,type);
        DirectionedRelIdArray add=addMap.get(type);
        relTypeList.add(RelTypeElement.create(type,this,null,add != null ? dir.get(add) : null,remove));
      }
    }
  }
  return relTypeList;
}
