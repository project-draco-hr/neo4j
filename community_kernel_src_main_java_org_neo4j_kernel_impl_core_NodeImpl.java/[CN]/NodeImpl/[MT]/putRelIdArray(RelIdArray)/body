{
  String expectedType=addRels.getType();
  RelIdArray[] safeRelationships=relationships;
  boolean stay=true;
  while (stay) {
    stay=false;
    for (int i=0; i < safeRelationships.length; i++) {
      if (safeRelationships[i].getType().equals(expectedType)) {
        if (relationships == safeRelationships) {
          safeRelationships[i]=addRels;
          return;
        }
        stay=true;
        safeRelationships=relationships;
        break;
      }
    }
  }
  while (true) {
    RelIdArray[] newArray=new RelIdArray[safeRelationships.length + 1];
    System.arraycopy(safeRelationships,0,newArray,0,safeRelationships.length);
    newArray[safeRelationships.length]=addRels;
    if (relationships == safeRelationships) {
      relationships=newArray;
      break;
    }
    safeRelationships=relationships;
  }
}
