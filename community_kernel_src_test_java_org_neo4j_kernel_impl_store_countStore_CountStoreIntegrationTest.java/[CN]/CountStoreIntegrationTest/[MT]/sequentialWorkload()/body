{
  int numberOfUpdates=1000;
  Snapshot snapshot;
  Map<CountsKey,long[]> snapshotMap;
  Map<CountsKey,long[]> map=new HashMap<>();
  Map<CountsKey,long[]> updateMap=new HashMap<>();
  IntermediateStateTestManager intermediateStateTestManager=new IntermediateStateTestManager(numberOfUpdates);
  CountStore countStore=new CountStore();
  for (int i=0; i < numberOfUpdates; i++) {
    long txId=intermediateStateTestManager.getNextUpdateMap(updateMap);
    DiffMapValuesTest.updateMapByDiff(map,updateMap,txId);
    countStore.updateAll(txId,updateMap);
    snapshot=countStore.snapshot(txId);
    snapshotMap=snapshot.getMap();
    compareMaps(map,snapshotMap);
  }
}
