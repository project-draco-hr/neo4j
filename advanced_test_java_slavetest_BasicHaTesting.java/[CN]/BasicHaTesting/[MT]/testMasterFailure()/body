{
  initializeDbs(1);
  GraphDatabaseService haDb=haDbs.get(0);
  Transaction tx=haDb.beginTx();
  Node node1;
  try {
    node1=haDb.createNode();
    Relationship rel1=haDb.getReferenceNode().createRelationshipTo(node1,REL_TYPE);
    node1.setProperty("name","Mattias");
    rel1.setProperty("something else","Somewhat different");
    tx.success();
  }
  finally {
    master.getGraphDb().shutdown();
    try {
      tx.finish();
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
  }
  master=new MasterImpl(new EmbeddedGraphDatabase(MASTER_PATH.getAbsolutePath()));
  try {
    haDb.getNodeById(node1.getId());
    fail("Node should not exist");
  }
 catch (  NotFoundException e) {
  }
}
