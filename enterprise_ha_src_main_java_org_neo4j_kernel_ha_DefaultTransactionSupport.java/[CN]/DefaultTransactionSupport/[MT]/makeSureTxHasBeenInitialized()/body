{
  try {
    Transaction tx=txManager.getTransaction();
    int eventIdentifier=txManager.getEventIdentifier();
    if (!hasAnyLocks(tx)) {
      if (!switchBlock.await(stateSwitchTimeout)) {
        throw new RuntimeException("Timed out waiting for database to switch state");
      }
      txHook.initializeTransaction(eventIdentifier);
    }
  }
 catch (  SystemException e) {
    throw new RuntimeException(e);
  }
}
