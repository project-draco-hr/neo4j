{
  LegacyStore legacyStore=new LegacyStore(new File(new File(legacyStoreDirectory),NeoStore.DEFAULT_NAME).getPath());
  HashMap config=new HashMap();
  config.put(IdGeneratorFactory.class,CommonFactories.defaultIdGeneratorFactory());
  config.put(FileSystemAbstraction.class,CommonFactories.defaultFileSystemAbstraction());
  File targetStoreDirectoryFile=new File(targetStoreDirectory);
  if (targetStoreDirectoryFile.exists()) {
    throw new IllegalStateException("Cannot migrate to a directory that already exists, please delete first and re-run");
  }
  boolean success=targetStoreDirectoryFile.mkdirs();
  if (!success) {
    throw new IllegalStateException("Failed to create directory");
  }
  File targetStoreFile=new File(targetStoreDirectory,NeoStore.DEFAULT_NAME);
  config.put("neo_store",targetStoreFile.getPath());
  NeoStore.createStore(targetStoreFile.getPath(),config);
  NeoStore neoStore=new NeoStore(config);
  long startTime=System.currentTimeMillis();
  new StoreMigrator(new SilentMigrationProgressMonitor()).migrate(legacyStore,neoStore);
  long duration=System.currentTimeMillis() - startTime;
  System.out.printf("Migration completed in %d s%n",duration / 1000);
  neoStore.close();
  EmbeddedGraphDatabase database=new EmbeddedGraphDatabase(targetStoreDirectoryFile.getPath());
  database.shutdown();
}
