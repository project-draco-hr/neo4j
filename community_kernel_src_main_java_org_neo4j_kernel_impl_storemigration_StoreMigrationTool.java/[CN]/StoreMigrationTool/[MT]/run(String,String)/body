{
  LegacyStore legacyStore=new LegacyStore(new File(new File(legacyStoreDirectory),NeoStore.DEFAULT_NAME).getPath());
  Map<String,String> config=new HashMap<String,String>();
  File targetStoreDirectoryFile=new File(targetStoreDirectory);
  if (targetStoreDirectoryFile.exists()) {
    throw new IllegalStateException("Cannot migrate to a directory that already exists, please delete first and re-run");
  }
  boolean success=targetStoreDirectoryFile.mkdirs();
  if (!success) {
    throw new IllegalStateException("Failed to create directory");
  }
  File targetStoreFile=new File(targetStoreDirectory,NeoStore.DEFAULT_NAME);
  config.put("neo_store",targetStoreFile.getPath());
  NeoStore neoStore=new StoreFactory(config,CommonFactories.defaultIdGeneratorFactory(),CommonFactories.defaultFileSystemAbstraction(),null,StringLogger.SYSTEM,null).createNeoStore(targetStoreFile.getPath());
  long startTime=System.currentTimeMillis();
  new StoreMigrator(new VisibleMigrationProgressMonitor(System.out)).migrate(legacyStore,neoStore);
  long duration=System.currentTimeMillis() - startTime;
  System.out.printf("Migration completed in %d s%n",duration / 1000);
  neoStore.close();
  EmbeddedGraphDatabase database=new EmbeddedGraphDatabase(targetStoreDirectoryFile.getPath());
  database.shutdown();
}
