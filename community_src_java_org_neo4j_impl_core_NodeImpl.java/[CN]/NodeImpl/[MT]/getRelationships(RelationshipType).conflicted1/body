{
  ensureFullRelationships();
  ArrayIntSet relIds=new ArrayIntSet();
  for (  RelationshipType type : types) {
    ArrayIntSet source=relationshipMap.get(type.name());
    if (source == null) {
      continue;
    }
    for (    int relId : source.values()) {
      ArrayIntSet skip=nodeManager.getCowRelationshipRemoveMap(this,type.name());
      if (skip != null && skip.contains(relId)) {
        continue;
      }
      relIds.add(relId);
    }
  }
  for (  RelationshipType type : types) {
    ArrayIntSet source=nodeManager.getCowRelationshipAddMap(this,type.name());
    if (source == null) {
      continue;
    }
    for (    int relId : source.values()) {
      relIds.add(relId);
    }
  }
  return new RelationshipArrayIntSetIterator(relIds,this,Direction.BOTH,nodeManager);
}
