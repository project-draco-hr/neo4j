{
  if (dir == Direction.BOTH) {
    return getRelationships(type);
  }
  ArrayMap<String,ArrayIntSet> mapToCheck=null;
  if (cowRelationshipMap != null && cowTxId == nodeManager.getTransactionId()) {
    mapToCheck=cowRelationshipMap;
  }
 else {
    ensureFullRelationships();
    mapToCheck=relationshipMap;
  }
  ArrayIntSet relationshipSet=mapToCheck.get(type.name());
  if (relationshipSet == null) {
    return Collections.emptyList();
  }
  int[] ids=new int[relationshipSet.size()];
  int position=0;
  for (  int relId : relationshipSet.values()) {
    ids[position++]=relId;
  }
  return new RelationshipIterator(ids,this,dir,nodeManager);
}
