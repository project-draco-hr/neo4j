{
  if (dir == Direction.BOTH) {
    return getRelationships(type);
  }
  acquireLock(this,LockType.READ);
  try {
    ensureFullRelationships();
    if (relationshipMap == null) {
      return Collections.emptyList();
    }
    ArrayIntSet relationshipSet=relationshipMap.get(type.name());
    if (relationshipSet == null) {
      return Collections.emptyList();
    }
    int[] ids=new int[relationshipSet.size()];
    int position=0;
    for (    int relId : relationshipSet.values()) {
      ids[position++]=relId;
    }
    return new RelationshipIterator(ids,this,dir);
  }
  finally {
    releaseLock(this,LockType.READ);
  }
}
