{
  initializeDbs(2);
  GraphDatabaseService slave1=haDbs.get(0);
  GraphDatabaseService slave2=haDbs.get(1);
  Transaction tx=master.getGraphDb().beginTx();
  try {
    Node node1=master.getGraphDb().createNode();
    master.getGraphDb().getReferenceNode().createRelationshipTo(node1,REL_TYPE);
    Node node2=master.getGraphDb().createNode();
    node1.createRelationshipTo(node2,REL_TYPE);
    tx.success();
  }
  finally {
    tx.finish();
  }
  pullUpdates();
  Node slave1Node1=slave1.getReferenceNode().getSingleRelationship(REL_TYPE,Direction.OUTGOING).getEndNode();
  Node slave1Node2=slave1Node1.getSingleRelationship(REL_TYPE,Direction.OUTGOING).getEndNode();
  Node slave2Node1=slave2.getReferenceNode().getSingleRelationship(REL_TYPE,Direction.OUTGOING).getEndNode();
  Node slave2Node2=slave2Node1.getSingleRelationship(REL_TYPE,Direction.OUTGOING).getEndNode();
  Queue<String> results=new LinkedList<String>();
  WaitingWorker worker1=new WaitingWorker("1",slave1,results);
  WaitingWorker worker2=new WaitingWorker("2",slave2,results);
  worker1.add(new SetPropertyJob(slave1Node2),true);
  worker2.add(new DeleteNodeAndRelsJob(slave2Node2),true);
  worker2.add(new RestartTxJob(false),true);
  worker1.add(new RestartTxJob(true),true);
  worker2.halt();
  worker1.halt();
  Thread.sleep(1000);
  System.out.println(results);
  pullUpdates();
}
