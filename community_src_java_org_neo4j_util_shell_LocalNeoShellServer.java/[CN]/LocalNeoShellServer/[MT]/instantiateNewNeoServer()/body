{
  String neoServiceClassName="org.neo4j.api.core.NeoService";
  String neoClassName=this.readOnly ? "org.neo4j.api.core.EmbeddedReadOnlyNeo" : "org.neo4j.api.core.EmbeddedNeo";
  String neoShellServerClassName="org.neo4j.impl.shell.NeoShellServer";
  try {
    Class<?> neoClass=Class.forName(neoClassName);
    Class<?> neoServiceClass=Class.forName(neoServiceClassName);
    Class<?> neoShellServerClass=Class.forName(neoShellServerClassName);
    if (this.neoServiceInstance == null) {
      this.neoServiceInstance=neoClass.getConstructor(String.class).newInstance(this.neoDirectory);
    }
    Object neoShellServerObject=neoShellServerClass.getConstructor(neoServiceClass).newInstance(neoServiceInstance);
    return (SimpleAppServer)neoShellServerObject;
  }
 catch (  Exception e) {
    throw new ShellException(e);
  }
}
