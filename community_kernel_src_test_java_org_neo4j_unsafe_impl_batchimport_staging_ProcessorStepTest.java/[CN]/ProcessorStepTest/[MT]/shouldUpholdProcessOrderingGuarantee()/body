{
  StageControl control=mock(StageControl.class);
  MyProcessorStep step=new MyProcessorStep(control,0);
  step.start(ORDER_SEND_DOWNSTREAM);
  step.processors(4);
  int batches=10;
  for (int i=0; i < batches; i++) {
    step.receive(i,i);
  }
  step.endOfUpstream();
  while (!step.isCompleted()) {
    verifyNoMoreInteractions(control);
  }
  assertEquals(batches,step.nextExpected.get());
  step.close();
}
