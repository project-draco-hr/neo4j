{
  String path="target/hcdb";
  Neo4jTestCase.deleteFileOrDirectory(new File(path));
  Process process=Runtime.getRuntime().exec(new String[]{"java","-cp",System.getProperty("java.class.path"),Inserter.class.getName(),path});
  Thread.sleep(6000);
  process.destroy();
  process.waitFor();
  GraphDatabaseService db=new EmbeddedGraphDatabase(path);
  assertTrue(db.index().existsForNodes("myIndex"));
  Index<Node> index=db.index().forNodes("myIndex");
  for (  Node node : GlobalGraphOperations.at(db).getAllNodes()) {
    for (    String key : node.getPropertyKeys()) {
      String value=(String)node.getProperty(key);
      boolean found=false;
      for (      Node indexedNode : index.get(key,value)) {
        if (indexedNode.equals(node)) {
          found=true;
          break;
        }
      }
      if (!found) {
        throw new IllegalStateException(node + " has property '" + key+ "'='"+ value+ "', but not in index");
      }
    }
  }
  db.shutdown();
}
