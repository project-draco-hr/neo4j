{
  createContainer();
  ServiceProviderActivator serviceProvider=new ServiceProviderActivator();
  serviceProvider.produceJar(container.getBundleDirectory(),"service-impl.jar");
  String expectedBundleSymbolicName=serviceProvider.getBundleSymbolicName();
  container.start();
  Bundle serviceProviderBundle=container.getBundles()[1];
  assertNotNull(serviceProviderBundle);
  assertThat(serviceProviderBundle.getState(),is(Bundle.ACTIVE));
  assertThat((String)serviceProviderBundle.getHeaders().get(Constants.BUNDLE_SYMBOLICNAME),is(expectedBundleSymbolicName));
  BundleContext bundleContext=serviceProviderBundle.getBundleContext();
  ServiceReference[] registeredServices=bundleContext.getServiceReferences(ExampleBundleService.class.getName(),null);
  ExampleBundleService service=(ExampleBundleService)bundleContext.getService(registeredServices[0]);
  assertThat(service,is(notNullValue()));
}
