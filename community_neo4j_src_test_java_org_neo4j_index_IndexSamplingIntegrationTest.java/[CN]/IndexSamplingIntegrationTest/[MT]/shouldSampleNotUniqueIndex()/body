{
  GraphDatabaseService db=null;
  try {
    db=new TestGraphDatabaseFactory().newEmbeddedDatabase(testDirectory.graphDbDir());
    IndexDefinition indexDefinition;
    try (Transaction tx=db.beginTx()){
      indexDefinition=db.schema().indexFor(label).on(property).create();
      tx.success();
    }
     try (Transaction tx=db.beginTx()){
      db.schema().awaitIndexOnline(indexDefinition,10,TimeUnit.SECONDS);
      tx.success();
    }
     try (Transaction tx=db.beginTx()){
      for (int i=0; i < nodes; i++) {
        db.createNode(label).setProperty(property,names[i % names.length]);
        tx.success();
      }
    }
   }
  finally {
    if (db != null) {
      db.shutdown();
    }
  }
  triggerIndexResamplingOnNextStartup();
  DoubleLongRegister register=fetchIndexSamplingValues(db);
  assertEquals(names.length,register.readFirst());
  assertEquals(nodes,register.readSecond());
}
