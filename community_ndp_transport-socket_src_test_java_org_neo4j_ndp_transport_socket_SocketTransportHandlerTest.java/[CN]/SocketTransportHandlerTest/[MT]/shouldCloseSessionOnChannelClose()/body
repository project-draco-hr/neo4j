{
  Session session=mock(Session.class);
  ChannelHandlerContext ctx=mock(ChannelHandlerContext.class);
  when(ctx.alloc()).thenReturn(UnpooledByteBufAllocator.DEFAULT);
  SocketTransportHandler handler=new SocketTransportHandler(protocolChooser(session));
  handler.channelRead(ctx,handshake());
  handler.channelInactive(ctx);
  verify(session).close();
}
