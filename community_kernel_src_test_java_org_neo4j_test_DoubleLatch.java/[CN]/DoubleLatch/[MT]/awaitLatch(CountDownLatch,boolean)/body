{
  long now=System.currentTimeMillis();
  long deadline=now + FIVE_MINUTES;
  while (now < deadline) {
    try {
      long waitingTime=Math.min(Math.max(0,deadline - now),1000L);
      latch.await(waitingTime,TimeUnit.MILLISECONDS);
      Thread.yield();
      return;
    }
 catch (    InterruptedException e) {
      Thread.interrupted();
      if (!uninterruptedWaiting) {
        throw new RuntimeException("Thread interrupted while waiting on latch",e);
      }
    }
    now=System.currentTimeMillis();
  }
  throw new AssertionError("Latch specified waiting time elapsed.");
}
