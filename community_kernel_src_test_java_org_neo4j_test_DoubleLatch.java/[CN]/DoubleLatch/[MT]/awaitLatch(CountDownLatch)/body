{
  long deadline=System.currentTimeMillis() + FIVE_MINUTES;
  long remaining;
  while ((remaining=deadline - System.currentTimeMillis()) >= 0) {
    try {
      latch.await(remaining,TimeUnit.MILLISECONDS);
      return;
    }
 catch (    InterruptedException e) {
      Thread.interrupted();
      new RuntimeException("Thread interrupted while waiting on latch",e).printStackTrace();
    }
    Thread.yield();
  }
  throw new RuntimeException("Failed to acquire latch");
}
