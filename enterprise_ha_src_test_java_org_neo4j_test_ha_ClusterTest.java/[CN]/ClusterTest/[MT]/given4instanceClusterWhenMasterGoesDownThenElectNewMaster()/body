{
  ClusterManager clusterManager=new ClusterManager(ClusterManager.clusterOfSize(4),TargetDirectory.forTest(getClass()).cleanDirectory("4instances"),MapUtil.stringMap());
  try {
    clusterManager.start();
    ClusterManager.ManagedCluster cluster=clusterManager.getDefaultCluster();
    cluster.await(allSeesAllAsAvailable());
    logging.getLogger().info("STOPPING MASTER");
    cluster.shutdown(cluster.getMaster());
    logging.getLogger().info("STOPPED MASTER");
    cluster.await(ClusterManager.masterAvailable());
    GraphDatabaseService master=cluster.getMaster();
    logging.getLogger().info("CREATE NODE");
    Transaction tx=master.beginTx();
    master.createNode();
    logging.getLogger().info("CREATED NODE");
    tx.success();
    tx.finish();
    logging.getLogger().info("STOPPING CLUSTER");
  }
  finally {
    clusterManager.safeShutdown();
  }
}
