{
  String hostName=InetAddress.getLocalHost().getHostName();
  ClusterManager clusterManager=new ClusterManager(ClusterManager.clusterOfSize(hostName,3),TargetDirectory.forTest(getClass()).cleanDirectory("testCluster"),MapUtil.stringMap(HaSettings.tx_push_factor.name(),"2"));
  try {
    clusterManager.start();
    clusterManager.getDefaultCluster().await(allSeesAllAsAvailable());
    GraphDatabaseAPI master=clusterManager.getDefaultCluster().getMaster();
    Transaction tx=master.beginTx();
    Node node=master.createNode();
    long nodeId=node.getId();
    node.setProperty("foo","bar");
    tx.success();
    tx.finish();
    HighlyAvailableGraphDatabase anySlave=clusterManager.getDefaultCluster().getAnySlave();
    try (Transaction ignore=anySlave.beginTx()){
      node=anySlave.getNodeById(nodeId);
      assertThat(node.getProperty("foo").toString(),CoreMatchers.equalTo("bar"));
    }
   }
  finally {
    clusterManager.safeShutdown();
  }
}
