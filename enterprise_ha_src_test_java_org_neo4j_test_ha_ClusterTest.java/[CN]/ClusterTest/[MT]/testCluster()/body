{
  ClusterManager clusterManager=new ClusterManager(fromXml(getClass().getResource("/threeinstances.xml").toURI()),testDirectory.directory("testCluster"),MapUtil.<String,String>map().entry(HaSettings.ha_server.name(),"localhost:6001-6005").entry(HaSettings.tx_push_factor.name(),"2").create());
  try {
    clusterManager.start();
    clusterManager.getDefaultCluster().await(allSeesAllAsAvailable());
    long nodeId;
    HighlyAvailableGraphDatabase master=clusterManager.getDefaultCluster().getMaster();
    try (Transaction tx=master.beginTx()){
      Node node=master.createNode();
      nodeId=node.getId();
      node.setProperty("foo","bar");
      tx.success();
    }
     HighlyAvailableGraphDatabase slave=clusterManager.getDefaultCluster().getAnySlave();
    try (Transaction transaction=slave.beginTx()){
      Node node=slave.getNodeById(nodeId);
      assertThat(node.getProperty("foo").toString(),CoreMatchers.equalTo("bar"));
    }
   }
  finally {
    clusterManager.stop();
  }
}
