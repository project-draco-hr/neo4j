{
  delegate.visitRelationshipCommand(command);
  cacheAccess.removeRelationshipFromCache(command.getKey());
  RelationshipRecord record=command.getRecord();
  RelationshipRecord before=null;
  if (!record.inUse()) {
    before=relationshipStore.forceGetRaw(record.getId());
  }
  if (!record.inUse()) {
    if (before != null) {
      cacheAccess.removeNodeFromCache(before.getFirstNode());
      cacheAccess.removeNodeFromCache(before.getSecondNode());
    }
 else {
      cacheAccess.removeNodeFromCache(record.getFirstNode());
      cacheAccess.removeNodeFromCache(record.getSecondNode());
    }
  }
  return true;
}
