{
  PrimitiveLongIterator relationships=relationshipsGetAll(state);
  while (relationships.hasNext()) {
    long relationshipId=relationships.next();
    try (Cursor<RelationshipItem> relationship=relationshipCursor(state,relationshipId)){
      if (relationship.next()) {
        if (relationship.get().type() == relTypeId && !relationship.get().hasProperty(propertyKeyId)) {
          RelationshipPropertyExistenceConstraint constraint=new RelationshipPropertyExistenceConstraint(relTypeId,propertyKeyId);
          throw new CreateConstraintFailureException(constraint,new RelationshipPropertyExistenceConstraintVerificationFailedKernelException(constraint,relationshipId));
        }
      }
    }
   }
  return schemaWriteOperations.relationshipPropertyExistenceConstraintCreate(state,relTypeId,propertyKeyId);
}
