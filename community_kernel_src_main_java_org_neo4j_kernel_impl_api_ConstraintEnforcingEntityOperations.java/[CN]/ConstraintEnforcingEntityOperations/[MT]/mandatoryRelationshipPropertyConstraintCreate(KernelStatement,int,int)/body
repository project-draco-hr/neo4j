{
  PrimitiveLongIterator relationships=relationshipsGetAll(state);
  while (relationships.hasNext()) {
    long relationshipId=relationships.next();
    try (Cursor<RelationshipItem> relationship=relationshipCursor(state,relationshipId)){
      if (relationship.next()) {
        if (relationship.get().type() == relTypeId && !relationship.get().hasProperty(propertyKeyId)) {
          MandatoryRelationshipPropertyConstraint constraint=new MandatoryRelationshipPropertyConstraint(relTypeId,propertyKeyId);
          throw new CreateConstraintFailureException(constraint,new MandatoryRelationshipPropertyConstraintVerificationFailedKernelException(constraint,relationshipId));
        }
      }
    }
   }
  return schemaWriteOperations.mandatoryRelationshipPropertyConstraintCreate(state,relTypeId,propertyKeyId);
}
