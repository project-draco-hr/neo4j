{
  if (retries > 20) {
    close();
  }
  connection.write();
  if (!buffer.hasRemaining()) {
    buffer.clear();
    try {
      if (logToSend.read(buffer) <= 0) {
        releaseWriteBuffer();
        setNoRequeue();
        return true;
      }
      buffer.flip();
    }
 catch (    IOException e) {
      log("Error reading log",e);
      close();
      return true;
    }
  }
  retries++;
  return false;
}
