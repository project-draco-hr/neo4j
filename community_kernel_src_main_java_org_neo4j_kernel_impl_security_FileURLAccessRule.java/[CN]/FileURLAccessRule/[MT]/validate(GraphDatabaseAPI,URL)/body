{
  if (!(url.getAuthority() == null || url.getAuthority().equals(""))) {
    throw new URLAccessValidationError("file URL may not contain an authority section (i.e. it should be 'file:///')");
  }
  if (!(url.getQuery() == null || url.getQuery().equals(""))) {
    throw new URLAccessValidationError("file URL may not contain a query component");
  }
  final Config config=gdb.getDependencyResolver().resolveDependency(Config.class);
  if (!config.get(GraphDatabaseSettings.allow_file_urls)) {
    throw new URLAccessValidationError("configuration property '" + GraphDatabaseSettings.allow_file_urls.name() + "' is false");
  }
  final File root=config.get(GraphDatabaseSettings.load_csv_file_url_root);
  if (root == null) {
    return url;
  }
  try {
    final Path urlPath=Paths.get(url.toURI());
    return root.getAbsoluteFile().toPath().resolve(urlPath.getRoot().relativize(urlPath)).toUri().toURL();
  }
 catch (  MalformedURLException|URISyntaxException e) {
    throw new RuntimeException(e);
  }
}
