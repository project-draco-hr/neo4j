{
  if (protocol.isExpecting(CatchupServerProtocol.State.MESSAGE_TYPE)) {
    ByteBuf buffer=(ByteBuf)msg;
    byte version=buffer.readByte();
    byte messageType=buffer.readByte();
    RequestMessageType requestMessageType=RequestMessageType.from(version,messageType);
    if (requestMessageType.equals(RequestMessageType.TX_PULL_REQUEST)) {
      protocol.expect(CatchupServerProtocol.State.TX_PULL);
    }
 else     if (requestMessageType.equals(RequestMessageType.STORE)) {
      protocol.expect(CatchupServerProtocol.State.GET_STORE);
    }
 else     if (requestMessageType.equals(RequestMessageType.STORE_ID)) {
      protocol.expect(CatchupServerProtocol.State.GET_STORE_ID);
    }
 else     if (requestMessageType.equals(RequestMessageType.RAFT_STATE)) {
      protocol.expect(CatchupServerProtocol.State.GET_RAFT_STATE);
    }
 else {
      log.warn("No handler found for version %d and message type %s",version,requestMessageType);
    }
    ReferenceCountUtil.release(msg);
  }
 else {
    ctx.fireChannelRead(msg);
  }
}
