{
  return new GraphDatabaseFactory(){
    @Override protected GraphDatabaseService newDatabase(    File dir,    Map<String,String> config,    Dependencies dependencies){
      return new CommunityFacadeFactory(){
        @Override protected PlatformModule createPlatform(        File storeDir,        Map<String,String> params,        Dependencies dependencies,        GraphDatabaseFacade facade){
          return new PlatformModule(storeDir,params,databaseInfo(),dependencies,facade){
            @Override protected FileSystemAbstraction createFileSystemAbstraction(){
              return fs;
            }
            @Override protected PageCache createPageCache(            FileSystemAbstraction fileSystem,            Config config,            LogService logging,            Tracers tracers){
              PageCache pageCache=super.createPageCache(fileSystem,config,logging,tracers);
              return new AdversarialPageCache(pageCache,adversary);
            }
          }
;
        }
      }
.newFacade(dir,config,dependencies);
    }
  }
;
}
