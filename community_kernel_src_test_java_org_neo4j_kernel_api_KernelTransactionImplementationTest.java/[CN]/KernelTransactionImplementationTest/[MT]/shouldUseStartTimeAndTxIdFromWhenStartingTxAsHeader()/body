{
  long startingTime=clock.currentTimeMillis();
  when(legacyIndexState.hasChanges()).thenReturn(true);
  when(storageEngine.createCommands(any(TransactionState.class),any(LegacyIndexTransactionState.class),any(Locks.Client.class),anyLong())).thenReturn(sillyCommandList());
  try (KernelTransactionImplementation transaction=newTransaction()){
    transaction.initialize(5L);
    clock.forward(5,MILLISECONDS);
    when(metaDataStore.getLastCommittedTransactionId()).thenReturn(7L);
    transaction.success();
  }
   assertEquals(5L,commitProcess.transaction.getLatestCommittedTxWhenStarted());
  assertEquals(startingTime,commitProcess.transaction.getTimeStarted());
  assertEquals(startingTime + 5,commitProcess.transaction.getTimeCommitted());
}
