{
  AbstractTransactionManager transactionManager=mock(AbstractTransactionManager.class);
  when(transactionManager.getTransactionState()).thenReturn(mock(TransactionState.class));
  doThrow(new TransactionFailureException("asd")).when(transactionManager).commit();
  KernelTransactionImplementation tx=new KernelTransactionImplementation(null,null,false,null,null,null,null,transactionManager,null,null,null,null,null,mock(NeoStore.class));
  try {
    tx.commit();
    fail("expected exception");
  }
 catch (  TransactionFailureException e) {
  }
  tx.rollback();
}
