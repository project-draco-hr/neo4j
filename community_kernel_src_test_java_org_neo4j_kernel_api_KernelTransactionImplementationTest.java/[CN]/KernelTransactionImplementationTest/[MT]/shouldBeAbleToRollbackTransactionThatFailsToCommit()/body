{
  KernelTransactionImplementation tx=new KernelTransactionImplementation(null,null){
    @Override protected void doCommit(){
      throw new TransactionFailureException("marked for rollback only");
    }
    @Override protected void doRollback(){
    }
    @Override protected Statement newStatement(){
      return null;
    }
  }
;
  try {
    tx.commit();
    fail("expected exception");
  }
 catch (  TransactionFailureException e) {
  }
  tx.rollback();
}
