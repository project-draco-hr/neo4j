{
  int id=IdGenerator.getGenerator().nextId(Node.class);
  NodeImpl node=new NodeImpl(id,true);
  acquireLock(node,LockType.WRITE);
  try {
    EventManager em=EventManager.getManager();
    EventData eventData=new EventData(new NodeOpData(node,id));
    if (!em.generateProActiveEvent(Event.NODE_CREATE,eventData)) {
      setRollbackOnly();
      throw new CreateException("Unable to create node, " + "pro-active event failed.");
    }
    addNodeToCache(node);
    em.generateReActiveEvent(Event.NODE_CREATE,eventData);
    return new NodeProxy(id);
  }
  finally {
    releaseLock(node,LockType.WRITE);
  }
}
