{
  if (this.directory == null) {
    return Collections.<Long>emptySet();
  }
  try {
    Sort sorting=contextOrNull != null ? contextOrNull.getSorting() : null;
    boolean prioritizeCorrectness=contextOrNull == null || !contextOrNull.getTradeCorrectnessForSpeed();
    IndexSearcher theSearcher=searcher(prioritizeCorrectness);
    query=includeOrphans(query);
    Hits hits=new Hits(theSearcher,query,null,sorting,prioritizeCorrectness);
    Collection<Long> result=new ArrayList<Long>();
    for (int i=0; i < hits.length(); i++) {
      result.add(Long.valueOf(hits.doc(i).get(KEY_DOC_ID)));
    }
    return result;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
