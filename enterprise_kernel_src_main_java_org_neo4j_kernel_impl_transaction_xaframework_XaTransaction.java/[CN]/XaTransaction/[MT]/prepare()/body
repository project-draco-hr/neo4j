{
  if (committed) {
    throw new XAException("Cannot prepare comitted transaction");
  }
  if (rolledback) {
    throw new XAException("Cannot prepare rolled back transaction");
  }
  prepared=true;
  doPrepare();
}
