{
  try {
    new EmbeddedGraphDatabase(path).shutdown();
    fail("Could start up database in same process, store not locked");
  }
 catch (  RuntimeException ex) {
    assertTrue(IllegalStateException.class.isAssignableFrom(ex.getCause().getCause().getCause().getClass()));
  }
  StartupChecker proc=new LockProcess().start(path);
  try {
    assertFalse("Could start up database in subprocess, store is not locked",proc.startupOk());
  }
  finally {
    SubProcess.stop(proc);
  }
}
