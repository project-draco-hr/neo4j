{
  try {
    new TestGraphDatabaseFactory().newEmbeddedDatabase(path).shutdown();
    fail("Could start up database in same process, store not locked");
  }
 catch (  RuntimeException ex) {
    assertThat(ex.getCause().getCause(),instanceOf(StoreLockException.class));
  }
  StartupChecker proc=new LockProcess().start(path);
  try {
    assertFalse("Could start up database in subprocess, store is not locked",proc.startupOk());
  }
  finally {
    SubProcess.stop(proc);
  }
}
