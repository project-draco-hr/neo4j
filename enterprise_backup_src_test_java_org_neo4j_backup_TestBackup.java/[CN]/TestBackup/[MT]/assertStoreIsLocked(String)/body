{
  try {
    new EmbeddedGraphDatabase(path).shutdown();
    fail("Could start up database in same process, store not locked");
  }
 catch (  RuntimeException ex) {
    assertThat(ex.getCause().getCause().getMessage(),is("Unable to obtain lock on store lock file: target/var/serverdb-lock/store_lock"));
  }
catch (  Exception e) {
    e.printStackTrace();
    fail("crap");
  }
  StartupChecker proc=new LockProcess().start(path);
  try {
    assertFalse("Could start up database in subprocess, store is not locked",proc.startupOk());
  }
  finally {
    SubProcess.stop(proc);
  }
}
