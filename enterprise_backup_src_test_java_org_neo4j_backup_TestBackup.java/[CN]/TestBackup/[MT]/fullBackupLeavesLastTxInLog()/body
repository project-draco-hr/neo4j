{
  GraphDatabaseSPI db=null;
  try {
    File serverDir=TargetDirectory.forTest(getClass()).directory("txinlog-server",true);
    File backupDir=TargetDirectory.forTest(getClass()).directory("txinlog-backup",true);
    createInitialDataSet(serverDir.getAbsolutePath());
    ServerInterface server=startServer(serverDir.getAbsolutePath());
    OnlineBackup backup=OnlineBackup.from("localhost");
    backup.full(backupDir.getAbsolutePath());
    shutdownServer(server);
    db=new EmbeddedGraphDatabase(backupDir.getAbsolutePath());
    for (    XaDataSource ds : db.getXaDataSourceManager().getAllRegisteredDataSources()) {
      long tx=ds.getLastCommittedTxId();
      System.out.println("Last committed tx for " + ds.getName() + " is "+ tx);
      ds.getMasterForCommittedTx(ds.getLastCommittedTxId());
    }
  }
  finally {
    if (db != null) {
      db.shutdown();
    }
  }
}
