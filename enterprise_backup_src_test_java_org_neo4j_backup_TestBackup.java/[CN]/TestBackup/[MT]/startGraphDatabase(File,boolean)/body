{
  GraphDatabaseFactory dbFactory=new TestGraphDatabaseFactory(){
    @Override protected GraphDatabaseService newDatabase(    String path,    Map<String,String> config,    GraphDatabaseFacadeFactory.Dependencies dependencies){
      config.put(GraphDatabaseSettings.store_dir.name(),path);
      return new CommunityFacadeFactory(){
        @Override protected EditionModule createEdition(        PlatformModule platformModule){
          return new CommunityEditionModule(platformModule){
            @Override protected TransactionHeaderInformationFactory createHeaderInformationFactory(){
              return new TransactionHeaderInformationFactory.WithRandomBytes(){
                @Override protected TransactionHeaderInformation createUsing(                byte[] additionalHeader){
                  return new TransactionHeaderInformation(1,2,additionalHeader);
                }
              }
;
            }
          }
;
        }
      }
.newFacade(config,dependencies);
    }
  }
;
  return dbFactory.newEmbeddedDatabaseBuilder(path.getPath()).setConfig(OnlineBackupSettings.online_backup_enabled,String.valueOf(withOnlineBackup)).setConfig(GraphDatabaseSettings.keep_logical_logs,Settings.TRUE).newGraphDatabase();
}
