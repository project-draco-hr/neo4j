{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.getPath());
  long lastCommittedTransactionId=-1;
  try {
    DependencyResolver resolver=db.getDependencyResolver();
    LogicalTransactionStore transactionStore=resolver.resolveDependency(LogicalTransactionStore.class);
    TransactionIdStore transactionIdStore=resolver.resolveDependency(TransactionIdStore.class);
    lastCommittedTransactionId=transactionIdStore.getLastCommittedTransactionId();
    assertNotNull(transactionStore.getMetadataFor(lastCommittedTransactionId));
  }
 catch (  NoSuchTransactionException e) {
    fail("Transaction metadata for " + lastCommittedTransactionId + " not found: "+ e);
  }
catch (  IOException e) {
    throw new RuntimeException(e);
  }
 finally {
    db.shutdown();
  }
}
