{
  GraphDatabaseService db=null;
  try {
    db=new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(serverPath.getPath()).setConfig(OnlineBackupSettings.online_backup_enabled,Settings.TRUE).newGraphDatabase();
    Transaction tx=db.beginTx();
    Index<Node> index=db.index().forNodes("yo");
    index.add(db.createNode(),"justTo","commitATx");
    tx.success();
    tx.finish();
    OnlineBackup backup=OnlineBackup.from(InetAddress.getLocalHost().getHostAddress());
    backup.full(backupPath.getPath());
    long lastCommittedTxForLucene=getLastCommittedTx(backupPath.getPath());
    for (int i=0; i < 5; i++) {
      tx=db.beginTx();
      Node node=db.createNode();
      index.add(node,"key","value" + i);
      tx.success();
      tx.finish();
      backup.incremental(backupPath.getPath());
      assertEquals(lastCommittedTxForLucene + i + 1,getLastCommittedTx(backupPath.getPath()));
    }
  }
  finally {
    if (db != null) {
      db.shutdown();
    }
  }
}
