{
  GraphDatabaseService db=null;
  try {
    db=new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(serverPath).setConfig(OnlineBackupSettings.online_backup_enabled,GraphDatabaseSetting.TRUE).newGraphDatabase();
    Transaction tx=db.beginTx();
    Index<Node> index=db.index().forNodes("yo");
    index.add(db.createNode(),"justTo","commitATx");
    tx.success();
    tx.finish();
    OnlineBackup backup=OnlineBackup.from("localhost");
    backup.full(backupPath);
    long lastCommittedTxForLucene=getLastCommittedTx(backupPath);
    for (int i=0; i < 5; i++) {
      tx=db.beginTx();
      Node node=db.createNode();
      index.add(node,"key","value" + i);
      tx.success();
      tx.finish();
      backup.incremental(backupPath);
      assertEquals(lastCommittedTxForLucene + i + 1,getLastCommittedTx(backupPath));
    }
  }
  finally {
    if (db != null) {
      db.shutdown();
    }
  }
}
