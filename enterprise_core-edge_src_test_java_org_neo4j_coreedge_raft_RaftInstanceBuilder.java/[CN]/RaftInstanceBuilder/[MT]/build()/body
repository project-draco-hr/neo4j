{
  SendToMyself leaderOnlyReplicator=new SendToMyself(member,outbound);
  RaftMembershipManager membershipManager=new RaftMembershipManager(leaderOnlyReplicator,memberSetBuilder,raftLog,logProvider,expectedClusterSize,electionTimeout,clock,catchupTimeout,raftMembership,localDatabase);
  RaftLogShippingManager logShipping=new RaftLogShippingManager(outbound,logProvider,raftLog,clock,member,membershipManager,retryTimeMillis,catchupBatchSize,maxAllowedShippingLag,inFlightMap);
  RaftInstance raft=new RaftInstance(member,termState,voteState,raftLog,raftStateMachine,electionTimeout,heartbeatInterval,renewableTimeoutService,mock(CoreTopologyService.class),outbound,logProvider,membershipManager,logShipping,databaseHealthSupplier,inFlightMap,monitors,localDatabase);
  inbound.registerHandler(raft);
  return raft;
}
