{
  FileSystemAbstraction fs=ensureLogExists(log);
  try (StoreChannel channel=fs.open(log,"rw");LogVersionedStoreChannel versionedChannel=new PhysicalLogVersionedStoreChannel(channel,0,(byte)0);PhysicalFlushableChannel writableLogChannel=new PhysicalFlushableChannel(versionedChannel)){
    long offset=channel.size();
    channel.position(offset);
    consumer.accept(new TransactionLogWriter(new LogEntryWriter(writableLogChannel)));
  }
 }
