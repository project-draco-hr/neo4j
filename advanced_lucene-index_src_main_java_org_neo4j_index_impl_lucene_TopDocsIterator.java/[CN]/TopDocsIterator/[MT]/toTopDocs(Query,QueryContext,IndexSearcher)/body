{
  Sort sorting=context != null ? context.sorting : null;
  TopDocs topDocs=null;
  if (sorting == null) {
    topDocs=searcher.search(query,context.topHits);
  }
 else {
    boolean forceScore=context == null || !context.tradeCorrectnessForSpeed;
    if (forceScore) {
      TopFieldCollector collector=LuceneDataSource.scoringCollector(sorting,context.topHits);
      searcher.search(query,collector);
      topDocs=collector.topDocs();
    }
 else {
      topDocs=searcher.search(query,null,context.topHits,sorting);
    }
  }
  return topDocs;
}
