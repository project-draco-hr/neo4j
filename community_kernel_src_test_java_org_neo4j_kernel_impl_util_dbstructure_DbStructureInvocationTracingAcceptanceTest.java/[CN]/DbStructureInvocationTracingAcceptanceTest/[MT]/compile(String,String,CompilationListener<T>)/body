{
  JavaCompiler systemCompiler=ToolProvider.getSystemJavaCompiler();
  JavaFileManager manager=new InMemFileManager();
  DiagnosticCollector<JavaFileObject> diagnosticsCollector=new DiagnosticCollector<JavaFileObject>();
  Iterable<? extends JavaFileObject> sources=Arrays.asList(new InMemSource(className,source));
  CompilationTask task=systemCompiler.getTask(null,manager,diagnosticsCollector,null,null,sources);
  Boolean success=task.call();
  return listener.compiled(success,manager,diagnosticsCollector.getDiagnostics());
}
