{
  final GraphDatabaseFactoryState state=getStateCopy();
  return new GraphDatabaseBuilder(new GraphDatabaseBuilder.DatabaseCreator(){
    @Override public GraphDatabaseService newDatabase(    Map<String,String> config){
      config.put("ephemeral","false");
      return new HighlyAvailableGraphDatabase(path,config,state.getIndexProviders(),state.getKernelExtension(),state.getCacheProviders(),state.getTransactionInterceptorProviders());
    }
  }
);
}
