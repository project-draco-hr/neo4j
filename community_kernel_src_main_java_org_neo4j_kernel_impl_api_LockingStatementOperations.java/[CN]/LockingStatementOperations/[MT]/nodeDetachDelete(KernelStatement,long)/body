{
  final MutableInt count=new MutableInt();
  TwoPhaseNodeForRelationshipLocking locking=new TwoPhaseNodeForRelationshipLocking(entityReadDelegate,new Consumer<Long>(){
    @Override public void accept(    Long relId){
      state.assertOpen();
      try {
        entityWriteDelegate.relationshipDelete(state,relId);
        count.increment();
      }
 catch (      EntityNotFoundException e) {
      }
    }
  }
);
  locking.lockAllNodesAndConsumeRelationships(nodeId,state);
  state.assertOpen();
  entityWriteDelegate.nodeDetachDelete(state,nodeId);
  return count.intValue();
}
