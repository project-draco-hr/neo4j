{
  HighlyAvailableGraphDatabase master=startDb(0);
  HighlyAvailableGraphDatabase slave1=startDb(1);
  HighlyAvailableGraphDatabase slave2=startDb(2);
  assertTrue(master.isMaster());
  assertTrue(!slave1.isMaster());
  assertTrue(!slave2.isMaster());
  startListenForNewMaster(slave2);
  master.shutdown();
  assertTrue(masterElectedLatch.await(20,SECONDS));
  assertTrue(slave1.isMaster());
  assertTrue(!slave2.isMaster());
  slave2.shutdown();
  slave1.shutdown();
}
