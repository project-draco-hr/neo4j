{
  StringBuilder target=new StringBuilder();
synchronized (this) {
    StringBuilder old=classes.put(type,target);
    if (old != null) {
      classes.put(type,old);
      throw new IllegalStateException("Trying to generate class twice: " + type);
    }
  }
  ClassSourceWriter writer=new ClassSourceWriter(target,configuration);
  writer.declarePackage(type);
  writer.javadoc("Generated by " + getClass().getName());
  writer.publicClass(type);
  writer.extendClass(base);
  writer.implement(interfaces);
  writer.begin();
  return writer;
}
