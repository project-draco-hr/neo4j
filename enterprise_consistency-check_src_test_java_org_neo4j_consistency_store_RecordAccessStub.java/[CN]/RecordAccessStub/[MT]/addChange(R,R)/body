{
  if (newRecord instanceof NodeRecord) {
    add(nodes,(NodeRecord)oldRecord,(NodeRecord)newRecord);
  }
 else   if (newRecord instanceof RelationshipRecord) {
    add(relationships,(RelationshipRecord)oldRecord,(RelationshipRecord)newRecord);
  }
 else   if (newRecord instanceof PropertyRecord) {
    add(properties,(PropertyRecord)oldRecord,(PropertyRecord)newRecord);
  }
 else   if (newRecord instanceof DynamicRecord) {
    DynamicRecord dyn=(DynamicRecord)newRecord;
    if (dyn.getType() == PropertyType.STRING.intValue()) {
      add(strings,(DynamicRecord)oldRecord,dyn);
    }
 else     if (dyn.getType() == PropertyType.ARRAY.intValue()) {
      add(arrays,(DynamicRecord)oldRecord,dyn);
    }
 else {
      throw new IllegalArgumentException("Invalid dynamic record type");
    }
  }
 else   if (newRecord instanceof RelationshipTypeRecord) {
    add(labels,(RelationshipTypeRecord)oldRecord,(RelationshipTypeRecord)newRecord);
  }
 else   if (newRecord instanceof PropertyIndexRecord) {
    add(keys,(PropertyIndexRecord)oldRecord,(PropertyIndexRecord)newRecord);
  }
 else   if (newRecord instanceof NeoStoreRecord) {
    this.graph=new Delta<NeoStoreRecord>((NeoStoreRecord)oldRecord,(NeoStoreRecord)newRecord);
  }
 else {
    throw new IllegalArgumentException("Invalid record type");
  }
  return newRecord;
}
