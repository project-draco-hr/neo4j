{
  StringBuilder classpath=buildClassPath();
  try (RmiServer server=new RmiServer()){
    int port=server.getPort();
    server.export(RMI_RUN_NOTIFIER_NAME,new DelegatingRemoteRunNotifier(notifier));
    List<String> command=new ArrayList<>();
    command.add(ProcessUtil.getJavaExecutable().toString());
    for (    String argument : ProcessUtil.getJavaExecutableArguments()) {
      if (!argument.startsWith("-agentlib")) {
        command.add(argument);
      }
    }
    command.add("-ea");
    command.add("-Xbootclasspath/a:" + classpathEntryToBootWith);
    command.add("-cp");
    command.add(classpath.toString());
    command.add(getClass().getName());
    command.add(String.valueOf(port));
    command.add(testClass.getName());
    ProcessBuilder pb=new ProcessBuilder();
    pb.command(command);
    pb.inheritIO();
    Process process=pb.start();
    process.waitFor();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
