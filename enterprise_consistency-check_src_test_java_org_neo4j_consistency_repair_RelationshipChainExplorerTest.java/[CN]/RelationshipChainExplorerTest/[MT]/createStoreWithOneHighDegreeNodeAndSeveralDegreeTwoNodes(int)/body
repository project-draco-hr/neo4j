{
  File storeDirectory=TargetDirectory.forTest(getClass()).graphDbDir(true);
  EmbeddedGraphDatabase database=new EmbeddedGraphDatabase(storeDirectory.getPath());
  Transaction transaction=database.beginTx();
  try {
    Node denseNode=database.createNode();
    for (int i=0; i < nDegreeTwoNodes; i++) {
      Node degreeTwoNode=database.createNode();
      Node leafNode=database.createNode();
      if (i % 2 == 0) {
        denseNode.createRelationshipTo(degreeTwoNode,TestRelationshipType.CONNECTED);
      }
 else {
        degreeTwoNode.createRelationshipTo(denseNode,TestRelationshipType.CONNECTED);
      }
      degreeTwoNode.createRelationshipTo(leafNode,TestRelationshipType.CONNECTED);
    }
    transaction.success();
  }
  finally {
    transaction.finish();
  }
  database.shutdown();
  return new StoreAccess(storeDirectory.getPath());
}
