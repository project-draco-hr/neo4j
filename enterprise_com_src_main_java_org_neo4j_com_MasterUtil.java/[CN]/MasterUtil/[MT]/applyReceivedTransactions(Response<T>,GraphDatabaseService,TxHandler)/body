{
  XaDataSourceManager dataSourceManager=((AbstractGraphDatabase)graphDb).getConfig().getTxModule().getXaDataSourceManager();
  for (  Triplet<String,Long,TxExtractor> tx : IteratorUtil.asIterable(response.transactions())) {
    String resourceName=tx.first();
    XaDataSource dataSource=dataSourceManager.getXaDataSource(resourceName);
    txHandler.accept(tx,dataSource);
    ReadableByteChannel txStream=tx.third().extract();
    try {
      dataSource.applyCommittedTransaction(tx.second(),txStream);
    }
  finally {
      txStream.close();
    }
  }
}
