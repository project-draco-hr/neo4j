{
  XaDataSourceManager dsManager=((AbstractGraphDatabase)graphDb).getConfig().getTxModule().getXaDataSourceManager();
  Collection<XaDataSource> sources=dsManager.getAllRegisteredDataSources();
  @SuppressWarnings("unchecked") Pair<String,Long>[] appliedTransactions=new Pair[sources.size()];
  int i=0;
  for (  XaDataSource ds : sources) {
    try {
      long lastCommittedTx=ds.getXaContainer().getResourceManager().rotateLogicalLog();
      appliedTransactions[i++]=Pair.of(ds.getName(),lastCommittedTx);
    }
 catch (    Throwable e) {
      ((AbstractGraphDatabase)graphDb).getMessageLog().logMessage("Unable to rotate log for " + ds,e);
      ((AbstractGraphDatabase)graphDb).getConfig().getKernelPanicGenerator().generateEvent(ErrorState.TX_MANAGER_NOT_OK);
      throw new MasterFailureException(e);
    }
  }
  return appliedTransactions;
}
