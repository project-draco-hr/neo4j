{
  try {
    long nextId=nextLocalId();
    if (nextId == VALUE_REPRESENTING_NULL) {
      IdAllocation allocation=receiver.receive(broker.getMaster().allocateIds(receiver.getSlaveContext(),idType));
      nextId=storeLocally(allocation);
    }
    return nextId;
  }
 catch (  ZooKeeperException e) {
    receiver.somethingIsWrong(e);
    throw e;
  }
catch (  HaCommunicationException e) {
    receiver.somethingIsWrong(e);
    throw e;
  }
}
