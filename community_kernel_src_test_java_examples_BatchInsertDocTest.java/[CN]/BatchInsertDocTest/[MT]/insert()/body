{
  BatchInserter inserter=BatchInserters.inserter("target/batchinserter-example",fileSystem);
  Label personLabel=DynamicLabel.label("Person");
  inserter.createDeferredSchemaIndex(personLabel).on("name").create();
  Map<String,Object> properties=new HashMap<>();
  properties.put("name","Mattias");
  long mattiasNode=inserter.createNode(properties,personLabel);
  properties.put("name","Chris");
  long chrisNode=inserter.createNode(properties,personLabel);
  RelationshipType knows=DynamicRelationshipType.withName("KNOWS");
  inserter.createRelationship(mattiasNode,chrisNode,knows,null);
  inserter.shutdown();
  GraphDatabaseService db=new TestGraphDatabaseFactory().setFileSystem(fileSystem).newImpermanentDatabase("target/batchinserter-example");
  try (Transaction tx=db.beginTx()){
    Node mNode=db.getNodeById(mattiasNode);
    Node cNode=mNode.getSingleRelationship(knows,Direction.OUTGOING).getEndNode();
    assertThat((String)cNode.getProperty("name"),is("Chris"));
    assertThat(db.schema().getIndexes(personLabel).iterator().hasNext(),is(true));
  }
  finally {
    db.shutdown();
  }
}
