{
  GraphDatabaseService batchDb=BatchInserters.batchDatabase("target/batchdb-example",fileSystem);
  Label personLabel=DynamicLabel.label("Person");
  Node mattiasNode=batchDb.createNode(personLabel);
  mattiasNode.setProperty("name","Mattias");
  Node chrisNode=batchDb.createNode();
  chrisNode.setProperty("name","Chris");
  chrisNode.addLabel(personLabel);
  RelationshipType knows=DynamicRelationshipType.withName("KNOWS");
  mattiasNode.createRelationshipTo(chrisNode,knows);
  long mattiasNodeId=mattiasNode.getId();
  batchDb.shutdown();
  GraphDatabaseService db=new TestGraphDatabaseFactory().setFileSystem(fileSystem).newImpermanentDatabase("target/batchdb-example");
  Transaction transaction=db.beginTx();
  try {
    Node mNode=db.getNodeById(mattiasNodeId);
    Node cNode=mNode.getSingleRelationship(knows,Direction.OUTGOING).getEndNode();
    assertThat(cNode,inTx(db,hasProperty("name").withValue("Chris")));
  }
  finally {
    transaction.finish();
    db.shutdown();
  }
}
