{
  try (StoreApplyEvent storeApplyEvent=commitEvent.beginStoreApply()){
    storageEngine.transactionApplier().apply(transaction,indexUpdates,locks,commitment.transactionId(),mode);
  }
 catch (  Throwable cause) {
    throw new TransactionFailureException(CouldNotCommit,cause,"Could not apply the transaction to the store after written to log");
  }
 finally {
    commitment.publishAsApplied();
  }
}
