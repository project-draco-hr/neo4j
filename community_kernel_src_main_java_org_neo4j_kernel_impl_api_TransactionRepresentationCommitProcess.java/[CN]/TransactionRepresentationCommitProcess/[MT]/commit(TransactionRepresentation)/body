{
  Future<Long> commitFuture;
  try {
    commitFuture=logicalTransactionStore.getAppender().append(representation);
  }
 catch (  IOException e) {
    kernelHealth.panic(e);
    throw new TransactionFailureException(Status.Transaction.CouldNotWriteToLog,e,"Could not write transaction representation to log");
  }
  long transactionId;
  try {
    transactionId=commitFuture.get();
  }
 catch (  InterruptedException|ExecutionException e) {
    throw new TransactionFailureException(Status.Transaction.CouldNotWriteToLog,e,"");
  }
  try {
    storeApplier.apply(representation,transactionId,recovery);
  }
 catch (  IOException e) {
    kernelHealth.panic(e);
    throw new TransactionFailureException(Status.Transaction.CouldNotCommit,e,"Could not apply the transaction to the store after written to log");
  }
 finally {
    neoStore.transactionClosed(transactionId);
  }
}
