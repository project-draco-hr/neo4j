{
  long transactionId=persistTransaction(representation);
  try {
    storeApplier.apply(representation,transactionId,recovery);
  }
 catch (  IOException e) {
    kernelHealth.panic(e);
    throw new TransactionFailureException(Status.Transaction.CouldNotCommit,e,"Could not apply the transaction to the store after written to log");
  }
 finally {
    transactionIdStore.transactionClosed(transactionId);
  }
  return transactionId;
}
