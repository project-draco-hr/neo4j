{
  try (ValidatedIndexUpdates indexUpdates=validateIndexUpdates(transaction)){
    Commitment commitment=appendToLog(transaction,commitEvent);
    applyToStore(transaction,locks,commitEvent,indexUpdates,commitment,mode);
    return commitment.transactionId();
  }
 }
