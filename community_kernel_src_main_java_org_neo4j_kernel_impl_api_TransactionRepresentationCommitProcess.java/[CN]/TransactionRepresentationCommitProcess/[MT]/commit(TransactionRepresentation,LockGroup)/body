{
  long transactionId=commitTransaction(transaction);
  try {
    transactionIdStore.transactionCommitted(transactionId);
    storeApplier.apply(transaction,locks,transactionId,recovery);
  }
 catch (  Throwable e) {
    throw exception(Status.Transaction.CouldNotCommit,e,"Could not apply the transaction to the store after written to log");
  }
 finally {
    transactionIdStore.transactionClosed(transactionId);
  }
  return transactionId;
}
