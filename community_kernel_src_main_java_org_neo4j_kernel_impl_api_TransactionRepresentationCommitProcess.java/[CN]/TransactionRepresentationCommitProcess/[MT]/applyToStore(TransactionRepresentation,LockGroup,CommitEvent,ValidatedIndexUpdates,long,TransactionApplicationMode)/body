{
  try (StoreApplyEvent storeApplyEvent=commitEvent.beginStoreApply()){
    storeApplier.apply(transaction,indexUpdates,locks,transactionId,mode);
  }
 catch (  Throwable cause) {
    throw new TransactionFailureException(CouldNotCommit,cause,"Could not apply the transaction to the store after written to log");
  }
 finally {
    transactionIdStore.transactionClosed(transactionId);
  }
}
