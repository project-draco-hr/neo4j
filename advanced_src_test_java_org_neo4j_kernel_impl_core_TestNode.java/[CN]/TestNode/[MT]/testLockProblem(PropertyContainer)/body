{
  entity.setProperty("key","value");
  final AtomicBoolean gotTheLock=new AtomicBoolean();
  Thread thread=new Thread(){
    @Override public void run(){
      Transaction tx=getGraphDb().beginTx();
      try {
        ((AbstractGraphDatabase)getGraphDb()).getConfig().getLockManager().getWriteLock(entity);
        gotTheLock.set(true);
        tx.success();
      }
 catch (      RuntimeException e) {
        e.printStackTrace();
        throw e;
      }
 finally {
        tx.failure();
      }
    }
  }
;
  thread.start();
  long endTime=System.currentTimeMillis() + 5000;
  while (thread.getState() != State.TERMINATED) {
    Thread.sleep(100);
    if (System.currentTimeMillis() > endTime) {
      break;
    }
  }
  assertFalse(gotTheLock.get());
}
