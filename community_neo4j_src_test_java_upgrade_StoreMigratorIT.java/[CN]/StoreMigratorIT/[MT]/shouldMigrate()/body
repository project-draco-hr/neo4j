{
  upgrader(new StoreMigrator(monitor,fs)).migrateIfNeeded(find20FormatStoreDirectory(storeDir));
  assertEquals(100,monitor.eventSize());
  assertTrue(monitor.isStarted());
  assertTrue(monitor.isFinished());
  GraphDatabaseService database=cleanup.add(new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.getAbsolutePath()));
  try {
    DatabaseContentVerifier verifier=new DatabaseContentVerifier(database);
    verifier.verifyNodes(501);
    verifier.verifyRelationships(500);
    verifier.verifyNodeIdsReused();
    verifier.verifyRelationshipIdsReused();
    verifier.verifyLegacyIndex();
  }
  finally {
    database.shutdown();
  }
  NeoStore neoStore=cleanup.add(storeFactory.newNeoStore(storeFileName));
  verifyNeoStore(neoStore);
  neoStore.close();
  assertConsistentStore(storeDir);
}
