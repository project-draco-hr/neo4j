{
  HighlyAvailableGraphDatabase initialMaster=cluster.getMaster();
  cluster.shutdown(initialMaster);
  cluster.await(masterAvailable(initialMaster));
  cluster.await(masterSeesSlavesAsAvailable(1));
  createNodeOn(cluster.getMaster());
  cluster.sync();
  ClusterClient clusterClient=cleanup.add(newClusterClient(new InstanceId(1)));
  final AtomicReference<InstanceId> coordinatorIdWhenReJoined=new AtomicReference<>();
  final CountDownLatch latch=new CountDownLatch(1);
  clusterClient.addClusterListener(new ClusterListener.Adapter(){
    @Override public void enteredCluster(    ClusterConfiguration clusterConfiguration){
      coordinatorIdWhenReJoined.set(clusterConfiguration.getElected(COORDINATOR));
      latch.countDown();
    }
  }
);
  clusterClient.init();
  clusterClient.start();
  latch.await(2,SECONDS);
  assertEquals(new InstanceId(2),coordinatorIdWhenReJoined.get());
}
