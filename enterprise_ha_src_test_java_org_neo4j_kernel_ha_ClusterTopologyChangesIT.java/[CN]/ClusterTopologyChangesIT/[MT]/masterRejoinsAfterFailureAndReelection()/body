{
  HighlyAvailableGraphDatabase initialMaster=cluster.getMaster();
  cluster.info("Fail master");
  RepairKit kit=cluster.fail(initialMaster);
  cluster.info("Wait for 2 to become master and 3 slave");
  cluster.await(masterAvailable(initialMaster));
  cluster.await(masterSeesSlavesAsAvailable(1));
  cluster.info("Repair 1");
  kit.repair();
  cluster.info("Wait for cluster recovery");
  cluster.await(masterAvailable());
  cluster.await(allSeesAllAsAvailable());
  assertEquals(3,cluster.size());
}
