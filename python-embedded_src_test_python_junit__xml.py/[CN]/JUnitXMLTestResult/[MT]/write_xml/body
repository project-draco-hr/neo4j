def write_xml(self):
    if (not self.tests):
        return
    stdout = self.stdout.getvalue()
    stderr = self.stderr.getvalue()
    sys.stdout = self.old_stdout
    sys.stderr = self.old_stderr
    ensure_dir(self.xml_dir)
    for module in self.tests:
        tests = self.tests[module]
        filename = os.path.join(self.xml_dir, ('TEST-%s.xml' % module))
        stream = open(filename, 'w')
        write_testsuite_xml(stream, len(tests), tests.errors, tests.failures, 0, module, tests.took)
        for info in tests:
            info.write_xml(stream)
        stream.write('</testsuite>\n')
        stream.close()
