def stopTest(self, test):
    took = (time.time() - self.start)
    unittest.TestResult.stopTest(self, test)
    args = [test, took, self.stdout.getvalue(), self.stderr.getvalue()]
    self.stdout.truncate(0)
    self.stderr.truncate(0)
    tests = self.tests['.'.join(test.id().split('.')[:(-1)])]
    tests.took += took
    if self.error:
        tests.errors += 1
        args.extend(['error', self.error])
    elif self.failure:
        tests.failures += 1
        args.extend(['failure', self.failure])
    tests.append(TestInfo.from_testcase(*args))
