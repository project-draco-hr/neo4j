{
  if (!availabilityGuard.isAvailable(accessTimeout)) {
    throw new TransactionFailureException("Database is currently not available. " + availabilityGuard.describeWhoIsBlocking());
  }
  KernelAPI kernel=neoDataSource.getKernel();
  TopLevelTransaction runningTransaction=threadToTransactionBridge.getTopLevelTransactionBoundToThisThread(false);
  if (runningTransaction != null) {
    return new PlaceboTransaction(runningTransaction);
  }
  KernelTransaction transaction=kernel.newTransaction();
  return new TopLevelTransaction(kernel,transaction,threadToTransactionBridge);
}
