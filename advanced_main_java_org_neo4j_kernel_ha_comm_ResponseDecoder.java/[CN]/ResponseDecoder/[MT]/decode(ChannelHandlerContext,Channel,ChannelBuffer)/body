{
  if (data != null) {
    Object result=data.read(buffer);
    if (result != null)     data=null;
    return result;
  }
  if (buffer.readableBytes() >= HEADER_SIZE) {
    int header=buffer.getShort(buffer.readerIndex());
    if (header < 0) {
      header=-header;
      data=TransactionDataReader.tryInitStream(header,buffer);
    }
 else {
      if (buffer.readableBytes() < HEADER_SIZE + header) {
        return null;
      }
 else {
        ChannelBuffer frame=buffer.factory().getBuffer(header);
        int index=buffer.readerIndex() + HEADER_SIZE;
        frame.writeBytes(buffer,index,header);
        buffer.readerIndex(index + header);
        return frame;
      }
    }
  }
  return null;
}
