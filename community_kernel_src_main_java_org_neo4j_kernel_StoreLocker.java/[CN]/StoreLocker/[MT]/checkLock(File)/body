{
  File storeLockFile=new File(storeDir,STORE_LOCK_FILENAME);
  try {
    if (!fileSystemAbstraction.fileExists(storeLockFile)) {
      fileSystemAbstraction.mkdirs(storeLockFile.getParentFile());
    }
  }
 catch (  IOException e) {
    throw new StoreLockException("Unable to create path for store dir: " + storeDir,e);
  }
  try {
    storeLockFileChannel=fileSystemAbstraction.open(storeLockFile,"rw");
    storeLockFileLock=fileSystemAbstraction.tryLock(storeLockFile,storeLockFileChannel);
    if (storeLockFileLock == null) {
      throw new StoreLockException("Could not create lock file");
    }
  }
 catch (  OverlappingFileLockException e) {
    throw new StoreLockException("Unable to obtain lock on store lock file: " + storeLockFile + ". Please ensure no other process is using this database, and that the directory is writable (required even for read-only access.",e);
  }
catch (  IOException e) {
    throw new StoreLockException("Unable to obtain lock on store lock file: " + storeLockFile + ". Please ensure no other process is using this database, and that the directory is writable (required even for read-only access",e);
  }
}
