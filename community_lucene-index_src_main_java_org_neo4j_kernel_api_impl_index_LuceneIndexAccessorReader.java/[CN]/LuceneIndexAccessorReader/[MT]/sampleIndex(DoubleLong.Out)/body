{
  NonUniqueIndexSampler sampler=new NonUniqueIndexSampler(bufferSizeLimit);
  for (  LeafReaderContext readerContext : luceneIndexReader().leaves()) {
    try {
      Set<String> fieldNames=getFieldNamesToSample(readerContext);
      for (      String fieldName : fieldNames) {
        Terms terms=readerContext.reader().terms(fieldName);
        if (terms != null) {
          TermsEnum termsEnum=terms.iterator();
          BytesRef termsRef;
          while ((termsRef=termsEnum.next()) != null) {
            sampler.include(termsRef.utf8ToString(),termsEnum.docFreq());
            checkCancellation();
          }
        }
      }
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
  return sampler.result(result);
}
