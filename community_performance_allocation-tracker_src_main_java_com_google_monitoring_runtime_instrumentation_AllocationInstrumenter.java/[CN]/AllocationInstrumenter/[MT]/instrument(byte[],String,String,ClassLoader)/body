{
  try {
    ClassReader cr=new ClassReader(originalBytes);
    ClassWriter cw=new StaticClassWriter(cr,ClassWriter.COMPUTE_FRAMES,loader);
    VerifyingClassAdapter vcw=new VerifyingClassAdapter(cw,originalBytes,cr.getClassName());
    ClassVisitor adapter=new AllocationClassAdapter(vcw,recorderClass,recorderMethod);
    cr.accept(adapter,ClassReader.SKIP_FRAMES);
    return vcw.toByteArray();
  }
 catch (  RuntimeException e) {
    logger.log(Level.WARNING,"Failed to instrument class.",e);
    throw e;
  }
catch (  Error e) {
    logger.log(Level.WARNING,"Failed to instrument class.",e);
    throw e;
  }
}
