{
  Long previousEntry=currentBatch.get(propertyValue);
  if (previousEntry == null) {
    IndexSearcher searcher=searcherManager.acquire();
    try {
      TopDocs docs=searcher.search(documentStructure.newSeekQuery(propertyValue),1);
      if (docs.totalHits > 0) {
        Document doc=searcher.getIndexReader().document(docs.scoreDocs[0].doc);
        previousEntry=documentStructure.getNodeId(doc);
      }
    }
  finally {
      searcherManager.release(searcher);
    }
  }
  if (previousEntry != null) {
    if (previousEntry != nodeId) {
      throw new PreexistingIndexEntryConflictException(propertyValue,previousEntry,nodeId);
    }
  }
 else {
    currentBatch.put(propertyValue,nodeId);
    IndexableField encodedValue=documentStructure.encodeAsFieldable(propertyValue);
    writer.addDocument(documentStructure.newDocumentRepresentingProperty(nodeId,encodedValue));
    if (currentBatch.size() >= batchSize) {
      startNewBatch();
    }
  }
}
