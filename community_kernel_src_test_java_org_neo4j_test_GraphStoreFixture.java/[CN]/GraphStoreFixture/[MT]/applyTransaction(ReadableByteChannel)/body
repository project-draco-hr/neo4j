{
  GraphDatabaseAPI database=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(directory).setConfig(configuration(false)).newGraphDatabase();
  try {
    database.beginTx();
    database.getDependencyResolver().resolveDependency(XaDataSourceManager.class).getNeoStoreDataSource().applyPreparedTransaction(transaction);
  }
  finally {
    database.shutdown();
  }
}
