{
  defaultDirection=defaultDirection != null ? defaultDirection : Direction.BOTH;
  Expander expander=Traversal.emptyExpander();
  boolean addedSomething=false;
  for (  RelationshipType type : db.getRelationshipTypes()) {
    Direction direction=null;
    if (filterMap == null || filterMap.isEmpty()) {
      direction=defaultDirection;
    }
 else {
      for (      Map.Entry<String,Object> entry : filterMap.entrySet()) {
        if (matches(newPattern(entry.getKey(),caseInsensitiveFilters),type.name(),caseInsensitiveFilters,looseFilters)) {
          direction=getDirection(entry.getValue() != null ? entry.getValue().toString() : null,defaultDirection);
          break;
        }
      }
    }
    if (direction != null) {
      expander=expander.add(type,direction);
      addedSomething=true;
    }
  }
  if (!filterMap.isEmpty() && !addedSomething) {
    return null;
  }
  return expander;
}
