{
  InMemoryIndex index=indexes.get(indexId);
  if (index == null || index.state != InternalIndexState.ONLINE) {
    throw new IllegalStateException("Index " + indexId + " not online yet");
  }
  if (config.isUnique() && !(index instanceof UniqueInMemoryIndex)) {
    throw new IllegalStateException(String.format("The index [%s] was not created as a unique index.",indexId));
  }
  return index;
}
