{
  if (retries > 20) {
    close();
  }
  if (!acquireReadBuffer()) {
    return false;
  }
  try {
    int read=connection.read();
    if (read > 29) {
      buffer.flip();
      byte slaveGreeting=buffer.get();
      if (slaveGreeting != HeaderConstants.SLAVE_GREETING) {
        setStatus(Status.SEND_BYE);
        return true;
      }
      long id=buffer.getLong();
      long timestamp=buffer.getLong();
      long version=buffer.getLong();
      int strLen=buffer.getInt();
      byte[] bytes=new byte[strLen];
      buffer.get(bytes);
      xaDsName=new String(bytes);
      long masterId=master.getIdentifier(xaDsName);
      long masterTimestamp=master.getCreationTime(xaDsName);
      long masterVersion=master.getVersion(xaDsName);
      if (id != masterId || timestamp != masterTimestamp || version > masterVersion) {
        log("Got wrong id/time/version [" + id + "/"+ timestamp+ "/"+ version+ "]"+ "["+ masterId+ "/"+ masterTimestamp+ "/"+ masterVersion+ "] for data source "+ xaDsName);
        setStatus(Status.SEND_BYE);
        return true;
      }
      log("Got slave version[" + version + "]. I am version["+ master.getVersion(xaDsName)+ "] for data source "+ xaDsName);
      slaveVersion=version;
      setStatus(Status.SETUP_GREETING);
      retries=0;
      return true;
    }
 else {
      retries++;
      if (read > 0) {
        connection.pushBackAllReadData();
      }
      return false;
    }
  }
  finally {
    releaseReadBuffer();
  }
}
