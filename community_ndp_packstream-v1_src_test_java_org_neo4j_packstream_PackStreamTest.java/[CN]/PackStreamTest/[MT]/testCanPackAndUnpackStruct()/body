{
  Machine machine=new Machine();
  PackStream.Packer packer=machine.packer();
  packer.packStructHeader(3,'N');
  packer.pack(12);
  packer.pack(asList("Person","Employee"));
  packer.pack(asMap("name","Alice","age",33));
  packer.flush();
  PackValue value=newUnpacker(machine.output()).unpack();
  assertThat(value.isStruct(),equalTo(true));
  List<PackValue> struct=value.listValue();
  assertThat(struct.size(),equalTo(3));
  assertThat(struct.get(0).isInteger(),equalTo(true));
  assertThat(struct.get(1).isList(),equalTo(true));
  assertThat(struct.get(2).isMap(),equalTo(true));
  assertThat(struct.get(0).longValue(),equalTo(12L));
  assertThat(struct.get(1).listValue().size(),equalTo(2));
  assertThat(struct.get(1).listValue().get(0).stringValue(),equalTo("Person"));
  assertThat(struct.get(1).listValue().get(1).stringValue(),equalTo("Employee"));
  assertThat(struct.get(2).mapValue().size(),equalTo(2));
  assertThat(struct.get(2).mapValue().get("name").stringValue(),equalTo("Alice"));
  assertThat(struct.get(2).mapValue().get("age").intValue(),equalTo(33));
}
