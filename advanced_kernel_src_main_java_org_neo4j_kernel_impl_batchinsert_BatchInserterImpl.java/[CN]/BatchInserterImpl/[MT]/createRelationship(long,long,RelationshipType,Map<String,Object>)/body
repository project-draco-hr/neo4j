{
  if (node1 == node2) {
    throw new IllegalArgumentException("Start node[" + node1 + "] equals end node["+ node2+ "]");
  }
  NodeRecord firstNode=getNodeRecord(node1);
  NodeRecord secondNode=getNodeRecord(node2);
  int typeId=typeHolder.getTypeId(type.name());
  if (typeId == -1) {
    typeId=createNewRelationshipType(type.name());
  }
  long id=getRelationshipStore().nextId();
  RelationshipRecord record=new RelationshipRecord(id,node1,node2,typeId);
  record.setInUse(true);
  record.setCreated();
  connectRelationship(firstNode,secondNode,record);
  getNodeStore().updateRecord(firstNode);
  getNodeStore().updateRecord(secondNode);
  record.setNextProp(createPropertyChain(properties));
  getRelationshipStore().updateRecord(record);
  return id;
}
