{
  File selectedFile=null;
  boolean cancelled=false;
  boolean validLocation=false;
  while (!validLocation && !cancelled) {
    if (SystemUtils.IS_OS_MAC) {
      selectedFile=macFileSelection();
    }
 else {
      selectedFile=fileSelection();
    }
    try {
      model.setDatabaseDirectory(selectedFile);
      directoryDisplay.setText(selectedFile.getAbsolutePath());
      validLocation=true;
      LastLocation.setLastLocation(selectedFile.getAbsolutePath());
    }
 catch (    UnsuitableDirectoryException ude) {
      int choice=showWrappedConfirmDialog(frame,"Please choose a different folder." + "\n" + ude.getStackTrace(),"Invalid folder selected",OK_CANCEL_OPTION,ERROR_MESSAGE);
      if (choice == CANCEL_OPTION) {
        cancelled=true;
      }
    }
  }
}
