{
  File selectedFile=null;
  boolean cancelled=false;
  boolean validLocation=false;
  while (!validLocation && !cancelled) {
    if (SystemUtils.IS_OS_MAC) {
      selectedFile=macFileSelection();
    }
 else {
      selectedFile=fileSelection();
    }
    try {
      model.setDatabaseDirectory(selectedFile);
      directoryDisplay.setText(selectedFile.getAbsolutePath());
      validLocation=true;
      FileWriter fileWriter=new FileWriter(new File(".dblocation"));
      fileWriter.write(selectedFile.getAbsolutePath());
      fileWriter.flush();
      fileWriter.close();
    }
 catch (    UnsuitableDirectoryException ude) {
      int choice=showWrappedConfirmDialog(frame,ude.getMessage() + "\n" + "Please choose a different folder.","Invalid folder selected",OK_CANCEL_OPTION,ERROR_MESSAGE);
      if (choice == CANCEL_OPTION) {
        cancelled=true;
      }
    }
catch (    IOException ioe) {
      System.out.println("Error saving DB location");
      System.out.println(ioe);
    }
  }
}
