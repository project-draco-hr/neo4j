{
  long nodeId=1337l;
  int propertyKey=2;
  int propValue=42;
  DiffSets<Long> nodesWithChangedProp=new DiffSets<Long>(asSet(nodeId),emptySet);
  when(legacyState.getDeletedNodes()).thenReturn(emptySet);
  when(legacyState.getNodesWithChangedProperty(propertyKey,propValue)).thenReturn(nodesWithChangedProp);
  DiffSets<Long> diff=state.getNodesWithChangedProperty(propertyKey,propValue);
  assertThat(diff.getAdded(),equalTo(asSet(nodeId)));
  assertThat(diff.getRemoved(),equalTo(emptySet));
}
