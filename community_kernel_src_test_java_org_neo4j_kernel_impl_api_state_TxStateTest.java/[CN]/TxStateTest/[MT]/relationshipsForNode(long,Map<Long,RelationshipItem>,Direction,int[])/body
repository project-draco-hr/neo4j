{
  Map<Long,RelationshipItem> result=new HashMap<>();
  for (  RelationshipItem relationship : allRelationships.values()) {
switch (direction) {
case OUTGOING:
      if (relationship.startNode() != nodeId) {
        continue;
      }
    break;
case INCOMING:
  if (relationship.endNode() != nodeId) {
    continue;
  }
break;
case BOTH:
if (relationship.startNode() != nodeId && relationship.endNode() != nodeId) {
continue;
}
break;
default :
throw new IllegalStateException("Unknown direction: " + direction);
}
if (relationshipTypes != null) {
if (!contains(relationshipTypes,relationship.type())) {
continue;
}
}
result.put(relationship.id(),relationship);
}
return result;
}
