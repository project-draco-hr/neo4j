{
  ReservingLuceneIndexWriter indexWriter=mock(ReservingLuceneIndexWriter.class);
  IndexUpdater updater=newIndexUpdater(indexWriter);
  updater.validate(asList(add(1,"foo"),add(2,"bar"),add(3,"baz")));
  updater.validate(asList(change(1,"foo1","bar1"),add(2,"foo2"),add(3,"foo3"),change(4,"foo4","bar4"),remove(5,"foo5")));
  updater.validate(asList(change(1,"foo1","bar1"),remove(2,"foo2"),remove(3,"foo3")));
  InOrder order=inOrder(indexWriter);
  order.verify(indexWriter).createSearcherManager();
  order.verify(indexWriter).reserveInsertions(3);
  order.verify(indexWriter).reserveInsertions(4);
  order.verify(indexWriter).reserveInsertions(1);
  verifyNoMoreInteractions(indexWriter);
}
