{
  Map<String,Object> environment=new HashMap<String,Object>();
  if (username != null && password != null) {
    environment.put(JMXConnector.CREDENTIALS,new String[]{username,password});
  }
 else   if (username != password) {
    throw new IllegalArgumentException("User name and password must either both be specified, or both be null.");
  }
  try {
    try {
      return JMXConnectorFactory.connect(url,environment).getMBeanServerConnection();
    }
 catch (    SecurityException e) {
      environment.put(RMIConnectorServer.RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE,new SslRMIClientSocketFactory());
      return JMXConnectorFactory.connect(url,environment).getMBeanServerConnection();
    }
  }
 catch (  IOException e) {
    throw new IllegalStateException("Connection failed.",e);
  }
}
