{
  TinyBundle bundle=newBundle().add(BundleJarProducer.class).add(this.getClass()).set(Constants.BUNDLE_SYMBOLICNAME,getBundleSymbolicName()).set(Constants.EXPORT_PACKAGE,getExportedPackages()).set(Constants.IMPORT_PACKAGE,getImportedPackages()).set(Constants.BUNDLE_ACTIVATOR,this.getClass().getName());
  for (  Class bundleClass : getExtraBundleClasses()) {
    bundle.add(bundleClass);
  }
  InputStream bundleStream=bundle.build(withBnd());
  File jarFile=new File(bundleDirectory,jarName);
  OutputStream jarOutputStream=new FileOutputStream(jarFile);
  StreamUtils.copyStream(bundleStream,jarOutputStream,true);
}
