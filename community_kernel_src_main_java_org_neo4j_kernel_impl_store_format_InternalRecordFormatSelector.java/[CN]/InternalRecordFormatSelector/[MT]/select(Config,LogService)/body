{
  String key=config.get(GraphDatabaseFacadeFactory.Configuration.record_format);
  for (  RecordFormats.Factory candidate : loadAdditionalFormats()) {
    String candidateId=candidate.getKeys().iterator().next();
    if (candidateId.equals(key)) {
      return candidate.newInstance();
    }
 else     if ("".equals(key)) {
      return loggedSelection(candidate.newInstance(),candidateId,logging);
    }
  }
  if (COMMUNITY_KEY.equals(key)) {
    return FALLBACK;
  }
  if ("".equals(key)) {
    return loggedSelection(FALLBACK,COMMUNITY_KEY,logging);
  }
  throw new IllegalArgumentException("No record format found with the name '" + key + "'.");
}
