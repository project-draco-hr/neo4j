{
  String key=config.get(GraphDatabaseFacadeFactory.Configuration.record_type);
  RecordFormats.Factory potentialCandidate=null;
  for (  RecordFormats.Factory candidate : Service.load(RecordFormats.Factory.class)) {
    String candidateId=candidate.getKeys().iterator().next();
    if (candidateId.equals(key)) {
      return candidate.newInstance();
    }
 else     if (potentialCandidate == null || candidateId.equals("highlimit")) {
      potentialCandidate=candidate;
    }
  }
  if (key.equals("")) {
    return potentialCandidate.newInstance();
  }
 else {
    throw new IllegalArgumentException("Invalid configuration for record format.");
  }
}
