{
  User user=getUser(username);
  if (user.hasFlag(IS_SUSPENDED)) {
    User activatedUser=user.augment().withoutFlag(IS_SUSPENDED).withRequiredPasswordChange(requirePasswordChange).build();
    try {
synchronized (this) {
        userRepository.update(user,activatedUser);
      }
    }
 catch (    ConcurrentModificationException e) {
      activateUser(username,requirePasswordChange);
    }
  }
  clearCacheForUser(username);
}
