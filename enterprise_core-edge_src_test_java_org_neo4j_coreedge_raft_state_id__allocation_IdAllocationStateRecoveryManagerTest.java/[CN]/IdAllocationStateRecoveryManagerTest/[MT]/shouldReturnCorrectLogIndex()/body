{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  File file=new File(testDir.directory(),"file");
  FlushableChannel channel=new PhysicalFlushableChannel(fsa.open(file,"rw"));
  putRecordWithIndex(42,channel);
  channel.close();
  IdAllocationStateRecoveryManager manager=new IdAllocationStateRecoveryManager(fsa,new InMemoryIdAllocationStateChannelMarshal());
  final long logIndex=manager.getOrdinalOfLastRecord(file);
  assertEquals(42,logIndex);
}
