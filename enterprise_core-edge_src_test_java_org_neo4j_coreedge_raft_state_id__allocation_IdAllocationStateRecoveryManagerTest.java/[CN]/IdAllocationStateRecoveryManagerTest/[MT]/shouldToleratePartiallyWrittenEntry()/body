{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  File fileA=new File(testDir.directory(),"fileA");
  FlushableChannel channelAWrite=new PhysicalFlushableChannel(fsa.create(fileA));
  putRecordWithIndex(42,channelAWrite);
  channelAWrite.putLong(101);
  channelAWrite.close();
  File fileB=new File(testDir.directory(),"fileB");
  FlushableChannel channelBWrite=new PhysicalFlushableChannel(fsa.create(fileB));
  filUpWithRecords(channelBWrite);
  channelBWrite.close();
  IdAllocationStateRecoveryManager manager=new IdAllocationStateRecoveryManager(fsa,new InMemoryIdAllocationStateChannelMarshal());
  final StateRecoveryManager.RecoveryStatus recoveryStatus=manager.recover(fileA,fileB);
  assertEquals(fileA,recoveryStatus.previouslyInactive());
  assertEquals(fileB,recoveryStatus.previouslyActive());
}
