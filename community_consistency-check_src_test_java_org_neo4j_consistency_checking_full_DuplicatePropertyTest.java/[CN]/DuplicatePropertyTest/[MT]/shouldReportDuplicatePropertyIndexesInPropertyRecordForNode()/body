{
  ChainCheck check=new ChainCheck();
  RecordAccessStub records=new RecordAccessStub();
  NodeRecord master=records.add(inUse(new NodeRecord(1,false,-1,1)));
  PropertyRecord propertyRecord=inUse(new PropertyRecord(1));
  PropertyBlock firstBlock=new PropertyBlock();
  firstBlock.setSingleBlock(1);
  firstBlock.setKeyIndexId(1);
  PropertyBlock secondBlock=new PropertyBlock();
  secondBlock.setSingleBlock(1);
  secondBlock.setKeyIndexId(2);
  PropertyBlock thirdBlock=new PropertyBlock();
  thirdBlock.setSingleBlock(1);
  thirdBlock.setKeyIndexId(1);
  propertyRecord.addPropertyBlock(firstBlock);
  propertyRecord.addPropertyBlock(secondBlock);
  propertyRecord.addPropertyBlock(thirdBlock);
  records.add(propertyRecord);
  ConsistencyReport.NodeConsistencyReport report=mock(ConsistencyReport.NodeConsistencyReport.class);
  CheckerEngine<NodeRecord,ConsistencyReport.NodeConsistencyReport> checkEngine=records.engine(master,report);
  check.checkReference(master,propertyRecord,checkEngine,records);
  verify(report).propertyKeyNotUniqueInChain();
}
