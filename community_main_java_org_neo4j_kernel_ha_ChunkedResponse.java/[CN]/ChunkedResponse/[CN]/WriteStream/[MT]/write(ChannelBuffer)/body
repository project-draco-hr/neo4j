{
  for (int space=CHUNK_SIZE - buffer.writerIndex(); current != null && space > 0; space=CHUNK_SIZE - buffer.writerIndex()) {
    if (data == null) {
      if (space < 12)       return;
      buffer.writeLong(current.first());
      buffer.writeInt(current.other().size());
      data=current.other().iterator();
    }
 else     if (data.hasNext()) {
      if (space < CHOP_SIZE)       return;
      buffer.writeBytes(data.next());
    }
 else {
      data=null;
      current=next();
    }
  }
  if (current == null) {
    state=next;
  }
}
