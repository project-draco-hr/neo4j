{
  String key="key", value="value";
  HighlyAvailableGraphDatabase master=cluster.getMaster();
  long nodeId=createNode(master,key,value,true);
  cluster.sync();
  Map<HighlyAvailableGraphDatabase,IndexManager> indexManagers=new HashMap<HighlyAvailableGraphDatabase,IndexManager>();
  Map<HighlyAvailableGraphDatabase,Index<Node>> indexes=new HashMap<HighlyAvailableGraphDatabase,Index<Node>>();
  for (  HighlyAvailableGraphDatabase db : cluster.getAllMembers()) {
    indexManagers.put(db,db.index());
    indexes.put(db,db.index().forNodes(key));
  }
  cluster.shutdown(master);
  indexManagers.remove(master);
  indexes.remove(master);
  for (  IndexManager indexManager : indexManagers.values()) {
    assertTrue(indexManager.existsForNodes(key));
    assertEquals(nodeId,indexManager.forNodes(key).get(key,value).getSingle().getId());
  }
  for (  Index<Node> index : indexes.values())   assertEquals(nodeId,index.get(key,value).getSingle().getId());
}
