{
  BoltResponseRecorder recorder=new BoltResponseRecorder();
  BoltStateMachine machine=env.newMachine("<test>");
  machine.init("TestClient",emptyMap(),null);
  machine.run("BEGIN",emptyMap(),recorder);
  machine.discardAll(new NullResponseHandler());
  machine.run("CREATE (n:InTx)",emptyMap(),recorder);
  machine.discardAll(new NullResponseHandler());
  machine.run("COMMIT",emptyMap(),recorder);
  machine.discardAll(new NullResponseHandler());
  assertThat(recorder.nextResponse(),succeeded());
  assertThat(recorder.nextResponse(),succeeded());
  assertThat(recorder.nextResponse(),succeeded());
}
