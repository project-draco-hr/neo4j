{
  Thread currentThread=Thread.currentThread();
  LockElement le=null;
  while (locked && lockingThread != currentThread) {
    if (le == null)     le=new LockElement(currentThread);
    waitingThreadList.addFirst(le);
    try {
      wait();
    }
 catch (    InterruptedException e) {
      Thread.interrupted();
    }
  }
  locked=true;
  lockingThread=currentThread;
  if (le != null)   le.movedOn=true;
  marked--;
  if (operationType == OperationType.WRITE) {
    isDirty=true;
  }
}
