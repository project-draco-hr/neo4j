{
  ByteBuffer buffer=ByteBuffer.allocateDirect(4 * 1024 * RECORD_SIZE);
  long position=0, fileSize=fileChannel.size();
  while (position < fileSize) {
    int recordOffset=0;
    buffer.clear();
    fileChannel.read(buffer,position);
    while (recordOffset < buffer.capacity() && (recordOffset + position) < fileSize) {
      buffer.position(recordOffset);
      long id=(position + recordOffset) / RECORD_SIZE;
      visitor.visit(id,readRecord(buffer,id));
      recordOffset+=RECORD_SIZE;
    }
    position+=buffer.capacity();
  }
}
