{
  CleanupService service=new ReferenceQueueBasedCleanupService(scheduler,mock(Logging.class),referenceQueue);
  service.start();
  Runnable cleanupTask=acquireCleanupTask();
  CleanupReference collectedReference=mock(CleanupReference.class);
  when(referenceQueue.remove()).thenReturn(collectedReference).thenReturn(null);
  cleanupTask.run();
  verify(collectedReference,times(1)).cleanupNow(false);
}
