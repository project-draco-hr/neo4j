{
  CleanupService service=new ReferenceQueueBasedCleanupService(scheduler,mock(Logging.class),referenceQueue,TRUE);
  service.start();
  Resource handler=mock(Resource.class);
  ResourceIterator<Object> reference=service.resourceIterator(new StubIterator(1,2,3),handler);
  while (reference.hasNext()) {
    if (reference.next().equals(2)) {
      break;
    }
  }
  verify(handler,never()).close();
}
