{
  CleanupService service=new ReferenceQueueBasedCleanupService(scheduler,mock(Logging.class),referenceQueue);
  service.start();
  Closeable handler=mock(Closeable.class);
  ResourceIterator<Object> reference=service.resourceIterator(new StubIterator(1,2,3),handler);
  while (reference.hasNext())   reference.next();
  verify(handler,times(1)).close();
}
