{
  Logging logging=mock(Logging.class);
  StringLogger logger=mock(StringLogger.class);
  when(logging.getMessagesLog(any(Class.class))).thenReturn(logger);
  CleanupService service=new ReferenceQueueBasedCleanupService(scheduler,logging,referenceQueue);
  service.start();
  Runnable cleanupTask=acquireCleanupTask();
  Closeable handler=mock(Closeable.class);
  ResourceIterator<Object> reference=service.resourceIterator(new StubIterator(),handler);
  when(referenceQueue.remove()).thenReturn(((AutoCleanupResourceIterator)reference).cleanup).thenReturn(null);
  cleanupTask.run();
  verify(handler,times(1)).close();
  verify(logger).warn("Resource not closed: AutoCleanupResourceIterator(StubIterator())");
}
