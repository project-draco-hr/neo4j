{
  TransactionRepresentation alreadyCommittedTx1=mock(TransactionRepresentation.class);
  TransactionRepresentation alreadyCommittedTx2=mock(TransactionRepresentation.class);
  TransactionRepresentation newTx=mock(TransactionRepresentation.class);
  StubLocalDatabase localDatabase=new StubLocalDatabase(3);
  final ReplayableCommitProcess txListener=new ReplayableCommitProcess(localDatabase,localDatabase);
  txListener.commit(alreadyCommittedTx1,new LockGroup(),NULL,EXTERNAL);
  txListener.commit(alreadyCommittedTx2,new LockGroup(),NULL,EXTERNAL);
  txListener.commit(newTx,new LockGroup(),NULL,EXTERNAL);
  verify(localDatabase.commitProcess,times(1)).commit(eq(newTx),any(LockGroup.class),any(CommitEvent.class),any(TransactionApplicationMode.class));
  verifyNoMoreInteractions(localDatabase.commitProcess);
}
