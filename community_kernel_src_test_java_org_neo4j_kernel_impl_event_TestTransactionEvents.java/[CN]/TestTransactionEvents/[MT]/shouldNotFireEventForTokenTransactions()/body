{
  final AtomicInteger counter=new AtomicInteger();
  dbRule.getGraphDatabaseService().registerTransactionEventHandler(new TransactionEventHandler.Adapter<Void>(){
    @Override public Void beforeCommit(    TransactionData data) throws Exception {
      assertTrue("Expected only transactions that had nodes or relationships created",data.createdNodes().iterator().hasNext() || data.createdRelationships().iterator().hasNext());
      counter.incrementAndGet();
      return null;
    }
  }
);
  try (Transaction tx=dbRule.beginTx()){
    dbRule.createNode(label("Label"));
    tx.success();
  }
   try (Transaction tx=dbRule.beginTx()){
    dbRule.createNode().setProperty("key","value");
    tx.success();
  }
   try (Transaction tx=dbRule.beginTx()){
    dbRule.createNode().createRelationshipTo(dbRule.createNode(),withName("A_TYPE"));
    tx.success();
  }
   assertEquals(3,counter.get());
}
