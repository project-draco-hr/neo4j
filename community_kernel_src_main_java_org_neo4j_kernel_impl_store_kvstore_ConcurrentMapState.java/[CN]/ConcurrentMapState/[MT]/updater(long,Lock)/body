{
  if (versionSequence.seen(version,0)) {
    throw new IllegalStateException("Cannot apply update with given version " + version + " when base version is "+ previousVersion);
  }
  versionSequence.offer(version,0);
  update(highestAppliedVersion,version);
  return new Updater<>(lock,store,changes,appliedChanges);
}
