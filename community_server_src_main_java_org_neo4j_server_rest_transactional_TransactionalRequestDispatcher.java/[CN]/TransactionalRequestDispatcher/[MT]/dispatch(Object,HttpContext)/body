{
  if (o instanceof RestfulGraphDatabase) {
    RestfulGraphDatabase restfulGraphDatabase=(RestfulGraphDatabase)o;
    final Transaction transaction=database.getGraph().beginTx();
    restfulGraphDatabase.getOutputFormat().setRepresentationWrittenHandler(new RepresentationWrittenHandler(){
      @Override public void onRepresentationWritten(){
        HttpResponseContext response=httpContext.getResponse();
        int statusCode=response.getStatus();
        if (statusCode >= 200 && statusCode < 300) {
          transaction.success();
        }
      }
      @Override public void onRepresentationFinal(){
        transaction.finish();
      }
    }
);
  }
 else   if (o instanceof BatchOperationService) {
    BatchOperationService batchOperationService=(BatchOperationService)o;
    final Transaction transaction=database.getGraph().beginTx();
    batchOperationService.setRepresentationWrittenHandler(new RepresentationWrittenHandler(){
      @Override public void onRepresentationWritten(){
        HttpResponseContext response=httpContext.getResponse();
        int statusCode=response.getStatus();
        if (statusCode >= 200 && statusCode < 300) {
          transaction.success();
        }
      }
      @Override public void onRepresentationFinal(){
        transaction.finish();
      }
    }
);
  }
 else   if (o instanceof CypherService) {
    CypherService cypherService=(CypherService)o;
    final Transaction transaction=database.getGraph().beginTx();
    cypherService.getOutputFormat().setRepresentationWrittenHandler(new RepresentationWrittenHandler(){
      @Override public void onRepresentationWritten(){
        HttpResponseContext response=httpContext.getResponse();
        int statusCode=response.getStatus();
        if (statusCode >= 200 && statusCode < 300) {
          transaction.success();
        }
      }
      @Override public void onRepresentationFinal(){
        transaction.finish();
      }
    }
);
  }
  requestDispatcher.dispatch(o,httpContext);
}
