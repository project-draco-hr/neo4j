{
  IndexUpdater indexUpdater=mock(IndexUpdater.class);
  IndexCountVisitor indexCountVisitor=mock(IndexCountVisitor.class);
  CountingIndexUpdater countingIndexUpdater=new CountingIndexUpdater(42l,indexUpdater,indexCountVisitor);
  NodePropertyUpdate update=NodePropertyUpdate.remove(1,2,"x",new long[]{3});
  countingIndexUpdater.process(update);
  countingIndexUpdater.close();
  verify(indexUpdater).process(update);
  verify(indexCountVisitor).incrementIndexCount(eq(42l),eq(-1l));
  verify(indexUpdater).close();
  verifyNoMoreInteractions(indexCountVisitor);
  verifyNoMoreInteractions(indexUpdater);
}
