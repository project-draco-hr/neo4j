{
  IndexUpdater indexUpdater=mock(IndexUpdater.class);
  IndexCountVisitor indexCountVisitor=mock(IndexCountVisitor.class);
  CountingIndexUpdater countingIndexUpdater=new CountingIndexUpdater(42l,indexUpdater,indexCountVisitor);
  NodePropertyUpdate update1=NodePropertyUpdate.add(1,2,"x",new long[]{3});
  NodePropertyUpdate update2=NodePropertyUpdate.add(4,2,"x",new long[]{3});
  NodePropertyUpdate update3=NodePropertyUpdate.remove(4,2,"x",new long[]{3});
  countingIndexUpdater.process(update1);
  countingIndexUpdater.process(update2);
  countingIndexUpdater.process(update3);
  countingIndexUpdater.close();
  verify(indexUpdater).process(update1);
  verify(indexUpdater).process(update2);
  verify(indexUpdater).process(update3);
  verify(indexCountVisitor).incrementIndexCount(eq(42l),eq(1l));
  verify(indexUpdater).close();
  verifyNoMoreInteractions(indexCountVisitor);
  verifyNoMoreInteractions(indexUpdater);
}
