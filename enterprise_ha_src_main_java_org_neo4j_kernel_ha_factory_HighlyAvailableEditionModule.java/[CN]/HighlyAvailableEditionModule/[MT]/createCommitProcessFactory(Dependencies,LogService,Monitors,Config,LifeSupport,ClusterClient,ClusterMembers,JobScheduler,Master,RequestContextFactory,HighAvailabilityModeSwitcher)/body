{
  final DelegateInvocationHandler<TransactionCommitProcess> commitProcessDelegate=new DelegateInvocationHandler<>(TransactionCommitProcess.class);
  DefaultSlaveFactory slaveFactory=dependencies.satisfyDependency(new DefaultSlaveFactory(logging.getInternalLogProvider(),monitors,config.get(HaSettings.com_chunk_size).intValue()));
  Slaves slaves=dependencies.satisfyDependency(paxosLife.add(new HighAvailabilitySlaves(members,clusterClient,slaveFactory)));
  final TransactionPropagator pusher=paxosLife.add(new TransactionPropagator(TransactionPropagator.from(config),logging.getInternalLog(TransactionPropagator.class),slaves,new CommitPusher(jobScheduler)));
  return new CommitProcessFactory(){
    @Override public TransactionCommitProcess create(    TransactionAppender appender,    KernelHealth kernelHealth,    NeoStore neoStore,    TransactionRepresentationStoreApplier storeApplier,    NeoStoreInjectedTransactionValidator txValidator,    IndexUpdatesValidator indexUpdatesValidator,    Config config){
      if (config.get(GraphDatabaseSettings.read_only)) {
        return new ReadOnlyTransactionCommitProcess();
      }
 else {
        TransactionCommitProcess inner=new TransactionRepresentationCommitProcess(appender,storeApplier,indexUpdatesValidator);
        paxosLife.add(new CommitProcessSwitcher(pusher,master,commitProcessDelegate,requestContextFactory,highAvailabilityModeSwitcher,txValidator,inner));
        return (TransactionCommitProcess)newProxyInstance(TransactionCommitProcess.class.getClassLoader(),new Class[]{TransactionCommitProcess.class},commitProcessDelegate);
      }
    }
  }
;
}
