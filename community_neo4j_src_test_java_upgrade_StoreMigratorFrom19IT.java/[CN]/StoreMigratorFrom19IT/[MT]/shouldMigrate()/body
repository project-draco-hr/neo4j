{
  StoreUpgrader upgrader=new StoreUpgrader(ALLOW_UPGRADE,fs,StoreUpgrader.NO_MONITOR);
  upgrader.addParticipant(new StoreMigrator(monitor,fs));
  File legacyStoreDir=find19FormatHugeStoreDirectory(storeDir.directory());
  upgrader.migrateIfNeeded(legacyStoreDir);
  assertEquals(100,monitor.eventSize());
  assertTrue(monitor.isStarted());
  assertTrue(monitor.isFinished());
  GraphDatabaseService database=cleanup.add(new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.absolutePath()));
  try {
    verifyDatabaseContents(database);
  }
  finally {
    database.shutdown();
  }
  NeoStore neoStore=cleanup.add(storeFactory.newNeoStore(true));
  verifyNeoStore(neoStore);
  neoStore.close();
  assertConsistentStore(storeDir.directory());
}
