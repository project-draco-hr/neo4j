{
  try {
    for (    Map.Entry<IndexIdentifier,CommandList> entry : this.commandMap.entrySet()) {
      if (entry.getValue().isEmpty()) {
        continue;
      }
      IndexIdentifier identifier=entry.getKey();
      CommandList commandList=entry.getValue();
      IndexType type=identifier == LuceneCommand.CreateIndexCommand.FAKE_IDENTIFIER || !commandList.containsWrites() ? null : dataSource.getType(identifier);
      CommitContext context=new CommitContext(dataSource,identifier,type,commandList);
      for (      LuceneCommand command : commandList.commands) {
        command.perform(context);
      }
      applyDocuments(context.writer,type,context.documents);
      if (context.writer != null) {
        dataSource.invalidateIndexSearcher(identifier);
      }
    }
    dataSource.setLastCommittedTxId(getCommitTxId());
    closeTxData();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
