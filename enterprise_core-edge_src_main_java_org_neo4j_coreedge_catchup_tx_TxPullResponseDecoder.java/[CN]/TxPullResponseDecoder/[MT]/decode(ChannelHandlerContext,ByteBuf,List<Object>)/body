{
  if (protocol.isExpecting(NextMessage.TX_PULL_RESPONSE)) {
    NetworkReadableClosableChannelNetty4 logChannel=new NetworkReadableClosableChannelNetty4(msg);
    StoreId storeId=StoreIdMarshal.unmarshal(logChannel);
    LogEntryReader<NetworkReadableClosableChannelNetty4> reader=new VersionAwareLogEntryReader<>(new RecordStorageCommandReaderFactory());
    PhysicalTransactionCursor<NetworkReadableClosableChannelNetty4> transactionCursor=new PhysicalTransactionCursor<>(logChannel,reader);
    transactionCursor.next();
    CommittedTransactionRepresentation tx=transactionCursor.get();
    if (tx != null) {
      out.add(new TxPullResponse(storeId,tx));
    }
  }
 else {
    out.add(Unpooled.copiedBuffer(msg));
  }
}
