{
  LifeSupport life=new LifeSupport();
  Map<String,String> params=new HashMap<String,String>();
  params.put(HaSettings.server_id.name(),"-1");
  params.put(ClusterSettings.cluster_name.name(),clusterName);
  params.put(ClusterSettings.initial_hosts.name(),from);
  params.put(ClusterSettings.cluster_discovery_enabled.name(),"false");
  final Config config=new Config(params,ClusterSettings.class,OnlineBackupSettings.class);
  ClusterClient clusterClient=life.add(new ClusterClient(ClusterClient.adapt(config),logging,new NotElectableElectionCredentialsProvider()));
  ClusterMemberEvents events=life.add(new PaxosClusterMemberEvents(clusterClient,clusterClient,clusterClient,new SystemOutLogging(),Predicates.<PaxosClusterMemberEvents.ClusterMembersSnapshot>TRUE()));
  final Semaphore infoReceivedLatch=new Semaphore(0);
  final AtomicReference<URI> backupUri=new AtomicReference<URI>();
  events.addClusterMemberListener(new ClusterMemberListener.Adapter(){
    Map<URI,URI> backupUris=new HashMap<URI,URI>();
    URI master=null;
    @Override public void memberIsAvailable(    String role,    URI clusterUri,    URI roleUri){
      if (OnlineBackupKernelExtension.BACKUP.equals(role)) {
        backupUris.put(clusterUri,roleUri);
      }
 else       if (HighAvailabilityModeSwitcher.MASTER.equals(role)) {
        master=clusterUri;
      }
      if (master != null && backupUris.containsKey(master)) {
        backupUri.set(backupUris.get(master));
        infoReceivedLatch.release();
      }
    }
  }
);
  life.start();
  try {
    if (!infoReceivedLatch.tryAcquire(10,TimeUnit.SECONDS)) {
      throw new RuntimeException("Could not find backup server in cluster " + clusterName + " at "+ from+ ", "+ "operation timed out");
    }
  }
 catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
 finally {
    life.shutdown();
  }
  return backupUri.get().toString();
}
