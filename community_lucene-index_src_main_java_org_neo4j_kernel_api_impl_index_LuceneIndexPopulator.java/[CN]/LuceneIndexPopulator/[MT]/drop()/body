{
  if (writer != null) {
    writer.close();
  }
  try {
    DirectorySupport.deleteDirectoryContents(directory=directory == null ? dirFactory.open(dirFile) : directory);
  }
 catch (  AlreadyClosedException e) {
    DirectorySupport.deleteDirectoryContents(directory=dirFactory.open(dirFile));
  }
 finally {
    if (directory != null) {
      directory.close();
    }
  }
  failureStorage.clearForIndex(indexId);
}
