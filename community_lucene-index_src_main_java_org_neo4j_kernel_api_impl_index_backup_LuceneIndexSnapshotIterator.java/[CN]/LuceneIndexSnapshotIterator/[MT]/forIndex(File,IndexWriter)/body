{
  IndexDeletionPolicy deletionPolicy=indexWriter.getConfig().getIndexDeletionPolicy();
  if (deletionPolicy instanceof SnapshotDeletionPolicy) {
    SnapshotDeletionPolicy policy=(SnapshotDeletionPolicy)deletionPolicy;
    return policy.getSnapshotCount() > 0 ? new LuceneIndexSnapshotIterator(indexDirectory,policy) : emptyIterator();
  }
 else {
    throw new UnsupportedIndexDeletionPolicy("Can't perform index snapshot with specified index deleiton " + "policy: " + deletionPolicy.getClass().getName() + ". "+ "Only "+ SnapshotDeletionPolicy.class.getName()+ " is "+ "supported");
  }
}
