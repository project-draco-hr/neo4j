{
  if (!directoryContainsDb(targetDirectory)) {
    logger.info("Previous backup not found, a new full backup will be performed.");
    return doFullBackup(sourceHostNameOrIp,sourcePort,targetDirectory,verification,config,timeout,forensics);
  }
  try {
    logger.info("Previous backup found, trying incremental backup.");
    return doIncrementalBackup(sourceHostNameOrIp,sourcePort,targetDirectory,verification,timeout,config);
  }
 catch (  IncrementalBackupNotPossibleException e) {
    try {
      logger.info("Existing backup is too far out of date, a new full backup will be performed.");
      File targetDirFile=new File(targetDirectory);
      FileUtils.deleteRecursively(targetDirFile);
      return doFullBackup(sourceHostNameOrIp,sourcePort,targetDirFile.getAbsolutePath(),verification,config,timeout,forensics);
    }
 catch (    Exception fullBackupFailure) {
      throw new RuntimeException("Failed to perform incremental backup, fell back to full backup, " + "but that failed as well: '" + fullBackupFailure.getMessage() + "'.",fullBackupFailure);
    }
  }
}
