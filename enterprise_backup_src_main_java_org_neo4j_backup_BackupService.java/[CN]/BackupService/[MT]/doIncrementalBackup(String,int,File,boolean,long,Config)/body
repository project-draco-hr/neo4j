{
  if (!directoryContainsDb(targetDirectory)) {
    throw new RuntimeException(targetDirectory + " doesn't contain a database");
  }
  ConfigParam keepLogs=new ConfigParam(){
    @Override public void configure(    Map<String,String> config){
      config.put(GraphDatabaseSettings.keep_logical_logs.name(),Settings.TRUE);
    }
  }
;
  config=config.with(buildTempDbConfig(keepLogs));
  try (PageCache pageCache=createPageCache(new DefaultFileSystemAbstraction(),config)){
    GraphDatabaseAPI targetDb=startTemporaryDb(targetDirectory,pageCache,config.getParams());
    long backupStartTime=System.currentTimeMillis();
    BackupOutcome outcome=null;
    try {
      outcome=doIncrementalBackup(sourceHostNameOrIp,sourcePort,targetDb,timeout);
    }
  finally {
      targetDb.shutdown();
    }
    bumpMessagesDotLogFile(targetDirectory,backupStartTime);
    removeIdFiles(targetDirectory);
    return outcome;
  }
 catch (  IOException e) {
    throw new IncrementalBackupNotPossibleException(e);
  }
}
