{
  Map<String,String> props=new HashMap<String,String>();
  props.put(Config.USE_MEMORY_MAPPED_LOG,"false");
  LogBufferFactory fac=CommonFactories.defaultLogBufferFactory(props);
  FileChannel channel=new RandomAccessFile("target/var/foobar4","rw").getChannel();
  LogBuffer buffer=fac.create(channel);
  assertEquals(DirectMappedLogBuffer.class,buffer.getClass());
  int writesAtFirst=DirectMappedLogBuffer.BUFFER_SIZE / 4;
  for (int i=0; i < writesAtFirst; i++) {
    buffer.putInt(i);
  }
  FileChannel channel2=new RandomAccessFile("target/var/foobar5","rw").getChannel();
  FileChannel dup=fac.combine(channel2,buffer);
  for (int i=0; i < 1; i++) {
    buffer.putInt(i);
  }
  ByteBuffer readInMe=ByteBuffer.allocate(writesAtFirst * 4);
  dup.read(readInMe);
  readInMe.flip();
  for (int i=0; i < writesAtFirst; i++) {
    assertEquals(i,readInMe.getInt());
  }
}
