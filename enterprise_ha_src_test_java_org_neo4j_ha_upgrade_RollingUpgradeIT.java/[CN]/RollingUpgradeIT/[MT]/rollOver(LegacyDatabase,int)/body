{
  String storeDir=legacyDb.getStoreDir();
  stop(i);
  Thread.sleep(30000);
  debug("Starting " + i + " as current version");
  newDbs[i]=(GraphDatabaseAPI)new HighlyAvailableGraphDatabaseFactory().newHighlyAvailableDatabaseBuilder(storeDir).setConfig(config(i)).newGraphDatabase();
  debug("Started " + i + " as current version");
  legacyDbs[i]=null;
  String name="upgraded-" + i;
  long node=createNodeWithRetry(newDbs[i],name);
  debug("Node created on " + i);
  for (int j=0; j < i; j++) {
    if (legacyDbs[i] != null) {
      legacyDbs[j].verifyNodeExists(node,name);
      debug("Verified on legacy db " + j);
    }
  }
  for (int j=0; j < newDbs.length; j++) {
    if (newDbs[j] != null) {
      verifyNodeExists(newDbs[j],node,name);
      debug("Verified on new db " + j);
    }
  }
}
