{
  final AuthorizationFilter filter=new AuthorizationFilter(authManager,logProvider);
  String credentials=Base64.encodeBase64String("foo:bar".getBytes(Charsets.UTF_8));
  when(servletRequest.getMethod()).thenReturn("GET");
  when(servletRequest.getContextPath()).thenReturn("/user/foo");
  when(servletRequest.getHeader(HttpHeaders.AUTHORIZATION)).thenReturn("BASIC " + credentials);
  when(authManager.authenticate("foo","bar")).thenReturn(AuthenticationResult.PASSWORD_CHANGE_REQUIRED);
  filter.doFilter(servletRequest,servletResponse,filterChain);
  verify(filterChain).doFilter(eq(new AuthorizedRequestWrapper(BASIC_AUTH,"foo",servletRequest)),same(servletResponse));
}
