{
  OmegaContext context=Mockito.mock(OmegaContext.class);
  Message<OmegaMessage> message=Message.internal(OmegaMessage.refresh_timeout);
  MessageHolder outgoing=Mockito.mock(MessageHolder.class);
  State state=new State(new EpochNumber());
  Mockito.when(context.getMyState()).thenReturn(state);
  Set<URI> servers=new HashSet<URI>();
  servers.add(new URI("localhost:80"));
  servers.add(new URI("localhost:81"));
  Mockito.when(context.getServers()).thenReturn((Collection)servers);
  OmegaState result=(OmegaState)OmegaState.omega.handle(context,message,outgoing);
  assertEquals(OmegaState.omega,result);
  Mockito.verify(context).getServers();
  Mockito.verify(outgoing,Mockito.times(servers.size())).process(Matchers.isA(Message.class));
  Mockito.verify(context).startRefreshRound();
}
