{
  T existing=index.get(key,value).getSingle();
  if (existing != null) {
    return existing;
  }
  IndexLock lock=new IndexLock(index.getName(),key);
  TransactionState state=getTransactionState();
  LockElement writeLock=state.acquireWriteLock(lock);
  existing=index.get(key,value).getSingle();
  if (existing != null) {
    writeLock.release();
    return existing;
  }
  index.add(entity,key,value);
  return null;
}
