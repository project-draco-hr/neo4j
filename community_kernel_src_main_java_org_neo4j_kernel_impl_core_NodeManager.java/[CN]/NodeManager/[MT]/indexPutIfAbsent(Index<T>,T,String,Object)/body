{
  T existing=index.get(key,value).getSingle();
  if (existing != null) {
    return existing;
  }
  try (Statement statement=threadToTransactionBridge.instance()){
    statement.readOperations().acquireExclusive(ResourceTypes.LEGACY_INDEX,legacyIndexResourceId(index.getName(),key));
    existing=index.get(key,value).getSingle();
    if (existing != null) {
      statement.readOperations().releaseExclusive(ResourceTypes.LEGACY_INDEX,legacyIndexResourceId(index.getName(),key));
      return existing;
    }
    index.add(entity,key,value);
    return null;
  }
 }
