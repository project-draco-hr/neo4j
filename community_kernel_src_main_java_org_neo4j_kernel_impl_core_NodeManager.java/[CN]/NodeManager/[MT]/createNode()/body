{
  long id=idGeneratorFactory.get(IdType.NODE).nextId();
  NodeImpl node=new NodeImpl(id,true);
  TransactionState transactionState=getTransactionState();
  transactionState.locks().acquireExclusive(ResourceTypes.NODE,id);
  boolean success=false;
  try {
    threadToTransactionBridge.getNeoStoreTransactionBoundToThisThread(true).nodeCreate(id);
    transactionState.createNode(id);
    nodeCache.put(node);
    success=true;
    return id;
  }
  finally {
    if (!success) {
      setRollbackOnly();
    }
  }
}
