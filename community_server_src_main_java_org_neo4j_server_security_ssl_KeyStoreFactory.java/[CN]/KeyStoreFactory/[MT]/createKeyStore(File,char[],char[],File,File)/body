{
  FileOutputStream fis=null;
  try {
    if (keyStorePath.exists()) {
      keyStorePath.delete();
    }
    ensureFolderExists(keyStorePath.getParentFile());
    KeyStore keyStore=KeyStore.getInstance("JKS");
    keyStore.load(null,keyStorePassword);
    keyStore.setKeyEntry("key",sslCertificateFactory.loadPrivateKey(privateKeyFile),keyPassword,sslCertificateFactory.loadCertificates(certFile));
    fis=new FileOutputStream(keyStorePath.getAbsolutePath());
    keyStore.store(fis,keyStorePassword);
  }
  finally {
    if (fis != null) {
      try {
        fis.close();
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
}
