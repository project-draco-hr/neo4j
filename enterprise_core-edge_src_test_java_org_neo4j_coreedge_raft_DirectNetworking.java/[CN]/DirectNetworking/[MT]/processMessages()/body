{
  while (messagesToBeProcessed()) {
    for (    Map.Entry<Long,Queue<Message>> entry : messageQueues.entrySet()) {
      Long id=entry.getKey();
      Queue<Message> queue=entry.getValue();
      if (!queue.isEmpty()) {
        Message message=queue.remove();
        handlers.get(id).handle(message);
      }
    }
  }
}
