{
  if (!key.allZeroes()) {
    throw new IllegalStateException("Expecting a valid format specifier.");
  }
  if (!collector.verifyFormatSpecifier(value)) {
    collector.state=in_error;
    throw new IllegalStateException("Format header/trailer has changed.");
  }
  try {
    if (nextState == expecting_header) {
      collector.header=1;
      return true;
    }
 else {
      collector.trailer=1;
      return false;
    }
  }
  finally {
    collector.state=nextState;
  }
}
