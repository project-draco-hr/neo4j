{
  try {
    cleanupChildren();
    writeHaServerConfig();
    String root=getRoot();
    String path=root + "/" + machineId+ "_";
    String created=zooKeeper.create(path,dataRepresentingMe(committedTx,masterForCommittedTx),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL);
    subscribeToDataChangeWatcher(MASTER_NOTIFY_CHILD);
    subscribeToDataChangeWatcher(MASTER_REBOUND_CHILD);
    subscribeToChildrenChangeWatcher(HA_SERVERS_CHILD);
    subscribeToChildrenChangeWatcher(COMPATIBILITY_CHILD_19);
    return created.substring(created.lastIndexOf("_") + 1);
  }
 catch (  KeeperException e) {
    throw new ZooKeeperException("Unable to setup",e);
  }
catch (  InterruptedException e) {
    Thread.interrupted();
    throw new ZooKeeperException("Setup got interrupted",e);
  }
catch (  Throwable t) {
    throw new ZooKeeperException("Unknown setup error",t);
  }
}
