{
  beforeCompletionRunning=true;
  try {
    for (    Synchronization s : syncHooks) {
      try {
        s.beforeCompletion();
      }
 catch (      Throwable t) {
        logger.warn("Caught exception from tx syncronization[" + s + "] beforeCompletion()");
      }
    }
    while (!syncHooksAdded.isEmpty()) {
      List<Synchronization> addedHooks=syncHooksAdded;
      syncHooksAdded=new ArrayList<Synchronization>();
      for (      Synchronization s : addedHooks) {
        s.beforeCompletion();
        syncHooks.add(s);
      }
    }
  }
  finally {
    beforeCompletionRunning=false;
  }
}
