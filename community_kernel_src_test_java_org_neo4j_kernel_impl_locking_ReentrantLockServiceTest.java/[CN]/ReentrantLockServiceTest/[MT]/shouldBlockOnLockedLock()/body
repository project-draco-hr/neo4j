{
  LockService locks=new ReentrantLockService();
  LockNode lockSameNode=new LockNode(locks,17);
  ThreadRepository.Events events=threads.events();
  ThreadRepository.Signal ready=threads.signal();
  try (Lock ignored=locks.acquireNodeLock(17,LockService.LockType.WRITE_LOCK)){
    ThreadRepository.ThreadInfo thread=threads.execute(ready,lockSameNode,events.trigger("locked"),lockSameNode.release);
    ready.awaitNow();
    assertTrue(awaitParked(thread,5,TimeUnit.SECONDS));
    assertTrue(events.snapshot().isEmpty());
  }
   events.assertInOrder("locked");
}
