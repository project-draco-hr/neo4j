{
  createGraphDbAndKillIt();
  Monitors monitors=new Monitors();
  Recovery.Monitor listener=mock(Recovery.Monitor.class);
  monitors.addMonitorListener(listener);
  ConsistencyCheckTool consistencyCheckTool=newConsistencyCheckToolWith(monitors,new StoreRecoverer(fs.get()),mock(ConsistencyCheckTool.ExitHandle.class));
  consistencyCheckTool.run("-recovery",storeDirectory.absolutePath());
  verify(listener).recoveryRequired(anyLong());
  verify(listener).recoveryCompleted();
}
