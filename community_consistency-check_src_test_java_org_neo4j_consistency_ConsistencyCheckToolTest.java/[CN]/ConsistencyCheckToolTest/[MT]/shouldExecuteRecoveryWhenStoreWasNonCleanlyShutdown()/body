{
  createGraphDbAndKillIt();
  Monitors monitors=new Monitors();
  Recovery.Monitor listener=mock(Recovery.Monitor.class);
  monitors.addMonitorListener(listener);
  ConsistencyCheckTool consistencyCheckTool=newConsistencyCheckToolWith(monitors,mock(ConsistencyCheckTool.ExitHandle.class),fs.get());
  consistencyCheckTool.run("-recovery",storeDirectory.graphDbDir().getAbsolutePath());
  verify(listener).recoveryRequired(any(LogPosition.class));
  verify(listener).recoveryCompleted();
}
