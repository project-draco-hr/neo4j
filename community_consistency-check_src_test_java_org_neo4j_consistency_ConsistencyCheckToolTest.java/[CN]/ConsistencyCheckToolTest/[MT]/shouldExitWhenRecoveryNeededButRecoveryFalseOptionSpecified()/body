{
  File storeDir=storeDirectory.graphDbDir();
  EphemeralFileSystemAbstraction fileSystem=createDataBaseWithStateThatNeedsRecovery(storeDir);
  Monitors monitors=new Monitors();
  PhysicalLogFile.Monitor listener=mock(PhysicalLogFile.Monitor.class);
  monitors.addMonitorListener(listener);
  ExitHandle exitHandle=mock(ExitHandle.class);
  doThrow(new TransientDatabaseFailureException("Recovery required")).when(exitHandle).pull();
  try {
    runConsistencyCheckToolWith(monitors,exitHandle,fileSystem,"-recovery=false",storeDir.getAbsolutePath());
    fail("Recovery should be required and exit pull should be called.");
  }
 catch (  TransientDatabaseFailureException ignored) {
  }
  verifyZeroInteractions(listener);
  verify(exitHandle).pull();
}
