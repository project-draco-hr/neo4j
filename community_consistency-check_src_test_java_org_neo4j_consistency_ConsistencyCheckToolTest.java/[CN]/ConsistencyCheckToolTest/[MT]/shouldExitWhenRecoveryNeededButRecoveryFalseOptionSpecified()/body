{
  createGraphDbAndKillIt();
  Monitors monitors=new Monitors();
  PhysicalLogFile.Monitor listener=mock(PhysicalLogFile.Monitor.class);
  monitors.addMonitorListener(listener);
  ConsistencyCheckTool.ExitHandle exitHandle=mock(ConsistencyCheckTool.ExitHandle.class);
  StoreRecoverer storeRecoverer=mock(StoreRecoverer.class);
  when(storeRecoverer.recoveryNeededAt(any(File.class))).thenReturn(true);
  ConsistencyCheckTool consistencyCheckTool=newConsistencyCheckToolWith(monitors,storeRecoverer,exitHandle);
  consistencyCheckTool.run("-recovery=false",storeDirectory.absolutePath());
  verifyZeroInteractions(listener);
  verify(exitHandle).pull();
}
