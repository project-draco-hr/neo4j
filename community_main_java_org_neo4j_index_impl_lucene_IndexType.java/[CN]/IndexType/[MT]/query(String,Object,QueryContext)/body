{
  if (value instanceof Query) {
    return (Query)value;
  }
  QueryParser parser=new QueryParser(Version.LUCENE_30,keyOrNull,analyzer);
  parser.setAllowLeadingWildcard(true);
  parser.setLowercaseExpandedTerms(toLowerCase);
  if (contextOrNull != null && contextOrNull.defaultOperator != null) {
    parser.setDefaultOperator(contextOrNull.defaultOperator);
  }
  try {
    return parser.parse(value.toString());
  }
 catch (  ParseException e) {
    throw new RuntimeException(e);
  }
}
