{
  int count=0;
  Set<String> otherKeys=IteratorUtil.addToCollection(otherEntity.getPropertyKeys().iterator(),new HashSet<String>());
  for (  String key : entity.getPropertyKeys()) {
    Object value1=entity.getProperty(key);
    Object value2=otherEntity.getProperty(key);
    if (value1.getClass().isArray() && value2.getClass().isArray()) {
    }
 else     if (!value1.equals(value2)) {
      throw new RuntimeException(entity + " not equals property '" + key+ "': "+ value1+ ", "+ value2);
    }
    otherKeys.remove(key);
    count++;
  }
  if (!otherKeys.isEmpty()) {
    throw new RuntimeException("Other node " + otherEntity + " has more properties: "+ otherKeys);
  }
  return count;
}
