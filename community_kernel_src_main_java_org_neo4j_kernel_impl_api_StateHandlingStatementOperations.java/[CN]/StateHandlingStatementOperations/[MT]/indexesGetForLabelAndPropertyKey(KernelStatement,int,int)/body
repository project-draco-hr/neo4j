{
  Iterable<IndexDescriptor> committedRules;
  try {
    committedRules=option(schemaReadDelegate.indexesGetForLabelAndPropertyKey(state,labelId,propertyKey));
  }
 catch (  SchemaRuleNotFoundException e) {
    committedRules=emptyList();
  }
  DiffSets<IndexDescriptor> ruleDiffSet=state.txState().indexDiffSetsByLabel(labelId);
  Iterator<IndexDescriptor> rules=state.hasTxStateWithChanges() ? ruleDiffSet.apply(committedRules.iterator()) : committedRules.iterator();
  IndexDescriptor single=singleOrNull(rules);
  if (single == null) {
    throw new SchemaRuleNotFoundException("Index rule for label:" + labelId + " and property:"+ propertyKey+ " not found");
  }
  return single;
}
