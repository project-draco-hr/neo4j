{
  Iterable<IndexDescriptor> committedRules;
  try {
    committedRules=option(storeLayer.indexesGetForLabelAndPropertyKey(state,labelId,propertyKey));
  }
 catch (  SchemaRuleNotFoundException e) {
    committedRules=emptyList();
  }
  DiffSets<IndexDescriptor> ruleDiffSet=state.txState().indexDiffSetsByLabel(labelId);
  boolean hasTxStateWithChanges=state.hasTxStateWithChanges();
  Iterator<IndexDescriptor> rules=hasTxStateWithChanges ? filterByPropertyKeyId(ruleDiffSet.apply(committedRules.iterator()),propertyKey) : committedRules.iterator();
  IndexDescriptor single=singleOrNull(rules);
  if (single == null) {
    throw new SchemaRuleNotFoundException("Index rule for label:" + labelId + " and property:"+ propertyKey+ " not found");
  }
  return single;
}
