{
  if (state.hasTxStateWithChanges()) {
    int degree=0;
    if (state.txState().nodeIsDeletedInThisTx(nodeId)) {
      return 0;
    }
    if (!state.txState().nodeIsAddedInThisTx(nodeId)) {
      degree=storeLayer.nodeGetDegree(state.getStoreStatement(),nodeId,direction);
    }
    return state.txState().augmentNodeDegree(nodeId,degree,direction);
  }
 else {
    return storeLayer.nodeGetDegree(state.getStoreStatement(),nodeId,direction);
  }
}
