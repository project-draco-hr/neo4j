{
  if (state.hasTxStateWithChanges()) {
    if (state.txState().nodeIsAddedInThisTx(nodeId)) {
      return state.txState().addedAndChangedNodeProperties(nodeId);
    }
    if (state.txState().nodeIsDeletedInThisTx(nodeId)) {
      throw new IllegalStateException("Node " + nodeId + " has been deleted");
    }
    return state.txState().augmentNodeProperties(nodeId,storeLayer.nodeGetAllProperties(nodeId));
  }
  return storeLayer.nodeGetAllProperties(nodeId);
}
