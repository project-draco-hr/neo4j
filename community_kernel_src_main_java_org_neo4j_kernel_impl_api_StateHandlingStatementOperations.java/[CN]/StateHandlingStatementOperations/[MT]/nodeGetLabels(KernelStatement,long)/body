{
  if (state.hasTxStateWithChanges()) {
    if (state.txState().nodeIsDeletedInThisTx(nodeId)) {
      return PrimitiveIntCollections.emptyIterator();
    }
    if (state.txState().nodeIsAddedInThisTx(nodeId)) {
      return PrimitiveIntCollections.toPrimitiveIterator(state.txState().nodeStateLabelDiffSets(nodeId).getAdded().iterator());
    }
    return state.txState().nodeStateLabelDiffSets(nodeId).augment(storeLayer.nodeGetLabels(nodeId));
  }
  return storeLayer.nodeGetLabels(nodeId);
}
