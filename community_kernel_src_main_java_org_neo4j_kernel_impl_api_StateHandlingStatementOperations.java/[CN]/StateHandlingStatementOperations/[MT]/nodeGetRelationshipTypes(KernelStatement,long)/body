{
  if (state.hasTxStateWithChanges() && state.txState().nodeModifiedInThisTx(nodeId)) {
    ReadableTxState tx=state.txState();
    if (tx.nodeIsDeletedInThisTx(nodeId)) {
      return PrimitiveIntCollections.emptyIterator();
    }
    if (tx.nodeIsAddedInThisTx(nodeId)) {
      return tx.nodeRelationshipTypes(nodeId);
    }
    Set<Integer> types=new HashSet<>();
    PrimitiveIntIterator typesInTx=tx.nodeRelationshipTypes(nodeId);
    while (typesInTx.hasNext()) {
      types.add(typesInTx.next());
    }
    PrimitiveIntIterator committedTypes=storeLayer.nodeGetRelationshipTypes(state.getStoreStatement(),nodeId);
    while (committedTypes.hasNext()) {
      int current=committedTypes.next();
      if (!types.contains(current) && nodeGetDegree(state,nodeId,Direction.BOTH,current) > 0) {
        types.add(current);
      }
    }
    return PrimitiveIntCollections.toPrimitiveIterator(types.iterator());
  }
  return storeLayer.nodeGetRelationshipTypes(state.getStoreStatement(),nodeId);
}
