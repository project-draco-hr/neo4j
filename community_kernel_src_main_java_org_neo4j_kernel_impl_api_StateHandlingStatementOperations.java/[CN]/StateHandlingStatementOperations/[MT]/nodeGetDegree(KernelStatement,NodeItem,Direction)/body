{
  if (state.hasTxStateWithChanges()) {
    int degree=0;
    if (state.txState().nodeIsDeletedInThisTx(node.id())) {
      return 0;
    }
    if (!state.txState().nodeIsAddedInThisTx(node.id())) {
      degree=storeLayer.nodeGetDegree(state.getStoreStatement(),node.id(),direction);
    }
    return state.txState().augmentNodeDegree(node.id(),degree,direction);
  }
 else {
    return storeLayer.nodeGetDegree(state.getStoreStatement(),node.id(),direction);
  }
}
