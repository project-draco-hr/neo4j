{
  TxState txState=state.txState();
  int labelId=index.getLabelId();
  int propertyKeyId=index.getPropertyKeyId();
  DiffSets<Long> diff=txState.nodesWithChangedProperty(propertyKeyId,value);
  HasLabelFilter hasLabel=new HasLabelFilter(state,labelId);
  diff=diff.filter(hasLabel);
  HasPropertyFilter hasPropertyFilter=new HasPropertyFilter(state,propertyKeyId,value);
  Iterator<Long> addedNodesWithLabel=txState.nodesWithLabelAdded(labelId).iterator();
  diff.addAll(filter(hasPropertyFilter,addedNodesWithLabel));
  Set<Long> removedNodesWithLabel=txState.nodesWithLabelChanged(index.getLabelId()).getRemoved();
  diff.removeAll(filter(hasPropertyFilter,removedNodesWithLabel.iterator()));
  return diff;
}
