{
  if (state.hasTxStateWithChanges()) {
    TxState txState=state.txState();
    DiffSets<Long> diff=nodesWithLabelAndPropertyDiffSet(state,index,value);
    if (diff.isEmpty()) {
      long indexNode=entityReadDelegate.nodeGetUniqueFromIndexLookup(state,index,value);
      return (!diff.isRemoved(indexNode)) ? nodeIfNotDeleted(indexNode,txState) : NO_SUCH_NODE;
    }
    Iterator<Long> iterator=diff.getAdded().iterator();
    return iterator.hasNext() ? nodeIfNotDeleted(single(iterator),txState) : NO_SUCH_NODE;
  }
  return entityReadDelegate.nodeGetUniqueFromIndexLookup(state,index,value);
}
