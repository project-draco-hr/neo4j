{
  DiffSets<Long> diff=state.txState().getNodesWithChangedProperty(index.getPropertyKeyId(),value);
  diff=diff.filterAdded(new HasLabelFilter(state,index.getLabelId()));
  HasPropertyFilter hasPropertyFilter=new HasPropertyFilter(state,index.getPropertyKeyId(),value);
  Iterator<Long> addedNodesWithLabel=state.txState().getNodesWithLabelAdded(index.getLabelId()).iterator();
  diff.addAll(Iterables.filter(hasPropertyFilter,addedNodesWithLabel));
  Set<Long> removedNodesWithLabel=state.txState().getNodesWithLabelChanged(index.getLabelId()).getRemoved();
  diff.removeAll(Iterables.filter(hasPropertyFilter,removedNodesWithLabel.iterator()));
  return state.txState().getDeletedNodes().apply(diff.apply(entityReadDelegate.nodesGetFromIndexLookup(state,index,value)));
}
