{
  Property existingProperty=nodeGetProperty(state,nodeId,property.propertyKeyId());
  if (!existingProperty.isDefined()) {
    legacyPropertyTrackers.nodeAddStoreProperty(nodeId,property);
    state.neoStoreTransaction.nodeAddProperty(nodeId,property.propertyKeyId(),property.value());
  }
 else {
    legacyPropertyTrackers.nodeChangeStoreProperty(nodeId,(DefinedProperty)existingProperty,property);
    state.neoStoreTransaction.nodeChangeProperty(nodeId,property.propertyKeyId(),property.value());
  }
  state.txState().nodeDoReplaceProperty(nodeId,existingProperty,property);
  return existingProperty;
}
