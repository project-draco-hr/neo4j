{
  Property existingProperty=nodeGetProperty(state,nodeId,property.propertyKeyId());
  if (!existingProperty.isDefined()) {
    legacyPropertyTrackers.nodeAddStoreProperty(nodeId,property);
  }
 else {
    legacyPropertyTrackers.nodeChangeStoreProperty(nodeId,(DefinedProperty)existingProperty,property);
  }
  state.txState().nodeDoReplaceProperty(nodeId,existingProperty,property);
  indexesUpdateProperty(state,nodeId,property.propertyKeyId(),existingProperty instanceof DefinedProperty ? (DefinedProperty)existingProperty : null,property);
  return existingProperty;
}
