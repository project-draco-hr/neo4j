{
  checkInterrupted();
  long previousPos=position();
  position(position);
  try {
    long transferred=0;
    ByteBuffer intermediary=ByteBuffer.allocateDirect(8096);
    while (transferred < count) {
      intermediary.clear();
      intermediary.limit((int)min(intermediary.capacity(),count - transferred));
      int read=src.read(intermediary);
      if (read == -1) {
        break;
      }
      transferred+=read;
      intermediary.flip();
    }
    return transferred;
  }
  finally {
    position(previousPos);
  }
}
