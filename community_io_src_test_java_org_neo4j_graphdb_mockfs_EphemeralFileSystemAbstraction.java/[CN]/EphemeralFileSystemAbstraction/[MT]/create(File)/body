{
  File parentFile=fileName.getParentFile();
  if (parentFile != null && !fileExists(parentFile)) {
    throw new FileNotFoundException("'" + fileName + "' (The system cannot find the path specified)");
  }
  EphemeralFileData data=new EphemeralFileData(clock);
  free(files.put(canonicalFile(fileName),data));
  return new StoreFileChannel(new EphemeralFileChannel(data,new FileStillOpenException(fileName.getPath())));
}
