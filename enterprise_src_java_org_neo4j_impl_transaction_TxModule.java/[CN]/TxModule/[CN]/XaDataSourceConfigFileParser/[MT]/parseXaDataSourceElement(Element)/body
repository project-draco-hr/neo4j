{
  XaDataSourceManager xaDsMgr=XaDataSourceManager.getManager();
  NamedNodeMap attributes=element.getAttributes();
  String name=attributes.getNamedItem("name").getNodeValue();
  name=name.toLowerCase();
  if (xaDsMgr.hasDataSource(name)) {
    throw new RuntimeException("Data source[" + name + "] has already been registered");
  }
  String fqn=attributes.getNamedItem("class").getNodeValue();
  String branchId=attributes.getNamedItem("branchid").getNodeValue();
  if (!branchId.startsWith("0x")) {
    throw new RuntimeException("Unable to parse branch id[" + branchId + "] on "+ name+ "["+ fqn+ "], branch id should start with \"0x\""+ " since they are hexadecimal");
  }
  if (branchId.length() != 8) {
    throw new RuntimeException("Unable to parse branch id[" + branchId + "] on "+ name+ "["+ fqn+ "], branch id must be a 3 byte hexadecimal number");
  }
  byte resourceId[]=getBranchId(branchId.substring(2,branchId.length()));
  Map<String,String> params=new java.util.HashMap<String,String>();
  NodeList list=element.getElementsByTagName("param");
  for (int i=0; i < list.getLength(); i++) {
    Element param=(Element)list.item(i);
    attributes=param.getAttributes();
    String key=attributes.getNamedItem("name").getNodeValue();
    String value=attributes.getNamedItem("value").getNodeValue();
    params.put(key,value);
  }
  try {
    XaDataSource dataSource=xaDsMgr.create(fqn,params);
    xaDsMgr.registerDataSource(name,dataSource,resourceId);
  }
 catch (  Exception e) {
    throw new RuntimeException("Could not create data source " + name + "["+ fqn+ "]",e);
  }
}
