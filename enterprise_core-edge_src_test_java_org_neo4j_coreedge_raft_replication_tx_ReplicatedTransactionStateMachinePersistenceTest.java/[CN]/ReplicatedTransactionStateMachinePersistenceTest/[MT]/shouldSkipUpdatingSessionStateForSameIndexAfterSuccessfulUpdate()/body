{
  TransactionCommitProcess commitProcess=mock(TransactionCommitProcess.class);
  InMemoryGlobalSessionTrackerState<RaftTestMember> sessionTrackerState=spy(new InMemoryGlobalSessionTrackerState<>());
  ReplicatedTransactionStateMachine<RaftTestMember> stateMachine=stateMachine(commitProcess,sessionTrackerState);
  ReplicatedTransaction<RaftTestMember> rtx=replicatedTx();
  final int commitAtRaftLogIndex=99;
  stateMachine.onReplicated(rtx,commitAtRaftLogIndex);
  assertEquals(commitAtRaftLogIndex,sessionTrackerState.logIndex());
  stateMachine.onReplicated(rtx,commitAtRaftLogIndex);
  verify(commitProcess,times(1)).commit(any(),any(),any());
  verify(sessionTrackerState,times(1)).update(any(),any(),eq(99L));
}
