{
  buffer.put(type);
  buffer.put(indexClass());
  char[] indexName=indexId.indexName.toCharArray();
  buffer.putInt(indexName.length);
  long id=entityId instanceof Long ? (Long)entityId : ((RelationshipId)entityId).id;
  buffer.putLong(id);
  char[] key=this.key.toCharArray();
  buffer.putInt(key.length);
  byte valueType=0;
  if (value instanceof Number) {
    if (value instanceof Float) {
      valueType=VALUE_TYPE_FLOAT;
    }
 else     if (value instanceof Double) {
      valueType=VALUE_TYPE_DOUBLE;
    }
 else     if (value instanceof Long) {
      valueType=VALUE_TYPE_LONG;
    }
 else {
      valueType=VALUE_TYPE_INT;
    }
  }
 else {
    valueType=VALUE_TYPE_STRING;
  }
  buffer.put(valueType);
  buffer.put(indexName);
  buffer.put(key);
  if (valueType == VALUE_TYPE_STRING) {
    char[] charValue=value.toString().toCharArray();
    buffer.putInt(charValue.length);
    buffer.put(charValue);
  }
 else {
    Number number=(Number)value;
switch (valueType) {
case VALUE_TYPE_FLOAT:
      buffer.putInt(Float.floatToRawIntBits(number.floatValue()));
    break;
case VALUE_TYPE_DOUBLE:
  buffer.putLong(Double.doubleToRawLongBits(number.doubleValue()));
break;
case VALUE_TYPE_LONG:
buffer.putLong(number.longValue());
break;
case VALUE_TYPE_INT:
buffer.putInt(number.intValue());
break;
default :
throw new Error("Should not reach here.");
}
}
}
