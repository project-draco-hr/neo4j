{
  buffer.clear();
  buffer.limit(1);
  if (channel.read(buffer) != buffer.limit()) {
    return null;
  }
  buffer.flip();
  byte commandType=buffer.get();
  CommandData data=readCommandData(channel,buffer,dataSource);
  if (data == null) {
    return null;
  }
switch (commandType) {
case ADD_COMMAND:
    return new AddCommand(data);
case REMOVE_COMMAND:
  return new RemoveCommand(data);
case CLEAR_COMMAND:
return new ClearCommand(data);
default :
throw new IOException("Unknown command type[" + commandType + "]");
}
}
