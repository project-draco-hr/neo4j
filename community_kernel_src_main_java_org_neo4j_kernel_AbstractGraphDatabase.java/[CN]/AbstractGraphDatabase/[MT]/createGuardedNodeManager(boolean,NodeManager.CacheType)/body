{
  final NodeManager.Configuration config=ConfigProxy.config(params,NodeManager.Configuration.class);
  if (readOnly) {
    return new ReadOnlyNodeManager(config,this,lockManager,lockReleaser,txManager,persistenceManager,persistenceSource,relationshipTypeHolder,cacheType,propertyIndexManager,createNodeLookup(),createRelationshipLookups(),msgLog,diagnosticsManager){
      @Override protected Node getNodeByIdOrNull(      final long nodeId){
        guard.check();
        return super.getNodeByIdOrNull(nodeId);
      }
      @Override public NodeImpl getNodeForProxy(      final long nodeId,      final LockType lock){
        guard.check();
        return super.getNodeForProxy(nodeId,lock);
      }
      @Override public RelationshipImpl getRelationshipForProxy(      final long relId,      final LockType lock){
        guard.check();
        return super.getRelationshipForProxy(relId,lock);
      }
      @Override protected Relationship getRelationshipByIdOrNull(      final long relId){
        guard.check();
        return super.getRelationshipByIdOrNull(relId);
      }
      @Override public Node createNode(){
        guard.check();
        return super.createNode();
      }
      @Override public Relationship createRelationship(      final Node startNodeProxy,      final NodeImpl startNode,      final Node endNode,      final RelationshipType type){
        guard.check();
        return super.createRelationship(startNodeProxy,startNode,endNode,type);
      }
    }
;
  }
  return new NodeManager(config,this,lockManager,lockReleaser,txManager,persistenceManager,persistenceSource,relationshipTypeHolder,cacheType,propertyIndexManager,createNodeLookup(),createRelationshipLookups(),msgLog,diagnosticsManager){
    @Override protected Node getNodeByIdOrNull(    final long nodeId){
      guard.check();
      return super.getNodeByIdOrNull(nodeId);
    }
    @Override public NodeImpl getNodeForProxy(    final long nodeId,    final LockType lock){
      guard.check();
      return super.getNodeForProxy(nodeId,lock);
    }
    @Override public RelationshipImpl getRelationshipForProxy(    final long relId,    final LockType lock){
      guard.check();
      return super.getRelationshipForProxy(relId,lock);
    }
    @Override protected Relationship getRelationshipByIdOrNull(    final long relId){
      guard.check();
      return super.getRelationshipByIdOrNull(relId);
    }
    @Override public Node createNode(){
      guard.check();
      return super.createNode();
    }
    @Override public Relationship createRelationship(    final Node startNodeProxy,    final NodeImpl startNode,    final Node endNode,    final RelationshipType type){
      guard.check();
      return super.createRelationship(startNodeProxy,startNode,endNode,type);
    }
  }
;
}
