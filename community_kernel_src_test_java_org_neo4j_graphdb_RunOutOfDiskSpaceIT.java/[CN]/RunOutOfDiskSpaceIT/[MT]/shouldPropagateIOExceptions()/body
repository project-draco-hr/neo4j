{
  TransactionFailureException exceptionThrown=null;
  LimitedFileSystemGraphDatabase db=cleanup.add(new LimitedFileSystemGraphDatabase());
  db.runOutOfDiskSpaceNao();
  try (Transaction tx=db.beginTx()){
    db.createNode();
    tx.success();
  }
 catch (  TransactionFailureException e) {
    exceptionThrown=e;
  }
 finally {
    Assert.assertNotNull("Expected tx finish to throw TransactionFailureException when filesystem is full.",exceptionThrown);
    assertTrue(Exceptions.contains(exceptionThrown,IOException.class));
  }
  db.somehowGainMoreDiskSpace();
}
