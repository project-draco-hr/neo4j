{
  byte[] header=new byte[2];
  buffer.readBytes(header);
  DechunkingChannelBuffer.assertSameProtocolVersion(header,applicationProtocolVersion);
  byte continuation=(byte)(header[0] & 0x1);
  if (continuation == ChunkingChannelBuffer.CONTINUATION_MORE) {
    PartialRequest partialRequest=partialRequests.get(channel);
    if (partialRequest == null) {
      RequestType<M> type=getRequestContext(buffer.readByte());
      SlaveContext context=readContext(buffer);
      Pair<ChannelBuffer,ByteBuffer> targetBuffers=mapSlave(channel,context,type);
      partialRequest=new PartialRequest(type,context,targetBuffers);
      partialRequests.put(channel,partialRequest);
    }
    partialRequest.add(buffer);
  }
 else {
    PartialRequest partialRequest=partialRequests.remove(channel);
    RequestType<M> type=null;
    SlaveContext context=null;
    Pair<ChannelBuffer,ByteBuffer> targetBuffers;
    ChannelBuffer bufferToReadFrom=null;
    ChannelBuffer bufferToWriteTo=null;
    if (partialRequest == null) {
      type=getRequestContext(buffer.readByte());
      context=readContext(buffer);
      targetBuffers=mapSlave(channel,context,type);
      bufferToReadFrom=buffer;
      bufferToWriteTo=targetBuffers.first();
    }
 else {
      type=partialRequest.type;
      context=partialRequest.context;
      targetBuffers=partialRequest.buffers;
      partialRequest.add(buffer);
      bufferToReadFrom=targetBuffers.first();
      bufferToWriteTo=ChannelBuffers.dynamicBuffer();
    }
    bufferToWriteTo.clear();
    final ChunkingChannelBuffer chunkingBuffer=new ChunkingChannelBuffer(bufferToWriteTo,channel,frameLength,applicationProtocolVersion);
    submitSilent(masterCallExecutor,masterCaller(type,channel,context,chunkingBuffer,bufferToReadFrom,targetBuffers.other()));
  }
}
