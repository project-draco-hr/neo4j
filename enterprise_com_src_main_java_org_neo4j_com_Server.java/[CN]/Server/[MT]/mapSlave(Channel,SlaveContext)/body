{
  channelGroup.add(channel);
  Pair<ChannelBuffer,ByteBuffer> buffer=null;
synchronized (connectedSlaveChannels) {
    if (slave != null && slave.machineId() != slave.EMPTY.machineId()) {
      connectedSlaveChannels.put(channel,slave);
    }
    buffer=channelBuffers.get(channel);
    if (buffer == null) {
      buffer=Pair.of(ChannelBuffers.dynamicBuffer(),ByteBuffer.allocateDirect(1 * 1024 * 1024));
      channelBuffers.put(channel,buffer);
    }
    buffer.first().clear();
  }
  return buffer;
}
