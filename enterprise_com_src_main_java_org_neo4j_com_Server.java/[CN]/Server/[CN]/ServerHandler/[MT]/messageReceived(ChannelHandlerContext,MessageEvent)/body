{
  try {
    ChannelBuffer message=(ChannelBuffer)event.getMessage();
    handleRequest(message,event.getChannel());
  }
 catch (  Throwable e) {
    msgLog.logMessage("Error handling request",e);
    ctx.getChannel().close();
    tryToFinishOffChannel(ctx.getChannel());
    e.printStackTrace();
    if (e instanceof Exception) {
      throw (Exception)e;
    }
    throw new RuntimeException(e);
  }
}
