{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabaseBuilder().setConfig(GraphDatabaseSettings.cache_type,GCResistantCacheProvider.NAME).newGraphDatabase();
  Cache<?> firstCache=first(db.getNodeManager().caches());
  db.shutdown();
  db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().newImpermanentDatabaseBuilder().setConfig(GraphDatabaseSettings.cache_type,GCResistantCacheProvider.NAME).newGraphDatabase();
  try {
    Cache<?> secondCache=first(db.getNodeManager().caches());
    assertEquals(firstCache,secondCache);
  }
  finally {
    db.shutdown();
  }
}
