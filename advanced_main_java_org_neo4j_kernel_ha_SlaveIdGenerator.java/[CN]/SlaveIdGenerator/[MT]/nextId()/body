{
  try {
    long nextId=nextLocalId();
    if (nextId == VALUE_REPRESENTING_NULL) {
      IdAllocation allocation=broker.getMaster().first().allocateIds(idType);
      nextId=storeLocally(allocation);
    }
    return nextId;
  }
 catch (  ZooKeeperException e) {
    receiver.newMaster(broker.getMaster(),e);
    throw e;
  }
catch (  HaCommunicationException e) {
    receiver.newMaster(broker.getMaster(),e);
    throw e;
  }
}
