{
  String indexProperty="indexProperty";
  GatheringIndexWriter writer=newWriter(indexProperty);
  createIndex(db,myLabel,indexProperty);
  int value1=12;
  String otherProperty="otherProperty";
  int otherValue=17;
  Node node=createNode(map(indexProperty,value1,otherProperty,otherValue),myLabel);
  Transaction tx=db.beginTx();
  try {
    StatementOperations context=ctxProvider.getCtxForWriting().asStatementOperations();
    StatementState state=ctxProvider.statementForWriting();
    long propertyKey1=context.propertyKeyGetForName(state,indexProperty);
    long[] labels=new long[]{context.labelGetForName(state,myLabel.name())};
    assertThat(writer.updates,equalTo(asSet(NodePropertyUpdate.add(node.getId(),propertyKey1,value1,labels))));
  }
  finally {
    tx.finish();
  }
}
