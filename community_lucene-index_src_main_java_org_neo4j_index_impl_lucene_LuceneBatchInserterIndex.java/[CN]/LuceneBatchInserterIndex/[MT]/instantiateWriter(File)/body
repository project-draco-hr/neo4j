{
  try {
    IndexWriterConfig writerConfig=new IndexWriterConfig(LUCENE_VERSION,type.analyzer);
    writerConfig.setRAMBufferSizeMB(determineGoodBufferSize(writerConfig.getRAMBufferSizeMB()));
    Directory luceneDir=getDirectory(directory,identifier);
    return IndexWriterFactories.batchInsert(writerConfig).create(luceneDir);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
