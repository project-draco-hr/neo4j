{
  Transaction tx=db.beginTx();
  Statement statement=statementContextProvider.instance();
  Node node=null;
  int labelId=-1;
  try {
    node=db.createNode();
    labelId=statement.dataWriteOperations().labelGetOrCreateForName("labello");
    statement.dataWriteOperations().nodeAddLabel(node.getId(),labelId);
    statement.close();
    tx.failure();
    tx.success();
    tx.finish();
    fail("Should have failed");
  }
 catch (  TransactionFailureException e) {
  }
  tx=db.beginTx();
  statement=statementContextProvider.instance();
  try {
    statement.readOperations().nodeHasLabel(node.getId(),labelId);
    fail("should have thrown exception");
  }
 catch (  EntityNotFoundException e) {
  }
  tx.finish();
}
