{
  Transaction tx;
  StatementOperations statement;
  tx=db.beginTx();
  statement=statementContextProvider.getCtxForWriting().asStatementOperations();
  String state=statement.schemaStateGetOrCreate(getState(),key,new Function<String,String>(){
    @Override public String apply(    String s){
      return maybeSetThisState;
    }
  }
);
  tx.success();
  tx.finish();
  return state;
}
