{
  if (!zooClient.isNewConnection() && masterClient != null) {
    return masterClient;
  }
  int masterId=zooClient.getMaster();
  if (masterId == machineId) {
    throw new ZooKeeperException("I am master, so can't call getMaster() here",new Exception());
  }
  invalidateMaster();
  createMaster(masterId);
  return masterClient;
}
