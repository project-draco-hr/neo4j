{
  LockManager lockManager=getEmbeddedGraphDb().getLockManager();
  LockReleaser lockReleaser=getEmbeddedGraphDb().getLockReleaser();
  FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();
  final Config config=new Config(MapUtil.stringMap(InternalAbstractGraphDatabase.Configuration.store_dir.name(),path().getPath(),InternalAbstractGraphDatabase.Configuration.neo_store.name(),file("neo").getPath(),InternalAbstractGraphDatabase.Configuration.logical_log.name(),file("nioneo_logical.log").getPath()),GraphDatabaseSettings.class);
  StoreFactory sf=new StoreFactory(config,new DefaultIdGeneratorFactory(),new DefaultWindowPoolFactory(),fileSystem,StringLogger.DEV_NULL,null);
  ds=new NeoStoreXaDataSource(config,sf,lockManager,lockReleaser,StringLogger.DEV_NULL,new XaFactory(config,TxIdGenerator.DEFAULT,new PlaceboTm(),new DefaultLogBufferFactory(),fileSystem,StringLogger.DEV_NULL,RecoveryVerifier.ALWAYS_VALID,LogPruneStrategies.NO_PRUNING),new TransactionInterceptorProviders(Collections.<TransactionInterceptorProvider>emptyList(),new DependencyResolver(){
    @Override public <T>T resolveDependency(    Class<T> type) throws IllegalArgumentException {
      return (T)config;
    }
  }
),null);
  ds.start();
  xaCon=ds.getXaConnection();
  pStore=xaCon.getPropertyStore();
  rtStore=xaCon.getRelationshipTypeStore();
}
