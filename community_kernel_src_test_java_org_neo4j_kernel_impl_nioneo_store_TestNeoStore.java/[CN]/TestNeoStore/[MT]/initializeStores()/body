{
  LockManager lockManager=new LockManagerImpl(new RagManager());
  final Config config=new Config(MapUtil.stringMap(InternalAbstractGraphDatabase.Configuration.store_dir.name(),path.getPath(),InternalAbstractGraphDatabase.Configuration.neo_store.name(),"neo",InternalAbstractGraphDatabase.Configuration.logical_log.name(),file("nioneo_logical.log").getPath()),GraphDatabaseSettings.class);
  StoreFactory sf=new StoreFactory(config,new DefaultIdGeneratorFactory(),new DefaultWindowPoolFactory(),fs.get(),StringLogger.DEV_NULL,null);
  NodeManager nodeManager=mock(NodeManager.class);
  @SuppressWarnings("rawtypes") List caches=Arrays.asList((Cache)mock(LockStripedCache.class),(Cache)mock(LockStripedCache.class));
  when(nodeManager.caches()).thenReturn(caches);
  ds=new NeoStoreXaDataSource(config,sf,StringLogger.DEV_NULL,new XaFactory(config,TxIdGenerator.DEFAULT,new PlaceboTm(lockManager,TxIdGenerator.DEFAULT),new DefaultLogBufferFactory(),fs.get(),new DevNullLoggingService(),RecoveryVerifier.ALWAYS_VALID,LogPruneStrategies.NO_PRUNING),TransactionStateFactory.noStateFactory(new DevNullLoggingService()),new TransactionInterceptorProviders(Collections.<TransactionInterceptorProvider>emptyList(),dependencyResolverForConfig(config)),null,new SingleLoggingService(DEV_NULL),new KernelSchemaStateStore(),mock(TokenNameLookup.class),dependencyResolverForNoIndexProvider(nodeManager));
  ds.init();
  ds.start();
  xaCon=ds.getXaConnection();
  pStore=xaCon.getPropertyStore();
  rtStore=xaCon.getRelationshipTypeStore();
}
