{
  LockManager lockManager=getEmbeddedGraphDb().getLockManager();
  LockReleaser lockReleaser=getEmbeddedGraphDb().getLockReleaser();
  FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();
  Config config=new Config(new ConfigurationDefaults(GraphDatabaseSettings.class).apply(MapUtil.stringMap(AbstractGraphDatabase.Configuration.store_dir.name(),path(),AbstractGraphDatabase.Configuration.neo_store.name(),file("neo"),AbstractGraphDatabase.Configuration.logical_log.name(),file("nioneo_logical.log"))));
  StoreFactory sf=new StoreFactory(config,new DefaultIdGeneratorFactory(),fileSystem,null,StringLogger.DEV_NULL,null);
  ds=new NeoStoreXaDataSource(config,sf,fileSystem,lockManager,lockReleaser,StringLogger.DEV_NULL,new XaFactory(config,TxIdGenerator.DEFAULT,new PlaceboTm(),new DefaultLogBufferFactory(),fileSystem,StringLogger.DEV_NULL,RecoveryVerifier.ALWAYS_VALID),Collections.<Pair<TransactionInterceptorProvider,Object>>emptyList(),null);
  xaCon=ds.getXaConnection();
  pStore=xaCon.getPropertyStore();
  rtStore=xaCon.getRelationshipTypeStore();
}
