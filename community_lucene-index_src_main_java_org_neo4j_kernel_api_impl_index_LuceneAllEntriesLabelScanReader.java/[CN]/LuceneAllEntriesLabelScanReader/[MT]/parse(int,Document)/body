{
  List<IndexableField> fields=document.getFields();
  long[] labelIds=new long[fields.size() - 1];
  Bitmap[] bitmaps=new Bitmap[fields.size() - 1];
  int i=0;
  long rangeId=-1;
  for (  IndexableField field : fields) {
    if (format.isRangeField(field)) {
      rangeId=format.rangeOf(field);
    }
 else {
      labelIds[i]=format.labelId(field);
      bitmaps[i]=format.readBitmap(field);
      i++;
    }
  }
  assert(rangeId >= 0);
  return LuceneNodeLabelRange.fromBitmapStructure(id,labelIds,getLongs(bitmaps,rangeId));
}
