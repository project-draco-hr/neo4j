{
  final StoreProcessor processor=new StoreProcessor(CheckDecorator.NONE,mock(ConsistencyReport.Reporter.class));
  RecordStore recordStore=mock(RecordStore.class);
  when(recordStore.getHighId()).thenReturn(4L);
  when(recordStore.forceGetRecord(0L)).thenReturn(new NodeRecord(0,false,0,0));
  when(recordStore.forceGetRecord(1L)).thenReturn(new NodeRecord(0,false,0,0));
  when(recordStore.forceGetRecord(2L)).thenAnswer(new Answer<NodeRecord>(){
    @Override public NodeRecord answer(    InvocationOnMock invocation) throws Throwable {
      processor.stopScanning();
      return new NodeRecord(0,false,0,0);
    }
  }
);
  processor.applyFiltered(recordStore);
  verify(recordStore).forceGetRecord(0);
  verify(recordStore).forceGetRecord(1);
  verify(recordStore).forceGetRecord(2);
  verify(recordStore,never()).forceGetRecord(3);
}
