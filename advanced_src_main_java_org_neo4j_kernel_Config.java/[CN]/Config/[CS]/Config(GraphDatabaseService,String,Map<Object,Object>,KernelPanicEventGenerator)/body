{
  this.storeDir=storeDir;
  this.params=params;
  String readOnlyStr=(String)params.get(READ_ONLY);
  if (readOnlyStr != null && readOnlyStr.toLowerCase().equals("true")) {
    readOnly=true;
  }
 else {
    readOnly=false;
  }
  String backupSlaveStr=(String)params.get("backup_slave");
  if (backupSlaveStr != null && backupSlaveStr.toLowerCase().equals("true")) {
    backupSlave=true;
  }
 else {
    backupSlave=false;
  }
  params.put("read_only",readOnly);
  cacheManager=new AdaptiveCacheManager();
  if (!readOnly) {
    txModule=new TxModule(this.storeDir,kpe);
  }
 else {
    txModule=new TxModule(true,kpe);
  }
  lockManager=new LockManager(txModule.getTxManager());
  lockReleaser=new LockReleaser(lockManager,txModule.getTxManager());
  persistenceModule=new PersistenceModule();
  idGeneratorModule=new IdGeneratorModule();
  graphDbModule=new GraphDbModule(graphDb,cacheManager,lockManager,txModule.getTxManager(),idGeneratorModule.getIdGenerator(),readOnly);
}
