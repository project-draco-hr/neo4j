{
  try (Transaction tx=db.beginTx()){
    for (int i=0; i < 10; i++) {
      ENTITY entity=entityFactory.newInstance();
      String key=keyFactory.apply(i);
      Object value=valueFactory.apply(i);
      assertEquals(entity,single((Iterator<ENTITY>)index.get(key,value)));
    }
    tx.success();
  }
 }
