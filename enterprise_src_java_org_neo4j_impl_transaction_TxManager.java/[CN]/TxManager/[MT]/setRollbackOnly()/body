{
  if (!tmOk) {
    throw new SystemException("TM has encountered some problem, " + "please perform neccesary action (tx recovery/restart)");
  }
  Thread thread=Thread.currentThread();
  if (!txThreadMap.containsKey(thread)) {
    throw new IllegalStateException("Not in transaction");
  }
  ((TransactionImpl)txThreadMap.get(thread)).setRollbackOnly();
}
