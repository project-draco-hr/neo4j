{
  Availability availability=availability(millis);
  if (availability == Availability.AVAILABLE) {
    return;
  }
  String description=(availability == Availability.UNAVAILABLE) ? "Timeout waiting for database to become available and allow new transactions. Waited " + Format.duration(millis) + ". "+ describeWhoIsBlocking() : "Database not available because it's shutting down";
  throw new UnavailableException(description);
}
