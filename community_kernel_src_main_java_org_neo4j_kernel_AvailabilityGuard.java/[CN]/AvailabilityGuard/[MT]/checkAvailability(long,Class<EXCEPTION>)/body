{
  Availability availability=availability(millis);
  if (!availability.available) {
    EXCEPTION exception;
    try {
      String description=availability.temporarily ? "Timeout waiting for database to become available and allow new transactions. Waited " + Format.duration(millis) + ". "+ describeWhoIsBlocking() : "Database not available because it's shutting down";
      exception=cls.getConstructor(String.class).newInstance(description);
    }
 catch (    NoSuchMethodException e) {
      throw new Error("Bad exception class given to this method, it doesn't have a (String) constructor",e);
    }
catch (    Exception e) {
      throw new RuntimeException(e);
    }
    throw exception;
  }
}
