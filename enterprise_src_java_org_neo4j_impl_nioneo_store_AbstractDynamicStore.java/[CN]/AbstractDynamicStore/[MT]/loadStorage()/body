{
  long fileSize=getFileChannel().size();
  String expectedVersion=getTypeAndVersionDescriptor();
  byte version[]=new byte[expectedVersion.length()];
  ByteBuffer buffer=ByteBuffer.wrap(version);
  getFileChannel().position(fileSize - expectedVersion.length());
  getFileChannel().read(buffer);
  if (!expectedVersion.equals(new String(version))) {
    setStoreNotOk();
  }
  buffer=ByteBuffer.allocate(4);
  getFileChannel().position(0);
  getFileChannel().read(buffer);
  buffer.flip();
  blockSize=buffer.getInt();
  if ((fileSize - expectedVersion.length()) % blockSize != 0) {
    setStoreNotOk();
  }
  if (getStoreOk()) {
    getFileChannel().truncate(fileSize - expectedVersion.length());
  }
  try {
    openIdGenerator();
  }
 catch (  IOException e) {
    setStoreNotOk();
  }
  setWindowPool(new PersistenceWindowPool(getStorageFileName(),getBlockSize(),getFileChannel(),getMappedMem()));
}
