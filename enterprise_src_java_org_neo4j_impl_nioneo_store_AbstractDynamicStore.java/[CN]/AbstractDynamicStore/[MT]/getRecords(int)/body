{
  List<DynamicRecord> recordList=new LinkedList<DynamicRecord>();
  int blockId=startBlockId;
  PersistenceWindow window=acquireWindow(blockId,OperationType.READ);
  try {
    DynamicRecord record=new DynamicRecord(blockId);
    Buffer buffer=window.getBuffer();
    int offset=(blockId - buffer.position()) * getBlockSize();
    buffer.setOffset(offset);
    byte inUse=buffer.get();
    if (inUse != Record.IN_USE.byteValue()) {
      throw new IOException("Not in use [" + inUse + "] blockId["+ blockId+ "]");
    }
    record.setInUse(true);
    int prevBlock=buffer.getInt();
    if (prevBlock != Record.NO_PREV_BLOCK.intValue()) {
      throw new IOException("Start block has previous block set");
    }
    record.setPrevBlock(prevBlock);
    int nextBlock=blockId;
    int dataSize=getBlockSize() - BLOCK_HEADER_SIZE;
    do {
      int nrOfBytes=buffer.getInt();
      prevBlock=nextBlock;
      nextBlock=buffer.getInt();
      if (nextBlock != Record.NO_NEXT_BLOCK.intValue() && nrOfBytes < dataSize || nrOfBytes > dataSize) {
        throw new IOException("Next block set[" + nextBlock + "] current block illegal size["+ nrOfBytes+ "/"+ dataSize+ "]");
      }
      record.setNextBlock(nextBlock);
      byte byteArrayElement[]=new byte[nrOfBytes];
      buffer.get(byteArrayElement);
      record.setData(byteArrayElement);
      recordList.add(record);
      if (nextBlock != Record.NO_NEXT_BLOCK.intValue()) {
        releaseWindow(window);
        window=acquireWindow(nextBlock,OperationType.READ);
        record=new DynamicRecord(nextBlock);
        buffer=window.getBuffer();
        offset=(nextBlock - buffer.position()) * getBlockSize();
        buffer.setOffset(offset);
        inUse=buffer.get();
        if (inUse != Record.IN_USE.byteValue()) {
          throw new IOException("Next block[" + nextBlock + "] not in use ["+ inUse+ "]");
        }
        record.setInUse(true);
        record.setPrevBlock(buffer.getInt());
        if (record.getPrevBlock() != prevBlock) {
          throw new IOException("Previous block don't match");
        }
      }
    }
 while (nextBlock != Record.NO_NEXT_BLOCK.intValue());
  }
  finally {
    releaseWindow(window);
  }
  return recordList;
}
