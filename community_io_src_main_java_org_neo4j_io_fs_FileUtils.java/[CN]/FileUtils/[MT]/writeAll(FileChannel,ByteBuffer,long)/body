{
  long filePosition=position;
  long expectedEndPosition=filePosition + src.limit() - src.position();
  int bytesWritten;
  while ((filePosition+=(bytesWritten=channel.write(src,filePosition))) < expectedEndPosition) {
    if (bytesWritten <= 0) {
      throw new IOException("Unable to write to disk, reported bytes written was " + bytesWritten);
    }
  }
}
