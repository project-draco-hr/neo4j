{
  KeyValueStoreState<Key,MetaData> state=this.state;
  if (visitor instanceof MetadataVisitor<?>) {
    @SuppressWarnings("unchecked") MetadataVisitor<MetaData> metadataVisitor=(MetadataVisitor<MetaData>)visitor;
    metadataVisitor.visitMetadata(state.file(),metadata(),state.totalRecordsStored());
  }
  try (DataProvider provider=state.dataProvider()){
    transfer(provider,visitor);
  }
 }
