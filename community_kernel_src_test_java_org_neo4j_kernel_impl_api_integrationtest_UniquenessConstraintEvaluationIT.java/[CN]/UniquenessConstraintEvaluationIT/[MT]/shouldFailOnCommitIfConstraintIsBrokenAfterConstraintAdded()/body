{
  newTransaction();
  db.createNode(label("Foo")).setProperty("name","foo");
  long foo=statement.getLabelId("Foo");
  long name=statement.getPropertyKeyId("name");
  commit();
  newTransaction();
  statement.addUniquenessConstraint(foo,name);
  ExecutorService executor=Executors.newSingleThreadExecutor();
  executor.submit(new Runnable(){
    @Override public void run(){
      Transaction tx=db.beginTx();
      try {
        db.createNode(label("Foo")).setProperty("name","foo");
        tx.success();
      }
  finally {
        tx.finish();
      }
    }
  }
).get();
  executor.shutdown();
  try {
    commit();
    fail("expected exception");
  }
 catch (  ConstraintCreationException ex) {
    assertEquals("",ex.getMessage());
  }
}
