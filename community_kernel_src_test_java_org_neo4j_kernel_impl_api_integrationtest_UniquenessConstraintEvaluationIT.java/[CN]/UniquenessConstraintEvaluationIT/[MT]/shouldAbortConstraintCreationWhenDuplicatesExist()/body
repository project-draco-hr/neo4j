{
  newTransaction();
  db.createNode(label("Foo")).setProperty("name","foo");
  db.createNode(label("Foo")).setProperty("name","foo");
  long foo=statement.getLabelId("Foo");
  long name=statement.getPropertyKeyId("name");
  commit();
  newTransaction();
  try {
    statement.addUniquenessConstraint(foo,name);
    fail("expected exception");
  }
 catch (  ConstraintCreationKernelException ex) {
    assertEquals(new UniquenessConstraint(foo,name),ex.constraint());
    assertThat(ex.getCause().getCause(),instanceOf(IllegalStateException.class));
  }
}
