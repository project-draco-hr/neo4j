{
  File baseDir=getBaseDir(storeDir);
  RequestContext context=RequestContext.anonymous(rotateLogs(dsManager,kernelPanicEventGenerator,logger));
  backupMonitor.finishedRotatingLogicalLogs();
  ByteBuffer temporaryBuffer=ByteBuffer.allocateDirect(1024 * 1024);
  for (  XaDataSource ds : dsManager.getAllRegisteredDataSources()) {
    copyStoreFiles(writer,fs,baseDir,temporaryBuffer,ds,backupMonitor);
    if (includeLogicalLogs) {
      copyLogicalLogs(writer,fs,baseDir,temporaryBuffer,ds,backupMonitor);
    }
  }
  return context;
}
