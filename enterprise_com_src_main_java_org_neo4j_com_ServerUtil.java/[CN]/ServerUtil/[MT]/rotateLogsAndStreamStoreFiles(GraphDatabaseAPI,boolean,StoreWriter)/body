{
  File baseDir=getBaseDir(graphDb);
  XaDataSourceManager dsManager=graphDb.getXaDataSourceManager();
  RequestContext context=RequestContext.anonymous(rotateLogs(graphDb));
  ByteBuffer temporaryBuffer=ByteBuffer.allocateDirect(1024 * 1024);
  for (  XaDataSource ds : dsManager.getAllRegisteredDataSources()) {
    try (ResourceIterator<File> files=ds.listStoreFiles(includeLogicalLogs)){
      while (files.hasNext()) {
        File storeFile=files.next();
        try (FileInputStream stream=new FileInputStream(storeFile)){
          writer.write(relativePath(baseDir,storeFile),stream.getChannel(),temporaryBuffer,storeFile.length() > 0);
        }
       }
    }
 catch (    IOException e) {
      throw new ServerFailureException(e);
    }
  }
  return context;
}
