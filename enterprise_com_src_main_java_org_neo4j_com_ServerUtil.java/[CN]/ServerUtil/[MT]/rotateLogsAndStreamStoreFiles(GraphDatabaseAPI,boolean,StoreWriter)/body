{
  File baseDir=getBaseDir(graphDb);
  XaDataSourceManager dsManager=graphDb.getXaDataSourceManager();
  RequestContext context=RequestContext.anonymous(rotateLogs(graphDb));
  ByteBuffer temporaryBuffer=ByteBuffer.allocateDirect(1024 * 1024);
  for (  XaDataSource ds : dsManager.getAllRegisteredDataSources()) {
    try {
      ClosableIterable<File> files=ds.listStoreFiles(includeLogicalLogs);
      try {
        for (        File storefile : files) {
          FileInputStream stream=new FileInputStream(storefile);
          try {
            writer.write(relativePath(baseDir,storefile),stream.getChannel(),temporaryBuffer,storefile.length() > 0);
          }
  finally {
            stream.close();
          }
        }
      }
  finally {
        files.close();
      }
    }
 catch (    IOException e) {
      throw new ServerFailureException(e);
    }
  }
  return context;
}
