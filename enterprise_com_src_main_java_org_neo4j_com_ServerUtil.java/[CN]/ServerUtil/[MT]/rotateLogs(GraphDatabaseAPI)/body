{
  XaDataSourceManager dsManager=graphDb.getXaDataSourceManager();
  Collection<XaDataSource> sources=dsManager.getAllRegisteredDataSources();
  Tx[] appliedTransactions=new Tx[sources.size()];
  int i=0;
  for (  XaDataSource ds : sources) {
    try {
      appliedTransactions[i++]=RequestContext.lastAppliedTx(ds.getName(),ds.getXaContainer().getResourceManager().rotateLogicalLog());
    }
 catch (    IOException e) {
      graphDb.getDependencyResolver().resolveDependency(Logging.class).getMessagesLog(ServerUtil.class).logMessage("Unable to rotate log for " + ds,e);
      graphDb.getKernelPanicGenerator().generateEvent(ErrorState.TX_MANAGER_NOT_OK);
      throw new ServerFailureException(e);
    }
  }
  return appliedTransactions;
}
