{
  Tx txForDs=null;
  for (  Tx tx : context.lastAppliedTransactions()) {
    if (tx.getDataSourceName().equals(dataSource.getName())) {
      txForDs=tx;
      break;
    }
  }
  if (txForDs == null) {
    throw new RuntimeException("Apparently " + context + " didn't have the XA data source we are commiting ("+ dataSource.getName()+ ")");
  }
  return new RequestContext(context.getSessionId(),context.machineId(),context.getEventIdentifier(),new Tx[]{txForDs},context.getMasterId(),context.getChecksum());
}
