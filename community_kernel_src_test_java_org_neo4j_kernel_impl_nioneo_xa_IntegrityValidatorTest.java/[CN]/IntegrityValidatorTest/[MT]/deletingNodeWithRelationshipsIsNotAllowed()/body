{
  NeoStore store=mock(NeoStore.class);
  IndexingService indexes=mock(IndexingService.class);
  IntegrityValidator validator=new IntegrityValidator(store,indexes);
  NodeRecord record=new NodeRecord(1l,false,1l,-1l);
  record.setInUse(false);
  try {
    validator.validateNodeRecord(record);
    fail("Should have thrown integrity error.");
  }
 catch (  XAException e) {
    assertThat(e.errorCode,equalTo(XAException.XA_RBINTEGRITY));
  }
}
