{
  for (int i=0; i < arrayCount; i++) {
    if (arrayEntries[i].getKey().equals(key)) {
      V removedProperty=arrayEntries[i].getValue();
      if (useThreadSafeMap) {
        ArrayEntry<K,V>[] newEntries=new ArrayEntry[toMapThreshold];
        System.arraycopy(arrayEntries,0,newEntries,0,i);
        arrayCount--;
        System.arraycopy(arrayEntries,i + 1,newEntries,i,arrayCount - i);
        arrayEntries=newEntries;
      }
 else {
        arrayCount--;
        System.arraycopy(arrayEntries,i + 1,arrayEntries,i,arrayCount - i);
      }
      return removedProperty;
    }
  }
  if (arrayCount == -1) {
    V value=propertyMap.remove(key);
    if (switchBackToArray && propertyMap.size() < toMapThreshold) {
      arrayCount=0;
      arrayEntries=new ArrayEntry[toMapThreshold];
      for (      Entry<K,V> entry : propertyMap.entrySet()) {
        arrayEntries[arrayCount++]=new ArrayEntry<K,V>(entry.getKey(),entry.getValue());
      }
    }
    return value;
  }
  return null;
}
