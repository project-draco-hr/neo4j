{
  long field=array.get(nodeId);
  if (fieldIsDense(field)) {
    long relGroupIndex=IdFieldManipulator.getId(field);
    if (relGroupIndex == EMPTY) {
      return 0;
    }
    relGroupIndex=relGroupCache.findGroupIndexForType(relGroupIndex,type);
    if (relGroupIndex == EMPTY) {
      return 0;
    }
    field=relGroupCache.getField(relGroupIndex,relGroupCache.directionIndex(direction));
  }
  return IdFieldManipulator.getCount(field);
}
