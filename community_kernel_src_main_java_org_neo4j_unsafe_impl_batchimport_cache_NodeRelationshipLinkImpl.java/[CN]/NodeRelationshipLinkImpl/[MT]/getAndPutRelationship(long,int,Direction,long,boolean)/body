{
  long field=array.get(nodeId);
  long existingId=IdFieldManipulator.getId(field);
  if (fieldIsDense(field)) {
    if (existingId == EMPTY) {
      existingId=relGroupCache.allocate(type,direction,firstRelId,incrementCount);
      field=IdFieldManipulator.setId(field,existingId);
      array.set(nodeId,field);
      return EMPTY;
    }
    return relGroupCache.putRelationship(existingId,type,direction,firstRelId,incrementCount);
  }
  field=IdFieldManipulator.setId(field,firstRelId);
  array.set(nodeId,field);
  return existingId;
}
