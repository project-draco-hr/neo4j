{
  serializer=new AtomicBroadcastSerializer();
  cluster.addClusterListener(clusterListener=new ClusterListener.Adapter(){
    @Override public void joinedCluster(    URI member){
      broadcastOurself();
    }
    @Override public void enteredCluster(    ClusterConfiguration clusterConfiguration){
      PaxosHighAvailabilityEvents.this.clusterConfiguration=clusterConfiguration;
    }
    @Override public void elected(    String role,    URI electedMember){
      try {
        if (electedMember.equals(serverClusterId)) {
          cluster.broadcast(serializer.broadcast(new MasterIsElected(serverClusterId)));
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
  }
);
  cluster.addHeartbeatListener(heartbeatListener=new HeartbeatListener.Adapter(){
    @Override public void alive(    URI server){
      broadcastOurself();
    }
  }
);
  cluster.addAtomicBroadcastListener(atomicBroadcastListener=new AtomicBroadcastListener(){
    @Override public void receive(    Payload payload){
      try {
        final Object value=serializer.receive(payload);
        if (value instanceof MasterIsElected) {
          Listeners.notifyListeners(listeners,new Listeners.Notification<HighAvailabilityListener>(){
            @Override public void notify(            HighAvailabilityListener listener){
              listener.masterIsElected(((MasterIsElected)value).getMasterUri());
            }
          }
);
        }
 else         if (value instanceof MemberIsAvailable) {
          Listeners.notifyListeners(listeners,new Listeners.Notification<HighAvailabilityListener>(){
            @Override public void notify(            HighAvailabilityListener listener){
              MemberIsAvailable memberIsAvailable=(MemberIsAvailable)value;
              listener.memberIsAvailable(memberIsAvailable.getRole(),memberIsAvailable.getClusterUri(),memberIsAvailable.getInstanceUris());
            }
          }
);
        }
      }
 catch (      Throwable t) {
        t.printStackTrace();
      }
    }
  }
);
}
