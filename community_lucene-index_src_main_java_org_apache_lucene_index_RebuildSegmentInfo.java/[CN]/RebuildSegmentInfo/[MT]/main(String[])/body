{
  if (args.length != 1) {
    System.out.println("Usage: RebuildSegmentInfo <INDEX DIRECTORY>");
    System.exit(0);
  }
  String path=args[0];
  File file=new File(path);
  Directory directory=FSDirectory.open(file);
  SegmentInfos infos=new SegmentInfos();
  int counter=0;
  for (  String fileName : directory.listAll()) {
    if (directory.fileLength(fileName) == 0 || !fileName.endsWith("cfs")) {
      System.out.println("Skipping " + fileName + ", size "+ directory.fileLength(fileName));
      continue;
    }
 else {
      System.out.println("Doing " + fileName + ", size "+ directory.fileLength(fileName));
    }
    String segmentName=fileName.substring(1,fileName.lastIndexOf('.'));
    int segmentInt=Integer.parseInt(segmentName,Character.MAX_RADIX);
    counter=Math.max(counter,segmentInt);
    segmentName=fileName.substring(0,fileName.lastIndexOf('.'));
    Directory fileReader=new CompoundFileReader(directory,fileName);
    IndexInput indexStream=fileReader.openInput(segmentName + ".cfs");
    SegmentInfo segmentInfo=new SegmentInfo(directory,SegmentInfos.CURRENT_FORMAT,indexStream);
    System.out.println("Name was: \"" + segmentInfo.name + "\"");
    System.out.println("Doc count was: " + segmentInfo.docCount);
    infos.add(segmentInfo);
  }
  infos.counter=++counter;
  infos.commit(directory);
}
