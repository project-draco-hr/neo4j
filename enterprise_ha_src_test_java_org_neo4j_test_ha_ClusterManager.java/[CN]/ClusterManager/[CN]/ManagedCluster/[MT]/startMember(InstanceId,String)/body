{
  Clusters.Member member=spec.getMembers().get(serverId.toIntegerIndex() - 1);
  StringBuilder initialHosts=new StringBuilder(spec.getMembers().get(0).getHost());
  for (int i=1; i < spec.getMembers().size(); i++) {
    initialHosts.append(",").append(spec.getMembers().get(i).getHost());
  }
  File parent=new File(root,name);
  URI clusterUri=new URI("cluster://" + member.getHost());
  if (member.isFullHaMember()) {
    int clusterPort=clusterUri.getPort();
    int haPort=clusterUri.getPort() + 3000;
    File storeDir=new File(parent,"server" + serverId);
    if (storeDirInitializer != null) {
      storeDirInitializer.initializeStoreDir(serverId.toIntegerIndex(),storeDir);
    }
    GraphDatabaseBuilder graphDatabaseBuilder=dbFactory.newHighlyAvailableDatabaseBuilder(path).setConfig(ClusterSettings.cluster_name,name).setConfig(ClusterSettings.initial_hosts,initialHosts.toString()).setConfig(ClusterSettings.server_id,serverId + "").setConfig(ClusterSettings.cluster_server,"0.0.0.0:" + clusterPort).setConfig(HaSettings.ha_server,":" + haPort).setConfig(OnlineBackupSettings.online_backup_enabled,Settings.FALSE).setConfig(commonConfig);
    if (instanceConfig.containsKey(serverId.toIntegerIndex())) {
      graphDatabaseBuilder.setConfig(instanceConfig.get(serverId.toIntegerIndex()));
    }
    config(graphDatabaseBuilder,name,serverId);
    final HighlyAvailableGraphDatabaseProxy graphDatabase=new HighlyAvailableGraphDatabaseProxy(graphDatabaseBuilder);
    members.put(serverId,graphDatabase);
    life.add(new LifecycleAdapter(){
      @Override public void stop() throws Throwable {
        graphDatabase.get().shutdown();
      }
    }
);
  }
 else {
    Map<String,String> config=MapUtil.stringMap(ClusterSettings.cluster_name.name(),name,ClusterSettings.initial_hosts.name(),initialHosts.toString(),ClusterSettings.server_id.name(),serverId + "",ClusterSettings.cluster_server.name(),"0.0.0.0:" + clusterUri.getPort(),GraphDatabaseSettings.store_dir.name(),path);
    Config config1=new Config(config,InternalAbstractGraphDatabase.Configuration.class,GraphDatabaseSettings.class);
    Logging clientLogging=life.add(new LogbackService(config1,new LoggerContext()));
    ObjectStreamFactory objectStreamFactory=new ObjectStreamFactory();
    ClusterClient clusterClient=new ClusterClient(new Monitors(),ClusterClient.adapt(config1),clientLogging,new NotElectableElectionCredentialsProvider(),objectStreamFactory,objectStreamFactory);
    arbiters.add(new ClusterMembers(clusterClient,clusterClient,new ClusterMemberEvents(){
      @Override public void addClusterMemberListener(      ClusterMemberListener listener){
      }
      @Override public void removeClusterMemberListener(      ClusterMemberListener listener){
      }
    }
,clusterClient.getServerId()));
    life.add(new FutureLifecycleAdapter<>(clusterClient));
  }
}
