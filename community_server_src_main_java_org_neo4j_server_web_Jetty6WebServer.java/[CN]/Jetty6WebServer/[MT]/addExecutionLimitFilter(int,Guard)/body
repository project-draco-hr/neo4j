{
  if (guard == null) {
    throw new RuntimeException("unable to use guard, enable guard-insertion in neo4j.properties");
  }
  if (jetty == null) {
    throw new RuntimeException("Jetty server not started before usage");
  }
  jetty.addLifeCycleListener(new JettyLifeCycleListenerAdapter(){
    @Override public void lifeCycleStarted(    LifeCycle arg0){
      for (      Handler handler : jetty.getHandlers()) {
        if (handler instanceof Context) {
          final Context context=(Context)handler;
          final Filter jettyFilter=new GuardingRequestFilter(guard,timeout);
          final FilterHolder holder=new FilterHolder(jettyFilter);
          context.addFilter(holder,"/*",Handler.ALL);
        }
      }
    }
  }
);
}
