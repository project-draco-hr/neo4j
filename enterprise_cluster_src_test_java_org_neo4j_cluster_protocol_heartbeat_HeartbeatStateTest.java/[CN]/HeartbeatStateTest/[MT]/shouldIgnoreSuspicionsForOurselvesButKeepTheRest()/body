{
  InstanceId myId=new InstanceId(1);
  InstanceId foreignId=new InstanceId(3);
  HeartbeatState heartbeat=HeartbeatState.heartbeat;
  ClusterConfiguration configuration=new ClusterConfiguration("whatever","cluster://1","cluster://2");
  configuration.joined(myId,URI.create("cluster://1"));
  configuration.joined(new InstanceId(2),URI.create("cluster://2"));
  Logging logging=mock(Logging.class);
  ClusterContext clusterContext=new ClusterContext(myId,mock(ProposerContext.class),mock(LearnerContext.class),configuration,mock(Timeouts.class),mock(Executor.class),logging,mock(ObjectInputStreamFactory.class),mock(ObjectOutputStreamFactory.class));
  when(logging.getMessagesLog(Matchers.<Class>any())).thenReturn(mock(StringLogger.class));
  HeartbeatContext context=new HeartbeatContext(clusterContext,mock(LearnerContext.class),mock(Executor.class));
  Message received=Message.internal(HeartbeatMessage.suspicions,new HeartbeatMessage.SuspicionsState(Iterables.toSet(Iterables.<InstanceId,InstanceId>iterable(myId,foreignId))));
  received.setHeader(Message.FROM,"cluster://2");
  heartbeat.handle(context,received,mock(MessageHolder.class));
  assertThat(context.getSuspicionsOf(myId).size(),equalTo(0));
  assertThat(context.getSuspicionsOf(foreignId).size(),equalTo(1));
}
