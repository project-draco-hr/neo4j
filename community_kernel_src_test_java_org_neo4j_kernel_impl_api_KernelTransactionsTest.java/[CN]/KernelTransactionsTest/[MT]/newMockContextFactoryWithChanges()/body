{
  NeoStoreTransactionContextFactory factory=mock(NeoStoreTransactionContextFactory.class);
  NeoStoreTransactionContext context=mock(NeoStoreTransactionContext.class,RETURNS_MOCKS);
  when(context.hasChanges()).thenReturn(true);
  RecordAccess<Long,NodeRecord,Void> recordChanges=mock(RecordAccess.class);
  when(recordChanges.changeSize()).thenReturn(1);
  RecordProxy<Long,NodeRecord,Void> recordChange=mock(RecordProxy.class);
  when(recordChange.forReadingLinkage()).thenReturn(new NodeRecord(1,false,1,1));
  when(recordChanges.changes()).thenReturn(Iterables.option(recordChange));
  when(context.getNodeRecords()).thenReturn(recordChanges);
  when(factory.newInstance(any(Locks.Client.class))).thenReturn(context);
  return factory;
}
