{
  KernelTransactions kernelTransactions=newKernelTransactions();
  kernelTransactions.blockNewTransactions();
  CountDownLatch aboutToStartTx=new CountDownLatch(1);
  Future<KernelTransaction> txOpener=startTxInSeparateThread(kernelTransactions,aboutToStartTx);
  await(aboutToStartTx);
  assertNotDone(txOpener);
  Future<?> wrongUnblocker=unblockTxsInSeparateThread(kernelTransactions);
  assertDone(wrongUnblocker);
  assertNotDone(txOpener);
  kernelTransactions.unblockNewTransactions();
  assertNotNull(txOpener.get(2,TimeUnit.SECONDS));
}
