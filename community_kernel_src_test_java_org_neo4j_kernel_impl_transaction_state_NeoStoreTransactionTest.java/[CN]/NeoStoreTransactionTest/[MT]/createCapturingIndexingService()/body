{
  NeoStoreIndexStoreView storeView=new NeoStoreIndexStoreView(locks,neoStore);
  SchemaIndexProviderMap providerMap=new DefaultSchemaIndexProviderMap(NO_INDEX_PROVIDER);
  Logging logging=new SingleLoggingService(DEV_NULL);
  IndexingService.Monitor monitor=IndexingService.NO_MONITOR;
  UpdateableSchemaState schemaState=new KernelSchemaStateStore(logging);
  IndexSamplingConfig samplingConfig=new IndexSamplingConfig(new Config());
  TokenNameLookup tokenNameLookup=mock(TokenNameLookup.class);
  IndexMapReference indexMapRef=new IndexMapReference();
  IndexSamplingControllerFactory samplingFactory=new IndexSamplingControllerFactory(samplingConfig,storeView,null,tokenNameLookup,logging);
  IndexProxySetup proxySetup=new IndexProxySetup(samplingConfig,storeView,providerMap,schemaState,null,null,logging);
  IndexSamplingController samplingController=samplingFactory.create(indexMapRef);
  return new CapturingIndexingService(proxySetup,providerMap,indexMapRef,storeView,Collections.<IndexRule>emptyList(),samplingController,logging,monitor);
}
