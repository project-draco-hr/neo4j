{
  NeoStoreIndexStoreView storeView=new NeoStoreIndexStoreView(locks,neoStore);
  SchemaIndexProviderMap providerMap=new DefaultSchemaIndexProviderMap(NO_INDEX_PROVIDER);
  IndexingService.Monitor monitor=IndexingService.NO_MONITOR;
  UpdateableSchemaState schemaState=new KernelSchemaStateStore(NULL_LOG_PROVIDER);
  IndexSamplingConfig samplingConfig=new IndexSamplingConfig(new Config());
  TokenNameLookup tokenNameLookup=mock(TokenNameLookup.class);
  IndexMapReference indexMapRef=new IndexMapReference();
  IndexSamplingControllerFactory samplingFactory=new IndexSamplingControllerFactory(samplingConfig,storeView,null,tokenNameLookup,NULL_LOG_PROVIDER);
  IndexProxySetup proxySetup=new IndexProxySetup(samplingConfig,storeView,providerMap,schemaState,null,null,NULL_LOG_PROVIDER);
  IndexSamplingController samplingController=samplingFactory.create(indexMapRef);
  return new CapturingIndexingService(proxySetup,providerMap,indexMapRef,storeView,Collections.<IndexRule>emptyList(),samplingController,NULL_LOG_PROVIDER,monitor);
}
