{
  TransactionAppender appenderMock=mock(TransactionAppender.class);
  when(appenderMock.append(Matchers.<TransactionRepresentation>any(),any(LogAppendEvent.class))).thenReturn(nextTxId++);
  LogicalTransactionStore txStoreMock=mock(LogicalTransactionStore.class);
  when(txStoreMock.getAppender()).thenReturn(appenderMock);
  LabelScanStore labelScanStore=mock(LabelScanStore.class);
  when(labelScanStore.newWriter()).thenReturn(mock(LabelScanWriter.class));
  TransactionRepresentationStoreApplier applier=new TransactionRepresentationStoreApplier(indexing,labelScanStore,neoStore,cacheAccessBackDoor,locks,null,null,null);
  neoStore.nextCommittingTransactionId();
  PropertyLoader propertyLoader=new PropertyLoader(neoStore);
  return new TransactionRepresentationCommitProcess(txStoreMock,mock(KernelHealth.class),neoStore,applier,new IndexUpdatesValidator(neoStore,propertyLoader,indexing),mode);
}
