{
  logRotationControl.awaitAllTransactionsClosed();
  logRotationControl.forceEverything();
  LogPosition endPosition=writer.getCurrentPosition();
  writer.close();
  File currentLogFile=currentLog == LOG1 ? logFiles.getLog1FileName() : logFiles.getLog2FileName();
  if (currentLog != CLEAN) {
    setActiveLog(CLEAN);
  }
  renameLogFileToRightVersion(currentLogFile,endPosition.getByteOffset());
  transactionIdStore.nextLogVersion();
  pruneStrategy.prune(this);
}
