{
  long logVersion=logFiles.getHighestLogVersion();
  long highTransactionId=transactionIdStore.getLastCommittingTransactionId();
  while (logFiles.versionExists(logVersion)) {
    long previousLogLastTxId=transactionMetadataCache.getLogHeader(logVersion);
    if (previousLogLastTxId == -1) {
      long[] header=readLogHeader(fileSystem,logFiles.getLogFileForVersion(logVersion));
      transactionMetadataCache.putHeader(header[0],header[1]);
      previousLogLastTxId=header[1];
    }
    long lowTransactionId=previousLogLastTxId + 1;
    if (!visitor.visit(new LogPosition(logVersion,LOG_HEADER_SIZE),lowTransactionId,highTransactionId)) {
      break;
    }
    logVersion--;
    highTransactionId=previousLogLastTxId;
  }
}
