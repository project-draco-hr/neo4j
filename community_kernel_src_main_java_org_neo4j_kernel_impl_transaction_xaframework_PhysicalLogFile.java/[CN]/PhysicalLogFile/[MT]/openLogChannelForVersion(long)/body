{
  File toOpen=logFiles.getLogFileForVersion(forVersion);
  StoreChannel storeChannel=fileSystem.open(toOpen,"rw");
  LogHeader header=readLogHeader(headerBuffer,storeChannel,false);
  if (header == null) {
    long lastTxId=transactionIdStore.getLastCommittedTransactionId();
    writeLogHeader(headerBuffer,forVersion,lastTxId);
    transactionMetadataCache.putHeader(forVersion,lastTxId);
    storeChannel.writeAll(headerBuffer);
    monitor.opened(toOpen,forVersion,lastTxId,true);
  }
  byte formatVersion=header == null ? CURRENT_LOG_VERSION : header.logFormatVersion;
  return new PhysicalLogVersionedStoreChannel(storeChannel,forVersion,formatVersion);
}
