{
  workerGroup=new NioEventLoopGroup(0,threadFactory);
  ServerBootstrap bootstrap=new ServerBootstrap().group(workerGroup).channel(NioServerSocketChannel.class).localAddress(listenAddress.socketAddress()).childHandler(new ChannelInitializer<SocketChannel>(){
    @Override protected void initChannel(    SocketChannel ch) throws Exception {
      CatchupServerProtocol protocol=new CatchupServerProtocol();
      ChannelPipeline pipeline=ch.pipeline();
      pipeline.addLast(new LengthFieldBasedFrameDecoder(Integer.MAX_VALUE,0,4,0,4));
      pipeline.addLast(new LengthFieldPrepender(4));
      pipeline.addLast(new ResponseMessageType.Encoder());
      pipeline.addLast(new RequestMessageType.Encoder());
      pipeline.addLast(new TxPullResponseEncoder());
      pipeline.addLast(new CoreSnapshotEncoder());
      pipeline.addLast(new StoreCopyFinishedResponseEncoder());
      pipeline.addLast(new TxStreamFinishedResponseEncoder());
      pipeline.addLast(new FileHeaderEncoder());
      pipeline.addLast(new ServerMessageTypeHandler(protocol,logProvider));
      pipeline.addLast(decoders(protocol));
      pipeline.addLast(new TxPullRequestHandler(versionChecker,protocol,storeIdSupplier,transactionIdStoreSupplier,logicalTransactionStoreSupplier,monitors,logProvider));
      pipeline.addLast(new ChunkedWriteHandler());
      pipeline.addLast(new GetStoreRequestHandler(versionChecker,protocol,dataSourceSupplier,checkPointerSupplier,logProvider));
      pipeline.addLast(new GetStoreIdRequestHandler(versionChecker,protocol,storeIdSupplier,logProvider));
      pipeline.addLast(new CoreSnapshotRequestHandler(versionChecker,protocol,coreState,logProvider));
      pipeline.addLast(new ExceptionLoggingHandler(log));
    }
  }
);
  channel=bootstrap.bind().syncUninterruptibly().channel();
}
