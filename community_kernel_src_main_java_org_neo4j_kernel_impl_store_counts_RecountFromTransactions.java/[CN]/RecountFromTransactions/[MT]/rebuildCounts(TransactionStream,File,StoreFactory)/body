{
  CountsRecordState counts=new CountsRecordState();
  try (NodeStore nodes=createNodeStore(factory,nodeStore)){
    try (IOCursor<CommittedTransactionRepresentation> cursor=transactions.cursor()){
      while (cursor.next()) {
        try (CommandApplierFacade visitor=new CommandApplierFacade(new NodeStoreApplier(nodes),new CountsStoreApplier(counts.updater(),nodes))){
          cursor.get().accept(visitor);
        }
       }
    }
   }
   return counts;
}
