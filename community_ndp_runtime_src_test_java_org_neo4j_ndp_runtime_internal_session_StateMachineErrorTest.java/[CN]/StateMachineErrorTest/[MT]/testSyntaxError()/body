{
  RecordingCallback responses=new RecordingCallback();
  doThrow(new SyntaxException("src/test")).when(runner).run(any(SessionState.class),any(String.class),any(Map.class));
  SessionStateMachine machine=new SessionStateMachine(db,txBridge,runner,StringLogger.DEV_NULL);
  machine.run("this is nonsense",EMPTY_MAP,null,responses);
  assertThat(responses.next(),failedWith(Status.Statement.InvalidSyntax));
  assertThat(machine.state(),equalTo(ERROR));
}
