{
  RecordingCallback<StatementMetadata,Object> messages=new RecordingCallback<>();
  RecordingCallback<Void,Object> failures=new RecordingCallback<>();
  SessionStateMachine machine=new SessionStateMachine(db,txBridge,runner,NullLog.getInstance());
  machine.commitTransaction();
  machine.acknowledgeFailure(null,failures);
  assertThat(failures.next(),success());
  machine.run("src/test",EMPTY_PARAMS,null,messages);
}
