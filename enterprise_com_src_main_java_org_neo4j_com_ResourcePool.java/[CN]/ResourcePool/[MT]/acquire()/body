{
  Thread thread=Thread.currentThread();
  R resource=current.get(thread);
  if (resource == null) {
    resources.acquireUninterruptibly();
    List<R> garbage=null;
synchronized (unused) {
      for (; ; ) {
        resource=unused.poll();
        if (resource == null)         break;
        if (isAlive(resource))         break;
        if (garbage == null)         garbage=new LinkedList<R>();
        garbage.add(resource);
      }
    }
    if (resource == null) {
      resource=create();
    }
    current.put(thread,resource);
    if (garbage != null) {
      for (      R dead : garbage) {
        dispose(dead);
      }
    }
  }
  return resource;
}
