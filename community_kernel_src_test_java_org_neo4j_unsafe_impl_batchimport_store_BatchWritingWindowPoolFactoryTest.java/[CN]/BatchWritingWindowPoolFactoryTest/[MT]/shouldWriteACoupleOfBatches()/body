{
  int recordSize=20;
  int bufferedRecords=10;
  int numberOfReservedLowIds=0;
  File file=new File("store");
  FileSystemAbstraction fsa=fs.get();
  try (StoreChannel channel=fsa.open(file,"rw")){
    WindowPoolFactory factory=new BatchWritingWindowPoolFactory(recordSize * bufferedRecords + recordSize / 2,Monitor.NO_MONITOR);
    WindowPool pool=factory.create(file,recordSize,channel,new Config(),DEV_NULL,numberOfReservedLowIds);
    byte[] staticRecordBytes=ladderBytes(recordSize);
    int recordsToWrite=bufferedRecords * 2 + bufferedRecords / 2;
    for (int i=0; i < recordsToWrite; i++) {
      PersistenceWindow window=pool.acquire(i,OperationType.WRITE);
      try {
        Buffer buffer=window.getOffsettedBuffer(i);
        buffer.put(staticRecordBytes);
      }
  finally {
        pool.release(window);
      }
    }
    pool.close();
    channel.position(recordSize * numberOfReservedLowIds);
    verifyChannel(staticRecordBytes,recordsToWrite,channel);
  }
 }
