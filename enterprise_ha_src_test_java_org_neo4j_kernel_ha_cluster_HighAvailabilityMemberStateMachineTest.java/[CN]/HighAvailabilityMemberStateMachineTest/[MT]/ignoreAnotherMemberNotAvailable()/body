{
  InstanceId me=new InstanceId(1);
  InstanceId other=new InstanceId(2);
  HighAvailabilityMemberContext context=new SimpleHighAvailabilityMemberContext(me,false);
  ClusterMemberEvents events=mock(ClusterMemberEvents.class);
  ClusterMemberListenerContainer memberListenerContainer=mockAddClusterMemberListener(events);
  HighAvailabilityMemberStateMachine stateMachine=buildMockedStateMachine(context,events);
  stateMachine.init();
  ClusterMemberListener memberListener=memberListenerContainer.get();
  memberListener.coordinatorIsElected(me);
  assertThat(stateMachine.getCurrentState(),equalTo(HighAvailabilityMemberState.TO_MASTER));
  memberListener.memberIsUnavailable(HighAvailabilityModeSwitcher.SLAVE,other);
  assertThat(stateMachine.getCurrentState(),equalTo(HighAvailabilityMemberState.TO_MASTER));
}
