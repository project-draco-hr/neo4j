{
  resizing=true;
  try {
    if (newMaxSize >= size()) {
      maxSize=newMaxSize;
    }
 else     if (newMaxSize == 0) {
      java.util.Iterator<Map.Entry<K,E>> itr=cache.entrySet().iterator();
      while (itr.hasNext()) {
        E element=itr.next().getValue();
        elementCleaned(element);
      }
      cache.clear();
    }
 else {
      maxSize=newMaxSize;
      java.util.Iterator<Map.Entry<K,E>> itr=cache.entrySet().iterator();
      while (itr.hasNext() && cache.size() > maxSize) {
        E element=itr.next().getValue();
        itr.remove();
        elementCleaned(element);
      }
    }
  }
  finally {
    resizing=false;
  }
}
