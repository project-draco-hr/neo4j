{
  if (dataSource != null) {
    dataSource.stop();
    dataSource.shutdown();
  }
  Locks locks=mock(Locks.class);
  when(locks.newClient()).thenReturn(mock(Locks.Client.class));
  dataSource=new NeoStoreDataSource(storeDir,config,storeFactory,logProvider,mock(JobScheduler.class,RETURNS_MOCKS),mock(TokenNameLookup.class),dependencyResolverForNoIndexProvider(),mock(PropertyKeyTokenHolder.class),mock(LabelTokenHolder.class),mock(RelationshipTypeTokenHolder.class),locks,mock(SchemaWriteGuard.class),mock(TransactionEventHandlers.class),IndexingService.NO_MONITOR,fs,mock(StoreUpgrader.class),mock(TransactionMonitor.class),kernelHealth,mock(PhysicalLogFile.Monitor.class),TransactionHeaderInformationFactory.DEFAULT,new StartupStatisticsProvider(),mock(NodeManager.class),null,null,new CommunityCommitProcessFactory(),mock(PageCache.class),mock(ConstraintSemantics.class),new Monitors(),new Tracers("null",NullLog.getInstance()),idGeneratorFactory,IdReuseEligibility.ALWAYS);
  return dataSource;
}
