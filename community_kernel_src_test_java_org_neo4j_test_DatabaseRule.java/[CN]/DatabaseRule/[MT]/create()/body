{
  createResources();
  try {
    GraphDatabaseFactory factory=newFactory();
    configure(factory);
    databaseBuilder=newBuilder(factory);
    configure(databaseBuilder);
    database=(GraphDatabaseAPI)databaseBuilder.newGraphDatabase();
    storeDir=database.getStoreDir();
    statementProvider=resolveDependency(ThreadToStatementContextBridge.class);
  }
 catch (  RuntimeException e) {
    deleteResources();
    throw e;
  }
}
