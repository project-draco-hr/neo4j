{
  final IterableSpecification<T> spec=init();
  return new CloseableIteratorWithSize<T>(){
    int index=0;
    T[] content=spec.content;
    int token=spec.token;
    boolean hasMore=spec.hasMore;
    long size=spec.size;
    public boolean hasNext(){
      return content != null && (index < content.length || hasMore);
    }
    public T next(){
      if (content != null && index < content.length) {
        return content[index++];
      }
 else       if (hasMore) {
        index=0;
        @SuppressWarnings("hiding") IterableSpecification<T> spec=more(token);
        content=spec.content;
        token=spec.token;
        hasMore=spec.hasMore;
        return content[index++];
      }
 else {
        throw new NoSuchElementException();
      }
    }
    public long size(){
      if (size < 0) {
        throw new UnsupportedOperationException("This iterator has no size.");
      }
      return size;
    }
    public void close(){
      if (content != null) {
        done(token);
        hasMore=false;
        content=null;
      }
    }
    public void remove(){
      throw new UnsupportedOperationException();
    }
    @Override protected void finalize(){
      close();
    }
  }
;
}
