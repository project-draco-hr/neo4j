{
  if (channel instanceof EphemeralFileChannel) {
    EphemeralFileChannel efc=(EphemeralFileChannel)channel;
    final java.nio.channels.FileLock lock=efc.tryLock();
    return new FileLock(){
      @Override public void release() throws IOException {
        lock.release();
      }
    }
;
  }
  System.err.println("WARNING: locking non-ephemeral FileChannel[" + channel + "] through EphemeralFileSystem, for: "+ fileName);
  return FileLock.getOsSpecificFileLock(fileName,channel);
}
