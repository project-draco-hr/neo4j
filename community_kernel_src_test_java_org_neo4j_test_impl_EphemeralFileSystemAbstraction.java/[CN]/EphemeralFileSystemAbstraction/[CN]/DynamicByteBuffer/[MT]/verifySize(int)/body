{
  if (buf.remaining() >= amount) {
    return;
  }
  int newSize=buf.capacity();
  int sizeIndex=sizeIndexFor(newSize);
  for (int required=newSize + amount - buf.remaining(); newSize < required; newSize+=Math.min(newSize,1024 * 1024), sizeIndex++)   ;
  int oldPosition=this.buf.position();
  ByteBuffer buf=allocate(sizeIndex);
  this.buf.position(0);
  buf.put(this.buf);
  this.buf=buf;
  this.buf.position(oldPosition);
}
