{
  acquireLock(this,LockType.READ);
  try {
    for (    PropertyIndex index : PropertyIndex.index(key)) {
      Property property=propertyMap.get(index.getKeyId());
      if (property != null) {
        return property.getValue();
      }
      if (ensureFullRelationship()) {
        property=propertyMap.get(index.getKeyId());
        if (property != null) {
          return property.getValue();
        }
      }
    }
    if (!PropertyIndex.hasAll()) {
      ensureFullRelationship();
      for (      int keyId : propertyMap.keySet()) {
        if (!PropertyIndex.hasIndexFor(keyId)) {
          PropertyIndex indexToCheck=PropertyIndex.getIndexFor(keyId);
          if (indexToCheck.getKey().equals(key)) {
            return propertyMap.get(indexToCheck.getKeyId());
          }
        }
      }
    }
  }
  finally {
    releaseLock(this,LockType.READ);
  }
  return defaultValue;
}
