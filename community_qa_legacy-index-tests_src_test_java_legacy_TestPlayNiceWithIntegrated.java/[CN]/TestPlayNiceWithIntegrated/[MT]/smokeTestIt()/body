{
  IndexService indexService=new LuceneIndexService(db);
  IndexService fulltextIndexService=new LuceneFulltextIndexService(db);
  Index<Node> aNodeIndex=db.index().forNodes("a");
  String key="key";
  String value="value";
  beginTx();
  Node node=db.createNode();
  indexService.index(node,key,value);
  fulltextIndexService.index(node,key,value);
  aNodeIndex.add(node,key,value);
  for (int i=0; i < 2; i++) {
    assertEquals(node,indexService.getSingleNode(key,value));
    assertEquals(node,fulltextIndexService.getSingleNode(key,value));
    assertEquals(node,aNodeIndex.get(key,value).getSingle());
    restartTx();
  }
  fulltextIndexService.shutdown();
  indexService.shutdown();
}
