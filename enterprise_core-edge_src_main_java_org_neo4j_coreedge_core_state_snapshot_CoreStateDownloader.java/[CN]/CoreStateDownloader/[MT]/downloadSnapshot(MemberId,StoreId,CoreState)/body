{
  try {
    localDatabase.stop();
    log.info("Downloading snapshot from core server at %s",source);
    CoreSnapshot coreSnapshot=catchUpClient.makeBlockingRequest(source,new CoreSnapshotRequest(),1,MINUTES,new CatchUpResponseAdaptor<CoreSnapshot>(){
      @Override public void onCoreSnapshot(      CompletableFuture<CoreSnapshot> signal,      CoreSnapshot response){
        signal.complete(response);
      }
    }
);
    localDatabase.bringUpToDateOrReplaceStoreFrom(source,storeId,storeFetcher);
    log.info("Replaced store with one downloaded from %s",source);
    coreState.installSnapshot(coreSnapshot);
    log.info("Core snapshot installed: " + coreSnapshot);
    log.info("Restarting local database",source);
    localDatabase.start();
    log.info("Restarted local database",source);
  }
 catch (  Throwable e) {
    localDatabase.panic(e);
    throw new StoreCopyFailedException(e);
  }
}
