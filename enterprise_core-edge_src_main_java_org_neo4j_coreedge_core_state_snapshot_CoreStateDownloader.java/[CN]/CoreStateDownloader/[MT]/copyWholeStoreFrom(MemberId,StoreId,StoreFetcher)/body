{
  TemporaryStoreDirectory tempStore=new TemporaryStoreDirectory(localDatabase.storeDir());
  storeFetcher.copyStore(source,expectedStoreId,tempStore.storeDir());
  copiedStoreRecovery.recoverCopiedStore(tempStore.storeDir());
  localDatabase.replaceWith(tempStore.storeDir());
  tempStore.cleanDirectory();
  log.info("Replaced store with one downloaded from %s",source);
}
