{
  String name="name";
  String mattias="Mattias Persson";
  String title="title";
  String hacker="Hacker";
  assertThat(index.get(name,mattias),emptyIterable());
  T entity1=creator.create();
  T entity2=creator.create();
  assertNull(index.get(name,mattias).getSingle());
  index.add(entity1,name,mattias);
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertContains(index.query(name,"\"" + mattias + "\""),entity1);
  assertContains(index.query("name:\"" + mattias + "\""),entity1);
  assertEquals(entity1,index.get(name,mattias).getSingle());
  assertContains(index.query("name","Mattias*"),entity1);
  commitTx();
  beginTx();
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertThat(index.query(name,"\"" + mattias + "\""),Contains.contains(entity1));
  assertThat(index.query("name:\"" + mattias + "\""),Contains.contains(entity1));
  assertEquals(entity1,index.get(name,mattias).getSingle());
  assertThat(index.query("name","Mattias*"),Contains.contains(entity1));
  commitTx();
  beginTx();
  index.add(entity2,title,hacker);
  index.add(entity1,title,hacker);
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertThat(index.get(title,hacker),Contains.contains(entity1,entity2));
  assertContains(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),entity1,entity2);
  commitTx();
  beginTx();
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertThat(index.get(title,hacker),Contains.contains(entity1,entity2));
  assertThat(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),Contains.contains(entity1,entity2));
  assertThat(index.query("name:\"" + mattias + "\" AND title:\""+ hacker+ "\""),Contains.contains(entity1));
  commitTx();
  beginTx();
  index.remove(entity2,title,hacker);
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertThat(index.get(title,hacker),Contains.contains(entity1));
  assertContains(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),entity1);
  commitTx();
  beginTx();
  assertThat(index.get(name,mattias),Contains.contains(entity1));
  assertThat(index.get(title,hacker),Contains.contains(entity1));
  assertThat(index.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),Contains.contains(entity1));
  commitTx();
  beginTx();
  index.remove(entity1,title,hacker);
  index.remove(entity1,name,mattias);
  index.delete();
  commitTx();
}
