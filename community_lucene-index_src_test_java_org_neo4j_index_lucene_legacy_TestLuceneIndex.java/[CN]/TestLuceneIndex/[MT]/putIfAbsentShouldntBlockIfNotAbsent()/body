{
  Index<Node> index=nodeIndex(LuceneIndexImplementation.EXACT_CONFIG);
  Node node=graphDb.createNode();
  String key="key";
  String value="value";
  index.add(node,key,value);
  restartTx();
  WorkThread otherThread=new WorkThread("other thread",index,graphDb,node);
  otherThread.beginTransaction();
  index.putIfAbsent(node,key,value);
  assertNotNull(otherThread.putIfAbsent(node,key,value).get());
  otherThread.commit();
  commitTx();
  otherThread.close();
}
