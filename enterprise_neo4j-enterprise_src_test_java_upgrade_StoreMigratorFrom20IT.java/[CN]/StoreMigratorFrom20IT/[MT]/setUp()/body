{
  pageCache=pageCacheRule.getPageCache(fs);
  schemaIndexProvider=new LuceneSchemaIndexProvider(fs,DirectoryFactory.PERSISTENT,storeDir.directory());
  labelScanStoreProvider=new LabelScanStoreProvider(new InMemoryLabelScanStore(),1);
  storeFactory=new StoreFactory(storeDir.directory(),config,new DefaultIdGeneratorFactory(fs),pageCache,fs,NullLogProvider.getInstance());
  upgradableDatabase=new UpgradableDatabase(fs,new StoreVersionCheck(pageCache),new LegacyStoreVersionCheck(fs),InternalRecordFormatSelector.select());
}
