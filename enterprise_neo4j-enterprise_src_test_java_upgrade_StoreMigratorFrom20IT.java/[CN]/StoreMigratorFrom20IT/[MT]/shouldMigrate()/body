{
  StoreMigrator storeMigrator=new StoreMigrator(monitor,fs,pageCache,config,NullLogService.getInstance());
  upgrader(storeMigrator).migrateIfNeeded(find20FormatStoreDirectory(storeDir.directory()),upgradableDatabase,schemaIndexProvider);
  assertEquals(100,monitor.eventSize());
  assertTrue(monitor.isStarted());
  assertTrue(monitor.isFinished());
  GraphDatabaseService database=new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.absolutePath());
  try {
    verifyDatabaseContents(database);
  }
  finally {
    database.shutdown();
  }
  try (NeoStores neoStores=storeFactory.openNeoStores(true)){
    verifyNeoStore(neoStores);
  }
   assertConsistentStore(storeDir.directory());
}
