{
  StoreMigrator storeMigrator=new StoreMigrator(monitor,fs,pageCache,config,NullLogService.getInstance());
  SchemaIndexMigrator indexMigrator=new SchemaIndexMigrator(fs);
  upgrader(indexMigrator,storeMigrator).migrateIfNeeded(find20FormatStoreDirectory(storeDir.directory()),upgradableDatabase,schemaIndexProvider,labelScanStoreProvider);
  assertEquals(100,monitor.eventSize());
  assertTrue(monitor.isStarted());
  assertTrue(monitor.isFinished());
  GraphDatabaseService database=new GraphDatabaseFactory().newEmbeddedDatabase(storeDir.absolutePath());
  try {
    verifyDatabaseContents(database);
  }
  finally {
    database.shutdown();
  }
  try (NeoStores neoStores=storeFactory.openAllNeoStores(true)){
    verifyNeoStore(neoStores);
  }
   assertConsistentStore(storeDir.directory());
}
