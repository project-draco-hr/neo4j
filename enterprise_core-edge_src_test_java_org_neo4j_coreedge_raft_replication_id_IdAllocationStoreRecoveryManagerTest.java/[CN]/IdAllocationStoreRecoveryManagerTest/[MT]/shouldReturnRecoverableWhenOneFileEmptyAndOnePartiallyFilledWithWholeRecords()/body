{
  EphemeralFileSystemAbstraction fsa=new EphemeralFileSystemAbstraction();
  fsa.mkdir(testDir.directory());
  File fileA=new File(testDir.directory(),"fileA");
  StoreChannel channel=fsa.create(fileA);
  ByteBuffer buffer=partiallyFillWithWholeRecord(999);
  channel.writeAll(buffer);
  channel.force(false);
  File fileB=new File(testDir.directory(),"fileB");
  channel=fsa.create(fileA);
  fillUpAndForce(channel);
  channel.close();
  IdAllocationStoreRecoveryManager manager=new IdAllocationStoreRecoveryManager(fsa);
  File fileToUse=manager.recover(fileA,fileB);
  assertEquals(fileA,fileToUse);
}
