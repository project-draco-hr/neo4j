{
  List<ComExceptionHandler> handlers=new ArrayList<>(2);
  MasterClientResolver resolver=newMasterClientResolver(handlers);
  LifeSupport life=new LifeSupport();
  try {
    life.start();
    MasterClient masterClient1=resolver.instantiate("cluster://localhost",44,new Monitors(),StoreId.DEFAULT,life);
    assertThat(masterClient1,instanceOf(MasterClient214.class));
  }
  finally {
    life.shutdown();
  }
  IllegalProtocolVersionException illegalProtocolVersionException=new IllegalProtocolVersionException(MasterClient210.PROTOCOL_VERSION.getApplicationProtocol(),MasterClient214.PROTOCOL_VERSION.getApplicationProtocol(),"Protocol is too modern");
  for (  ComExceptionHandler handler : handlers) {
    handler.handle(illegalProtocolVersionException);
  }
  life=new LifeSupport();
  try {
    life.start();
    MasterClient masterClient2=resolver.instantiate("cluster://localhost",55,new Monitors(),StoreId.DEFAULT,life);
    assertThat(masterClient2,instanceOf(MasterClient210.class));
  }
  finally {
    life.shutdown();
  }
}
