{
  this.fileSystemAbstraction=fileSystemAbstraction;
  this.marshal=marshal;
  this.numberOfEntriesBeforeRotation=numberOfEntriesBeforeRotation;
  this.databaseHealthSupplier=databaseHealthSupplier;
  fileA=new File(stateDir,name + ".a");
  fileB=new File(stateDir,name + ".b");
  StateRecoveryManager<STATE> recoveryManager=new StateRecoveryManager<>(fileSystemAbstraction,marshal);
  final StateRecoveryManager.RecoveryStatus<STATE> recoveryStatus=recoveryManager.recover(fileA,fileB);
  this.currentStoreFile=recoveryStatus.activeFile();
  this.currentStoreChannel=new PhysicalFlushableChannel(fileSystemAbstraction.open(currentStoreFile,"rw"));
  initialiseStoreFile(currentStoreFile);
  this.initialState=recoveryStatus.recoveredState();
  Log log=logProvider.getLog(getClass());
  log.info("%s state restored, up to level %d.",name,marshal.ordinal(initialState));
}
