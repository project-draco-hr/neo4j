{
  try {
    if (ignored) {
      out.handleIgnoredMessage();
    }
 else     if (error != null) {
      publishError(out,error);
    }
 else {
      out.handleSuccessMessage(successMetadata());
    }
  }
 catch (  Throwable e) {
    log.error("Failed to write response to driver",e);
  }
 finally {
    onCompleted.run();
    clearState();
  }
}
