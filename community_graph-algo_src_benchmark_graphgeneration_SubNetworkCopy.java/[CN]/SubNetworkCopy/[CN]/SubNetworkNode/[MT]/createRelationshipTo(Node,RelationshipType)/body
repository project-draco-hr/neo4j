{
  SubNetworkNode otherSubNetworkNode=(SubNetworkNode)otherNode;
  Node otherUnderlyingNode=otherNode;
  if (nodeMap.containsValue(otherNode)) {
    otherUnderlyingNode=otherSubNetworkNode.underlyingNode;
  }
 else {
    otherSubNetworkNode=new SubNetworkNode(otherUnderlyingNode);
    nodeMap.put(otherUnderlyingNode,otherSubNetworkNode);
  }
  Relationship underlyingRelationship=underlyingNode.createRelationshipTo(otherUnderlyingNode,type);
  return addRelationship(underlyingRelationship);
}
