{
  StoreChannel channel1=mock(StoreChannel.class);
  StoreChannel channel2=mock(StoreChannel.class);
  Writer writer1=queue.create(channel1,monitor);
  Writer writer2=queue.create(channel2,monitor);
  SimplePool<ByteBuffer> pool1=mock(SimplePool.class);
  SimplePool<ByteBuffer> pool2=mock(SimplePool.class);
  final int position1=100;
  final int position2=position1 + buffer.capacity();
  final int position3=50;
  writer1.write(buffer,position1,pool1);
  writer1.write(buffer,position2,pool1);
  writer2.write(buffer,position3,pool2);
  executor.shutdown();
  executor.awaitTermination(10,SECONDS);
  verify(executor,atLeast(2)).submit(any(Callable.class));
  verify(executor,atMost(3)).submit(any(Callable.class));
  executor.shutdown();
  executor.awaitTermination(10,SECONDS);
  verify(channel1).position(position1);
  verify(channel1).position(position2);
  verify(channel2).position(position3);
  verify(channel1,times(2)).write(buffer);
  verify(channel2).write(buffer);
  verifyNoMoreInteractions(channel1);
  verifyNoMoreInteractions(channel2);
}
