{
  ExecutorService executor=cleanupRule.add(spy(Executors.newFixedThreadPool(3)));
  IoQueue queue=new IoQueue(executor);
  File file=new File(directory.directory(),"file");
  StoreChannel channel=spy(fs.create(file));
  Monitor monitor=mock(Monitor.class);
  Writer writer=queue.create(file,channel,monitor);
  Ring<ByteBuffer> ring=mock(Ring.class);
  ByteBuffer buffer=ByteBuffer.allocate(10);
  int position=100;
  writer.write(buffer,position,ring);
  verify(executor,times(1)).submit(any(Callable.class));
  executor.shutdown();
  executor.awaitTermination(10,SECONDS);
  verify(channel,times(1)).write(buffer,position);
  verifyNoMoreInteractions(channel);
}
