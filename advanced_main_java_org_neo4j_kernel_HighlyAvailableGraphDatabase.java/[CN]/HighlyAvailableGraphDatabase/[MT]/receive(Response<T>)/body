{
  try {
    XaDataSourceManager localDataSourceManager=getConfig().getTxModule().getXaDataSourceManager();
    for (    Pair<String,TransactionStream> streams : response.transactions().getStreams()) {
      String resourceName=streams.first();
      XaDataSource dataSource=localDataSourceManager.getXaDataSource(resourceName);
      for (      Pair<Long,ReadableByteChannel> channel : streams.other().getChannels()) {
        dataSource.applyCommittedTransaction(channel.first(),channel.other());
        channel.other().close();
      }
    }
    updateTime();
    return response.response();
  }
 catch (  IOException e) {
    newMaster(broker.getMaster(),e);
    throw new RuntimeException(e);
  }
}
