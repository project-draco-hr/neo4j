{
  shutdownIfNecessary();
  if (brokerSaysIAmMaster()) {
    this.localGraph=new EmbeddedGraphDbImpl(storeDir,config,this,LockManagerFactory.DEFAULT,IdGeneratorFactory.DEFAULT);
  }
 else {
    ResponseReceiver receiver=new ResponseReceiver();
    this.localGraph=new EmbeddedGraphDbImpl(storeDir,config,this,new SlaveLockManager.SlaveLockManagerFactory(broker,receiver),new SlaveIdGenerator.SlaveIdGeneratorFactory(broker,receiver));
  }
}
