{
  CodePosition codePosition=getCodePositionAfterCall("addUserToRole","getUserByName");
  InternalFlatFileRealm realm=new InternalFlatFileRealm(userRepository,roleRepository,passwordPolicy,authenticationStrategy,true);
  RunResult result=InterleavedRunner.interleave(new AddUserToRoleInMain(realm),new DeleteUserInSecondary(),Arrays.asList(codePosition));
  result.throwExceptionsIfAny();
  RoleRecord role=roleRepository.getRoleByName(ROLE);
  assertNull("User " + USERNAME + " should be deleted!",userRepository.getUserByName(USERNAME));
  assertNotNull("Role " + ROLE + " should exist!",role);
  assertTrue("Users assigned to role " + ROLE + " should be empty!",role.users().isEmpty());
}
