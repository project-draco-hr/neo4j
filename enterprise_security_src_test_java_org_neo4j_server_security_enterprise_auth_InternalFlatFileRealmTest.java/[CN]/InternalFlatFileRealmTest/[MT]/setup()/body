{
  log=new AssertableLogProvider();
  Log actualLog=log.getLog(this.getClass());
  testRealm=new TestRealm(new InMemoryUserRepository(),new InMemoryRoleRepository(),new BasicPasswordPolicy(),new RateLimitedAuthenticationStrategy(Clock.systemUTC(),3),mock(JobScheduler.class),actualLog);
  List<Realm> realms=listOf(testRealm);
  authManager=new MultiRealmAuthManager(testRealm,realms,new MemoryConstrainedCacheManager(),new SecurityLog(actualLog));
  authManager.init();
  authManager.start();
  authManager.getUserManager().newUser("mike","123",false);
}
