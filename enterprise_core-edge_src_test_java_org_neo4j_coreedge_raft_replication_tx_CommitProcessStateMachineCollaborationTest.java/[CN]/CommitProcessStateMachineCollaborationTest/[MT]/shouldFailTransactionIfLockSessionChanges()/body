{
  CoreMember coreMember=new CoreMember(new AdvertisedSocketAddress("core:1"),new AdvertisedSocketAddress("raft:1"));
  TransactionCommitProcess localCommitProcess=mock(TransactionCommitProcess.class);
  LocalSessionPool sessionPool=new LocalSessionPool(coreMember);
  ReplicatedLockTokenStateMachine<Object> lockState=lockState(1);
  RecoverTransactionLogState recoverTransactionLogState=mock(RecoverTransactionLogState.class);
  when(recoverTransactionLogState.findLastAppliedIndex()).thenReturn(-1L);
  TriggeredReplicator replicator=new TriggeredReplicator();
  CommittingTransactions txFutures=new StubCommittingTransactionsRegistry(replicator);
  final ReplicatedTransactionStateMachine stateMachine=new ReplicatedTransactionStateMachine<>(localCommitProcess,sessionPool.getGlobalSession(),lockState,txFutures,new InMemoryStateStorage<>(new GlobalSessionTrackerState<>()),NullLogProvider.getInstance(),recoverTransactionLogState);
  StateMachines stateMachines=new StateMachines(stateMachine);
  replicator.setStateMachines(stateMachines);
  ReplicatedTransactionCommitProcess commitProcess=new ReplicatedTransactionCommitProcess(replicator,sessionPool,new ExponentialBackoffStrategy(10,SECONDS),NullLogService.getInstance(),txFutures,new Monitors());
  try {
    commitProcess.commit(tx(),NULL,INTERNAL);
    fail("Should have thrown exception.");
  }
 catch (  TransactionFailureException e) {
  }
}
