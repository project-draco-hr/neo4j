{
  boolean authEnabled=config.get(GraphDatabaseSettings.auth_enabled);
  if (!authEnabled) {
    return AuthManager.NO_AUTH;
  }
  String key=config.get(GraphDatabaseFacadeFactory.Configuration.auth_manager);
  for (  AuthManager.Factory candidate : Service.load(AuthManager.Factory.class)) {
    String candidateId=candidate.getKeys().iterator().next();
    if (candidateId.equals(key)) {
      return candidate.newInstance(config,logging.getUserLogProvider());
    }
 else     if (key.equals("")) {
      logging.getInternalLog(CommunityFacadeFactory.class).info("No auth manager implementation specified, defaulting to '" + candidateId + "'");
      return candidate.newInstance(config,logging.getUserLogProvider());
    }
  }
  if (key.equals("")) {
    logging.getUserLog(CommunityFacadeFactory.class).error("No auth manager implementation specified and no default could be loaded.");
    throw new IllegalArgumentException("No auth manager found.");
  }
  throw new IllegalArgumentException("No auth manager found with the name '" + key + "'.");
}
