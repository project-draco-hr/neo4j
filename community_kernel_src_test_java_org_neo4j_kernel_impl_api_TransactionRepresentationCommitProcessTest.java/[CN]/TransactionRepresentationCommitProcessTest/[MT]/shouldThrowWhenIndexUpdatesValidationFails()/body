{
  IndexUpdatesValidator indexUpdatesValidator=mock(IndexUpdatesValidator.class);
  RuntimeException error=new UnderlyingStorageException(new IndexCapacityExceededException(10,10));
  when(indexUpdatesValidator.validate(any(TransactionRepresentation.class),eq(INTERNAL))).thenThrow(error);
  TransactionRepresentationCommitProcess commitProcess=new TransactionRepresentationCommitProcess(mock(LogicalTransactionStore.class),mock(KernelHealth.class),mock(TransactionIdStore.class),mock(TransactionRepresentationStoreApplier.class),indexUpdatesValidator);
  try (LockGroup lockGroup=new LockGroup()){
    commitProcess.commit(mock(TransactionRepresentation.class),lockGroup,CommitEvent.NULL,INTERNAL);
    fail("Should have thrown " + TransactionFailureException.class.getSimpleName());
  }
 catch (  TransactionFailureException e) {
    assertEquals(Status.Transaction.ValidationFailed,e.status());
  }
}
