{
  IndexUpdatesValidator indexUpdatesValidator=mock(IndexUpdatesValidator.class);
  RuntimeException error=new UnderlyingStorageException(new IndexCapacityExceededException(10,10));
  when(indexUpdatesValidator.validate(any(TransactionRepresentation.class))).thenThrow(error);
  StorageEngine storageEngine=mock(StorageEngine.class);
  TransactionRepresentationCommitProcess commitProcess=new TransactionRepresentationCommitProcess(mock(TransactionAppender.class),storageEngine,indexUpdatesValidator);
  try {
    commitProcess.commit(mock(TransactionToApply.class),CommitEvent.NULL,INTERNAL);
    fail("Should have thrown " + TransactionFailureException.class.getSimpleName());
  }
 catch (  TransactionFailureException e) {
    assertEquals(Status.Transaction.ValidationFailed,e.status());
  }
}
