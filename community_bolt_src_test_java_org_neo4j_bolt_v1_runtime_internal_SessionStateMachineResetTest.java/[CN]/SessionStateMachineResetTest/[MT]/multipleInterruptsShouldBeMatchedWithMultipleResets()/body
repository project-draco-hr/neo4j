{
  RecordingCallback recorder=new RecordingCallback();
  SessionStateMachine.SPI spi=mock(SessionStateMachine.SPI.class);
  when(spi.authenticate(any())).thenReturn(mock(BasicAuthenticationResult.class));
  SessionStateMachine ssm=new SessionStateMachine(spi);
  ssm.init("bob/1.0",map(),-1,null,noOp());
  ssm.interrupt();
  ssm.interrupt();
  ssm.run("hello",map(),null,recorder);
  ssm.reset(null,recorder);
  ssm.run("hello",map(),null,recorder);
  assertThat(recorder,recorded(ignored(),ignored(),ignored()));
  recorder=new RecordingCallback();
  ssm.reset(null,recorder);
  ssm.run("hello",map(),null,recorder);
  assertThat(recorder,recorded(success(),success()));
}
