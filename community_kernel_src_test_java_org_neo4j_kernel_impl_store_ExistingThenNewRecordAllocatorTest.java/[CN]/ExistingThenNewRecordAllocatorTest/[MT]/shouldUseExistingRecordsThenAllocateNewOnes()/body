{
  IdSequence mock=mock(IdSequence.class);
  when(mock.nextId()).thenReturn(3L).thenReturn(4L);
  ExistingThenNewRecordAllocator allocator=new ExistingThenNewRecordAllocator(mock(DynamicBlockSize.class),mock);
  Iterator<DynamicRecord> existing=asList(new DynamicRecord(1),new DynamicRecord(2)).iterator();
  DynamicRecord record1=allocator.nextUsedRecordOrNew(existing);
  DynamicRecord record2=allocator.nextUsedRecordOrNew(existing);
  DynamicRecord record3=allocator.nextUsedRecordOrNew(existing);
  DynamicRecord record4=allocator.nextUsedRecordOrNew(existing);
  assertEquals(1,record1.getId());
  assertEquals(2,record2.getId());
  assertEquals(3,record3.getId());
  assertEquals(4,record4.getId());
}
