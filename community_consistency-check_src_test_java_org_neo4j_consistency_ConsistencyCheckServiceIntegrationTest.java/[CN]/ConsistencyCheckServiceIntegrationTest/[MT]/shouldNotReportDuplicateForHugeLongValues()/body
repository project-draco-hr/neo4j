{
  ConsistencyCheckService service=new ConsistencyCheckService();
  Config configuration=new Config(settings(),GraphDatabaseSettings.class,ConsistencyCheckSettings.class);
  GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(testDirectory.graphDbDir());
  String propertyKey="itemId";
  Label label=DynamicLabel.label("Item");
  try (Transaction tx=db.beginTx()){
    db.schema().constraintFor(label).assertPropertyIsUnique(propertyKey).create();
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    set(db.createNode(label),property(propertyKey,973305894188596880L));
    set(db.createNode(label),property(propertyKey,973305894188596864L));
    tx.success();
  }
   db.shutdown();
  Result result=service.runFullConsistencyCheck(testDirectory.graphDbDir(),configuration,ProgressMonitorFactory.NONE,NullLogProvider.getInstance());
  assertEquals(ConsistencyCheckService.Result.SUCCESS,result);
}
