{
  try {
    createDeadDbs(numSlaves);
    haDbs=new ArrayList<GraphDatabaseService>();
    startUpMaster(config);
    FakeBroker broker=new FakeBroker(master);
    for (int i=1; i <= numSlaves; i++) {
      File slavePath=dbPath(i);
      Map<String,String> cfg=new HashMap<String,String>(config);
      cfg.put(HighlyAvailableGraphDatabase.CONFIG_KEY_HA_MACHINE_ID,Integer.toString(i));
      cfg.put(Config.KEEP_LOGICAL_LOGS,"true");
      GraphDatabaseService db=new HighlyAvailableGraphDatabase(slavePath.getAbsolutePath(),cfg,AbstractBroker.wrapSingleBroker(broker));
      haDbs.add(db);
      broker.setDb(db);
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
