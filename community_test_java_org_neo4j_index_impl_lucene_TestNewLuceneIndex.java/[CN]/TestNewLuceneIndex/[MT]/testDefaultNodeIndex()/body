{
  String name="name";
  String mattias="Mattias Persson";
  String title="title";
  String hacker="Hacker";
  Index<Node> nodeIndex=provider.nodeIndex("default",null);
  assertCollection(nodeIndex.get(name,mattias));
  Node node1=graphDb.createNode();
  Node node2=graphDb.createNode();
  assertNull(nodeIndex.get(name,mattias).getSingle());
  nodeIndex.add(node1,name,mattias);
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.query(name,"\"" + mattias + "\""),node1);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\""),node1);
  assertEquals(node1,nodeIndex.get(name,mattias).getSingle());
  assertCollection(nodeIndex.query("name","Mattias*"),node1);
  commitTx();
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.query(name,"\"" + mattias + "\""),node1);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\""),node1);
  assertEquals(node1,nodeIndex.get(name,mattias).getSingle());
  assertCollection(nodeIndex.query("name","Mattias*"),node1);
  beginTx();
  nodeIndex.add(node2,title,hacker);
  nodeIndex.add(node1,title,hacker);
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.get(title,hacker),node1,node2);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),node1,node2);
  commitTx();
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.get(title,hacker),node1,node2);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),node1,node2);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\" AND title:\""+ hacker+ "\""),node1);
  beginTx();
  nodeIndex.remove(node2,title,hacker);
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.get(title,hacker),node1);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),node1);
  commitTx();
  assertCollection(nodeIndex.get(name,mattias),node1);
  assertCollection(nodeIndex.get(title,hacker),node1);
  assertCollection(nodeIndex.query("name:\"" + mattias + "\" OR title:\""+ hacker+ "\""),node1);
  beginTx();
  nodeIndex.remove(node1,title,hacker);
  nodeIndex.remove(node1,name,mattias);
  commitTx();
}
