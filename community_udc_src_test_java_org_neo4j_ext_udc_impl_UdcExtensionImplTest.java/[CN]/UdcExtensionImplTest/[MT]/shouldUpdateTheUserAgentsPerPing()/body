{
  CollectUserAgentFilter.addUserAgent("test/1.0");
  setupServer();
  config.put(GraphDatabaseSettings.interval.name(),"1000");
  GraphDatabaseService graphdb=createTempDatabase(config);
  assertGotSuccessWithRetry(IS_GREATER_THAN_ZERO);
  String userAgents=handler.getQueryMap().get(USER_AGENTS);
  assertEquals(true,userAgents.contains("test/1.0"));
  CollectUserAgentFilter.addUserAgent("foo/bar");
  Thread.sleep(1000);
  assertGotSuccessWithRetry(IS_GREATER_THAN_ZERO);
  userAgents=handler.getQueryMap().get(USER_AGENTS);
  assertEquals(true,userAgents.contains("foo/bar"));
  destroy(graphdb);
}
