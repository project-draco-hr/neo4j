{
  TransactionIdStore transactionIdStore=new DeadSimpleTransactionIdStore(0l);
  LogRotationControl logRotationControl=mock(LogRotationControl.class);
  TransactionMetadataCache positionCache=new TransactionMetadataCache(10,1000);
  LifeSupport life=new LifeSupport();
  PhysicalLogFiles logFiles=new PhysicalLogFiles(testDir,DEFAULT_NAME,fs);
  Monitor monitor=new Monitors().newMonitor(PhysicalLogFile.Monitor.class);
  LogFile logFile=life.add(new PhysicalLogFile(fs,logFiles,1000,NO_PRUNING,transactionIdStore,mock(LogVersionRepository.class),monitor,logRotationControl,positionCache,noRecoveryAsserter()));
  TxIdGenerator txIdGenerator=new DefaultTxIdGenerator(singletonProvider(transactionIdStore));
  life.add(new PhysicalLogicalTransactionStore(logFile,txIdGenerator,positionCache,transactionIdStore,BYPASS,true));
  try {
    life.start();
  }
  finally {
    life.shutdown();
  }
}
