{
  Map<String,String> params=new HashMap<String,String>();
  Master master=new Master("var/master",params,9050);
  ReadOnlySlave slave=new ReadOnlySlave("var/slave",params,"127.0.0.1",9050);
  Thread.sleep(2000);
  NeoService neo=master.getNeoService();
  Transaction tx=neo.beginTx();
  long nodeId=-1;
  try {
    nodeId=neo.createNode().getId();
    tx.success();
  }
  finally {
    tx.finish();
  }
  neo=slave.getNeoService();
  tx=neo.beginTx();
  try {
    neo.getNodeById(nodeId);
    throw new RuntimeException("Node should not exist");
  }
 catch (  NotFoundException e) {
  }
 finally {
    tx.finish();
  }
  master.rotateLogAndPushToSlaves();
  Thread.sleep(5000);
  tx=neo.beginTx();
  try {
    neo.getNodeById(nodeId);
  }
  finally {
    tx.finish();
    master.shutdown();
    slave.shutdown();
  }
}
