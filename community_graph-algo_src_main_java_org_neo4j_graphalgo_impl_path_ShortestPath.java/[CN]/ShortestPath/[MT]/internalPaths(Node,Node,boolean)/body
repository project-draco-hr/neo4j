{
  lastMetadata=new Metadata();
  if (start.equals(end)) {
    return filterPaths(Collections.singletonList(PathImpl.singular(start)));
  }
  Hits hits=new Hits();
  Collection<Long> sharedVisitedRels=new HashSet<Long>();
  MutableInteger sharedFrozenDepth=new MutableInteger(NULL);
  MutableBoolean sharedStop=new MutableBoolean();
  MutableInteger sharedCurrentDepth=new MutableInteger(0);
  final DirectionData startData=new DirectionData(start,sharedVisitedRels,sharedFrozenDepth,sharedStop,sharedCurrentDepth,expander);
  final DirectionData endData=new DirectionData(end,sharedVisitedRels,sharedFrozenDepth,sharedStop,sharedCurrentDepth,expander.reverse());
  while (startData.hasNext() || endData.hasNext()) {
    goOneStep(startData,endData,hits,startData,stopAsap);
    goOneStep(endData,startData,hits,startData,stopAsap);
  }
  Collection<Hit> least=hits.least();
  return least != null ? filterPaths(hitsToPaths(least,start,end,stopAsap)) : Collections.<Path>emptyList();
}
