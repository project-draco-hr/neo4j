{
  if (!directionData.hasNext()) {
    otherSide.finishCurrentLayerThenStop=true;
    return;
  }
  Node nextNode=directionData.next();
  LevelData otherSideHit=otherSide.visitedNodes.get(nextNode);
  if (otherSideHit != null) {
    int depth=directionData.currentDepth + otherSideHit.depth;
    if (directionData.sharedFrozenDepth.value == NULL) {
      directionData.sharedFrozenDepth.value=depth;
    }
    if (depth <= directionData.sharedFrozenDepth.value) {
      directionData.haveFoundSomething=true;
      if (depth < directionData.sharedFrozenDepth.value) {
        directionData.sharedFrozenDepth.value=depth;
        otherSide.stop=true;
      }
      DirectionData startSideData=directionData == startSide ? directionData : otherSide;
      DirectionData endSideData=directionData == startSide ? otherSide : directionData;
      Hit hit=new Hit(startSideData,endSideData,nextNode);
      Node start=startSide.startNode;
      Node end=(startSide == directionData) ? otherSide.startNode : directionData.startNode;
      monitorData(startSide,(otherSide == startSide) ? directionData : otherSide);
      if (filterPaths(hitToPaths(hit,start,end,stopAsap)).size() > 0) {
        if (hits.add(hit,depth) >= maxResultCount) {
          directionData.stop=true;
          otherSide.stop=true;
          lastMetadata.paths++;
        }
 else         if (stopAsap) {
          if (otherSide.stop) {
            return;
          }
          directionData.stop=true;
        }
      }
 else {
        directionData.haveFoundSomething=false;
        directionData.sharedFrozenDepth.value=NULL;
        otherSide.stop=false;
      }
    }
  }
}
