{
  while (true) {
    Relationship nextRel=fetchNextRelOrNull();
    if (nextRel == null) {
      return null;
    }
    Node result=nextRel.getOtherNode(this.lastPath.endNode());
    if (filterNextLevelNodes(result) != null) {
      lastMetadata.rels++;
      LevelData levelData=this.visitedNodes.get(result);
      boolean createdLevelData=false;
      if (levelData == null) {
        levelData=new LevelData(nextRel,this.currentDepth);
        this.visitedNodes.put(result,levelData);
        createdLevelData=true;
      }
      if (this.currentDepth == levelData.depth && !createdLevelData) {
        levelData.addRel(nextRel);
      }
      if (createdLevelData) {
        this.nextNodes.add(result);
        return result;
      }
    }
  }
}
