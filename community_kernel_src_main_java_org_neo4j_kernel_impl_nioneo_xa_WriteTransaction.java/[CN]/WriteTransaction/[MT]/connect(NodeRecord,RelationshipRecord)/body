{
  if (node.getNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(node.getNextRel());
    getWriteLock(lockableRel);
    RelationshipRecord nextRel=getRelationshipRecord(node.getNextRel());
    if (nextRel == null) {
      nextRel=getRelationshipStore().getRecord(node.getNextRel());
      addRelationshipRecord(nextRel);
    }
    boolean changed=false;
    if (nextRel.getFirstNode() == node.getId()) {
      nextRel.setFirstPrevRel(rel.getId());
      changed=true;
    }
    if (nextRel.getSecondNode() == node.getId()) {
      nextRel.setSecondPrevRel(rel.getId());
      changed=true;
    }
    if (!changed) {
      throw new InvalidRecordException(node + " dont match " + nextRel);
    }
  }
}
