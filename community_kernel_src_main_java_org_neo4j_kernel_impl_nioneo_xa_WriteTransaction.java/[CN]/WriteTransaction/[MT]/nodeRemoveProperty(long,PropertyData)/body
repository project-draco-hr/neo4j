{
  long propertyId=propertyData.getId();
  NodeRecord nodeRecord=getNodeRecord(nodeId);
  if (nodeRecord == null) {
    nodeRecord=getNodeStore().getRecord(nodeId);
    addNodeRecord(nodeRecord);
  }
  if (!nodeRecord.inUse()) {
    throw new IllegalStateException("Property remove on node[" + nodeId + "] illegal since it has been deleted.");
  }
  PropertyRecord propRecord=getPropertyRecord(propertyId,false,true);
  if (!propRecord.inUse()) {
    throw new IllegalStateException("Unable to delete property[" + propertyId + "] since it is already deleted.");
  }
  propRecord.setNodeId(nodeId);
  PropertyBlock block=propRecord.removePropertyBlock(propertyData.getIndex());
  if (block == null) {
    throw new IllegalStateException("Property with index[" + propertyData.getIndex() + "] is not present in property["+ propertyId+ "]");
  }
  if (block.isLight()) {
    getPropertyStore().makeHeavy(block);
  }
  block.setChanged();
  propRecord.setChanged();
  for (  DynamicRecord valueRecord : block.getValueRecords()) {
    if (valueRecord.inUse()) {
      valueRecord.setInUse(false,block.getType().intValue());
      propRecord.addDeletedRecord(valueRecord);
    }
  }
  if (propRecord.getUsedPayloadBytes() > 0) {
    return;
  }
 else {
    unlinkPropertyRecord(propRecord,nodeRecord);
  }
}
