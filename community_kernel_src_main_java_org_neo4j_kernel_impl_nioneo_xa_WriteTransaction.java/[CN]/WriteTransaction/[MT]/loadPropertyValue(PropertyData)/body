{
  Pair<PropertyRecord,PropertyRecord> propertyChange=propertyRecords.get(propertyData.getId());
  if (propertyChange == null) {
    PropertyRecord before=getPropertyStore().getRecord(propertyData.getId());
    propertyChange=Pair.of(before,before.clone());
  }
  PropertyRecord propertyRecord=propertyChange.other();
  PropertyBlock block=propertyRecord.getPropertyBlock(propertyData.getIndex());
  if (block == null) {
    throw new IllegalStateException("Property with index[" + propertyData.getIndex() + "] is not present in property["+ propertyData.getId()+ "]");
  }
  if (block.isLight()) {
    getPropertyStore().makeHeavy(block);
  }
  return block.getType().getValue(block,getPropertyStore());
}
