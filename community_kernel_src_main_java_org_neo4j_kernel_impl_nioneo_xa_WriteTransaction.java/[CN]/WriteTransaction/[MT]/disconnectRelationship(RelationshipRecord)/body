{
  if (rel.getFirstPrevRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getFirstPrevRel());
    getWriteLock(lockableRel);
    RelationshipRecord prevRel=getRelationshipRecord(rel.getFirstPrevRel());
    if (prevRel == null) {
      prevRel=getRelationshipStore().getRecord(rel.getFirstPrevRel());
      addRelationshipRecord(prevRel);
    }
    boolean changed=false;
    if (prevRel.getFirstNode() == rel.getFirstNode()) {
      prevRel.setFirstNextRel(rel.getFirstNextRel());
      changed=true;
    }
    if (prevRel.getSecondNode() == rel.getFirstNode()) {
      prevRel.setSecondNextRel(rel.getFirstNextRel());
      changed=true;
    }
    if (!changed) {
      throw new InvalidRecordException(prevRel + " don't match " + rel);
    }
  }
  if (rel.getFirstNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getFirstNextRel());
    getWriteLock(lockableRel);
    RelationshipRecord nextRel=getRelationshipRecord(rel.getFirstNextRel());
    if (nextRel == null) {
      nextRel=getRelationshipStore().getRecord(rel.getFirstNextRel());
      addRelationshipRecord(nextRel);
    }
    boolean changed=false;
    if (nextRel.getFirstNode() == rel.getFirstNode()) {
      nextRel.setFirstPrevRel(rel.getFirstPrevRel());
      changed=true;
    }
    if (nextRel.getSecondNode() == rel.getFirstNode()) {
      nextRel.setSecondPrevRel(rel.getFirstPrevRel());
      changed=true;
    }
    if (!changed) {
      throw new InvalidRecordException(nextRel + " don't match " + rel);
    }
  }
  if (rel.getSecondPrevRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getSecondPrevRel());
    getWriteLock(lockableRel);
    RelationshipRecord prevRel=getRelationshipRecord(rel.getSecondPrevRel());
    if (prevRel == null) {
      prevRel=getRelationshipStore().getRecord(rel.getSecondPrevRel());
      addRelationshipRecord(prevRel);
    }
    boolean changed=false;
    if (prevRel.getFirstNode() == rel.getSecondNode()) {
      prevRel.setFirstNextRel(rel.getSecondNextRel());
      changed=true;
    }
    if (prevRel.getSecondNode() == rel.getSecondNode()) {
      prevRel.setSecondNextRel(rel.getSecondNextRel());
      changed=true;
    }
    if (!changed) {
      throw new InvalidRecordException(prevRel + " don't match " + rel);
    }
  }
  if (rel.getSecondNextRel() != Record.NO_NEXT_RELATIONSHIP.intValue()) {
    Relationship lockableRel=new LockableRelationship(rel.getSecondNextRel());
    getWriteLock(lockableRel);
    RelationshipRecord nextRel=getRelationshipRecord(rel.getSecondNextRel());
    if (nextRel == null) {
      nextRel=getRelationshipStore().getRecord(rel.getSecondNextRel());
      addRelationshipRecord(nextRel);
    }
    boolean changed=false;
    if (nextRel.getFirstNode() == rel.getSecondNode()) {
      nextRel.setFirstPrevRel(rel.getSecondPrevRel());
      changed=true;
    }
    if (nextRel.getSecondNode() == rel.getSecondNode()) {
      nextRel.setSecondPrevRel(rel.getSecondPrevRel());
      changed=true;
    }
    if (!changed) {
      throw new InvalidRecordException(nextRel + " don't match " + rel);
    }
  }
}
