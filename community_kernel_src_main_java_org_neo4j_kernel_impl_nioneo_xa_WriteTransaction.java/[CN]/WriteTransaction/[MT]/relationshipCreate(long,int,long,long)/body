{
  NodeRecord firstNode=getOrLoadNodeRecord(firstNodeId);
  if (!firstNode.inUse()) {
    throw new IllegalStateException("First node[" + firstNodeId + "] is deleted and cannot be used to create a relationship");
  }
  NodeRecord secondNode=getOrLoadNodeRecord(secondNodeId);
  if (!secondNode.inUse()) {
    throw new IllegalStateException("Second node[" + secondNodeId + "] is deleted and cannot be used to create a relationship");
  }
  RelationshipRecord record=new RelationshipRecord(id,firstNodeId,secondNodeId,type);
  record.setInUse(true);
  record.setCreated();
  addRelationshipRecord(record);
  connectRelationship(firstNode,secondNode,record);
}
