{
  DirectoryFactory.InMemoryDirectoryFactory directoryFactory=new DirectoryFactory.InMemoryDirectoryFactory();
  File indexDirectory=new File("whatever");
  final LuceneSchemaIndexProvider.DocumentLogic documentLogic=new LuceneSchemaIndexProvider.DocumentLogic();
  UniquenessEnforcingLuceneIndexPopulator populator=new UniquenessEnforcingLuceneIndexPopulator(100,documentLogic,standard(),directoryFactory,indexDirectory);
  populator.create();
  populator.add(1,"value1");
  populator.add(2,"value2");
  populator.close(true);
  final IndexSearcher searcher=new SearcherManager(standard().create(directoryFactory.open(indexDirectory)),true,new SearcherFactory()).acquire();
  ArrayList<Long> nodeIds=new ArrayList<Long>();
  searcher.search(documentLogic.newQuery("value1"),new AllNodesCollector(documentLogic,nodeIds));
  assertEquals(asList(1l),nodeIds);
}
