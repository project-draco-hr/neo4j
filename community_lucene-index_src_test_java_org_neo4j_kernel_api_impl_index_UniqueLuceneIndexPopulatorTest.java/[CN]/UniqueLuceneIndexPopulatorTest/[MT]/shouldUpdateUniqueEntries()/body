{
  DirectoryFactory.InMemoryDirectoryFactory directoryFactory=new DirectoryFactory.InMemoryDirectoryFactory();
  File indexDirectory=new File("whatever");
  final LuceneDocumentStructure documentStructure=new LuceneDocumentStructure();
  UniqueLuceneIndexPopulator populator=new UniqueLuceneIndexPopulator(100,documentStructure,standard(),new IndexWriterStatus(),directoryFactory,indexDirectory);
  populator.create();
  populator.add(1,"value1");
  populator.add(2,"value2");
  populator.update(asList(NodePropertyUpdate.add(3,100,"value3",new long[]{1000})));
  populator.close(true);
  List<Long> nodeIds=getAllNodes(documentStructure,directoryFactory.open(indexDirectory),"value3");
  assertEquals(asList(3l),nodeIds);
}
