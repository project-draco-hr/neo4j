{
  try {
    for (    Triplet<String,Long,TxExtractor> tx : IteratorUtil.asIterable(response.transactions())) {
      String resourceName=tx.first();
      XaDataSource dataSource=getXaDataSource(resourceName);
      txHandler.accept(tx,dataSource);
      ReadableByteChannel txStream=tx.third().extract();
      try {
        dataSource.applyCommittedTransaction(tx.second(),txStream);
      }
  finally {
        txStream.close();
      }
    }
    txHandler.done();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    response.close();
  }
  return response.response();
}
