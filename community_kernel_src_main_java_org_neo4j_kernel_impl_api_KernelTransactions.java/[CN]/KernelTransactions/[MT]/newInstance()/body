{
  assertDatabaseIsRunning();
  Locks.Client locksClient=locks.newClient();
  LegacyIndexTransactionState legacyIndexTransactionState=new LegacyIndexTransactionStateImpl(indexConfigStore,legacyIndexProviderLookup);
  long lastTransactionIdWhenStarted=((MetaDataStore)storageEngine.metaDataStore()).getLastCommittedTransactionId();
  KernelTransactionImplementation tx=new KernelTransactionImplementation(statementOperations,schemaWriteGuard,locksClient,hooks,constraintIndexCreator,procedures,transactionHeaderInformationFactory,transactionCommitProcess,transactionMonitor,legacyIndexTransactionState,this,Clock.SYSTEM_CLOCK,tracers.transactionTracer,storageEngine,lastTransactionIdWhenStarted);
  allTransactions.add(tx);
  return tx;
}
