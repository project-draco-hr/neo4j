{
  DatabaseRegistry registry=newRegistryWithEmbeddedProvider();
  final AtomicReference<Database> dbProvidedToVisitor=new AtomicReference<>();
  registry.create(new DatabaseDefinition("northwind",EMBEDDED,DatabaseHosting.Mode.EXTERNAL,new Config()));
  registry.visit("northwind",new DatabaseRegistry.Visitor(){
    @Override public void visit(    Database db){
      dbProvidedToVisitor.set(db);
    }
  }
);
  assertThat(dbProvidedToVisitor.get(),equalTo(northwind));
  verify(northwind).init();
  verify(northwind).start();
}
