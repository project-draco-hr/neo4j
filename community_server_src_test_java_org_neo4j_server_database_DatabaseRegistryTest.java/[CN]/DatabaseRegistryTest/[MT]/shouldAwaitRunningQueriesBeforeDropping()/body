{
  final CountDownLatch visitingDbLatch=new CountDownLatch(1);
  final CountDownLatch doneVisitingLatch=new CountDownLatch(1);
  threadOne.execute(visitAndAwaitLatch(NORTH_WIND,registry,visitingDbLatch,doneVisitingLatch));
  visitingDbLatch.await();
  Future<Object> threadTwoCompletion=threadTwo.execute(drop(NORTH_WIND,registry));
  Thread.sleep(100);
  verify(database,never()).stop();
  verify(database,never()).shutdown();
  doneVisitingLatch.countDown();
  threadTwoCompletion.get(10,TimeUnit.SECONDS);
  verify(database).stop();
  verify(database).shutdown();
}
