{
  DatabaseRegistry registry=newRegistryWithEmbeddedProvider();
  registry.create(new DatabaseDefinition("northwind",EMBEDDED,DatabaseHosting.Mode.EXTERNAL,new Config()));
  CountDownLatch visitingDbLatch=new CountDownLatch(1);
  threadOne.execute(visitAndAwaitLatch("northwind",registry,visitingDbLatch));
  Future<Object> threadTwoCompletion=threadTwo.execute(drop("northwind",registry));
  Thread.sleep(100);
  verify(northwind,never()).stop();
  verify(northwind,never()).shutdown();
  visitingDbLatch.countDown();
  threadTwoCompletion.get(10,TimeUnit.SECONDS);
  verify(northwind).stop();
  verify(northwind).shutdown();
}
