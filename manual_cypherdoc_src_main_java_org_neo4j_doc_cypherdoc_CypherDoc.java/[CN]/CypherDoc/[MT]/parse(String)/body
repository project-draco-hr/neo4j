{
  List<Block> blocks=parseBlocks(input);
  StringBuilder output=new StringBuilder(4096);
  GraphDatabaseService database=new TestGraphDatabaseFactory().newImpermanentDatabase();
  Transaction transaction=database.beginTx();
  try {
    ExecutionEngine engine=new ExecutionEngine(database);
    State state=new State(engine,database);
    removeReferenceNode(database);
    for (    Block block : blocks) {
      output.append(block.process(state)).append(EOL).append(EOL);
    }
    return output.toString();
  }
  finally {
    transaction.finish();
  }
}
