{
  List<Block> blocks=parseBlocks(input);
  StringBuilder output=new StringBuilder(4096);
  GraphDatabaseService database=new TestGraphDatabaseFactory().newImpermanentDatabase();
  ExecutionEngine engine=new ExecutionEngine(database);
  State state=new State(engine,database);
  boolean hasConsole=false;
  for (  Block block : blocks) {
    if (block.type == BlockType.CONSOLE) {
      hasConsole=true;
    }
    output.append(block.process(state)).append(EOL).append(EOL);
  }
  if (!hasConsole) {
    output.append(BlockType.CONSOLE.process(null,state));
  }
  return output.toString();
}
