{
  StringBuilder output=new StringBuilder(4096);
  boolean hasConsole=false;
  for (  Block block : blocks) {
    if (block.type == BlockType.CONSOLE) {
      hasConsole=true;
    }
    output.append(block.process(state)).append(EOL).append(EOL);
  }
  if (!hasConsole) {
    output.append(BlockType.CONSOLE.process(null,state));
  }
  return output.toString();
}
