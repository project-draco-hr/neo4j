{
  cursor.assertNotInUse();
  PageLock lock=getLockType(pf_flags);
  for (; ; ) {
    Object pageRef=filePages.get(pageId);
    if (pageRef == null) {
      filePages.putIfAbsent(pageId,NULL);
    }
 else     if (pageRef == NULL) {
      CountDownLatch latch=new CountDownLatch(1);
      if (filePages.replace(pageId,pageRef,latch)) {
        PinnablePage page=table.load(swapper,pageId,pf_flags);
        cursor.reset(page,lock);
        filePages.put(pageId,page);
        latch.countDown();
        monitor.pinned(lock == PageLock.EXCLUSIVE,pageId,swapper);
        return;
      }
    }
 else     if (pageRef instanceof CountDownLatch) {
      try {
        ((CountDownLatch)pageRef).await();
      }
 catch (      InterruptedException e) {
        Thread.interrupted();
        throw new IOException("Interrupted while waiting for page load.",e);
      }
    }
 else {
      PinnablePage page=(PinnablePage)pageRef;
      if (page.pin(swapper,pageId,pf_flags)) {
        cursor.reset(page,lock);
        monitor.pinned(lock == PageLock.EXCLUSIVE,pageId,swapper);
        return;
      }
      filePages.replace(pageId,page,NULL);
    }
  }
}
