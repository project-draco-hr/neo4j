{
  GraphDatabaseAPI database=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(directory).setConfig(configuration(false)).newGraphDatabase();
  try {
    TransactionRepresentationCommitProcess commitProcess=database.getDependencyResolver().resolveDependency(TransactionRepresentationCommitProcess.class);
    TransactionIdStore transactionIdStore=database.getDependencyResolver().resolveDependency(TransactionIdStore.class);
    commitProcess.commit(transaction.representation(idGenerator(),masterId(),myId(),transactionIdStore.getLastCommittingTransactionId()));
  }
  finally {
    database.shutdown();
  }
}
