{
  String[] args=new String[]{"-from","single://localhost","-to","my_backup"};
  BackupService service=mock(BackupService.class);
  when(service.directoryContainsDb(anyString())).thenReturn(true);
  StoreId expected=new StoreId(42,87,117);
  StoreId encountered=new StoreId(287,345,756);
  when(service.doIncrementalBackup(eq("localhost"),eq(BackupServer.DEFAULT_PORT),eq("my_backup"),eq(true))).thenThrow(new MismatchingStoreIdException(expected,encountered));
  PrintStream systemOut=mock(PrintStream.class);
  try {
    new BackupTool(service,systemOut).run(args);
    fail("should exit abnormally");
  }
 catch (  BackupTool.ToolFailureException e) {
    verify(systemOut).println("Performing incremental backup from 'single://localhost'");
    verify(systemOut).println("Backup failed.");
    verifyNoMoreInteractions(systemOut);
    assertEquals(format(MISMATCHED_STORE_ID,expected,encountered),e.getMessage());
  }
}
