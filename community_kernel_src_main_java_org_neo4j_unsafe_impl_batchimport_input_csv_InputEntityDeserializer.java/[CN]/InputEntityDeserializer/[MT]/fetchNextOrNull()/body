{
  try {
    Header.Entry[] entries=header.entries();
    for (int i=0; i < entries.length; i++) {
      if (!data.seek(mark,delimiter)) {
        if (i > 0) {
          throw new UnexpectedEndOfInputException("Near " + mark);
        }
        return null;
      }
      Header.Entry entry=entries[i];
      Object value=data.extract(mark,entry.extractor()).value();
      boolean handled=true;
switch (entry.type()) {
case PROPERTY:
        ensurePropertiesArrayCapacity(propertiesCursor + 2);
      properties[propertiesCursor++]=entry.name();
    properties[propertiesCursor++]=value;
  break;
case IGNORE:
break;
default :
handled=false;
break;
}
if (!handled) {
handleValue(entry,value);
}
if (mark.isEndOfLine()) {
break;
}
}
ENTITY entity=convertToInputEntity(properties());
while (!mark.isEndOfLine()) {
data.seek(mark,delimiter);
}
return decorator.apply(entity);
}
 catch (IOException e) {
throw new InputException("Unable to read more data from input stream",e);
}
 finally {
propertiesCursor=0;
}
}
