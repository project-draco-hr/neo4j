{
  if (!startIsOk) {
    return;
  }
  boolean useNewCache=true;
  if (params.containsKey("use_old_cache") && params.get("use_old_cache").equals("true")) {
    useNewCache=false;
  }
  nodeManager=new NodeManager(cacheManager,lockManager,lockReleaser,transactionManager,persistenceManager,idGenerator,useNewCache);
  RelationshipTypeData relTypes[]=null;
  PropertyIndexData propertyIndexes[]=null;
  try {
    transactionManager.begin();
    relTypes=persistenceManager.loadAllRelationshipTypes();
    propertyIndexes=persistenceManager.loadPropertyIndexes(INDEX_COUNT);
    transactionManager.commit();
  }
 catch (  Exception e) {
    e.printStackTrace();
    try {
      transactionManager.rollback();
    }
 catch (    Exception ee) {
      ee.printStackTrace();
      log.severe("Unable to rollback tx");
    }
    throw new RuntimeException("Unable to load all relationships",e);
  }
  nodeManager.addRawRelationshipTypes(relTypes);
  nodeManager.addPropertyIndexes(propertyIndexes);
  if (propertyIndexes.length < INDEX_COUNT) {
    nodeManager.setHasAllpropertyIndexes(true);
  }
  nodeManager.start(params);
  startIsOk=false;
}
