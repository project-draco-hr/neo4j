{
  verifyHacks();
  verifyCachePageSizeIsPowerOfTwo(cachePageSize);
  this.pageCacheId=pageCacheIdCounter.incrementAndGet();
  this.swapperFactory=swapperFactory;
  this.cachePageSize=cachePageSize;
  this.keepFree=Math.min(pagesToKeepFree,maxPages / 2);
  this.cursorPool=new CursorPool();
  this.tracer=tracer;
  this.pages=new MuninnPage[maxPages];
  this.printExceptionsOnClose=true;
  MemoryReleaser memoryReleaser=new MemoryReleaser(maxPages);
  Object pageList=null;
  int pageIndex=maxPages;
  while (pageIndex-- > 0) {
    MuninnPage page=new MuninnPage(cachePageSize,memoryReleaser);
    pages[pageIndex]=page;
    if (pageList == null) {
      FreePage freePage=new FreePage(page);
      freePage.setNext(null);
      pageList=freePage;
    }
 else     if (pageList instanceof FreePage && ((FreePage)pageList).count < keepFree) {
      FreePage freePage=new FreePage(page);
      freePage.setNext((FreePage)pageList);
      pageList=freePage;
    }
 else {
      page.nextFree=pageList;
      pageList=page;
    }
  }
  UnsafeUtil.putObjectVolatile(this,freelistOffset,pageList);
}
