{
  lastFlushed=lastApplied=lastFlushedStorage.getInitialState();
  log.info(format("Restoring last applied index to %d",lastApplied));
  sessionState=sessionStorage.getInitialState();
  long lastPossiblyApplying=max(coreStateMachines.getLastAppliedIndex(),sessionState.logIndex());
  if (lastApplied > lastPossiblyApplying) {
    throw new IllegalStateException(format("lastApplied: %d, lastPossiblyApplying: %d, sessionIndex:%d",lastApplied,lastPossiblyApplying,sessionState.logIndex()));
  }
  submitApplyJob(lastPossiblyApplying);
  applier.sync(false);
}
