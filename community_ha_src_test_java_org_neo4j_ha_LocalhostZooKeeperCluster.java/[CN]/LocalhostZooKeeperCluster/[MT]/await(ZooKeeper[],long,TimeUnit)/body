{
  timeout=System.currentTimeMillis() + unit.toMillis(timeout);
  do {
    ClusterManager cm=null;
    try {
      cm=new ClusterManager(getConnectionString());
      cm.waitForSyncConnected();
      break;
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
 finally {
      if (cm != null) {
        try {
          cm.shutdown();
        }
 catch (        Throwable t) {
          t.printStackTrace();
        }
      }
    }
    if (System.currentTimeMillis() > timeout) {
      throw new TimeoutException("waiting for ZooKeeper cluster to start");
    }
    try {
      Thread.sleep(2000);
    }
 catch (    InterruptedException e) {
      Thread.interrupted();
    }
  }
 while (true);
}
