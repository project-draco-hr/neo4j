{
  Status reason=ktx.getReasonIfTerminated();
  if (reason == null) {
    if (ktx.isOpen()) {
      try {
        guard.check((KernelTransactionImplementation)ktx);
      }
 catch (      GuardException e) {
        throw new TransactionGuardException(e.status(),"Transaction guard check failed",e);
      }
    }
  }
 else {
    throw new TransactionTerminatedException(reason);
  }
}
