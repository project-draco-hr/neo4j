{
  assertFalse(indexExists(DynamicLabel.label("User")));
  try (Transaction tx=db.beginTx()){
    Label label=DynamicLabel.label("User");
    for (int id=0; id < 100000; id++) {
      Node userNode=db.createNode(label);
      userNode.setProperty("username","user" + id + "@neo4j.org");
    }
    tx.success();
  }
   IndexDefinition indexDefinition;
  try (Transaction tx=db.beginTx()){
    Schema schema=db.schema();
    indexDefinition=schema.indexFor(DynamicLabel.label("User")).on("username").create();
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    Schema schema=db.schema();
    Schema.IndexState state;
    IndexPopulationProgress progress;
    do {
      state=schema.getIndexState(indexDefinition);
      progress=schema.getIndexPopulationProgress(indexDefinition);
      assertTrue(progress.getCompletedPercentage() >= 0);
      assertTrue(progress.getCompletedPercentage() <= 100);
      Thread.sleep(10);
    }
 while (state == Schema.IndexState.POPULATING);
    assertTrue(state == Schema.IndexState.ONLINE);
    assertEquals(100.0f,progress.getCompletedPercentage(),0.0f);
  }
 }
