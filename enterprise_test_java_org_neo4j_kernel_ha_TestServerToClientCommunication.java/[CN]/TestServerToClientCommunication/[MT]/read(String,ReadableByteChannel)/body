{
  ByteBuffer buffer=ByteBuffer.allocate(512);
  try {
    int size=data.read(buffer);
    if (size < 0) {
      fail("End of stream when reading " + message);
      return null;
    }
    byte[] result=new byte[size];
    buffer.flip();
    buffer.get(result);
    return result;
  }
 catch (  IOException e) {
    e.printStackTrace();
    fail("IOException when reading stream while reading " + message);
    return null;
  }
}
