{
  NeoStoreUtil util=new NeoStoreUtil(store,fileSystem);
  LifeSupport life=new LifeSupport();
  DeadSimpleTransactionIdStore transactionIdStore=new DeadSimpleTransactionIdStore(util.getLastCommittedTx(),0);
  TransactionMetadataCache positionCache=new TransactionMetadataCache(10,10);
  PhysicalLogFiles logFiles=new PhysicalLogFiles(store,PhysicalLogFile.DEFAULT_NAME,fileSystem);
  LogFile logFile=life.add(new PhysicalLogFile(fileSystem,logFiles,1000,transactionIdStore,new DeadSimpleLogVersionRepository(util.getLogVersion()),mock(PhysicalLogFile.Monitor.class),positionCache));
  life.start();
  try {
    PhysicalLogicalTransactionStore transactionStore=new PhysicalLogicalTransactionStore(logFile,LogRotation.NO_ROTATION,positionCache,transactionIdStore,IdOrderingQueue.BYPASS,mock(KernelHealth.class));
    life.add(transactionStore);
    TransactionAppender appender=transactionStore.getAppender();
    appender.append(singleNodeTransaction(),LogAppendEvent.NULL);
  }
  finally {
    life.shutdown();
  }
}
