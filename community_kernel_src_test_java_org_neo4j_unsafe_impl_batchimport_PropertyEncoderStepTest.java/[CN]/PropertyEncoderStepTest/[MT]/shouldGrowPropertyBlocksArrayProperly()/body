{
  StageControl control=mock(StageControl.class);
  BatchingPropertyKeyTokenRepository tokens=new BatchingPropertyKeyTokenRepository(neoStores.getPropertyKeyTokenStore());
  Step<Batch<InputNode,NodeRecord>> step=new PropertyEncoderStep<>(control,DEFAULT,tokens,neoStores.getPropertyStore());
  @SuppressWarnings("rawtypes") Step downstream=mock(Step.class);
  step.setDownstream(downstream);
  step.start(0);
  step.receive(0,smallbatch());
  step.endOfUpstream();
  awaitCompleted(step,control);
  verify(downstream).receive(anyLong(),any());
  verifyNoMoreInteractions(control);
}
