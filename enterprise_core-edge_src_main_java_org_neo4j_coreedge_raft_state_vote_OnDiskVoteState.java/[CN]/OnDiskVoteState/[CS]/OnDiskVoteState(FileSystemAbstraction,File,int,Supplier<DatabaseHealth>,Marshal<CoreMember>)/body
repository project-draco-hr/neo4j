{
  File fileA=new File(storeDir,FILENAME + "A");
  File fileB=new File(storeDir,FILENAME + "B");
  workingBuffer=ByteBuffer.allocate(InMemoryVoteState.InMemoryVoteStateStateMarshal.NUMBER_OF_VOTES_PER_WRITE);
  IdAllocationStateRecoveryManager recoveryManager=new IdAllocationStateRecoveryManager(fileSystemAbstraction);
  final StateRecoveryManager.RecoveryStatus recoveryStatus=recoveryManager.recover(fileA,fileB);
  this.inMemoryVoteState=readLastEntryFrom(fileSystemAbstraction,recoveryStatus.previouslyActive());
  this.marshal=new InMemoryVoteState.InMemoryVoteStateStateMarshal<>(memberMarshal);
  this.statePersister=new StatePersister<>(fileA,fileB,fileSystemAbstraction,numberOfEntriesBeforeRotation,workingBuffer,marshal,recoveryStatus.previouslyInactive(),databaseHealthSupplier);
}
