{
  String storeDirectory=getStoreDir("testConfig");
  GraphDatabaseService graphDb=new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(storeDirectory).setConfig(GraphDatabaseSettings.node_keys_indexable,"nodeProp1,nodeProp2").setConfig(GraphDatabaseSettings.relationship_keys_indexable,"relProp1,relProp2").setConfig(GraphDatabaseSettings.node_auto_indexing,"true").setConfig(GraphDatabaseSettings.relationship_auto_indexing,"true").newGraphDatabase();
  Transaction tx=graphDb.beginTx();
  Node node1=null, node2=null;
  Relationship rel=null;
  try {
    node1=graphDb.createNode();
    node2=graphDb.createNode();
    rel=node1.createRelationshipTo(node2,DynamicRelationshipType.withName("DYNAMIC"));
    node1.setProperty("nodeProp1","nodeProp1Value");
    node2.setProperty("nodeProp2","nodeProp2Value");
    node1.setProperty("nonIndexed","nodeProp2NonIndexedValue");
    rel.setProperty("relProp1","relProp1Value");
    rel.setProperty("relPropNonIndexed","relPropValueNonIndexed");
    tx.success();
  }
 catch (  Exception e) {
    tx.failure();
  }
 finally {
    tx.finish();
  }
  Transaction transaction=graphDb.beginTx();
  ReadableIndex<Node> autoNodeIndex=graphDb.index().getNodeAutoIndexer().getAutoIndex();
  assertEquals(node1,autoNodeIndex.get("nodeProp1","nodeProp1Value").getSingle());
  assertEquals(node2,autoNodeIndex.get("nodeProp2","nodeProp2Value").getSingle());
  assertFalse(autoNodeIndex.get("nonIndexed","nodeProp2NonIndexedValue").hasNext());
  ReadableIndex<Relationship> autoRelIndex=graphDb.index().getRelationshipAutoIndexer().getAutoIndex();
  assertEquals(rel,autoRelIndex.get("relProp1","relProp1Value").getSingle());
  assertFalse(autoRelIndex.get("relPropNonIndexed","relPropValueNonIndexed").hasNext());
  transaction.finish();
  graphDb.shutdown();
}
