{
  LogPosition logPosition=channel.getCurrentPosition();
  logEntryWriter.writeStartEntry(transaction.getMasterId(),transaction.getAuthorId(),transaction.getTimeWritten(),transaction.getLatestCommittedTxWhenStarted(),transaction.additionalHeader());
  logEntryWriter.serialize(transaction);
  long transactionId=txIdGenerator.generate(transaction);
  logEntryWriter.writeCommitEntry(transaction.getTimeWritten(),transactionId);
  positionCache.putStartPosition(transactionId,logPosition);
  channel.force();
  return FutureAdapter.present(transactionId);
}
