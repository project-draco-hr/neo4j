{
  LogPosition logPosition=channel.getCurrentPosition();
  logEntryWriter.writeStartEntry(transaction.getMasterId(),transaction.getAuthorId(),transaction.getTimeWritten(),transaction.getLatestCommittedTxWhenStarted(),transaction.additionalHeader());
  logEntryWriter.serialize(transaction);
  long transactionId=txIdGenerator.generate(transaction);
  logEntryWriter.writeCommitEntry(transaction.getTimeWritten(),transactionId);
  transactionMetadataCache.cacheTransactionMetadata(transactionId,logPosition,transaction.getMasterId(),transaction.getAuthorId(),LogEntry.Start.checksum(transaction.additionalHeader(),transaction.getMasterId(),transaction.getAuthorId()));
  channel.force();
  return FutureAdapter.present(transactionId);
}
