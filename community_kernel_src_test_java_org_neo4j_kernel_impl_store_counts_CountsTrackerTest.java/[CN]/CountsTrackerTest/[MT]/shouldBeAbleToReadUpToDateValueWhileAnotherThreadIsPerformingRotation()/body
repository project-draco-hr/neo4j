{
  CountsTracker.createEmptyCountsStore(pageCache(),storeFile(),VERSION);
  CountsOracle oracle=oracle();
  int newTxId=2;
  try (CountsTracker tracker=new CountsTracker(fs.get(),pageCache(),storeFile(),BASE_TX_ID)){
    oracle.update(tracker);
    tracker.rotate(newTxId);
  }
   final CountsOracle delta=new CountsOracle();
{
    CountsOracle.Node n1=delta.node(1);
    CountsOracle.Node n2=delta.node(1,4);
    delta.relationship(n1,1,n2);
    delta.relationship(n2,2,n1);
  }
  delta.update(oracle);
  Barrier.Control barrier=new Barrier.Control();
  try (CountsTracker tracker=new InstrumentedCountsTracker(fs.get(),pageCache(),storeFile(),newTxId,barrier)){
    Future<Void> task=threading.execute(new Function<CountsTracker,Void>(){
      @Override public Void apply(      CountsTracker tracker){
        try {
          delta.update(tracker);
          tracker.rotate(2);
        }
 catch (        IOException e) {
          throw new AssertionError(e);
        }
        return null;
      }
    }
,tracker);
    barrier.await();
    oracle.verify(tracker);
    barrier.release();
    task.get();
    oracle.verify(tracker);
  }
 }
