{
  final AtomicReference<ClusterConfiguration> config=new AtomicReference<ClusterConfiguration>();
  cluster.addClusterListener(new ClusterListener(){
    @Override public void enteredCluster(    ClusterConfiguration clusterConfiguration){
      logger.getLogger().debug(uri + " entered cluster:" + clusterConfiguration.getMemberURIs());
      config.set(new ClusterConfiguration(clusterConfiguration));
      in.add(cluster);
    }
    @Override public void joinedCluster(    InstanceId instanceId,    URI member){
      logger.getLogger().debug(uri + " sees a join from " + instanceId+ " at URI "+ member.toString());
      config.get().joined(instanceId,member);
    }
    @Override public void leftCluster(    InstanceId instanceId){
      logger.getLogger().debug(uri + " sees a leave:" + instanceId);
      config.get().left(instanceId);
    }
    @Override public void leftCluster(){
      out.add(cluster);
      config.set(null);
    }
    @Override public void elected(    String role,    InstanceId instanceId,    URI electedMember){
      logger.getLogger().debug(uri + " sees an election:" + instanceId+ "was elected as "+ role+ " on URI "+ electedMember);
    }
    @Override public void unelected(    String role,    InstanceId instanceId,    URI electedMember){
      logger.getLogger().debug(uri + " sees an unelection:" + instanceId+ "was removed from "+ role+ " on URI "+ electedMember);
    }
  }
);
  return config;
}
