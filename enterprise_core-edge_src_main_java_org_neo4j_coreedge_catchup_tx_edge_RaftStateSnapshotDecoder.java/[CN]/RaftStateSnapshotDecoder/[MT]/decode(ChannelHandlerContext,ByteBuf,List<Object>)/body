{
  if (protocol.isExpecting(NextMessage.RAFT_STATE_SNAPSHOT)) {
    out.add(new RaftStateSnapshot.Marshal().unmarshal(new NetworkReadableClosableByteBuf(msg)));
  }
 else {
    out.add(Unpooled.copiedBuffer(msg));
  }
}
