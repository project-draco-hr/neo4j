{
  try {
    State<Object,MessageType> oldState=(State<Object,MessageType>)state;
    State<?,?> newState=oldState.handle((Object)context,(Message<MessageType>)message,outgoing);
    state=newState;
    StateTransition transition=new StateTransition(oldState,message,newState);
    for (    StateTransitionListener listener : listeners) {
      try {
        listener.stateTransition(transition);
      }
 catch (      Throwable e) {
        logProvider.getLog(listener.getClass()).warn("Listener threw exception",e);
      }
    }
  }
 catch (  Throwable throwable) {
    logProvider.getLog(getClass()).warn("Exception in message handling",throwable);
  }
}
