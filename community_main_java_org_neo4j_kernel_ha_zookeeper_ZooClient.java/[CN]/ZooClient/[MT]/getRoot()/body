{
  String rootPath="/" + storeCreationTime + "_"+ storeId;
  byte[] rootData=null;
  do {
    try {
      rootData=zooKeeper.getData(rootPath,false,null);
      ByteBuffer buf=ByteBuffer.wrap(rootData);
      globalCommittedTx=buf.getInt();
      if (globalCommittedTx < committedTx) {
        throw new IllegalStateException("Global committed tx " + globalCommittedTx + " while machine["+ machineId+ "] @"+ committedTx);
      }
      return rootPath;
    }
 catch (    KeeperException e) {
      if (e.code() != KeeperException.Code.NONODE) {
        throw new ZooKeeperException("Unable to get root node",e);
      }
    }
catch (    InterruptedException e) {
      Thread.interrupted();
      throw new ZooKeeperException("Got interrupted",e);
    }
    try {
      byte data[]=new byte[4];
      ByteBuffer buf=ByteBuffer.wrap(data);
      buf.putInt(committedTx);
      zooKeeper.create(rootPath,data,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
 catch (    KeeperException e) {
      if (e.code() != KeeperException.Code.NODEEXISTS) {
        throw new ZooKeeperException("Unable to create root",e);
      }
    }
catch (    InterruptedException e) {
      Thread.interrupted();
      throw new ZooKeeperException("Got interrupted",e);
    }
  }
 while (rootData == null);
  throw new IllegalStateException();
}
