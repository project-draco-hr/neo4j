{
  String path=rootPath + "/" + HA_SERVERS_CHILD;
  try {
    zooKeeper.create(path,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
 catch (  KeeperException e) {
    if (e.code() != KeeperException.Code.NODEEXISTS) {
      throw e;
    }
  }
  String machinePath=path + "/" + machineId;
  byte[] data=haServerAsData();
  try {
    zooKeeper.create(machinePath,data,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  }
 catch (  KeeperException e) {
    if (e.code() != KeeperException.Code.NODEEXISTS) {
      throw e;
    }
    msgLog.logMessage("HA server info already present, trying again");
    try {
      zooKeeper.delete(machinePath,-1);
    }
 catch (    KeeperException ee) {
      if (ee.code() != KeeperException.Code.NONODE) {
        msgLog.logMessage("Unable to delete " + machinePath,ee);
      }
    }
 finally {
      writeHaServerConfig();
    }
  }
  zooKeeper.setData(machinePath,data,-1);
  msgLog.logMessage("Wrote HA server " + haServer + " to zoo keeper");
}
