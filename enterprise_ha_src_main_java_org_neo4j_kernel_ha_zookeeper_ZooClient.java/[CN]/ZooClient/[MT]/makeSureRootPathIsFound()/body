{
  if (rootPath == null) {
    storeId=getClusterStoreId(zooKeeper,clusterName);
    if (storeId != null) {
      rootPath=asRootPath(storeId);
      if (NeoStoreUtil.storeExists(storeDir)) {
        NeoStoreUtil store=new NeoStoreUtil(storeDir);
        committedTx=store.getLastCommittedTx();
        if (!storeId.equals(store.asStoreId()))         throw new ZooKeeperException("StoreId in database doesn't match that of the ZK cluster");
      }
 else {
        committedTx=1;
      }
    }
 else {
      if (!allowCreateCluster)       throw new RuntimeException("Not allowed to create cluster");
      StoreId storeIdSuggestion=NeoStoreUtil.storeExists(storeDir) ? new NeoStoreUtil(storeDir).asStoreId() : new StoreId();
      storeId=createCluster(storeIdSuggestion);
      makeSureRootPathIsFound();
    }
    masterForCommittedTx=getFirstMasterForTx(committedTx);
  }
}
