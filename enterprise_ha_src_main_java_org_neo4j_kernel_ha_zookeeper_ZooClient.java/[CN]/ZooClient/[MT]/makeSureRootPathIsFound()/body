{
  if (rootPath == null) {
    storeId=ZooKeeperClusterClient.getClusterStoreId(zooKeeper,clusterName);
    if (storeId != null) {
      rootPath=asRootPath(storeId);
      if (NeoStoreUtil.storeExists(getGraphDb().getStoreDir())) {
        NeoStoreUtil store=new NeoStoreUtil(getGraphDb().getStoreDir());
        committedTx=store.getLastCommittedTx();
        if (!storeId.equals(store.asStoreId()))         throw new ZooKeeperException("StoreId in database doesn't match that of the ZK cluster");
      }
 else {
        committedTx=1;
      }
    }
 else {
      if (!allowCreateCluster)       throw new RuntimeException("Not allowed to create cluster");
      StoreId storeIdSuggestion=NeoStoreUtil.storeExists(getGraphDb().getStoreDir()) ? new NeoStoreUtil(getGraphDb().getStoreDir()).asStoreId() : new StoreId();
      storeId=createCluster(storeIdSuggestion);
      makeSureRootPathIsFound();
    }
    masterForCommittedTx=getFirstMasterForTx(committedTx);
  }
}
