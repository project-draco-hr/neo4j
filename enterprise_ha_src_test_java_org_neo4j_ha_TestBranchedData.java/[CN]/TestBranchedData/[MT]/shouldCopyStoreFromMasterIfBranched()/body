{
  File dir=directory.directory();
  ClusterManager clusterManager=life.add(new ClusterManager.Builder(dir).withProvider(clusterOfSize(2)).build());
  ManagedCluster cluster=clusterManager.getDefaultCluster();
  cluster.await(allSeesAllAsAvailable());
  createNode(cluster.getMaster(),"A");
  cluster.sync();
  HighlyAvailableGraphDatabase slave=cluster.getAnySlave();
  String storeDir=slave.getStoreDir();
  RepairKit starter=cluster.shutdown(slave);
  HighlyAvailableGraphDatabase master=cluster.getMaster();
  createNode(master,"B1");
  createNode(master,"C");
  createNodeOffline(storeDir,"B2");
  slave=starter.repair();
  cluster.await(allSeesAllAsAvailable());
  slave.beginTx().close();
}
