{
  if (searcher == null) {
    return null;
  }
  try {
    TopDocs docs=searcher.searchAfter(lastDoc,query,rangesPerPage);
    lastDoc=null;
    if (docs == null || docs.totalHits == 0) {
      searcher=null;
      return null;
    }
    lastDoc=docs.scoreDocs[docs.totalHits - 1];
    long[] rangeMap=new long[docs.totalHits * 2];
    for (int i=0; i < docs.totalHits; i++) {
      Document doc=searcher.doc(docs.scoreDocs[i].doc);
      rangeMap[i * 2]=format.rangeOf(doc);
      rangeMap[i * 2 + 1]=labeledBitmap(doc);
    }
    if (docs.totalHits < rangesPerPage) {
      searcher=null;
    }
    return new LongPageIterator(new BitmapExtractor(format.bitmapFormat(),rangeMap));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
