{
  getMessageLog().logMessage("Starting[" + machineId + "] as master",true);
  EmbeddedGraphDbImpl result=new EmbeddedGraphDbImpl(getStoreDir(),storeId,config,this,CommonFactories.defaultLockManagerFactory(),new MasterIdGeneratorFactory(),CommonFactories.defaultRelationshipTypeCreator(),new MasterTxIdGeneratorFactory(broker),new MasterTxHook(),new ZooKeeperLastCommittedTxIdSetter(broker),CommonFactories.defaultFileSystemAbstraction());
  this.masterServer=(MasterServer)broker.instantiateMasterServer(this);
  logHaInfo("Started as master");
  return result;
}
