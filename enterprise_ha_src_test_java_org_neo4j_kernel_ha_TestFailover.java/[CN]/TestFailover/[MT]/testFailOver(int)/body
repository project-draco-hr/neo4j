{
  ClusterManager clusterManager=new ClusterManager(clusterOfSize(clusterSize),dir.cleanDirectory("failover"),stringMap(ClusterSettings.default_timeout.name(),"1",ClusterSettings.heartbeat_interval.name(),"1",ClusterSettings.heartbeat_timeout.name(),"2"));
  clusterManager.start();
  ClusterManager.ManagedCluster cluster=clusterManager.getDefaultCluster();
  cluster.await(ClusterManager.allSeesAllAsAvailable());
  HighlyAvailableGraphDatabase oldMaster=cluster.getMaster();
  long start=System.nanoTime();
  ClusterManager.RepairKit repairKit=cluster.fail(oldMaster);
  logger.getLogger().warn("Shut down master");
  cluster.await(ClusterManager.masterAvailable(oldMaster));
  long end=System.nanoTime();
  logger.getLogger().warn("Failover took:" + (end - start) / 1000000 + "ms");
  repairKit.repair();
  Thread.sleep(3000);
  clusterManager.safeShutdown();
}
