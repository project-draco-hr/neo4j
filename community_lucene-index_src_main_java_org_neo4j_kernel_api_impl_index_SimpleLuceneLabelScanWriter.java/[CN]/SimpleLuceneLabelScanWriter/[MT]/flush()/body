{
  if (currentRange < 0) {
    return;
  }
  try (PartitionSearcher partitionSearcher=partition.acquireSearcher()){
    IndexSearcher searcher=partitionSearcher.getIndexSearcher();
    Map<Long,Bitmap> fields=readLabelBitMapsInRange(searcher,currentRange);
    updateFields(updates,fields);
    Document document=new Document();
    format.addRangeValuesField(document,currentRange);
    for (    Map.Entry<Long,Bitmap> field : fields.entrySet()) {
      Bitmap value=field.getValue();
      if (value.hasContent()) {
        format.addLabelAndSearchFields(document,field.getKey(),value);
      }
    }
    if (isEmpty(document)) {
      partition.getIndexWriter().deleteDocuments(format.rangeTerm(document));
    }
 else {
      partition.getIndexWriter().updateDocument(format.rangeTerm(document),document);
    }
    updates.clear();
  }
 }
