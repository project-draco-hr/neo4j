{
  Map<Long,AtomicInteger> lockMap=getLockMap(exclusiveLocks,resourceType);
  AtomicInteger preExistingLock=lockMap.get(resourceId);
  if (preExistingLock != null) {
    preExistingLock.incrementAndGet();
  }
 else   if (acquireExclusiveOnMaster(resourceType,resourceId)) {
    if (client.tryExclusiveLock(resourceType,resourceId)) {
      lockMap.put(resourceId,new AtomicInteger(1));
    }
 else {
      throw new LocalDeadlockDetectedException(client,localLockManager,resourceType,resourceId,WRITE);
    }
  }
}
