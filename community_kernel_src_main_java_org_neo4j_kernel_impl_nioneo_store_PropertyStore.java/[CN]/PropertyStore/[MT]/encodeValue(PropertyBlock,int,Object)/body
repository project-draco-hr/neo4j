{
  if (value instanceof String) {
    String string=(String)value;
    if (LongerShortString.encode(keyId,string,block,PropertyType.getPayloadSize()))     return;
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.STRING);
    long stringBlockId=nextStringBlockId();
    bits.or(stringBlockId,0xFFFFFFFFFL);
    block.getValueBlocks()[0]=bits.getLongs()[0];
    int length=string.length();
    char[] chars=new char[length];
    string.getChars(0,length,chars,0);
    Collection<DynamicRecord> valueRecords=allocateStringRecords(stringBlockId,chars);
    for (    DynamicRecord valueRecord : valueRecords) {
      valueRecord.setType(PropertyType.STRING.intValue());
      block.addValueRecord(valueRecord);
    }
  }
 else   if (value instanceof Integer) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.INT).or(((Integer)value).intValue());
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value instanceof Boolean) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.BOOL).or(((Boolean)value).booleanValue() ? 1 : 0,0x1);
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value instanceof Float) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.FLOAT).or(Float.floatToRawIntBits(((Float)value).floatValue()));
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value instanceof Long) {
    Bits bits=bits64WithKeyAndType(keyId,PropertyType.LONG).or(((Long)value).longValue());
    block.setValueBlocks(bits.getLongs());
  }
 else   if (value instanceof Double) {
    Bits bits=bits64WithKeyAndType(keyId,PropertyType.DOUBLE).or(Double.doubleToRawLongBits(((Double)value).doubleValue()));
    block.setValueBlocks(bits.getLongs());
  }
 else   if (value instanceof Byte) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.BYTE).or(((Byte)value).byteValue());
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value instanceof Character) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.CHAR).or(((Character)value).charValue());
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value instanceof Short) {
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.SHORT).or(((Short)value).shortValue());
    block.setSingleBlock(bits.getLongs()[0]);
  }
 else   if (value.getClass().isArray()) {
    if (ShortArray.encode(keyId,value,block,DEFAULT_PAYLOAD_SIZE))     return;
    long arrayBlockId=nextArrayBlockId();
    Bits bits=bits32WithKeyAndType(keyId,PropertyType.ARRAY).or(arrayBlockId,0xFFFFFFFFFL);
    block.setSingleBlock(bits.getLongs()[0]);
    Collection<DynamicRecord> arrayRecords=allocateArrayRecords(arrayBlockId,value);
    for (    DynamicRecord valueRecord : arrayRecords) {
      valueRecord.setType(PropertyType.ARRAY.intValue());
      block.addValueRecord(valueRecord);
    }
  }
 else {
    throw new IllegalArgumentException("Unknown property type on: " + value + ", "+ value.getClass());
  }
}
