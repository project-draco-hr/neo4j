{
  Sessions delegate=mock(Sessions.class);
  ControlledCompletionSession innerSession=new ControlledCompletionSession();
  when(delegate.newSession(anyString(),anyBoolean())).thenReturn(innerSession);
  Monitors monitors=new Monitors();
  CountingSessionMonitor monitor=new CountingSessionMonitor();
  monitors.addMonitorListener(monitor);
  FakeClock clock=new FakeClock();
  MonitoredSessions sessions=new MonitoredSessions(monitors,delegate,clock);
  Session session=sessions.newSession("<test>");
  session.run("hello",null,noOp());
  clock.forward(1337);
  innerSession.callback.started();
  clock.forward(1338);
  innerSession.callback.completed();
  assertEquals(1,monitor.messagesRecieved);
  assertEquals(1337,monitor.queueTime);
  assertEquals(1338,monitor.processingTime);
}
