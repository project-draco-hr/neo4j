{
  idGeneratorFactory=new HaIdGeneratorFactory(masterDelegateInvocationHandler,logging,requestContextFactory);
  highAvailabilityModeSwitcher=new HighAvailabilityModeSwitcher(clusterClient,clusterClient,masterDelegateInvocationHandler,clusterMemberAvailability,memberStateMachine,this,(HaIdGeneratorFactory)idGeneratorFactory,config,logging,updateableSchemaState,kernelExtensions.listFactories(),monitors,requestContextFactory);
  paxosLife.add(highAvailabilityModeSwitcher);
  ((HaIdGeneratorFactory)idGeneratorFactory).switchToMaster();
  return idGeneratorFactory;
}
