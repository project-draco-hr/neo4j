{
  idGeneratorFactory=new HaIdGeneratorFactory(master,logging);
  ScheduledExecutorService scheduledExecutorService=Executors.newSingleThreadScheduledExecutor();
  highAvailabilityModeSwitcher=new HighAvailabilityModeSwitcher(clusterClient,masterDelegateInvocationHandler,clusterMemberAvailability,memberStateMachine,this,(HaIdGeneratorFactory)idGeneratorFactory,config,logging,scheduledExecutorService);
  paxosLife.add(highAvailabilityModeSwitcher);
  if (compatibilityMode) {
    compatibilityLifecycle.add(1,highAvailabilityModeSwitcher);
    life.add(highAvailabilityModeSwitcher);
  }
  ((HaIdGeneratorFactory)idGeneratorFactory).switchToMaster();
  return idGeneratorFactory;
}
