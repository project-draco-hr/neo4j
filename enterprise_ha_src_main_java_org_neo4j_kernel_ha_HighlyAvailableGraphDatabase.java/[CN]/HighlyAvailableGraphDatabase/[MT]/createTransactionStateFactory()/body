{
  return new TransactionStateFactory(logging){
    @Override public TransactionState create(    Transaction tx){
      return new WritableTransactionState(newLockClient(),nodeManager,snapshot(txHook),snapshot(txIdGenerator));
    }
    private Locks.Client newLockClient(){
      try {
        return locks.newClient();
      }
 catch (      TransactionFailureException e) {
        return new NoOpClient();
      }
    }
  }
;
}
