{
  if (value instanceof Collection<?>) {
    Collection<?> collection=(Collection<?>)value;
    Object[] array=null;
    Iterator<?> objects=collection.iterator();
    for (int i=0; objects.hasNext(); i++) {
      Object object=objects.next();
      if (array == null) {
        array=(Object[])Array.newInstance(object.getClass(),collection.size());
      }
      array[i]=object;
    }
    return array;
  }
 else {
    return value;
  }
}
