{
  while (currentNode != null) {
    for (int i=0; i < commonAncestors.size(); i++) {
      Node node=commonAncestors.get(i);
      if (node.getId() == currentNode.getId()) {
        for (int j=0; j < i; j++) {
          commonAncestors.pollFirst();
        }
        return;
      }
    }
    Iterator<Relationship> relIt=currentNode.getRelationships(relationship,direction).iterator();
    if (relIt.hasNext()) {
      Relationship rel=relIt.next();
      if (direction.equals(Direction.INCOMING)) {
        currentNode=rel.getStartNode();
      }
 else {
        currentNode=rel.getEndNode();
      }
    }
 else {
      currentNode=null;
    }
  }
}
