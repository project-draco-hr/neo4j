{
  long highestValueBeforeWrappingAround=3;
  LogFile logFile=mock(LogFile.class);
  when(logFile.getWriter()).thenReturn(new InMemoryLogChannel());
  TransactionMetadataCache cache=new TransactionMetadataCache(10,10);
  TransactionIdStore transactionIdStore=mock(TransactionIdStore.class);
  LimitedCounterFactory counters=new LimitedCounterFactory(highestValueBeforeWrappingAround,0);
  ControlledIdler forceThreadControl=new ControlledIdler();
  BatchingPhysicalTransactionAppender appender=new BatchingPhysicalTransactionAppender(logFile,cache,transactionIdStore,BYPASS,counters,forceThreadControl);
  Counter appendCounter=counters.createdCounters.get(0);
  OtherThreadExecutor<Void> t2=cleanup.add(new OtherThreadExecutor<Void>("T2",null));
  assertForceAfterAppendAwaitsCorrectForceTicket(t2,appender,forceThreadControl,appendCounter);
}
