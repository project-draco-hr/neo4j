{
  life.add(new LifecycleAdapter(){
    @Override public void start() throws IOException {
      storeLayerModule.neoStores().makeStoreOk();
      propertyKeyTokenHolder.setInitialTokens(storeLayerModule.neoStores().getPropertyKeyTokenStore().getTokens(Integer.MAX_VALUE));
      relationshipTypeTokens.setInitialTokens(storeLayerModule.neoStores().getRelationshipTypeTokenStore().getTokens(Integer.MAX_VALUE));
      labelTokens.setInitialTokens(storeLayerModule.neoStores().getLabelTokenStore().getTokens(Integer.MAX_VALUE));
      storeLayerModule.neoStores().rebuildCountStoreIfNeeded();
    }
  }
);
  final StoreFactory storeFactory=new StoreFactory(storeDir,config,idGeneratorFactory,pageCache,fs,logProvider);
  final NeoStores neoStores=storeFactory.openAllNeoStores(true);
  return new NeoStoreModule(){
    @Override public NeoStores neoStores(){
      return neoStores;
    }
  }
;
}
