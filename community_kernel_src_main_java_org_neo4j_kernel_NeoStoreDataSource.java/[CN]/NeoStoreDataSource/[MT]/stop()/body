{
  if (!life.isRunning()) {
    return;
  }
  StoreFlusher storeFlusher=transactionLogModule.storeFlusher();
  CheckPointer checkPointer=transactionLogModule.checkPointing();
  awaitAllTransactionsClosed();
  LogFile logFile=transactionLogModule.logFile();
synchronized (logFile) {
synchronized (logFile.getWriter()) {
      awaitAllTransactionsClosed();
      storeFlusher.forceEverything();
      if (kernelHealth.isHealthy()) {
        try {
          checkPointer.forceCheckPoint();
        }
 catch (        IOException e) {
          throw new UnderlyingStorageException(e);
        }
      }
      life.shutdown();
      neoStoreModule.neoStore().close();
      msgLog.info("NeoStore closed");
    }
  }
}
