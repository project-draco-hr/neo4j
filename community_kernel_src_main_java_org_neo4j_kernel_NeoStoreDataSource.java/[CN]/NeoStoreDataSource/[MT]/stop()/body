{
  if (!life.isRunning()) {
    return;
  }
  LogRotationControl logRotationControl=transactionLogModule.logRotationControl();
  logRotationControl.awaitAllTransactionsClosed();
  LogFile logFile=transactionLogModule.logFile();
synchronized (logFile) {
synchronized (logFile.getWriter()) {
      logRotationControl.awaitAllTransactionsClosed();
      logRotationControl.forceEverything();
      if (kernelHealth.isHealthy()) {
        neoStoreModule.neoStore().incrementAndGetVersion();
      }
      life.shutdown();
      neoStoreModule.neoStore().close();
      msgLog.info("NeoStore closed");
    }
  }
}
