{
  if (!life.isRunning()) {
    return;
  }
  CheckPointer checkPointer=transactionLogModule.checkPointing();
  awaitAllTransactionsClosed();
  LogFile logFile=transactionLogModule.logFile();
  life.stop();
synchronized (logFile) {
    awaitAllTransactionsClosed();
    if (databaseHealth.isHealthy()) {
      try {
        checkPointer.forceCheckPoint(new SimpleTriggerInfo("database shutdown"));
      }
 catch (      IOException e) {
        throw new UnderlyingStorageException(e);
      }
    }
    life.shutdown();
  }
}
