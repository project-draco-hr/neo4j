{
  @SuppressWarnings("resource") MetaDataStore metaDataStore=neoStores.getMetaDataStore();
  @SuppressWarnings("resource") RecoveryVisitor recoveryVisitor=new RecoveryVisitor(metaDataStore,storageEngine,recoveryVisitorMonitor);
  LogEntryReader<ReadableLogChannel> logEntryReader=new VersionAwareLogEntryReader<>();
  final Visitor<LogVersionedStoreChannel,Exception> logFileRecoverer=new LogFileRecoverer(logEntryReader,recoveryVisitor);
  final LatestCheckPointFinder checkPointFinder=new LatestCheckPointFinder(logFiles,fileSystemAbstraction,logEntryReader);
  Recovery.SPI spi=new DefaultRecoverySPI(storeFlusher,neoStores,logFileRecoverer,logFiles,fileSystemAbstraction,metaDataStore,checkPointFinder);
  Recovery recovery=new Recovery(spi,recoveryMonitor);
  life.add(recovery);
  life.add(new LifecycleAdapter(){
    @Override public void init() throws Throwable {
      startupStatistics.setNumberOfRecoveredTransactions(recoveredCount.get());
      recoveredCount.set(0);
    }
  }
);
}
