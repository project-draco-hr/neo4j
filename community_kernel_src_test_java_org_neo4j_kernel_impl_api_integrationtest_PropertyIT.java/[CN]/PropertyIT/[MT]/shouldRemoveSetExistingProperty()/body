{
  dbWithNoCache();
  int propertyKeyId;
  long nodeId;
{
    DataWriteOperations statement=dataWriteOperationsInNewTransaction();
    Node node=db.createNode();
    propertyKeyId=statement.propertyKeyGetOrCreateForName("clown");
    nodeId=node.getId();
    statement.nodeSetProperty(nodeId,stringProperty(propertyKeyId,"bozo"));
    commit();
  }
  DefinedProperty newProperty=stringProperty(propertyKeyId,"ozob");
{
    DataWriteOperations statement=dataWriteOperationsInNewTransaction();
    statement.nodeRemoveProperty(nodeId,propertyKeyId);
    statement.nodeSetProperty(nodeId,newProperty);
    assertThat(statement.nodeGetProperty(nodeId,propertyKeyId),equalTo((Property)newProperty));
    commit();
  }
{
    DataWriteOperations statement=dataWriteOperationsInNewTransaction();
    assertThat(statement.nodeGetProperty(nodeId,propertyKeyId),equalTo((Property)newProperty));
    assertThat(IteratorUtil.asList(statement.nodeGetAllProperties(nodeId)),equalTo(Arrays.asList(newProperty)));
  }
}
