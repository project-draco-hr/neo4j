{
  newTransaction();
  Node node=db.createNode();
  node.setProperty("prop","value");
  assertThat(asSet(statement.listNodePropertyKeys(node.getId())),equalTo(asSet(statement.getPropertyKeyId("prop"))));
  commit();
  newTransaction();
  assertThat(asSet(statement.listNodePropertyKeys(node.getId())),equalTo(asSet(statement.getPropertyKeyId("prop"))));
  commit();
  newTransaction();
  node.removeProperty("prop");
  assertThat(asSet(statement.listNodePropertyKeys(node.getId())),equalTo(Collections.<Long>emptySet()));
  commit();
  newTransaction();
  assertThat(asSet(statement.listNodePropertyKeys(node.getId())),equalTo(Collections.<Long>emptySet()));
  commit();
}
