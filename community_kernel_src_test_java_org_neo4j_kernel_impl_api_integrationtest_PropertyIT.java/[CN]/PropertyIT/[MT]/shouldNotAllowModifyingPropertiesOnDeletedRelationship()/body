{
  int prop1;
  long rel;
{
    DataWriteOperations statement=dataWriteOperationsInNewTransaction();
    prop1=statement.propertyKeyGetOrCreateForName("prop1");
    int type=statement.relationshipTypeGetOrCreateForName("RELATED");
    rel=statement.relationshipCreate(type,statement.nodeCreate(),statement.nodeCreate());
    statement.relationshipSetProperty(rel,Property.stringProperty(prop1,"As"));
    statement.relationshipDelete(rel);
    try {
      statement.relationshipRemoveProperty(rel,prop1);
      fail("Should have failed.");
    }
 catch (    IllegalStateException e) {
      assertThat(e.getMessage(),equalTo("Relationship " + rel + " has been deleted"));
    }
  }
}
