{
  long node;
  int prop;
{
    DataWriteOperations ops=dataWriteOperationsInNewTransaction();
    prop=ops.propertyKeyGetOrCreateForName("foo");
    node=ops.nodeCreate();
    ops.nodeSetProperty(node,property(prop,"bar"));
    commit();
  }
{
    DataWriteOperations ops=dataWriteOperationsInNewTransaction();
    ops.nodeRemoveProperty(node,prop);
    ops.nodeSetProperty(node,property(prop,"bar"));
    ops.nodeRemoveProperty(node,prop);
    ops.nodeRemoveProperty(node,prop);
    commit();
  }
{
    ReadOperations ops=readOperationsInNewTransaction();
    assertThat(ops.nodeGetProperty(node,prop),not(isDefinedProperty()));
  }
}
