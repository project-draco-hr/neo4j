{
  onBatchOfMessagesStarted();
  while (data.readableBytes() > 0) {
    if (isReadingSplitChunk) {
      collectChunk(data,splitChunkRemaining);
    }
 else     if (data.readableBytes() == 1) {
      currentHeader[0]=data.readByte();
    }
 else {
      int chunkSize;
      if (isReadingSplitHeader) {
        currentHeader[1]=data.readByte();
        chunkSize=(currentHeader[0] << 8 | currentHeader[1]) & 0xffff;
      }
 else {
        chunkSize=data.readUnsignedShort();
      }
      if (chunkSize > 0) {
        collectChunk(data,chunkSize);
      }
 else {
        processCollectedMessage(channelContext);
      }
    }
  }
  onBatchOfMessagesDone();
}
