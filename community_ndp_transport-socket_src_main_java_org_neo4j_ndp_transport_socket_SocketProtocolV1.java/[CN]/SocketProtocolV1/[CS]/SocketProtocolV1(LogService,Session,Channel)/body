{
  this.log=logging.getInternalLog(getClass());
  this.session=session;
  this.errorTranslator=new ErrorTranslator(logging);
  this.output=new ChunkedOutput(channel,DEFAULT_BUFFER_SIZE);
  this.input=new ChunkedInput();
  this.packer=new PackStreamMessageFormatV1.Writer(new PackStream.Packer(output),output.messageBoundaryHook());
  this.unpacker=new PackStreamMessageFormatV1.Reader(new PackStream.Unpacker(input));
  this.bridge=new TransportBridge(log).reset(session,packer,new Runnable(){
    @Override public void run(){
      onMessageDone();
    }
  }
);
}
