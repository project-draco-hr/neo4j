{
  this.log=log;
  this.session=session;
  this.output=new ChunkedOutput();
  this.input=new ChunkedInput();
  this.packer=new PackStreamMessageFormatV1.Writer(output,output.messageBoundaryHook());
  this.unpacker=new PackStreamMessageFormatV1.Reader(input);
  this.bridge=new TransportBridge(log).reset(session,packer,new Runnable(){
    @Override public void run(){
      onMessagDone();
    }
  }
);
}
