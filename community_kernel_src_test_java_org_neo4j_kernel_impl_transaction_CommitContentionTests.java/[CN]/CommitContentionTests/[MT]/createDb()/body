{
  GraphDatabaseFactoryState state=new GraphDatabaseFactoryState();
  return new EmbeddedGraphDatabase(storeLocation.absolutePath(),stringMap(),state.databaseDependencies()){
    @Override protected TransactionCounters createTransactionCounters(){
      return new TransactionCounters(){
        public boolean skip;
        @Override public void transactionFinished(        boolean successful){
          super.transactionFinished(successful);
          if (isTheRemoveOrphanedConstraintIndexesOnStartupTransaction()) {
            return;
          }
          if (successful) {
            if (skip) {
              return;
            }
            skip=true;
            signalFirstTransactionStartedPushing();
            waitForSecondTransactionToFinish();
          }
        }
        private boolean isTheRemoveOrphanedConstraintIndexesOnStartupTransaction(){
          for (          StackTraceElement element : Thread.currentThread().getStackTrace()) {
            if (element.getClassName().contains(RemoveOrphanConstraintIndexesOnStartup.class.getSimpleName())) {
              return true;
            }
          }
          return false;
        }
      }
;
    }
  }
;
}
