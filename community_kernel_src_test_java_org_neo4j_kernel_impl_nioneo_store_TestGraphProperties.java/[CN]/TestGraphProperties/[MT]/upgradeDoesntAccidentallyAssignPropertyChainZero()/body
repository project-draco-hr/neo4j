{
  EphemeralFileSystemAbstraction fileSystem=new EphemeralFileSystemAbstraction();
  TestGraphDatabaseFactory factory=new TestGraphDatabaseFactory().setFileSystem(fileSystem);
  String storeDir=new File("test").getAbsolutePath();
  GraphDatabaseAPI db=(GraphDatabaseAPI)factory.newImpermanentDatabase(storeDir);
  Transaction tx=db.beginTx();
  Node node=db.createNode();
  node.setProperty("name","Something");
  tx.success();
  tx.finish();
  db.shutdown();
  removeLastNeoStoreRecord(fileSystem,storeDir);
  db=(GraphDatabaseAPI)factory.newImpermanentDatabase(storeDir);
  PropertyContainer properties=db.getNodeManager().getGraphProperties();
  assertThat(getPropertyKeys(db,properties),isEmpty());
  tx=db.beginTx();
  properties.setProperty("a property","a value");
  tx.success();
  tx.finish();
  db.getNodeManager().clearCache();
  assertThat(properties,inTx(db,hasProperty("a property").withValue("a value")));
  db.shutdown();
  db=(GraphDatabaseAPI)factory.newImpermanentDatabase(storeDir);
  properties=db.getNodeManager().getGraphProperties();
  assertThat(properties,inTx(db,hasProperty("a property").withValue("a value")));
  db.shutdown();
  fileSystem.shutdown();
}
