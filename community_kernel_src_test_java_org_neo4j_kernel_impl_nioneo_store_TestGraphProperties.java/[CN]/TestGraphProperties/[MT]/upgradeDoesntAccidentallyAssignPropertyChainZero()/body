{
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(TargetDirectory.forTest(TestGraphProperties.class).directory("upgrade",true).getAbsolutePath()).newGraphDatabase();
  String storeDir=db.getStoreDir();
  Transaction tx=db.beginTx();
  Node node=db.createNode();
  node.setProperty("name","Something");
  tx.success();
  tx.finish();
  db.shutdown();
  removeLastNeoStoreRecord(storeDir);
  db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(storeDir).newGraphDatabase();
  PropertyContainer properties=db.getNodeManager().getGraphProperties();
  assertFalse(properties.getPropertyKeys().iterator().hasNext());
  tx=db.beginTx();
  properties.setProperty("a property","a value");
  tx.success();
  tx.finish();
  db.getNodeManager().clearCache();
  assertEquals("a value",properties.getProperty("a property"));
  db.shutdown();
  db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(storeDir).newGraphDatabase();
  properties=db.getNodeManager().getGraphProperties();
  assertEquals("a value",properties.getProperty("a property"));
  db.shutdown();
}
