{
  String storeDir=TargetDirectory.forTest(TestGraphProperties.class).directory("nonclean",true).getAbsolutePath();
  Process process=Runtime.getRuntime().exec(new String[]{"java","-cp",System.getProperty("java.class.path"),ProduceUncleanStore.class.getName(),storeDir,"true"});
  assertEquals(0,new ProcessStreamHandler(process,true).waitForResult());
  removeLastNeoStoreRecord(storeDir);
  GraphDatabaseAPI db=(GraphDatabaseAPI)new GraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  PropertyContainer properties=db.getNodeManager().getGraphProperties();
  assertFalse(properties.getPropertyKeys().iterator().hasNext());
  Transaction tx=db.beginTx();
  properties.setProperty("a property","a value");
  tx.success();
  tx.finish();
  db.getNodeManager().clearCache();
  assertEquals("a value",properties.getProperty("a property"));
  db.shutdown();
}
